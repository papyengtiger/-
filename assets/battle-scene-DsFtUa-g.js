var Gd=Object.defineProperty;var Yf=(C,e,t)=>e in C?Gd(C,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):C[e]=t;var c=(C,e)=>Gd(C,"name",{value:e,configurable:!0});var qa=(C,e,t)=>Yf(C,typeof e!="symbol"?e+"":e,t);import{F as ht,C as Ge,B as ue,T as Zt,a as D,b as tt,P as Be,M as Re,g as Wt,r as Ve,G as ce,c as Wd,d as Sr,e as xt,O as le,i as ve,f as Je,h as Gf,j as Wf,k as ns,l as it,S as pe,m as In,n as fs,o as gs,p as ot,q as Kf,s as zf,U as x,t as ah,u as Is,v as Kd,w as je,x as ut,y as os,z as zd,W as jf,A as $f,D as Ut,E as Yt,H as rh,I as Ae,J as ds,K as Xf,L as Xe,N as Oe,Q as Zi,R as gi,V as es,X as mi,Y as us,Z as jd,_ as Zn,$ as Ws,a0 as Kp,a1 as oh,a2 as ei,a3 as qf,a4 as Qf,a5 as ct,a6 as vs,a7 as Zf,a8 as Jf,a9 as eg,aa as Ji,ab as en,ac as zp,ad as tg,ae as Pe,af as Ne,ag as Jn,ah as ls,ai as jp,aj as kt,ak as tn,al as sg,am as Ks,an as Pt,ao as $d,ap as ig,aq as Xd,ar as ng,as as qd,at as ag,au as ni,av as rg,aw as gt,ax as Ke,ay as cs,az as ti,aA as Ot,aB as Qd,aC as Zd,aD as lh,aE as ze,aF as Ha,aG as Si,aH as og,aI as Ya,aJ as sn,aK as hs,aL as Ga,aM as $e,aN as ge,aO as Ht,aP as ye,aQ as P,aR as A,aS as $p,aT as Xi,aU as Xp,aV as St,aW as He,aX as hh,aY as Ai,aZ as F,a_ as xi,a$ as mt,b0 as Jd,b1 as Se,b2 as Os,b3 as lg,b4 as bs,b5 as ms,b6 as hg,b7 as xs,b8 as Cr,b9 as cg,ba as ug,bb as dg,bc as pg,bd as fg,be as Ct,bf as qp,bg as Qp,bh as gg,bi as Wa,bj as mg,bk as Zp,bl as Jp,bm as Oi,bn as ef,bo as ws,bp as jt,bq as yg,br as nn,bs as Qa,bt as Tg,bu as Ri,bv as Za,bw as Ka,bx as tf,by as Ms,bz as Sg,bA as za,bB as ps,bC as Cg,bD as Fe,bE as sf,bF as Er,bG as nf,bH as Eg,bI as bg,bJ as af,bK as Ig,bL as vg,bM as _g,bN as Ag,bO as $n,bP as xg,bQ as Og,bR as wg,bS as Ci,bT as rf,bU as nt,bV as zt,bW as It,bX as Wi,bY as qi,bZ as Gs,b_ as Mg,b$ as Ei,c0 as st,c1 as Bt,c2 as On,c3 as ch,c4 as uh,c5 as of,c6 as Ng,c7 as br,c8 as dh,c9 as ts,ca as Xn,cb as Qs,cc as kg,cd as Pg,ce as ep,cf as pi,cg as wn,ch as Bg,ci as fi,cj as tp,ck as Mn,cl as Lg,cm as Dg,cn as Rg,co as Fi,cp as Fg,cq as Ja,cr as Ug,cs as Ui,ct as sp,cu as Vg,cv as er,cw as Hg,cx as Yg,cy as ip,cz as Gg,cA as lf,cB as Wg,cC as Kg,cD as zg,cE as jg,cF as $g,cG as Xg,cH as qg,cI as np,cJ as hf,cK as Qg,cL as cf,cM as Zg,cN as Jg,cO as em,cP as li,cQ as uf,cR as tm,cS as sm,cT as im,cU as nm,cV as df,cW as am,cX as ap,cY as pf,cZ as ph,c_ as Nn,c$ as rm,d0 as ea,d1 as om,d2 as ks,d3 as zs,d4 as ta,d5 as bi,d6 as ff,d7 as gf,d8 as mf,d9 as yf,da as lm,db as hm,dc as rp,dd as cm,de as um,df as Tf,dg as Sf,dh as dm,di as ke,dj as pm,dk as Ft,dl as fm,dm as gm,dn as fh,dp as mm,dq as ym,dr as Tm,ds as Sm,dt as Cm,du as tr,dv as Ir,dw as Em,dx as bm,dy as Im,dz as Cf,dA as vm,dB as _m,dC as Am,dD as xm,dE as Om,dF as wm,dG as Mm,dH as Nm,dI as km,dJ as sa,dK as Pm,dL as Bm,dM as Lm,dN as Dm,dO as Rm,dP as Ys,dQ as op,dR as Fm,dS as Gt,dT as Ns,dU as Qt,dV as gh,dW as ia,dX as Zs,dY as vr,dZ as Lt,d_ as Ef,d$ as sr,e0 as wt,e1 as rt,e2 as na,e3 as ai,e4 as Jt,e5 as _r,e6 as lp,e7 as Et,e8 as an,e9 as yt,ea as rn,eb as on,ec as Ii,ed as bf,ee as mh,ef as ri,eg as If,eh as aa,ei as Js,ej as ss,ek as $t,el as vf,em as is,en as ja,eo as _f,ep as Nt,eq as Ar,er as Af,es as xf,et as Um,eu as Of,ev as yh,ew as yi,ex as $s,ey as hp,ez as Vm,eA as Hm,eB as Ki,eC as ir,eD as At,eE as Ls,eF as Vi,eG as nr,eH as Ym,eI as hi,eJ as cp,eK as Gm,eL as zi,eM as wf,eN as xr,eO as Wm,eP as _t,eQ as up,eR as Mf,eS as Ds,eT as Km,eU as zm,eV as ar,eW as Nf,eX as jm,eY as $m,eZ as qs,e_ as Xm,e$ as dp,f0 as pp,f1 as Xs,f2 as qm,f3 as Qm,f4 as kn,f5 as Ts,f6 as rr,f7 as ft,f8 as Zm,f9 as Jm,fa as ey,fb as ty,fc as sy,fd as iy,fe as fp,ff as ny,fg as ay,fh as ry,fi as oy,fj as ly,fk as hy,fl as cy,fm as uy,fn as dy,fo as py,fp as fy,fq as gy,fr as my,fs as gp,ft as or,fu as Pn,fv as mp,fw as yy,fx as Ty,fy as Bn,fz as Sy,fA as Cy,fB as Ey,fC as by,fD as Iy,fE as vy,fF as _y,fG as Ay,fH as yp,fI as Tp,fJ as lr,fK as xy,fL as Oy,fM as Ln,fN as wy,fO as My,fP as Ny,fQ as ky,fR as Py,fS as By,fT as Ly,fU as Dy,fV as Sp,fW as Ry,fX as Fy,fY as Uy,fZ as Vy,f_ as Hy,f$ as Yy,g0 as Gy,g1 as Wy,g2 as Ky,g3 as zy,g4 as jy,g5 as Rs,g6 as Cp,g7 as $y,g8 as Xy,g9 as qy,ga as hr,gb as Qy,gc as Zy,gd as Ep}from"./loading-scene-nnLA-Ske.js";import{g as s,i as m,B as v,P as rs,T as Jy,t as eT,a as Tt,R as tT,b as wi,c as sT,v as iT,d as nT,e as Dn,f as aT,h as rT,I as oT}from"./index-C87ZYWwm.js";const cr=!1,ra=!1,bp={[Ge.TOWN_YOUNGSTER]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.YOUNGSTER,Ve(2)?tt.FEMALE:tt.DEFAULT)),[Ge.RIVAL_1]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)),[Ge.RIVAL_2]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL_2,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[Re.ULTRA,Re.GREAT,Re.GREAT],allowLuckUpgrades:!1}),[Ge.EVIL_GRUNT_1]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(Wt([D.ROCKET_GRUNT,D.MAGMA_GRUNT,D.AQUA_GRUNT,D.GALACTIC_GRUNT,D.PLASMA_GRUNT,D.FLARE_GRUNT,D.AETHER_GRUNT,D.SKULL_GRUNT,D.MACRO_GRUNT,D.STAR_GRUNT],!0)),[Ge.RIVAL_3]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL_3,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[Re.ULTRA,Re.ULTRA,Re.GREAT,Re.GREAT],allowLuckUpgrades:!1}),[Ge.EVIL_GRUNT_2]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([D.ROCKET_GRUNT,D.MAGMA_GRUNT,D.AQUA_GRUNT,D.GALACTIC_GRUNT,D.PLASMA_GRUNT,D.FLARE_GRUNT,D.AETHER_GRUNT,D.SKULL_GRUNT,D.MACRO_GRUNT,D.STAR_GRUNT],!0)),[Ge.EVIL_GRUNT_3]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([D.ROCKET_GRUNT,D.MAGMA_GRUNT,D.AQUA_GRUNT,D.GALACTIC_GRUNT,D.PLASMA_GRUNT,D.FLARE_GRUNT,D.AETHER_GRUNT,D.SKULL_GRUNT,D.MACRO_GRUNT,D.STAR_GRUNT],!0)),[Ge.EVIL_ADMIN_1]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([[D.ARCHER,D.ARIANA,D.PROTON,D.PETREL],[D.TABITHA,D.COURTNEY],[D.MATT,D.SHELLY],[D.JUPITER,D.MARS,D.SATURN],[D.ZINZOLIN,D.COLRESS],[D.XEROSIC,D.BRYONY],D.FABA,D.PLUMERIA,D.OLEANA,[D.GIACOMO,D.MELA,D.ATTICUS,D.ORTEGA,D.ERI]],!0)),[Ge.RIVAL_4]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL_4,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[Re.ULTRA,Re.ULTRA,Re.ULTRA,Re.ULTRA],allowLuckUpgrades:!1}),[Ge.EVIL_GRUNT_4]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([D.ROCKET_GRUNT,D.MAGMA_GRUNT,D.AQUA_GRUNT,D.GALACTIC_GRUNT,D.PLASMA_GRUNT,D.FLARE_GRUNT,D.AETHER_GRUNT,D.SKULL_GRUNT,D.MACRO_GRUNT,D.STAR_GRUNT],!0)),[Ge.EVIL_ADMIN_2]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([[D.ARCHER,D.ARIANA,D.PROTON,D.PETREL],[D.TABITHA,D.COURTNEY],[D.MATT,D.SHELLY],[D.JUPITER,D.MARS,D.SATURN],[D.ZINZOLIN,D.COLRESS],[D.XEROSIC,D.BRYONY],D.FABA,D.PLUMERIA,D.OLEANA,[D.GIACOMO,D.MELA,D.ATTICUS,D.ORTEGA,D.ERI]],!0,1)),[Ge.EVIL_BOSS_1]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([D.ROCKET_BOSS_GIOVANNI_1,D.MAXIE,D.ARCHIE,D.CYRUS,D.GHETSIS,D.LYSANDRE,D.LUSAMINE,D.GUZMA,D.ROSE,D.PENNY])).setCustomModifierRewards({guaranteedModifierTiers:[Re.ROGUE,Re.ROGUE,Re.ULTRA,Re.ULTRA,Re.ULTRA],allowLuckUpgrades:!1}),[Ge.RIVAL_5]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL_5,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[Re.ROGUE,Re.ROGUE,Re.ROGUE,Re.ULTRA,Re.ULTRA],allowLuckUpgrades:!1}),[Ge.EVIL_BOSS_2]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.EVIL_GRUNT_1).setGetTrainerFunc(Wt([D.ROCKET_BOSS_GIOVANNI_2,D.MAXIE_2,D.ARCHIE_2,D.CYRUS_2,D.GHETSIS_2,D.LYSANDRE_2,D.LUSAMINE_2,D.GUZMA_2,D.ROSE_2,D.PENNY_2])).setCustomModifierRewards({guaranteedModifierTiers:[Re.ROGUE,Re.ROGUE,Re.ULTRA,Re.ULTRA,Re.ULTRA,Re.ULTRA],allowLuckUpgrades:!1}),[Ge.ELITE_FOUR_1]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(Wt([D.LORELEI,D.WILL,D.SIDNEY,D.AARON,D.SHAUNTAL,D.MALVA,[D.HALA,D.MOLAYNE],D.MARNIE_ELITE,D.RIKA,D.CRISPIN])),[Ge.ELITE_FOUR_2]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.ELITE_FOUR_1).setGetTrainerFunc(Wt([D.BRUNO,D.KOGA,D.PHOEBE,D.BERTHA,D.MARSHAL,D.SIEBOLD,D.OLIVIA,D.NESSA_ELITE,D.POPPY,D.AMARYS])),[Ge.ELITE_FOUR_3]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.ELITE_FOUR_1).setGetTrainerFunc(Wt([D.AGATHA,D.BRUNO,D.GLACIA,D.FLINT,D.GRIMSLEY,D.WIKSTROM,D.ACEROLA,[D.BEA_ELITE,D.ALLISTER_ELITE],D.LARRY_ELITE,D.LACEY])),[Ge.ELITE_FOUR_4]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.ELITE_FOUR_1).setGetTrainerFunc(Wt([D.LANCE,D.KAREN,D.DRAKE,D.LUCIAN,D.CAITLIN,D.DRASNA,D.KAHILI,D.RAIHAN_ELITE,D.HASSEL,D.DRAYTON])),[Ge.CHAMPION]:new ht().setBattleType(ue.TRAINER).setSeedOffsetWave(Ge.ELITE_FOUR_1).setGetTrainerFunc(Wt([D.BLUE,[D.RED,D.LANCE_CHAMPION],[D.STEVEN,D.WALLACE],D.CYNTHIA,[D.ALDER,D.IRIS],D.DIANTHA,[D.KUKUI,D.HAU],[D.LEON,D.MUSTARD],[D.GEETA,D.NEMONA],D.KIERAN])),[Ge.RIVAL_6]:new ht().setBattleType(ue.TRAINER).setGetTrainerFunc(()=>new Zt(D.RIVAL_6,s.gameData.gender===Be.MALE?tt.FEMALE:tt.DEFAULT)).setCustomModifierRewards({guaranteedModifierTiers:[Re.ROGUE,Re.ROGUE,Re.ULTRA,Re.ULTRA,Re.GREAT,Re.GREAT],allowLuckUpgrades:!1})},_h=class _h{modeId;isClassic;isEndless;isDaily;hasTrainers;hasNoShop;hasShortBiomes;hasRandomBiomes;hasRandomBosses;isSplicedOnly;isChallenge;challenges;battleConfig;hasMysteryEncounters;minMysteryEncounterWave;maxMysteryEncounterWave;constructor(e,t,i){this.modeId=e,this.challenges=[],Object.assign(this,t),this.isChallenge&&(this.challenges=Wd.map(n=>Sr(n))),this.battleConfig=i||{}}setChallengeValue(e,t){this.isChallenge||(this.isChallenge=!0,this.challenges=Wd.map(i=>Sr(i))),this.challenges.filter(i=>i.id===e).map(i=>i.value=t)}hasChallenge(e){return this.challenges.some(t=>t.id===e&&t.value!==0)}hasAnyChallenges(){return this.challenges.length>0}isFreshStartChallenge(){return this.hasChallenge(xt.FRESH_START)}isFullFreshStartChallenge(){for(const e of this.challenges)if(e.id===xt.FRESH_START&&e.value===1)return!0;return!1}getStartingLevel(){if(le.STARTING_LEVEL_OVERRIDE>0)return le.STARTING_LEVEL_OVERRIDE;switch(this.modeId){case ce.DAILY:return 20;default:return 5}}getStartingMoney(){return le.STARTING_MONEY_OVERRIDE||1e3}getStartingBiome(){if(!ve(le.STARTING_BIOME_OVERRIDE))return le.STARTING_BIOME_OVERRIDE;switch(this.modeId){case ce.DAILY:return Gf();default:return Je.TOWN}}getWaveForDifficulty(e,t=!1){switch(this.modeId){case ce.DAILY:return e+30+(t?0:Math.floor(e/5));default:return e}}isWaveTrainer(e,t){if(this.isDaily)return e%10===5||!(e%10)&&e>10&&!this.isWaveFinal(e);if(e%30===(s.offsetGym?0:20)&&!this.isWaveFinal(e))return!0;if(e%10!==1&&e%10){const i=t.getTrainerChance();let n=!0;if(i){const a=Math.floor(e/10)*10;for(let r=Math.max(e-2,a+2);r<=Math.min(e+2,a+9);r++)if(r!==e){if(r%30===(s.offsetGym?0:20)||this.isFixedBattle(r)){n=!1;break}if(r<e&&(s.executeWithSeedOffset(()=>{const o=t.getTrainerChance();Ve(o)||(n=!1)},r),!n))break}}return!!(n&&i&&!Ve(i))}return!1}isTrainerBoss(e,t,i){switch(this.modeId){case ce.DAILY:return e>10&&e<50&&!(e%10);default:return e%30===(i?0:20)&&(t!==Je.END||this.isClassic||this.isWaveFinal(e))}}getOverrideSpecies(e){if(this.isDaily&&this.isWaveFinal(e)){const t=Wf(s.seed);if(!ve(t))return ns(t.speciesId);const i=it.filter(n=>(n.subLegendary||n.legendary||n.mythical)&&n.baseTotal>=600&&n.speciesId!==pe.ETERNATUS&&n.speciesId!==pe.ARCEUS);return In(i)}return null}isWaveFinal(e,t=this.modeId){switch(t){case ce.CLASSIC:case ce.CHALLENGE:return e===200;case ce.ENDLESS:case ce.SPLICED_ENDLESS:return!(e%250);case ce.DAILY:return e===50}}isBoss(e){return e%10===0}isBattleClassicFinalBoss(e){return(this.modeId===ce.CLASSIC||this.modeId===ce.CHALLENGE)&&this.isWaveFinal(e)}isEndlessBoss(e){return e%50===0&&(this.modeId===ce.ENDLESS||this.modeId===ce.SPLICED_ENDLESS)}isEndlessMinorBoss(e){return e%250===0&&(this.modeId===ce.ENDLESS||this.modeId===ce.SPLICED_ENDLESS)}isEndlessMajorBoss(e){return e%1e3===0&&(this.modeId===ce.ENDLESS||this.modeId===ce.SPLICED_ENDLESS)}isFixedBattle(e){const t=new ht;return this.battleConfig.hasOwnProperty(e)||fs(gs.FIXED_BATTLES,e,t)}getFixedBattle(e){const t=new ht;return fs(gs.FIXED_BATTLES,e,t)?t:this.battleConfig[e]}getShopStatus(){const e=new ot(!this.hasNoShop);return fs(gs.SHOP,e),e.value}getClearScoreBonus(){switch(this.modeId){case ce.CLASSIC:case ce.CHALLENGE:return 5e3;case ce.DAILY:return 2500;default:return 0}}getEnemyModifierChance(e){switch(this.modeId){case ce.CLASSIC:case ce.CHALLENGE:case ce.DAILY:return e?6:18;case ce.ENDLESS:case ce.SPLICED_ENDLESS:return e?4:12}}getName(){switch(this.modeId){case ce.CLASSIC:return m.t("gameMode:classic");case ce.ENDLESS:return m.t("gameMode:endless");case ce.SPLICED_ENDLESS:return m.t("gameMode:endlessSpliced");case ce.DAILY:return m.t("gameMode:dailyRun");case ce.CHALLENGE:return m.t("gameMode:challenge")}}getMysteryEncounterLegalWaves(){switch(this.modeId){case ce.CLASSIC:return zf;case ce.CHALLENGE:return Kf;default:return[0,0]}}static getModeName(e){switch(e){case ce.CLASSIC:return m.t("gameMode:classic");case ce.ENDLESS:return m.t("gameMode:endless");case ce.SPLICED_ENDLESS:return m.t("gameMode:endlessSpliced");case ce.DAILY:return m.t("gameMode:dailyRun");case ce.CHALLENGE:return m.t("gameMode:challenge")}}};c(_h,"GameMode");let Mt=_h;function oa(C){switch(C){case ce.CLASSIC:return new Mt(ce.CLASSIC,{isClassic:!0,hasTrainers:!0,hasMysteryEncounters:!0},bp);case ce.ENDLESS:return new Mt(ce.ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0});case ce.SPLICED_ENDLESS:return new Mt(ce.SPLICED_ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0,isSplicedOnly:!0});case ce.DAILY:return new Mt(ce.DAILY,{isDaily:!0,hasTrainers:!0,hasNoShop:!0});case ce.CHALLENGE:return new Mt(ce.CHALLENGE,{isClassic:!0,hasTrainers:!0,isChallenge:!0,hasMysteryEncounters:!0},bp)}}c(oa,"getGameMode");var Me=(C=>(C[C.GAMEPAD=0]="GAMEPAD",C[C.KEYBOARD=1]="KEYBOARD",C))(Me||{}),ae=(C=>(C.Button_Up="BUTTON_UP",C.Alt_Button_Up="ALT_BUTTON_UP",C.Button_Down="BUTTON_DOWN",C.Alt_Button_Down="ALT_BUTTON_DOWN",C.Button_Left="BUTTON_LEFT",C.Alt_Button_Left="ALT_BUTTON_LEFT",C.Button_Right="BUTTON_RIGHT",C.Alt_Button_Right="ALT_BUTTON_RIGHT",C.Button_Action="BUTTON_ACTION",C.Alt_Button_Action="ALT_BUTTON_ACTION",C.Button_Cancel="BUTTON_CANCEL",C.Alt_Button_Cancel="ALT_BUTTON_CANCEL",C.Button_Menu="BUTTON_MENU",C.Alt_Button_Menu="ALT_BUTTON_MENU",C.Button_Stats="BUTTON_STATS",C.Alt_Button_Stats="ALT_BUTTON_STATS",C.Button_Cycle_Form="BUTTON_CYCLE_FORM",C.Alt_Button_Cycle_Form="ALT_BUTTON_CYCLE_FORM",C.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",C.Alt_Button_Cycle_Shiny="ALT_BUTTON_CYCLE_SHINY",C.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",C.Alt_Button_Cycle_Gender="ALT_BUTTON_CYCLE_GENDER",C.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",C.Alt_Button_Cycle_Ability="ALT_BUTTON_CYCLE_ABILITY",C.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",C.Alt_Button_Cycle_Nature="ALT_BUTTON_CYCLE_NATURE",C.Button_Cycle_Tera="BUTTON_CYCLE_TERA",C.Alt_Button_Cycle_Tera="ALT_BUTTON_CYCLE_TERA",C.Button_Speed_Up="BUTTON_SPEED_UP",C.Alt_Button_Speed_Up="ALT_BUTTON_SPEED_UP",C.Button_Slow_Down="BUTTON_SLOW_DOWN",C.Alt_Button_Slow_Down="ALT_BUTTON_SLOW_DOWN",C.Button_Submit="BUTTON_SUBMIT",C.Alt_Button_Submit="ALT_BUTTON_SUBMIT",C))(ae||{});const Ye=m.t("settings:pressToBind"),lT={BUTTON_UP:[`KEY ${v.UP.toString()}`,Ye],BUTTON_DOWN:[`KEY ${v.DOWN.toString()}`,Ye],ALT_BUTTON_UP:[`KEY ${v.UP.toString()}`,Ye],BUTTON_LEFT:[`KEY ${v.LEFT.toString()}`,Ye],BUTTON_RIGHT:[`KEY ${v.RIGHT.toString()}`,Ye],BUTTON_ACTION:[`KEY ${v.ACTION.toString()}`,Ye],BUTTON_MENU:[`KEY ${v.MENU.toString()}`,Ye],BUTTON_SUBMIT:[`KEY ${v.SUBMIT.toString()}`,Ye],ALT_BUTTON_DOWN:[`KEY ${v.DOWN.toString()}`,Ye],ALT_BUTTON_LEFT:[`KEY ${v.LEFT.toString()}`,Ye],ALT_BUTTON_RIGHT:[`KEY ${v.RIGHT.toString()}`,Ye],ALT_BUTTON_ACTION:[`KEY ${v.ACTION.toString()}`,Ye],BUTTON_CANCEL:[`KEY ${v.CANCEL.toString()}`,Ye],ALT_BUTTON_CANCEL:[`KEY ${v.CANCEL.toString()}`,Ye],ALT_BUTTON_MENU:[`KEY ${v.MENU.toString()}`,Ye],BUTTON_STATS:[`KEY ${v.STATS.toString()}`,Ye],ALT_BUTTON_STATS:[`KEY ${v.STATS.toString()}`,Ye],BUTTON_CYCLE_FORM:[`KEY ${v.CYCLE_FORM.toString()}`,Ye],ALT_BUTTON_CYCLE_FORM:[`KEY ${v.CYCLE_FORM.toString()}`,Ye],BUTTON_CYCLE_SHINY:[`KEY ${v.CYCLE_SHINY.toString()}`,Ye],ALT_BUTTON_CYCLE_SHINY:[`KEY ${v.CYCLE_SHINY.toString()}`,Ye],BUTTON_CYCLE_GENDER:[`KEY ${v.CYCLE_GENDER.toString()}`,Ye],ALT_BUTTON_CYCLE_GENDER:[`KEY ${v.CYCLE_GENDER.toString()}`,Ye],BUTTON_CYCLE_ABILITY:[`KEY ${v.CYCLE_ABILITY.toString()}`,Ye],ALT_BUTTON_CYCLE_ABILITY:[`KEY ${v.CYCLE_ABILITY.toString()}`,Ye],BUTTON_CYCLE_NATURE:[`KEY ${v.CYCLE_NATURE.toString()}`,Ye],ALT_BUTTON_CYCLE_NATURE:[`KEY ${v.CYCLE_NATURE.toString()}`,Ye],BUTTON_CYCLE_TERA:[`KEY ${v.CYCLE_TERA.toString()}`,Ye],ALT_BUTTON_CYCLE_TERA:[`KEY ${v.CYCLE_TERA.toString()}`,Ye],BUTTON_SPEED_UP:[`KEY ${v.SPEED_UP.toString()}`,Ye],ALT_BUTTON_SPEED_UP:[`KEY ${v.SPEED_UP.toString()}`,Ye],BUTTON_SLOW_DOWN:[`KEY ${v.SLOW_DOWN.toString()}`,Ye],ALT_BUTTON_SLOW_DOWN:[`KEY ${v.SLOW_DOWN.toString()}`,Ye],ALT_BUTTON_SUBMIT:[`KEY ${v.SUBMIT.toString()}`,Ye]},hT={BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_MENU:0,BUTTON_SUBMIT:0,ALT_BUTTON_UP:0,ALT_BUTTON_DOWN:0,ALT_BUTTON_LEFT:0,ALT_BUTTON_RIGHT:0,ALT_BUTTON_ACTION:0,BUTTON_CANCEL:0,ALT_BUTTON_CANCEL:0,ALT_BUTTON_MENU:0,BUTTON_STATS:0,ALT_BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,ALT_BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,ALT_BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,ALT_BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,ALT_BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,ALT_BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,ALT_BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,ALT_BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,ALT_BUTTON_SLOW_DOWN:0,ALT_BUTTON_SUBMIT:0},cT=["BUTTON_SUBMIT","BUTTON_MENU","BUTTON_ACTION","BUTTON_CANCEL","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT"];function kf(C,e){switch(C){case"BUTTON_UP":case"BUTTON_DOWN":case"BUTTON_LEFT":case"BUTTON_RIGHT":case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"ALT_BUTTON_UP":case"ALT_BUTTON_DOWN":case"ALT_BUTTON_LEFT":case"ALT_BUTTON_RIGHT":case"ALT_BUTTON_ACTION":case"ALT_BUTTON_CANCEL":case"ALT_BUTTON_MENU":case"ALT_BUTTON_STATS":case"ALT_BUTTON_CYCLE_SHINY":case"ALT_BUTTON_CYCLE_FORM":case"ALT_BUTTON_CYCLE_GENDER":case"ALT_BUTTON_CYCLE_ABILITY":case"ALT_BUTTON_CYCLE_NATURE":case"ALT_BUTTON_CYCLE_TERA":case"ALT_BUTTON_SPEED_UP":case"ALT_BUTTON_SLOW_DOWN":case"ALT_BUTTON_SUBMIT":if(e&&s.ui){const t=c((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(x.KEYBOARD_BINDING,{target:C,cancelHandler:t})}break}return!0}c(kf,"setSettingKeyboard");const Or={padID:"default",padType:"keyboard",deviceMapping:{KEY_A:Phaser.Input.Keyboard.KeyCodes.A,KEY_B:Phaser.Input.Keyboard.KeyCodes.B,KEY_C:Phaser.Input.Keyboard.KeyCodes.C,KEY_D:Phaser.Input.Keyboard.KeyCodes.D,KEY_E:Phaser.Input.Keyboard.KeyCodes.E,KEY_F:Phaser.Input.Keyboard.KeyCodes.F,KEY_G:Phaser.Input.Keyboard.KeyCodes.G,KEY_H:Phaser.Input.Keyboard.KeyCodes.H,KEY_I:Phaser.Input.Keyboard.KeyCodes.I,KEY_J:Phaser.Input.Keyboard.KeyCodes.J,KEY_K:Phaser.Input.Keyboard.KeyCodes.K,KEY_L:Phaser.Input.Keyboard.KeyCodes.L,KEY_M:Phaser.Input.Keyboard.KeyCodes.M,KEY_N:Phaser.Input.Keyboard.KeyCodes.N,KEY_O:Phaser.Input.Keyboard.KeyCodes.O,KEY_P:Phaser.Input.Keyboard.KeyCodes.P,KEY_Q:Phaser.Input.Keyboard.KeyCodes.Q,KEY_R:Phaser.Input.Keyboard.KeyCodes.R,KEY_S:Phaser.Input.Keyboard.KeyCodes.S,KEY_T:Phaser.Input.Keyboard.KeyCodes.T,KEY_U:Phaser.Input.Keyboard.KeyCodes.U,KEY_V:Phaser.Input.Keyboard.KeyCodes.V,KEY_W:Phaser.Input.Keyboard.KeyCodes.W,KEY_X:Phaser.Input.Keyboard.KeyCodes.X,KEY_Y:Phaser.Input.Keyboard.KeyCodes.Y,KEY_Z:Phaser.Input.Keyboard.KeyCodes.Z,KEY_0:Phaser.Input.Keyboard.KeyCodes.ZERO,KEY_1:Phaser.Input.Keyboard.KeyCodes.ONE,KEY_2:Phaser.Input.Keyboard.KeyCodes.TWO,KEY_3:Phaser.Input.Keyboard.KeyCodes.THREE,KEY_4:Phaser.Input.Keyboard.KeyCodes.FOUR,KEY_5:Phaser.Input.Keyboard.KeyCodes.FIVE,KEY_6:Phaser.Input.Keyboard.KeyCodes.SIX,KEY_7:Phaser.Input.Keyboard.KeyCodes.SEVEN,KEY_8:Phaser.Input.Keyboard.KeyCodes.EIGHT,KEY_9:Phaser.Input.Keyboard.KeyCodes.NINE,KEY_F1:Phaser.Input.Keyboard.KeyCodes.F1,KEY_F2:Phaser.Input.Keyboard.KeyCodes.F2,KEY_F3:Phaser.Input.Keyboard.KeyCodes.F3,KEY_F4:Phaser.Input.Keyboard.KeyCodes.F4,KEY_F5:Phaser.Input.Keyboard.KeyCodes.F5,KEY_F6:Phaser.Input.Keyboard.KeyCodes.F6,KEY_F7:Phaser.Input.Keyboard.KeyCodes.F7,KEY_F8:Phaser.Input.Keyboard.KeyCodes.F8,KEY_F9:Phaser.Input.Keyboard.KeyCodes.F9,KEY_F10:Phaser.Input.Keyboard.KeyCodes.F10,KEY_F11:Phaser.Input.Keyboard.KeyCodes.F11,KEY_F12:Phaser.Input.Keyboard.KeyCodes.F12,KEY_PAGE_DOWN:Phaser.Input.Keyboard.KeyCodes.PAGE_DOWN,KEY_PAGE_UP:Phaser.Input.Keyboard.KeyCodes.PAGE_UP,KEY_CTRL:Phaser.Input.Keyboard.KeyCodes.CTRL,KEY_DEL:Phaser.Input.Keyboard.KeyCodes.DELETE,KEY_END:Phaser.Input.Keyboard.KeyCodes.END,KEY_ENTER:Phaser.Input.Keyboard.KeyCodes.ENTER,KEY_ESC:Phaser.Input.Keyboard.KeyCodes.ESC,KEY_HOME:Phaser.Input.Keyboard.KeyCodes.HOME,KEY_INSERT:Phaser.Input.Keyboard.KeyCodes.INSERT,KEY_PLUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_ADD,KEY_MINUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_SUBTRACT,KEY_QUOTATION:Phaser.Input.Keyboard.KeyCodes.QUOTES,KEY_SHIFT:Phaser.Input.Keyboard.KeyCodes.SHIFT,KEY_SPACE:Phaser.Input.Keyboard.KeyCodes.SPACE,KEY_TAB:Phaser.Input.Keyboard.KeyCodes.TAB,KEY_TILDE:Phaser.Input.Keyboard.KeyCodes.BACKTICK,KEY_ARROW_UP:Phaser.Input.Keyboard.KeyCodes.UP,KEY_ARROW_DOWN:Phaser.Input.Keyboard.KeyCodes.DOWN,KEY_ARROW_LEFT:Phaser.Input.Keyboard.KeyCodes.LEFT,KEY_ARROW_RIGHT:Phaser.Input.Keyboard.KeyCodes.RIGHT,KEY_LEFT_BRACKET:Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET,KEY_RIGHT_BRACKET:Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET,KEY_SEMICOLON:Phaser.Input.Keyboard.KeyCodes.SEMICOLON,KEY_COMMA:Phaser.Input.Keyboard.KeyCodes.COMMA,KEY_PERIOD:Phaser.Input.Keyboard.KeyCodes.PERIOD,KEY_BACK_SLASH:Phaser.Input.Keyboard.KeyCodes.BACK_SLASH,KEY_FORWARD_SLASH:Phaser.Input.Keyboard.KeyCodes.FORWARD_SLASH,KEY_BACKSPACE:Phaser.Input.Keyboard.KeyCodes.BACKSPACE,KEY_ALT:Phaser.Input.Keyboard.KeyCodes.ALT},icons:{KEY_A:"A.png",KEY_B:"B.png",KEY_C:"C.png",KEY_D:"D.png",KEY_E:"E.png",KEY_F:"F.png",KEY_G:"G.png",KEY_H:"H.png",KEY_I:"I.png",KEY_J:"J.png",KEY_K:"K.png",KEY_L:"L.png",KEY_M:"M.png",KEY_N:"N.png",KEY_O:"O.png",KEY_P:"P.png",KEY_Q:"Q.png",KEY_R:"R.png",KEY_S:"S.png",KEY_T:"T.png",KEY_U:"U.png",KEY_V:"V.png",KEY_W:"W.png",KEY_X:"X.png",KEY_Y:"Y.png",KEY_Z:"Z.png",KEY_0:"0.png",KEY_1:"1.png",KEY_2:"2.png",KEY_3:"3.png",KEY_4:"4.png",KEY_5:"5.png",KEY_6:"6.png",KEY_7:"7.png",KEY_8:"8.png",KEY_9:"9.png",KEY_F1:"F1.png",KEY_F2:"F2.png",KEY_F3:"F3.png",KEY_F4:"F4.png",KEY_F5:"F5.png",KEY_F6:"F6.png",KEY_F7:"F7.png",KEY_F8:"F8.png",KEY_F9:"F9.png",KEY_F10:"F10.png",KEY_F11:"F11.png",KEY_F12:"F12.png",KEY_PAGE_DOWN:"PAGE_DOWN.png",KEY_PAGE_UP:"PAGE_UP.png",KEY_CTRL:"CTRL.png",KEY_DEL:"DEL.png",KEY_END:"END.png",KEY_ENTER:"ENTER.png",KEY_ESC:"ESC.png",KEY_HOME:"HOME.png",KEY_INSERT:"INS.png",KEY_PLUS:"PLUS.png",KEY_MINUS:"MINUS.png",KEY_QUOTATION:"QUOTE.png",KEY_SHIFT:"SHIFT.png",KEY_SPACE:"SPACE.png",KEY_TAB:"TAB.png",KEY_TILDE:"TILDE.png",KEY_ARROW_UP:"KEY_ARROW_UP.png",KEY_ARROW_DOWN:"KEY_ARROW_DOWN.png",KEY_ARROW_LEFT:"KEY_ARROW_LEFT.png",KEY_ARROW_RIGHT:"KEY_ARROW_RIGHT.png",KEY_LEFT_BRACKET:"LEFT_BRACKET.png",KEY_RIGHT_BRACKET:"RIGHT_BRACKET.png",KEY_SEMICOLON:"SEMICOLON.png",KEY_COMMA:"COMMA.png",KEY_PERIOD:"PERIOD.png",KEY_BACK_SLASH:"BACK_SLASH.png",KEY_FORWARD_SLASH:"FORWARD_SLASH.png",KEY_BACKSPACE:"BACK.png",KEY_ALT:"ALT.png"},settings:{[ae.Button_Up]:v.UP,[ae.Button_Down]:v.DOWN,[ae.Button_Left]:v.LEFT,[ae.Button_Right]:v.RIGHT,[ae.Button_Submit]:v.SUBMIT,[ae.Button_Action]:v.ACTION,[ae.Button_Cancel]:v.CANCEL,[ae.Button_Menu]:v.MENU,[ae.Button_Stats]:v.STATS,[ae.Button_Cycle_Shiny]:v.CYCLE_SHINY,[ae.Button_Cycle_Form]:v.CYCLE_FORM,[ae.Button_Cycle_Gender]:v.CYCLE_GENDER,[ae.Button_Cycle_Ability]:v.CYCLE_ABILITY,[ae.Button_Cycle_Nature]:v.CYCLE_NATURE,[ae.Button_Speed_Up]:v.SPEED_UP,[ae.Button_Slow_Down]:v.SLOW_DOWN,[ae.Button_Cycle_Tera]:v.CYCLE_TERA,[ae.Alt_Button_Up]:v.UP,[ae.Alt_Button_Down]:v.DOWN,[ae.Alt_Button_Left]:v.LEFT,[ae.Alt_Button_Right]:v.RIGHT,[ae.Alt_Button_Submit]:v.SUBMIT,[ae.Alt_Button_Action]:v.ACTION,[ae.Alt_Button_Cancel]:v.CANCEL,[ae.Alt_Button_Menu]:v.MENU,[ae.Alt_Button_Stats]:v.STATS,[ae.Alt_Button_Cycle_Shiny]:v.CYCLE_SHINY,[ae.Alt_Button_Cycle_Form]:v.CYCLE_FORM,[ae.Alt_Button_Cycle_Gender]:v.CYCLE_GENDER,[ae.Alt_Button_Cycle_Ability]:v.CYCLE_ABILITY,[ae.Alt_Button_Cycle_Nature]:v.CYCLE_NATURE,[ae.Alt_Button_Speed_Up]:v.SPEED_UP,[ae.Alt_Button_Slow_Down]:v.SLOW_DOWN,[ae.Alt_Button_Cycle_Tera]:v.CYCLE_TERA},default:{KEY_ARROW_UP:ae.Button_Up,KEY_ARROW_DOWN:ae.Button_Down,KEY_ARROW_LEFT:ae.Button_Left,KEY_ARROW_RIGHT:ae.Button_Right,KEY_ENTER:ae.Button_Submit,KEY_SPACE:ae.Button_Action,KEY_BACKSPACE:ae.Button_Cancel,KEY_ESC:ae.Button_Menu,KEY_C:ae.Button_Stats,KEY_R:ae.Button_Cycle_Shiny,KEY_F:ae.Button_Cycle_Form,KEY_G:ae.Button_Cycle_Gender,KEY_E:ae.Button_Cycle_Ability,KEY_N:ae.Button_Cycle_Nature,KEY_V:ae.Button_Cycle_Tera,KEY_PLUS:-1,KEY_MINUS:-1,KEY_A:ae.Alt_Button_Left,KEY_B:-1,KEY_D:ae.Alt_Button_Right,KEY_H:-1,KEY_I:-1,KEY_J:-1,KEY_K:-1,KEY_L:-1,KEY_M:ae.Alt_Button_Menu,KEY_O:-1,KEY_P:-1,KEY_Q:-1,KEY_S:ae.Alt_Button_Down,KEY_T:ae.Alt_Button_Cycle_Form,KEY_U:-1,KEY_W:ae.Alt_Button_Up,KEY_X:ae.Alt_Button_Cancel,KEY_Y:ae.Alt_Button_Cycle_Shiny,KEY_Z:ae.Alt_Button_Action,KEY_0:-1,KEY_1:-1,KEY_2:-1,KEY_3:-1,KEY_4:-1,KEY_5:-1,KEY_6:-1,KEY_7:-1,KEY_8:-1,KEY_9:-1,KEY_CTRL:-1,KEY_DEL:-1,KEY_END:-1,KEY_F1:-1,KEY_F2:-1,KEY_F3:-1,KEY_F4:-1,KEY_F5:-1,KEY_F6:-1,KEY_F7:-1,KEY_F8:-1,KEY_F9:-1,KEY_F10:-1,KEY_F11:-1,KEY_F12:-1,KEY_HOME:-1,KEY_INSERT:-1,KEY_PAGE_DOWN:ae.Button_Slow_Down,KEY_PAGE_UP:ae.Button_Speed_Up,KEY_QUOTATION:-1,KEY_SHIFT:ae.Alt_Button_Stats,KEY_TAB:-1,KEY_TILDE:-1,KEY_LEFT_BRACKET:-1,KEY_RIGHT_BRACKET:-1,KEY_SEMICOLON:-1,KEY_ALT:-1},blacklist:["KEY_ENTER","KEY_ESC","KEY_SPACE","KEY_BACKSPACE","KEY_ARROW_UP","KEY_ARROW_DOWN","KEY_ARROW_LEFT","KEY_ARROW_RIGHT","KEY_DEL","KEY_HOME"]};function Mi(C,e){return Object.keys(C.deviceMapping).find(t=>C.deviceMapping[t]===e)}c(Mi,"getKeyWithKeycode");function Pf(C,e){const t=Mi(C,e);return t?C.custom[t]:null}c(Pf,"getSettingNameWithKeycode");function Rn(C,e){const t=Pf(C,e);return C.settings[t]}c(Rn,"getButtonWithKeycode");function Ni(C,e){return Object.keys(C.custom).find(t=>C.custom[t]===e)}c(Ni,"getKeyWithSettingName");function wr(C,e){return C.custom[e]}c(wr,"getSettingNameWithKey");function uT(C,e){return C.icons[e]}c(uT,"getIconWithKey");function la(C,e){const t=Ni(C,e);return uT(C,t)}c(la,"getIconWithSettingName");function dT(C,e,t,i){let n;e==="gamepad"?n=C[t[Me.GAMEPAD]]:n=C[t[Me.KEYBOARD]];const a=la(n,i);if(!a){const r=i.includes("ALT_");let o;return r?o=i.split("ALT_").splice(1)[0]:o=`ALT_${i}`,la(n,o)}return a}c(dT,"getIconForLatestInput");function pT(C,e,t){if(!mT(C,Mi(C,t))||!yT(C,e))return!1;const i=Pf(C,t);if(i){const r=Ni(C,i);r&&(C.custom[r]=-1)}const n=Ni(C,e);n&&(C.custom[n]=-1);const a=Mi(C,t);return a&&(C.custom[a]=e),!0}c(pT,"assign");function fT(C,e,t){if(C.padType==="keyboard")return!1;const i=Ni(C,e),n=wr(C,i),a=Mi(C,t),r=wr(C,a);return i&&(C.custom[i]=r),a&&(C.custom[a]=n),!0}c(fT,"swap");function gT(C,e){const t=Ni(C,e);return C.blacklist.includes(t)?!1:(t&&(C.custom[t]=-1),!0)}c(gT,"deleteBind");function mT(C,e){const t=wr(C,e);return!C.blacklist?.includes(e)}c(mT,"canIAssignThisKey");function yT(C,e){const t=Ni(C,e);return!C.blacklist?.includes(t)}c(yT,"canIOverrideThisSetting");var G=(C=>(C.Controller="CONTROLLER",C.Gamepad_Support="GAMEPAD_SUPPORT",C.Button_Up="BUTTON_UP",C.Button_Down="BUTTON_DOWN",C.Button_Left="BUTTON_LEFT",C.Button_Right="BUTTON_RIGHT",C.Button_Action="BUTTON_ACTION",C.Button_Cancel="BUTTON_CANCEL",C.Button_Menu="BUTTON_MENU",C.Button_Stats="BUTTON_STATS",C.Button_Cycle_Form="BUTTON_CYCLE_FORM",C.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",C.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",C.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",C.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",C.Button_Cycle_Tera="BUTTON_CYCLE_TERA",C.Button_Speed_Up="BUTTON_SPEED_UP",C.Button_Slow_Down="BUTTON_SLOW_DOWN",C.Button_Submit="BUTTON_SUBMIT",C))(G||{});const vt=m.t("settings:pressActionToAssign"),Bf={CONTROLLER:[m.t("settings:controllerDefault"),m.t("settings:controllerChange")],GAMEPAD_SUPPORT:[m.t("settings:gamepadSupportAuto"),m.t("settings:gamepadSupportDisabled")],BUTTON_UP:[`KEY ${v.UP.toString()}`,vt],BUTTON_DOWN:[`KEY ${v.DOWN.toString()}`,vt],BUTTON_LEFT:[`KEY ${v.LEFT.toString()}`,vt],BUTTON_RIGHT:[`KEY ${v.RIGHT.toString()}`,vt],BUTTON_ACTION:[`KEY ${v.ACTION.toString()}`,vt],BUTTON_CANCEL:[`KEY ${v.CANCEL.toString()}`,vt],BUTTON_MENU:[`KEY ${v.MENU.toString()}`,vt],BUTTON_STATS:[`KEY ${v.STATS.toString()}`,vt],BUTTON_CYCLE_FORM:[`KEY ${v.CYCLE_FORM.toString()}`,vt],BUTTON_CYCLE_SHINY:[`KEY ${v.CYCLE_SHINY.toString()}`,vt],BUTTON_CYCLE_GENDER:[`KEY ${v.CYCLE_GENDER.toString()}`,vt],BUTTON_CYCLE_ABILITY:[`KEY ${v.CYCLE_ABILITY.toString()}`,vt],BUTTON_CYCLE_NATURE:[`KEY ${v.CYCLE_NATURE.toString()}`,vt],BUTTON_CYCLE_TERA:[`KEY ${v.CYCLE_TERA.toString()}`,vt],BUTTON_SPEED_UP:[`KEY ${v.SPEED_UP.toString()}`,vt],BUTTON_SLOW_DOWN:[`KEY ${v.SLOW_DOWN.toString()}`,vt],BUTTON_SUBMIT:[`KEY ${v.SUBMIT.toString()}`,vt]},Lf={CONTROLLER:0,GAMEPAD_SUPPORT:0,BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_CANCEL:0,BUTTON_MENU:0,BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,BUTTON_SUBMIT:0},TT=[ae.Button_Up,ae.Button_Down,ae.Button_Left,ae.Button_Right];function qn(C,e){switch(C){case"GAMEPAD_SUPPORT":s.inputController.setGamepadSupport(Bf[C][e]!=="Disabled");break;case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"BUTTON_SUBMIT":if(e&&s.ui){const t=c((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(x.GAMEPAD_BINDING,{target:C,cancelHandler:t})}break;case"CONTROLLER":if(e){const t=s.inputController.getGamepadsName();if(s.ui&&t){const i=c(()=>(s.ui.revertMode(),s.ui.getHandler().setOptionCursor(Object.values(G).indexOf("CONTROLLER"),0,!0),s.ui.getHandler().updateBindings(),!1),"cancelHandler"),n=c(a=>(s.inputController.setChosenGamepad(a),i(),!0),"changeGamepadHandler");return s.ui.setOverlayMode(x.OPTION_SELECT,{options:[...t.map(a=>({label:ah(a,30),handler:c(()=>n(a),"handler")})),{label:m.t("settings:cancelControllerChoice"),handler:i}]}),!1}}break}return!0}c(qn,"setSettingGamepad");const Df={padID:"Dualshock",padType:"dualshock",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,TOUCH:17},icons:{RC_S:"CROSS.png",RC_E:"CIRCLE.png",RC_W:"SQUARE.png",RC_N:"TRIANGLE.png",START:"START.png",SELECT:"SELECT.png",LB:"L1.png",RB:"R1.png",LT:"L2.png",RT:"R2.png",LS:"L3.png",RS:"R3.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png",TOUCH:"TOUCH.png"},settings:{[G.Button_Up]:v.UP,[G.Button_Down]:v.DOWN,[G.Button_Left]:v.LEFT,[G.Button_Right]:v.RIGHT,[G.Button_Action]:v.ACTION,[G.Button_Cancel]:v.CANCEL,[G.Button_Cycle_Nature]:v.CYCLE_NATURE,[G.Button_Cycle_Tera]:v.CYCLE_TERA,[G.Button_Menu]:v.MENU,[G.Button_Stats]:v.STATS,[G.Button_Cycle_Form]:v.CYCLE_FORM,[G.Button_Cycle_Shiny]:v.CYCLE_SHINY,[G.Button_Cycle_Gender]:v.CYCLE_GENDER,[G.Button_Cycle_Ability]:v.CYCLE_ABILITY,[G.Button_Speed_Up]:v.SPEED_UP,[G.Button_Slow_Down]:v.SLOW_DOWN,[G.Button_Submit]:v.SUBMIT},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down,TOUCH:G.Button_Submit}},ST={padID:"Generic",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:v.UP,[G.Button_Down]:v.DOWN,[G.Button_Left]:v.LEFT,[G.Button_Right]:v.RIGHT,[G.Button_Action]:v.ACTION,[G.Button_Cancel]:v.CANCEL,[G.Button_Cycle_Nature]:v.CYCLE_NATURE,[G.Button_Cycle_Tera]:v.CYCLE_TERA,[G.Button_Menu]:v.MENU,[G.Button_Stats]:v.STATS,[G.Button_Cycle_Form]:v.CYCLE_FORM,[G.Button_Cycle_Shiny]:v.CYCLE_SHINY,[G.Button_Cycle_Gender]:v.CYCLE_GENDER,[G.Button_Cycle_Ability]:v.CYCLE_ABILITY,[G.Button_Speed_Up]:v.SPEED_UP,[G.Button_Slow_Down]:v.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down},blacklist:["LC_N","LC_S","LC_W","LC_E"]},CT={padID:"Pro Controller",padType:"xbox",deviceMapping:{RC_S:1,RC_E:0,RC_W:3,RC_N:2,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,MENU:16},icons:{RC_S:"XB_Letter_B_OL.png",RC_E:"XB_Letter_A_OL.png",RC_W:"XB_Letter_Y_OL.png",RC_N:"XB_Letter_X_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:v.UP,[G.Button_Down]:v.DOWN,[G.Button_Left]:v.LEFT,[G.Button_Right]:v.RIGHT,[G.Button_Action]:v.ACTION,[G.Button_Cancel]:v.CANCEL,[G.Button_Cycle_Nature]:v.CYCLE_NATURE,[G.Button_Cycle_Tera]:v.CYCLE_TERA,[G.Button_Menu]:v.MENU,[G.Button_Stats]:v.STATS,[G.Button_Cycle_Form]:v.CYCLE_FORM,[G.Button_Cycle_Shiny]:v.CYCLE_SHINY,[G.Button_Cycle_Gender]:v.CYCLE_GENDER,[G.Button_Cycle_Ability]:v.CYCLE_ABILITY,[G.Button_Speed_Up]:v.SPEED_UP,[G.Button_Slow_Down]:v.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},Rf={padID:"081f-e401",padType:"xbox",deviceMapping:{RC_S:2,RC_E:1,RC_W:3,RC_N:0,START:9,SELECT:8,LB:4,RB:5,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:v.UP,[G.Button_Down]:v.DOWN,[G.Button_Left]:v.LEFT,[G.Button_Right]:v.RIGHT,[G.Button_Action]:v.ACTION,[G.Button_Cancel]:v.CANCEL,[G.Button_Cycle_Nature]:v.CYCLE_NATURE,[G.Button_Cycle_Tera]:v.CYCLE_TERA,[G.Button_Menu]:v.MENU,[G.Button_Stats]:v.STATS,[G.Button_Cycle_Form]:v.CYCLE_FORM,[G.Button_Cycle_Shiny]:v.CYCLE_SHINY,[G.Button_Cycle_Gender]:v.CYCLE_GENDER,[G.Button_Cycle_Ability]:v.CYCLE_ABILITY,[G.Button_Speed_Up]:v.SPEED_UP,[G.Button_Slow_Down]:v.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:-1,RT:-1,LS:-1,RS:-1}},Ff={padID:"Xbox 360 controller (XInput STANDARD GAMEPAD)",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:v.UP,[G.Button_Down]:v.DOWN,[G.Button_Left]:v.LEFT,[G.Button_Right]:v.RIGHT,[G.Button_Action]:v.ACTION,[G.Button_Cancel]:v.CANCEL,[G.Button_Cycle_Nature]:v.CYCLE_NATURE,[G.Button_Cycle_Tera]:v.CYCLE_TERA,[G.Button_Menu]:v.MENU,[G.Button_Stats]:v.STATS,[G.Button_Cycle_Form]:v.CYCLE_FORM,[G.Button_Cycle_Shiny]:v.CYCLE_SHINY,[G.Button_Cycle_Gender]:v.CYCLE_GENDER,[G.Button_Cycle_Ability]:v.CYCLE_ABILITY,[G.Button_Speed_Up]:v.SPEED_UP,[G.Button_Slow_Down]:v.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},ET="touchControlPositionsLandscape",bT="touchControlPositionsPortrait",Ah=class Ah{draggingElement=null;inConfigurationMode;configurationEventListeners={touchstart:[],touchmove:[],touchend:[]};overlay;isLandscapeMode=this.getScreenSize().width>this.getScreenSize().height;touchControls;constructor(e){this.touchControls=e,this.inConfigurationMode=!1,this.setPositions(this.getSavedPositionsOfCurrentOrientation()??[]),window.addEventListener("resize",t=>{const i=this.getScreenSize();i.width>i.height!==this.isLandscapeMode&&this.changeOrientation(i.width>i.height)})}async changeOrientation(e){if(this.isLandscapeMode=e,this.inConfigurationMode){const i=document.querySelector("#touchControls #orientation");i&&(i.textContent=this.isLandscapeMode?m.t("settings:landscape"):m.t("settings:portrait"))}const t=this.getSavedPositionsOfCurrentOrientation()??[];this.setPositions(t)}getScreenSize(){return{width:window.screen.width,height:window.screen.height}}createToolbarElement(){const e=document.createElement("div");return e.id="configToolbar",e.innerHTML=`
    <div class="column">
      <div class="button-row">
        <div id="resetButton" class="button">${m.t("settings:touchReset")}</div>
        <div id="saveButton" class="button">${m.t("settings:touchSaveClose")}</div>
        <div id="cancelButton" class="button">${m.t("settings:touchCancel")}</div>
      </div>
      <div class="info-row">
        <div class="orientation-label">
          ${m.t("settings:orientation")}
          <span id="orientation">
            ${this.isLandscapeMode?m.t("settings:landscape"):m.t("settings:portrait")}
          </span>
        </div>
      </div>
    </div>
  `,e}createToolbar(){document.querySelector("#touchControls")?.prepend(this.createToolbarElement());const e=this.getConfigToolbarRefs();if(!e)return;const{saveButton:t,resetButton:i,cancelButton:n}=e;t.addEventListener("click",()=>{this.saveCurrentPositions(),this.disableConfigurationMode()}),i.addEventListener("click",()=>{this.resetPositions()}),n.addEventListener("click",()=>{const a=this.getSavedPositionsOfCurrentOrientation();this.setPositions(a),this.disableConfigurationMode()})}getConfigToolbarRefs(){const e=document.querySelector("#touchControls #configToolbar");if(e)return{toolbar:e,saveButton:e.querySelector("#saveButton"),resetButton:e.querySelector("#resetButton"),cancelButton:e.querySelector("#cancelButton")}}isLeft=c(e=>document.querySelector("#touchControls .left")?.contains(e),"isLeft");startDrag=c(e=>{this.draggingElement=e},"startDrag");drag=c(e=>{if(!this.draggingElement)return;const t=this.draggingElement.getBoundingClientRect(),i=this.isLeft(this.draggingElement)?e.clientX-t.width/2:window.innerWidth-e.clientX-t.width/2,n=window.innerHeight-e.clientY-t.height/2;this.setPosition(this.draggingElement,i,n)},"drag");stopDrag=c(()=>{this.draggingElement=null},"stopDrag");getModifiedCurrentPositions(){return this.getControlGroupElements().filter(e=>e.style.right||e.style.left).map(e=>({id:e.id,x:Number.parseFloat(this.isLeft(e)?e.style.left:e.style.right),y:Number.parseFloat(e.style.bottom)}))}getLocalStorageKey(){return this.isLandscapeMode?ET:bT}getSavedPositionsOfCurrentOrientation(){const e=localStorage.getItem(this.getLocalStorageKey());return e?JSON.parse(e):[]}saveCurrentPositions(){const e=this.getModifiedCurrentPositions();localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))}setPositions(e){return this.resetPositions(),e.forEach(t=>{const i=document.querySelector(`#${t.id}`);this.setPosition(i,t.x,t.y)})}setPosition(e,t,i){const n=e.getBoundingClientRect(),a=c((l,h,u)=>Math.min(Math.max(l,h),u),"checkBound"),{height:r,width:o}=this.getScreenSize();t=a(t,0,o-n.width),i=a(i,0,r-n.height),this.isLeft(e)?e.style.left=`${t}px`:e.style.right=`${t}px`,e.style.bottom=`${i}px`}resetPositions(){this.getControlGroupElements().forEach(e=>{e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.removeProperty("bottom")})}getControlGroupElements(){return[...document.querySelectorAll("#touchControls .control-group")]}createConfigurationEventListeners(e){return{touchstart:e.map(t=>{const i=c(()=>this.startDrag(t),"startDrag");return t.addEventListener("touchstart",i,{passive:!0}),i}),touchmove:e.map(()=>{const t=c(i=>this.drag(i.touches[0]),"drag");return window.addEventListener("touchmove",t,{passive:!0}),t}),touchend:e.map(()=>{const t=c(()=>this.stopDrag(),"stopDrag");return window.addEventListener("touchend",t,{passive:!0}),t})}}createOverlay(e){const t=new Phaser.GameObjects.Container(s,0,0),i=new Phaser.GameObjects.Rectangle(s,0,0,s.game.canvas.width,s.game.canvas.height,0,.5);i.setInteractive(),t.add(i),e.add(t),this.overlay=t,document.querySelector("#touchControls")?.classList.add("config-mode")}enableConfigurationMode(e){this.inConfigurationMode||(this.inConfigurationMode=!0,this.touchControls.disable(),this.createOverlay(e),this.createToolbar(),setTimeout(()=>{this.configurationEventListeners=this.createConfigurationEventListeners(this.getControlGroupElements())},500))}disableConfigurationMode(){this.inConfigurationMode=!1,this.draggingElement=null;const{touchstart:e,touchmove:t,touchend:i}=this.configurationEventListeners;this.getControlGroupElements().forEach((a,r)=>a.removeEventListener("touchstart",e[r])),t.forEach(a=>window.removeEventListener("touchmove",a)),i.forEach(a=>window.removeEventListener("touchend",a)),document.querySelector("#touchControls #configToolbar")?.remove(),this.overlay?.destroy(),document.querySelector("#touchControls")?.classList.remove("config-mode"),this.touchControls.enable()}};c(Ah,"MoveTouchControlsHandler");let Mr=Ah;const Ip=250,xh=class xh{gamepads=[];events;buttonLock=[];interactions=new Map;configs=new Map;gamepadSupport=!0;selectedDevice;disconnectedGamepads=[];lastSource="keyboard";inputInterval=[];touchControls;moveTouchControlsHandler;constructor(){this.selectedDevice={[Me.GAMEPAD]:null,[Me.KEYBOARD]:"default"};for(const e of Is(v))this.interactions[e]={pressTime:!1,isPressed:!1,source:null};delete this.interactions[v.MENU],delete this.interactions[v.STATS],this.init()}init(){if(this.events=s.game.events,s.game.events.on(rs.Core.Events.BLUR,()=>{this.loseFocus()}),typeof s.input.gamepad<"u"){if(s.input.gamepad?.on("connected",function(e){e&&(this.refreshGamepads(),this.setupGamepad(e),this.onReconnect(e))},this),s.input.gamepad?.on("disconnected",function(e){this.onDisconnect(e)},this),s.input.gamepad?.refreshPads(),s.input.gamepad?.total){this.refreshGamepads();for(const e of this.gamepads)s.input.gamepad.emit("connected",e)}s.input.gamepad?.on("down",this.gamepadButtonDown,this),s.input.gamepad?.on("up",this.gamepadButtonUp,this),s.input.keyboard?.on("keydown",this.keyboardKeyDown,this),s.input.keyboard?.on("keyup",this.keyboardKeyUp,this)}this.touchControls=new Jy,this.moveTouchControlsHandler=new Mr(this.touchControls)}loseFocus(){this.deactivatePressedKey(),this.touchControls.deactivatePressedKey()}setGamepadSupport(e){e?this.gamepadSupport=!0:(this.gamepadSupport=!1,this.deactivatePressedKey())}setChosenGamepad(e){this.deactivatePressedKey(),this.initChosenGamepad(e)}setChosenKeyboardLayout(e){this.deactivatePressedKey(),this.initChosenLayoutKeyboard(e)}getGamepadsName(){return this.gamepads.filter(e=>!this.disconnectedGamepads.includes(e.id)).map(e=>e.id)}initChosenGamepad(e){e&&(this.selectedDevice[Me.GAMEPAD]=e.toLowerCase()),s.ui?.handlers[x.SETTINGS_GAMEPAD]?.updateChosenGamepadDisplay()}initChosenLayoutKeyboard(e){e&&(this.selectedDevice[Me.KEYBOARD]=e.toLowerCase()),s.ui?.handlers[x.SETTINGS_KEYBOARD]?.updateChosenKeyboardDisplay()}onDisconnect(e){this.disconnectedGamepads.push(e.id)}onReconnect(e){this.disconnectedGamepads=this.disconnectedGamepads.filter(t=>t!==e.id)}setupGamepad(e){const t=this.getGamepadsName();for(const n of t){const a=n.toLowerCase();this.selectedDevice[Me.GAMEPAD]||this.setChosenGamepad(a);const r=Kd(this.getConfig(a));r.custom=this.configs[a]?.custom||{...r.default},this.configs[a]=r,s.gameData?.saveMappingConfigs(a,this.configs[a])}this.lastSource="gamepad",s.ui?.handlers[x.SETTINGS_GAMEPAD]?.updateChosenGamepadDisplay()}setupKeyboard(){for(const e of["default"]){const t=Kd(this.getConfigKeyboard(e));t.custom=this.configs[e]?.custom||{...t.default},this.configs[e]=t,s.gameData?.saveMappingConfigs(this.selectedDevice[Me.KEYBOARD],this.configs[e])}this.initChosenLayoutKeyboard(this.selectedDevice[Me.KEYBOARD])}refreshGamepads(){this.gamepads=s.input.gamepad?.gamepads.filter(e=>e!==null)??[];for(const[e,t]of this.gamepads.entries())t.index=e}ensureKeyboardIsInit(){this.getActiveConfig(Me.KEYBOARD)?.padID||this.setupKeyboard()}keyboardKeyDown(e){this.lastSource="keyboard",this.ensureKeyboardIsInit();const t=Rn(this.getActiveConfig(Me.KEYBOARD),e.keyCode);if(t!==void 0){if(this.buttonLock.includes(t))return;this.events.emit("input_down",{controller_type:"keyboard",button:t}),clearInterval(this.inputInterval[t]),this.inputInterval[t]=setInterval(()=>{this.events.emit("input_down",{controller_type:"keyboard",button:t})},Ip),this.buttonLock.push(t)}}keyboardKeyUp(e){this.lastSource="keyboard";const t=Rn(this.getActiveConfig(Me.KEYBOARD),e.keyCode);if(t!==void 0){this.events.emit("input_up",{controller_type:"keyboard",button:t});const i=this.buttonLock.indexOf(t);this.buttonLock.splice(i,1),clearInterval(this.inputInterval[t])}}gamepadButtonDown(e,t,i){if(this.configs[this.selectedDevice[Me.KEYBOARD]]?.padID||this.setupKeyboard(),!e||(this.lastSource="gamepad",(!this.selectedDevice[Me.GAMEPAD]||s.ui.getMode()!==x.GAMEPAD_BINDING&&this.selectedDevice[Me.GAMEPAD]!==e.id.toLowerCase())&&this.setChosenGamepad(e.id),!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Me.GAMEPAD].toLowerCase()))return;const n=this.getActiveConfig(Me.GAMEPAD),a=n&&Rn(n,t.index);if(a!==void 0){if(this.buttonLock.includes(a))return;this.events.emit("input_down",{controller_type:"gamepad",button:a}),clearInterval(this.inputInterval[a]),this.inputInterval[a]=setInterval(()=>{if(!this.buttonLock.includes(a)){clearInterval(this.inputInterval[a]);return}this.events.emit("input_down",{controller_type:"gamepad",button:a})},Ip),this.buttonLock.push(a)}}gamepadButtonUp(e,t,i){if(!e||(this.lastSource="gamepad",!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[Me.GAMEPAD]))return;const n=Rn(this.getActiveConfig(Me.GAMEPAD),t.index);if(n!==void 0){this.events.emit("input_up",{controller_type:"gamepad",button:n});const a=this.buttonLock.indexOf(n);this.buttonLock.splice(a,1),clearInterval(this.inputInterval[n])}}getConfig(e){return e=e.toLowerCase(),e.includes("081f")&&e.includes("e401")?Rf:e.includes("xbox")&&e.includes("360")?Ff:e.includes("054c")?Df:e.includes("057e")&&e.includes("2009")?CT:ST}getConfigKeyboard(e){return Or}deactivatePressedKey(){for(const e of Object.keys(this.inputInterval))clearInterval(this.inputInterval[e]);this.buttonLock=[]}getActiveConfig(e){return this.configs[this.selectedDevice[e]]?.padID?this.configs[this.selectedDevice[e]]:null}getIconForLatestInputRecorded(e){return this.lastSource==="keyboard"&&this.ensureKeyboardIsInit(),dT(this.configs,this.lastSource,this.selectedDevice,e)}getLastSourceDevice(){return this.lastSource==="gamepad"?Me.GAMEPAD:Me.KEYBOARD}getLastSourceConfig(){const e=this.getLastSourceDevice();return e===Me.KEYBOARD&&this.ensureKeyboardIsInit(),this.getActiveConfig(e)}getLastSourceType(){return this.getLastSourceConfig()?.padType}injectConfig(e,t){this.configs[e]||(this.configs[e]={});const i={BUTTON_CYCLE_VARIANT:"BUTTON_CYCLE_TERA"};for(const n in t.custom)t.custom[n]in i&&(t.custom[n]=i[t.custom[n]]);this.configs[e].custom=t.custom}resetConfigs(){this.configs=new Map,this.getGamepadsName()?.length&&this.setupGamepad(this.selectedDevice[Me.GAMEPAD]),this.setupKeyboard()}assignBinding(e,t,i){return this.deactivatePressedKey(),e.padType==="keyboard"?pT(e,t,i):fT(e,t,i)}};c(xh,"InputsController");let Nr=xh;var ha=(C=>(C[C.POST_SUMMON=0]="POST_SUMMON",C))(ha||{});const Oh=class Oh extends je{phaseName="ActivatePriorityQueuePhase";type;constructor(e){super(),this.type=e}start(){super.start(),s.phaseManager.startDynamicPhaseType(this.type),this.end()}getType(){return this.type}};c(Oh,"ActivatePriorityQueuePhase");let ki=Oh;var vi;let IT=(vi=class extends ut{pokemon;originalMaxHp;originalHp;pokemonSprite;pokemonEvoTintSprite;pokemonEvoSprite;field;constructor(e,t){super(),this.pokemon=e,this.scene=t,this.originalMaxHp=e.getMaxHp(!1),this.originalHp=e.hp}start(){const e=this.pokemon.speciesId;if(e===pe.ZACIAN||e===pe.ZAMAZENTA){console.warn(`[DynamaxPhase] ${this.pokemon.name}     .`),s.playSound("se/error"),this.end();return}super.start(),this.pokemon.isDynamaxed=!0,this.pokemon.dynamaxPhase=this;const t=this.scene.field;if(this.field=t,!t){console.warn("[DynamaxPhase] field not found");return}const n=[os.GIGANTAMAX,os.GIGANTAMAX_SINGLE,os.GIGANTAMAX_RAPID,os.ETERNAMAX].includes(this.pokemon.formKey),a=this.pokemon.getMaxHp(),r=this.originalMaxHp>0?this.originalHp/this.originalMaxHp:1,o=Math.min(r,1);if(o>=1)this.pokemon.hp=a;else{const l=a-this.originalMaxHp;this.pokemon.hp=Math.min(Math.floor(a*o+l),a)}this.pokemon.updateScale(),this.pokemon.updateHpBar?.(),this.pokemon.updateScale(),s.time.delayedCall(300,()=>{s.playSound("se/beam"),this.doArcDownward?.();const l=this.scene.scale.width/2,h=this.scene.scale.height/2,u=this.field.getBounds(),p=u.x+u.width/2,f=u.y+u.height/2,d=n?3.5:4,y=l-p*d/this.field.scaleX-546,g=h-f*d/this.field.scaleY+96;this.pokemon.getSprite(),this.scene.tweens.add({targets:this.field,scale:d,x:this.field.x+y,y:this.field.y+g,duration:1e3,ease:"Sine.easeInOut",onComplete:c(()=>{this.field.getBounds()},"onComplete")}),s.time.delayedCall(1e3,()=>{this.pokemonEvoTintSprite?.setScale(.25),this.pokemonEvoTintSprite?.setVisible(!0),this.doCycle?.(1,1).then(()=>{s.playSound("se/sparkle"),this.pokemonEvoSprite?.setVisible(!0),this.doCircleInward?.(),s.time.delayedCall(900,()=>{s.tweens.add({targets:this.pokemon.getSprite(),scale:this.pokemon.getSpriteScale(),duration:500,ease:"Sine.easeInOut",onComplete:c(()=>{this.pokemon.cry(this.pokemon.getHpRatio()>.25?void 0:{rate:.85}),this.pokemon.getSprite().clearTint(),this.pokemon.summonData.speciesForm&&this.pokemon.loadAssets(!1),s.phaseManager.unshiftNew("EndEvolutionPhase"),this.end()},"onComplete")})})})})})}adjustHpChange(e){return Math.floor(e/2)}isForceSwitchImmunity(e){return this.pokemon.isDynamaxed&&e}applyAbAttrs(e,t,i,...n){if(this.pokemon.isDynamaxed){if(e===zd){new zd().apply(t,!1,!1,i,n);return}if(e===jf){let a=n.find(r=>r instanceof BooleanHolder);a||(a=new BooleanHolder(!1),n.push(a)),a.value=!0;return}if(e===$f){let a=n.find(r=>r instanceof BooleanHolder);a||(a=new BooleanHolder(!1),n.push(a)),a.value=!0;return}e===PreApplyBattlerTagAbAttr&&t.addBattleAttribute(new PreApplyBattlerTagImmunityAbAttr([BattlerTagType.TAUNT,BattlerTagType.TORMENT,BattlerTagType.HEAL_BLOCK,BattlerTagType.INFATUATED,BattlerTagType.DISABLED,BattlerTagType.ENCORE,BattlerTagType.PERISH_SONG,BattlerTagType.DESTINY_BOND]))}}doArcDownward(){}doCycle(e,t){return Promise.resolve()}doCircleInward(){}},c(vi,"DynamaxPhase"),vi);const wh=class wh extends Ut{phaseName="PostSummonPhase";start(){super.start();const e=this.getPokemon();console.debug(`[PostSummonPhase] Start for ${e.name}`),e.status?.effect===Yt.TOXIC&&(e.status.toxicTurnCount=0),s.arena.applyTags(rh,!1,e);const t=new Set([Ae.POMEG,Ae.KELPSY,Ae.QUALOT,Ae.HONDEW,Ae.GREPA,Ae.TAMATO]);let i=s.getModifiers(ds,e.isPlayer())?.find(f=>f instanceof ds&&f.pokemonId===e.id),n;try{n=e.getHeldBerryType?.()}catch{n=void 0}let a;if(i&&t.has(i.berryType)?a=i.berryType:n&&t.has(n)&&(a=n),a!==void 0){const f=s.phaseManager.phaseQueuePrepend?.some(d=>d.phaseName==="BerryPhase")||s.phaseManager.phaseQueue?.some(d=>d.phaseName==="BerryPhase");if(!i){const d=ModifierType.BERRY();i=new ds(d,e.id,a),s.addModifier(i,e.isPlayer()),s.updateModifiers(e.isPlayer()),console.debug(`[PostSummonPhase] ${e.name} BerryModifier(${Ae[a]}) `)}f||(console.debug(`[PostSummonPhase] ${e.name}: ${Ae[a]}   BerryPhase  `),s.phaseManager.unshiftNew("BerryPhase"))}s.currentBattle.isBattleMysteryEncounter()&&e.findTags(f=>f instanceof Xf).length>0&&e.lapseTag(Xe.MYSTERY_ENCOUNTER_POST_SUMMON),this.applyBoostEnergyTag(e),console.debug("[PostSummonPhase] BoostEnergyTagAttr  "),Oe("BoostEnergyTagAttr",e);const r=e.isPlayer()?s.getPlayerField():s.getEnemyField();for(const f of r)Oe("CommanderAbAttr",{pokemon:f});const o=s.getModifiers(Zi),l=new Set([pe.ZACIAN,pe.ZAMAZENTA]);for(const f of o){const d=f.getPokemon?.();d&&(l.has(d.speciesId)||d.isOnField?.()&&!d.isDynamaxed&&!d.isMax?.()&&s.phaseManager.unshiftPhase(new IT(d,s)))}const h=s.getModifiers(gi,!0).filter(f=>f instanceof gi);if(h.length>0&&s.arena)for(const f of h){const d=f.weatherType,y=s.arena.weather?.weatherType??es.NONE,g=s.arena.weather?.turnsLeft??0,T=f.getRemainingTurns();if(y===d&&g>0){`${es[d]}${g}`;continue}`${es[d]}`,s.arena.trySetWeather(d)&&s.arena.weather&&(T>0&&T<f.getMaxBattles()?(s.arena.weather.turnsLeft=T,`${es[d]}${T}`):(s.arena.weather.turnsLeft=f.getMaxBattles(),f.setRemainingTurns(s.arena.weather.turnsLeft),`${es[d]}${f.getMaxBattles()}`))}const u=s.getModifiers(mi,!0).filter(f=>f instanceof mi);if(u.length>0&&s.arena)for(const f of u){const d=f.terrainType,y=s.arena.terrain?.terrainType??us.NONE,g=s.arena.terrain?.turnsLeft??0,T=f.getRemainingTurns();if(y===d&&g>0){`${us[d]}${g}`;continue}`${us[d]}`,s.arena.trySetTerrain(d)&&s.arena.terrain&&(T>0&&T<f.getMaxBattles()?(s.arena.terrain.turnsLeft=T,`${us[d]}${T}`):(s.arena.terrain.turnsLeft=f.getMaxBattles(),f.setRemainingTurns(s.arena.terrain.turnsLeft),`${us[d]}${f.getMaxBattles()}`))}const p=s.findModifier(f=>f instanceof ds&&f.pokemonId===e.id,e.isPlayer());p&&(s.removeModifier(p,e.isPlayer()),console.debug(`[PostSummonPhase] ${e.name}  BerryModifier  `)),this.end()}applyBoostEnergyTag(e){const t=s.getModifiers(jd).find(o=>o.pokemonId===e.id);if(!t)return;let i=null,n=Number.NEGATIVE_INFINITY;for(const o of Zn){const l=e.getEffectiveStat(o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);l>n&&(n=l,i=o)}if(!i){e.name;return}t.apply(e,[i],1.3),s.updateModifiers(e.isPlayer());const r=e.getHeldItems().find(o=>o instanceof jd);r&&(e.loseHeldItem(r),s.updateModifiers(e.isPlayer()),`${e.name}`),this.activateProtosynthesis(e),this.activateQuarkDrive(e)}activateProtosynthesis(e){if(!e.summonData?.tags){console.warn(`[PostSummonPhase] ${e.name} tag container not ready, skipping Protosynthesis`);return}e.addTag(Xe.PROTOSYNTHESIS,0)||console.warn("[PostSummonPhase] Failed to add Protosynthesis tag")}activateQuarkDrive(e){if(!e.summonData?.tags){console.warn(`[PostSummonPhase] ${e.name} tag container not ready, skipping Quark Drive`);return}e.addTag(Xe.QUARK_DRIVE,0)||console.warn("[PostSummonPhase] Failed to add Quark Drive tag")}getPriority(){return 0}};c(wh,"PostSummonPhase");let ln=wh;const Mh=class Mh extends ln{priority;passive;constructor(e,t,i){super(e),this.priority=t,this.passive=i}start(){const e=this.getPokemon?.();if(!e){this.end();return}Oe("PostSummonAbAttr",{pokemon:e,passive:this.passive});const t=new Set([Ae.POMEG,Ae.KELPSY,Ae.QUALOT,Ae.HONDEW,Ae.GREPA,Ae.TAMATO]),i=e.getHeldBerryType?.();`${i!==void 0?Ae[i]:"none"}`;const n=globalScene.getModifiers(ds,e.isPlayer()).filter(r=>r instanceof ds&&r.pokemonId===e.id);if(`${n.map(r=>Ae[r.berryType]).join(", ")}`,t.has(i)&&n.length===0){const r=ModifierType.BERRY(),o=new ds(r,e.id,i);globalScene.addModifier(o,e.isPlayer()),globalScene.updateModifiers(e.isPlayer()),`${Ae[i]}`,n.push(o)}const a=n.find(r=>t.has(r.berryType));if(a){const r=a.berryType;globalScene.phaseManager.phaseQueuePrepend?.some(l=>l.phaseName==="BerryPhase")||globalScene.phaseManager.phaseQueue?.some(l=>l.phaseName==="BerryPhase")||(`${e.name}${Ae[r]}`,globalScene.phaseManager.unshiftNew("BerryPhase")),e.turnData.hasUsedBerry=!0,`${e.name}`}else n.length>0?`${e.name}${Ae[n[0].berryType]}`:`${e.name}`;this.end()}getPriority(){return this.priority}};c(Mh,"PostSummonActivateAbilityPhase");let kr=Mh;const Nh=class Nh{pop(){return this.reorder(),this.queue.shift()}push(e){this.queue.push(e)}clear(){this.queue.splice(0,this.queue.length)}tryRemovePhase(e,t=1){if(t==="all")t=this.queue.length;else if(t<1)return 0;let i=0;do{const n=this.queue.findIndex(e);if(n===-1)break;this.queue.splice(n,1),i++}while(i<t&&this.queue.length>0);return i}};c(Nh,"PhasePriorityQueue");let Pr=Nh;const kh=class kh extends Pr{queue=[];reorder(){this.queue.sort((e,t)=>e.getPriority()===t.getPriority()?(t.getPokemon().getEffectiveStat(Ws.SPD)-e.getPokemon().getEffectiveStat(Ws.SPD))*(vT()?-1:1):t.getPriority()-e.getPriority())}push(e){super.push(e),this.queueAbilityPhase(e)}queueAbilityPhase(e){const t=e.getPokemon();t.getAbilityPriorities().forEach((i,n)=>{this.queue.push(new kr(t.getBattlerIndex(),i,!!n)),s.phaseManager.appendToPhase(new ki(ha.POST_SUMMON),"ActivatePriorityQueuePhase",a=>a.getType()===ha.POST_SUMMON)})}};c(kh,"PostSummonPhasePriorityQueue");let Br=kh;function vT(){const C=new ot(!1);return s.arena.applyTags(Kp,!1,C),C.value}c(vT,"isTrickRoom");const Ph=class Ph extends je{phaseName="AddEnemyBuffModifierPhase";start(){super.start();const e=s.currentBattle.waveIndex,t=e%1e3?e%250?Re.COMMON:Re.GREAT:Re.ULTRA;oh(s.getEnemyParty(),ei.ENEMY_BUFF);const i=Math.ceil(e/250);for(let n=0;n<i;n++)s.addEnemyModifier(qf(t,s.findModifiers(a=>a instanceof Qf,!1)),!0,!0);s.updateModifiers(!1,!0),this.end()}};c(Ph,"AddEnemyBuffModifierPhase");let Lr=Ph;const Bh=class Bh extends Ut{phaseName="AttemptCapturePhase";pokeballType;pokeball;originalY;constructor(e,t){super(ct.ENEMY+e),this.pokeballType=t}start(){super.start();const e=this.getPokemon();if(!e?.hp)return this.end();const t=e.getTag(vs);t&&t.sprite.setVisible(!1),s.pokeballCounts[this.pokeballType]--,this.originalY=e.y;const i=3*e.getMaxHp(),n=2*e.hp,a=e.species.catchRate,r=Zf(this.pokeballType),o=e.status?Jf(e.status.effect):1,l=Math.round((i-n)*a*r/i*o),h=Math.round(65536/Math.pow(255/l,.1875)),u=eg(l),p=e.randBattleSeedInt(256)<u,f=e.getFieldPositionOffset(),d=Ji(this.pokeballType);this.pokeball=s.addFieldSprite(16,80,"pb",d),this.pokeball.setOrigin(.5,.625),s.field.add(this.pokeball),s.playSound(p?"se/crit_throw":"se/pb_throw"),s.time.delayedCall(300,()=>{s.field.moveBelow(this.pokeball,e)}),s.tweens.add({targets:this.pokeball,x:{value:236+f[0],ease:"Linear"},y:{value:16+f[1],ease:"Cubic.easeOut"},duration:500,onComplete:c(()=>{this.pokeball.setTexture("pb",`${d}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${d}_open`)),s.playSound("se/pb_rel"),e.tint(en(this.pokeballType)),zp(this.pokeball.x,this.pokeball.y,this.pokeballType),s.tweens.add({targets:e,duration:500,ease:"Sine.easeIn",scale:.25,y:20,onComplete:c(()=>{this.pokeball.setTexture("pb",`${d}_opening`),e.setVisible(!1),s.playSound("se/pb_catch"),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${d}`));const y=c(()=>{let g=0;const T=this.pokeball.x,E=s.tweens.addCounter({from:0,to:1,repeat:p?2:4,yoyo:!0,ease:"Cubic.easeOut",duration:250,repeatDelay:500,onUpdate:c(b=>{if(g&&g<(p?2:4)){const _=b.getValue()??0,O=g%2===1?1:-1;this.pokeball.setX(T+_*4*O),this.pokeball.setAngle(_*27.5*O)}},"onUpdate"),onRepeat:c(()=>{if(!e.species.isObtainable())E.stop(),this.failCatch(g);else if(g++<(p?1:3))r===-1||p||l>=255||e.randBattleSeedInt(65536)<h?s.playSound("se/pb_move"):(E.stop(),this.failCatch(g));else if(p&&e.randBattleSeedInt(65536)>=h)E.stop(),this.failCatch(g);else{s.playSound("se/pb_lock"),sg(this.pokeball);const b=s.add.sprite(this.pokeball.x,this.pokeball.y,"pb","pb");b.setOrigin(this.pokeball.originX,this.pokeball.originY),b.setTintFill(0),b.setAlpha(0),s.field.add(b),s.tweens.add({targets:b,alpha:.375,duration:200,easing:"Sine.easeOut",onComplete:c(()=>{s.tweens.add({targets:b,alpha:0,duration:200,easing:"Sine.easeIn",onComplete:c(()=>b.destroy(),"onComplete")})},"onComplete")})}},"onRepeat"),onComplete:c(()=>{this.catch()},"onComplete")})},"doShake");s.time.delayedCall(250,()=>tg(this.pokeball,16,72,350,y,p))},"onComplete")})},"onComplete")})}failCatch(e){const t=this.getPokemon();s.playSound("se/pb_rel"),t.setY(this.originalY),t.status?.effect!==Yt.SLEEP&&t.cry(t.getHpRatio()>.25?void 0:{rate:.85}),t.tint(en(this.pokeballType)),t.setVisible(!0),t.untint(250,"Sine.easeOut");const i=t.getTag(vs);i&&i.sprite.setVisible(!0);const n=Ji(this.pokeballType);this.pokeball.setTexture("pb",`${n}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${n}_open`)),s.tweens.add({targets:t,duration:250,ease:"Sine.easeOut",scale:1}),s.currentBattle.lastUsedPokeball=this.pokeballType,this.removePb(),this.end()}catch(){const e=this.getPokemon(),t=e.fusionSpecies?e.getFusionSpeciesForm():e.getSpeciesForm();t.abilityHidden&&(e.fusionSpecies?e.fusionAbilityIndex:e.abilityIndex)===t.getAbilityCount()-1&&s.validateAchv(Pe.HIDDEN_ABILITY),e.species.subLegendary&&s.validateAchv(Pe.CATCH_SUB_LEGENDARY),e.species.legendary&&s.validateAchv(Pe.CATCH_LEGENDARY),e.species.mythical&&s.validateAchv(Pe.CATCH_MYTHICAL),s.pokemonInfoContainer.show(e,!0),s.gameData.updateSpeciesDexIvs(e.species.getRootSpeciesId(!0),e.ivs);const i=new ot(!0);fs(gs.POKEMON_ADD_TO_PARTY,e,i),s.ui.showText(m.t(i.value?"battle:pokemonCaught":"battle:pokemonCaughtButChallenge",{pokemonName:Ne(e)}),null,()=>{const n=c(()=>{s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),s.pokemonInfoContainer.hide(),this.removePb(),this.end()},"end"),a=c(()=>{s.addFaintedEnemyScore(e),e.hp=0,e.doSetStatus(Yt.FAINT),s.clearEnemyHeldItemModifiers(),e.leaveField(!0,!0,!0)},"removePokemon"),r=c(o=>{const l=e.addToParty(this.pokeballType,o),h=s.findModifiers(u=>u instanceof ls,!1);s.getPlayerParty().filter(u=>u.isShiny()).length===Jn&&s.validateAchv(Pe.SHINY_PARTY),Promise.all(h.map(u=>s.addModifier(u,!0))).then(()=>{s.updateModifiers(!0),a(),l?(l.leaveField(!0,!0,!1),l.loadAssets().then(n)):n()})},"addToParty");Promise.all([e.hideInfo(),s.gameData.setPokemonCaught(e)]).then(()=>{if(!i.value){a(),n();return}if(s.getPlayerParty().length===Jn){const o=c(()=>{s.ui.showText(m.t("battle:partyFull",{pokemonName:e.getNameToRender()}),null,()=>{s.pokemonInfoContainer.makeRoomForConfirmUi(1,!0),s.ui.setMode(x.CONFIRM,()=>{const l=s.addPlayerPokemon(e.species,e.level,e.abilityIndex,e.formIndex,e.gender,e.shiny,e.variant,e.ivs,e.nature,e);s.ui.setMode(x.SUMMARY,l,0,jp.DEFAULT,()=>{s.ui.setMode(x.MESSAGE).then(()=>{o()})},!1)},()=>{const l={shiny:e.shiny,variant:e.variant,form:e.formIndex,female:e.gender===kt.FEMALE};s.ui.setOverlayMode(x.POKEDEX_PAGE,e.species,l,null,null,()=>{s.ui.setMode(x.MESSAGE).then(()=>{o()})})},()=>{s.ui.setMode(x.PARTY,tn.RELEASE,this.fieldIndex,(l,h)=>{s.ui.setMode(x.MESSAGE).then(()=>{l<6?r(l):o()})})},()=>{s.ui.setMode(x.MESSAGE).then(()=>{a(),n()})},"fullParty")})},"promptRelease");o()}else r()})},0,!0)}removePb(){s.tweens.add({targets:this.pokeball,duration:250,delay:250,ease:"Sine.easeIn",alpha:0,onComplete:c(()=>this.pokeball.destroy(),"onComplete")})}};c(Bh,"AttemptCapturePhase");let Dr=Bh;const Lh=class Lh extends Ks{forceFailEscape=!1;start(){super.start();const e=s.getPlayerField(!0)[0],t=new Pt(0);this.attemptRunAway(s.getPlayerField(),s.getEnemyField(),t),(e.arena?.getAllies(e)??[]).forEach(l=>{l.name,l.isFainted(),l.heldItem?.modifierType,l.hasHeldItemOfType($d.SMOKE_BALL),l.arena?.getTags(),l.arena?.hasTag(ArenaTagType.NEUTRALIZING_GAS)}),s.getPlayerField().forEach(l=>{l.hasHeldItemOfType($d.SMOKE_BALL)&&(t.value=256,e.battleData.escapeChance=256),s.applyModifiers(ig,l.isPlayer(),l)}),t.value<256&&Oe("RunSuccessAbAttr",{pokemon:e,chance:t});const r=e.randBattleSeedInt(100),o=r<t.value&&!this.forceFailEscape;t.value,this.forceFailEscape,o?(s.playSound("se/flee"),s.phaseManager.queueMessage(m.t("battle:runAwaySuccess"),null,!0,500),s.tweens.add({targets:[s.arenaEnemy,s.getEnemyField()].flat(),alpha:0,duration:250,ease:"Sine.easeIn",onComplete:c(()=>s.getEnemyField().forEach(l=>l.destroy()),"onComplete")}),s.clearEnemyHeldItemModifiers(),s.getEnemyField().forEach(l=>{l.hideInfo().then(()=>l.destroy()),l.hp=0,l.trySetStatus(Yt.FAINT)}),s.phaseManager.pushNew("BattleEndPhase",!1),(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")):(e.turnData.failedRunAway=!0,s.queueMessage(m.t("battle:runAwayCannotEscape"),null,!0,500)),this.end()}attemptRunAway(e,t,i){const n=t.reduce((d,y)=>d+y.getStat(Ws.SPD),0),a=e.reduce((d,y)=>d+y.getStat(Ws.SPD),0),r=t.some(d=>d.isBoss()),o=a/n,l=r?6:4,h=5,u=r?45:95,p=r?2:10,f=(u-h)/l;i.value=Phaser.Math.Clamp(Math.round(f*o+h+p*s.currentBattle.escapeAttempts++),h,u)}};c(Lh,"AttemptRunPhase");let Rr=Lh;const Dh=class Dh extends ut{phaseName="BattleEndPhase";isVictory;constructor(e){super(),this.isVictory=e}start(){for(super.start(),s.phaseManager.phaseQueue=s.phaseManager.phaseQueue.filter(t=>t.is("BattleEndPhase")?(this.isVictory||=t.isVictory,!1):!0);s.phaseManager.tryRemoveUnshiftedPhase(t=>t.is("BattleEndPhase")?(this.isVictory||=t.isVictory,!0):!1););if(s.gameData.gameStats.battles++,s.gameMode.isEndless&&s.currentBattle.waveIndex+1>s.gameData.gameStats.highestEndlessWave&&(s.gameData.gameStats.highestEndlessWave=s.currentBattle.waveIndex+1),this.isVictory&&(s.currentBattle.addBattleScore(),s.currentBattle.trainer&&s.gameData.gameStats.trainersDefeated++),s.gameMode.isEndless&&s.currentBattle.waveIndex>=5850&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase",!0)),this.isVictory)for(const t of s.getField())t?.battleSummonData&&(t.battleSummonData.waveTurnCount=1);for(const t of s.getPokemonAllowedInBattle()){Oe("PostBattleAbAttr",{pokemon:t,victory:this.isVictory});const i=s.getModifiers(Xd).find(n=>n.pokemonId===t.id);if(i instanceof Xd)try{i.applyPostBattleIfPossible(t,this.isVictory)}catch(n){console.error("[PostBattleLootItemModifier]   ",n)}}s.currentBattle.moneyScattered&&s.currentBattle.pickUpScatteredMoney(),s.clearEnemyHeldItemModifiers();for(const t of s.getEnemyParty())try{t.destroy()}catch{console.warn("Unable to destroy stale pokemon object in BattleEndPhase:",t)}const e=s.findModifiers(t=>t instanceof ng||t instanceof qd);for(const t of e){const i=[];t instanceof qd&&i.push(s.getPokemonById(t.pokemonId)),t.lapse(...i)||s.removeModifier(t)}s.updateModifiers(),this.end()}};c(Dh,"BattleEndPhase");let Fr=Dh;const Rh=class Rh extends Ks{phaseName="BerryPhase";start(){super.start(),this.executeForAll(e=>{this.eatBerries(e),Oe("CudChewConsumeBerryAbAttr",{pokemon:e})}),this.end()}eatBerries(e){if(e.getTag?.(Xe.BERRY_USED)||!!!s.findModifier(r=>r instanceof ds&&r.shouldApply(e),e.isPlayer()))return;if(e.getOpponents().some(r=>s.getModifiers(ag).some(o=>o.pokemonId===r.id))){s.phaseManager.queueMessage(m.t("abilityTriggers:preventBerryUse",{pokemonNameWithAffix:Ne(e)}));return}const a=new ot(!1);if(e.getOpponents().forEach(r=>Oe("PreventBerryUseAbAttr",{pokemon:r,cancelled:a})),a.value){s.phaseManager.queueMessage(m.t("abilityTriggers:preventBerryUse",{pokemonNameWithAffix:Ne(e)}));return}s.phaseManager.unshiftNew("CommonAnimPhase",e.getBattlerIndex(),e.getBattlerIndex(),ni.USE_ITEM);for(const r of s.applyModifiers(ds,e.isPlayer(),e))r.consumed&&(r.consumed=!1,e.loseHeldItem(r)),s.eventTarget.dispatchEvent(new rg(r));s.updateModifiers(e.isPlayer()),Oe("HealFromBerryUseAbAttr",{pokemon:e})}};c(Rh,"BerryPhase");let Ur=Rh;const Fh=class Fh extends je{phaseName="CheckInterludePhase";start(){super.start();const{phaseManager:e}=s,{waveIndex:t}=s.currentBattle;t%10===0&&s.getEnemyParty().every(i=>i.isFainted())&&e.onInterlude(),this.end()}};c(Fh,"CheckInterludePhase");let Vr=Fh;const Uh=class Uh extends je{phaseName="CheckStatusEffectPhase";order;constructor(e){super(),this.order=e}start(){const e=s.getField();for(const t of this.order)e[t].status?.isPostTurn()&&s.phaseManager.unshiftNew("PostTurnStatusEffectPhase",t);this.end()}};c(Uh,"CheckStatusEffectPhase");let Hr=Uh;var Th=(C=>(C[C.SWITCH=0]="SWITCH",C[C.SET=1]="SET",C))(Th||{});const Vh=class Vh extends ut{phaseName="CheckSwitchPhase";fieldIndex;useName;constructor(e,t){super(),this.fieldIndex=e,this.useName=t}start(){super.start();const e=s.getPlayerField()[this.fieldIndex];if(s.battleStyle===Th.SET)return super.end();if(s.field.getAll().indexOf(e)===-1)return s.phaseManager.unshiftNew("SummonMissingPhase",this.fieldIndex),super.end();if(!s.getPlayerParty().slice(1).filter(t=>t.isActive()).length)return super.end();if(e.getTag(Xe.FRENZY)||e.isTrapped()||s.getPlayerField().some(t=>t.getTag(Xe.COMMANDED)))return super.end();s.ui.showText(m.t("battle:switchQuestion",{pokemonName:this.useName?Ne(e):m.t("battle:pokemon")}),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.setMode(x.MESSAGE),s.phaseManager.unshiftNew("SwitchPhase",gt.INITIAL_SWITCH,this.fieldIndex,!1,!0),this.end()},()=>{s.ui.setMode(x.MESSAGE),this.end()})})}};c(Vh,"CheckSwitchPhase");let Yr=Vh;const Hh=class Hh extends Ks{phaseName="CommandPhase";fieldIndex;isSwitch=!1;constructor(e){super(),this.fieldIndex=e}resetCursorIfNeeded(){const e=s.ui.handlers[x.COMMAND],{arena:t,commandCursorMemory:i,currentBattle:n}=s,{battleType:a,turn:r}=n,{biomeType:o}=t,l=a===ue.MYSTERY_ENCOUNTER||a===ue.TRAINER||o===Je.END;e&&(r===1&&(!i||l)||e.getCursor()===Ke.POKEMON)&&e.setCursor(Ke.FIGHT)}handleFieldIndexLogic(){if(s.getPlayerField().filter(t=>t.isActive()).length===1){this.fieldIndex=cs.CENTER;return}const e=s.currentBattle.turnCommands[this.fieldIndex-1];(e?.command===Ke.BALL||e?.command===Ke.RUN)&&(s.currentBattle.turnCommands[this.fieldIndex]={command:e?.command,skip:!0})}checkCommander(){s.currentBattle?.double&&this.getPokemon().getAlly()?.getTag(Xe.COMMANDED)?.getSourcePokemon()===this.getPokemon()&&(s.currentBattle.turnCommands[this.fieldIndex]={command:Ke.FIGHT,move:{move:Ot.NONE,targets:[],useMode:ti.NORMAL},skip:!0})}clearUnusableMoves(){const e=this.getPokemon(),t=e.getMoveQueue();if(t.length===0)return;let i=0;const n=e.getMoveset();for(const a of t){const r=n.find(o=>o.moveId===a.move);if(a.move!==Ot.NONE&&!Qd(a.useMode)&&!r?.isUsable(e,Zd(a.useMode)))i++;else break}i&&t.splice(0,i)}tryExecuteQueuedMove(){this.clearUnusableMoves();const e=s.getPlayerField()[this.fieldIndex],t=e.getMoveQueue();if(t.length===0)return!1;const i=t[0];if(i.move===Ot.NONE)return this.handleCommand(Ke.FIGHT,-1),!0;const n=e.getMoveset().findIndex(a=>a.moveId===i.move);return!Qd(i.useMode)&&n===-1?s.ui.setMode(x.COMMAND,this.fieldIndex):this.handleCommand(Ke.FIGHT,n,i.useMode,i),!0}start(){if(super.start(),s.updateGameInfo(),this.resetCursorIfNeeded(),this.fieldIndex&&this.handleFieldIndexLogic(),this.checkCommander(),this.getPokemon().lapseTag(Xe.ENCORE),s.currentBattle.turnCommands[this.fieldIndex]?.skip){this.end();return}this.tryExecuteQueuedMove()||(s.currentBattle.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter?.skipToFightInput?(s.ui.clearText(),s.ui.setMode(x.FIGHT,this.fieldIndex)):s.ui.setMode(x.COMMAND,this.fieldIndex))}queueFightErrorMessage(e,t){s.ui.setMode(x.MESSAGE);let i;const n=new ot(!0);fs(gs.POKEMON_MOVE,t.moveId,n),n.value?t.getPpRatio()===0?i="battle:moveNoPP":t.getName().endsWith(" (N)")?i="battle:moveNotImplemented":e.isMoveRestricted(t.moveId,e)?i=e.getRestrictingTag(t.moveId,e).selectionDeniedText(e,t.moveId):i="":i="battle:moveCannotUseChallenge";const a=t.getName().replace(" (N)","");s.ui.showText(m.t(i,{moveName:a}),null,()=>{s.ui.clearText(),s.ui.setMode(x.FIGHT,this.fieldIndex)},null,!0)}computeMoveId(e,t,i){return i?.move??(t>-1?e.getMoveset()[t]?.moveId:Ot.NONE)}handleFightCommand(e,t,i=ti.NORMAL,n){const a=this.getPokemon(),r=Zd(i);let o=t===-1||a.trySelectMove(t,r);const l=a.getMoveset(),h=o?!1:t>-1&&!l.some(y=>y.isUsable(a));if(o||=h,!o)return l[t]&&this.queueFightErrorMessage(a,l[t]),!1;const u=h?Ot.STRUGGLE:this.computeMoveId(a,t,n),p={command:Ke.FIGHT,cursor:t,move:{move:u,targets:[],useMode:i},args:[i,n]},f={command:e,targets:[this.fieldIndex],skip:e===Ke.FIGHT},d=n===void 0?lh(a,u):{targets:n.targets,multiple:n.targets.length>1};return u===Ot.NONE&&(p.targets=[this.fieldIndex]),Ot[u],Ne(a),d.targets.length>1&&d.multiple&&s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),p.move&&(d.targets.length<=1||d.multiple)?p.move.targets=d.targets:p.move&&a.getTag(Xe.CHARGING)&&a.getMoveQueue().length>=1?p.move.targets=a.getMoveQueue()[0].targets:s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),s.currentBattle.preTurnCommands[this.fieldIndex]=f,s.currentBattle.turnCommands[this.fieldIndex]=p,!0}queueShowText(e){s.ui.setMode(x.COMMAND,this.fieldIndex),s.ui.setMode(x.MESSAGE),s.ui.showText(m.t(e),null,()=>{s.ui.showText("",0),s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)}checkCanUseBall(){const{arena:e,currentBattle:t,gameData:i,gameMode:n}=s,{battleType:a}=t,{biomeType:r}=e,{isClassic:o,isEndless:l,isDaily:h}=n,{dexData:u}=i,p=n.isBattleClassicFinalBoss(s.currentBattle.waveIndex),f=n.isEndlessMinorBoss(s.currentBattle.waveIndex),d=n.isFullFreshStartChallenge(),y=s.getEnemyField().some(T=>T.isActive()&&!u[T.species.speciesId].caughtAttr),g=i.getStarterCount(T=>!!T.caughtAttr)<Object.keys(ze).length-1;if(r===Je.END&&a===ue.WILD)if(o&&!p&&y||d&&!p||l&&!f)this.queueShowText("battle:noPokeballForce");else if(o&&p&&g||d&&p||l&&f||h)this.queueShowText("battle:noPokeballForceFinalBoss");else return!0;else if(a===ue.TRAINER)this.queueShowText("battle:noPokeballTrainer");else if(t.isBattleMysteryEncounter()&&!t.mysteryEncounter.catchAllowed)this.queueShowText("battle:noPokeballMysteryEncounter");else return!0;return!1}handleBallCommand(e){const t=s.getEnemyField().filter(r=>r.isActive(!0)).map(r=>r.getBattlerIndex());if(!this.checkCanUseBall())return!1;if(t.length>1)return this.queueShowText("battle:noPokeballMulti"),!1;const i=s.gameMode.hasAnyChallenges(),n=s.gameMode.isBattleClassicFinalBoss(s.currentBattle.waveIndex);if(e<5){const r=s.getEnemyPokemon();if(r?.isBoss()&&r?.bossSegmentIndex>=1&&!r?.hasAbility(Ha.WONDER_GUARD,!1,!0)){if(n&&(e<Si.MASTER_BALL||e===Si.MASTER_BALL&&i))return this.queueShowText("battle:noPokeballForceFinalBossCatchable"),!1;if(e<Si.MASTER_BALL)return this.queueShowText("battle:noPokeballStrong"),!1}return s.currentBattle.turnCommands[this.fieldIndex]={command:Ke.BALL,cursor:e},s.currentBattle.turnCommands[this.fieldIndex].targets=t,this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),!0}return!1}handleTrap(){const e=this.getPokemon(),t=[],i=this.isSwitch;if(!e.isTrapped(t))return!1;if(t.length>0)i&&s.ui.setMode(x.MESSAGE).then(()=>{s.ui.showText(t[0],null,()=>{s.ui.showText("",0),i&&s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)});else{const n=e.getTag(og),a=s.arena.getTagOnSide(Ya.FAIRY_LOCK,sn.PLAYER);i||(s.ui.setMode(x.COMMAND,this.fieldIndex),s.ui.setMode(x.MESSAGE)),n?this.showNoEscapeText(n,!1):a&&this.showNoEscapeText(a,!1)}return!0}tryLeaveField(e,t=!1){const i=s.currentBattle;return t||!this.handleTrap()?(i.turnCommands[this.fieldIndex]=this.isSwitch?{command:Ke.POKEMON,cursor:e,args:[t]}:{command:Ke.RUN},!this.isSwitch&&this.fieldIndex&&(i.turnCommands[this.fieldIndex-1].skip=!0),!0):!1}handleRunCommand(){const{currentBattle:e,arena:t}=s,i=e.mysteryEncounter?.fleeAllowed??!0;return t.biomeType===Je.END||!i?(this.queueShowText("battle:noEscapeForce"),!1):e.battleType===ue.TRAINER||e.mysteryEncounter?.encounterMode===hs.TRAINER_BATTLE?(this.queueShowText("battle:noEscapeTrainer"),!1):this.tryLeaveField()}showNoEscapeText(e,t){s.ui.showText(m.t("battle:noEscapePokemon",{pokemonName:e.sourceId&&s.getPokemonById(e.sourceId)?Ne(s.getPokemonById(e.sourceId)):"",moveName:e.getMoveName(),escapeVerb:m.t(t?"battle:escapeVerbSwitch":"battle:escapeVerbFlee")}),null,()=>{s.ui.showText("",0),t||s.ui.setMode(x.COMMAND,this.fieldIndex)},null,!0)}handleCommand(e,t,i=!1,n){let a=!1;switch(e){case Ke.TERA:case Ke.FIGHT:a=this.handleFightCommand(e,t,typeof i=="boolean"?void 0:i,n);break;case Ke.BALL:a=this.handleBallCommand(t);break;case Ke.POKEMON:this.isSwitch=!0,a=this.tryLeaveField(t,typeof i=="boolean"?i:void 0),this.isSwitch=!1;break;case Ke.RUN:a=this.handleRunCommand()}return a&&this.end(),a}cancel(){this.fieldIndex&&(s.phaseManager.unshiftNew("CommandPhase",0),s.phaseManager.unshiftNew("CommandPhase",1),this.end())}getFieldIndex(){return this.fieldIndex}getPokemon(){return s.getPlayerField()[this.fieldIndex]}end(){s.ui.setMode(x.MESSAGE).then(()=>super.end())}};c(Hh,"CommandPhase");let Gr=Hh;const Yh=class Yh extends Ut{phaseName="CommonAnimPhase";anim;targetIndex;playOnEmptyField;constructor(e,t,i=null,n=!1){super(e),this.anim=i,this.targetIndex=t,this.playOnEmptyField=n}setAnimation(e){this.anim=e}start(){const e=this.targetIndex!==void 0?(this.player?s.getEnemyField():s.getPlayerField())[this.targetIndex]:this.getPokemon();new Ga(this.anim,this.getPokemon(),e).play(!1,()=>{this.end()})}};c(Yh,"CommonAnimPhase");let hn=Yh;const Gh=class Gh extends Ut{phaseName="DamageAnimPhase";amount;damageResult;critical;constructor(e,t,i=$e.EFFECTIVE,n=!1){super(e),this.amount=t,this.damageResult=i,this.critical=n}start(){if(super.start(),this.damageResult===$e.ONE_HIT_KO||this.damageResult===$e.INDIRECT_KO){s.moveAnimations&&s.toggleInvert(!0),s.time.delayedCall(ge(1e3),()=>{s.toggleInvert(!1),this.applyDamage()});return}this.applyDamage()}updateAmount(e){this.amount=e}applyDamage(){switch(this.damageResult){case $e.EFFECTIVE:case $e.CONFUSION:s.playSound("se/hit");break;case $e.SUPER_EFFECTIVE:case $e.INDIRECT_KO:case $e.ONE_HIT_KO:s.playSound("se/hit_strong");break;case $e.NOT_VERY_EFFECTIVE:s.playSound("se/hit_weak");break}if(this.amount&&s.damageNumberHandler.add(this.getPokemon(),this.amount,this.damageResult,this.critical),this.damageResult!==$e.INDIRECT&&this.amount>0){const e=s.time.addEvent({delay:100,repeat:5,startAt:200,callback:c(()=>{this.getPokemon().getSprite().setVisible(e.repeatCount%2===0),e.repeatCount||this.getPokemon().updateInfo().then(()=>this.end())},"callback")})}else this.getPokemon().updateInfo().then(()=>this.end())}end(){s.currentBattle.battleSpec===Ht.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};c(Gh,"DamageAnimPhase");let Wr=Gh;var Uf=(C=>(C.EGG_COUNT_CHANGED="onEggCountChanged",C))(Uf||{});const Wh=class Wh extends Event{eggCount;constructor(e){super("onEggCountChanged"),this.eggCount=e}};c(Wh,"EggCountChangedEvent");let Kr=Wh;const Kh=class Kh extends Phaser.GameObjects.Container{WINDOW_DEFAULT_WIDTH=37;WINDOW_MEDIUM_WIDTH=42;WINDOW_HEIGHT=26;onEggCountChangedEvent=c(e=>this.onEggCountChanged(e),"onEggCountChangedEvent");eggCount;eggCountWindow;eggCountText;constructor(e){super(s,0,0),this.eggCount=e,s.ui.getHandler().eventTarget.addEventListener(Uf.EGG_COUNT_CHANGED,this.onEggCountChangedEvent),this.setup()}setup(){const e=this.eggCount>9?this.WINDOW_MEDIUM_WIDTH:this.WINDOW_DEFAULT_WIDTH;this.eggCountWindow=ye(5,5,e,this.WINDOW_HEIGHT),this.setVisible(this.eggCount>1),this.add(this.eggCountWindow);const t=s.add.sprite(19,18,"egg","egg_0").setScale(.32);this.eggCountText=P(28,13,`${this.eggCount}`,A.MESSAGE,{fontSize:"66px"}).setName("text-egg-count"),this.add([t,this.eggCountText])}setWindowToDefaultSize(){this.eggCountWindow.setSize(this.WINDOW_DEFAULT_WIDTH,this.WINDOW_HEIGHT)}onEggCountChanged(e){const t=e;if(!t||!this.eggCountText?.data)return;const i=t.eggCount;i<10&&this.setWindowToDefaultSize(),i>0?this.eggCountText.setText(i.toString()):this.eggCountText.setVisible(!1)}};c(Kh,"EggCounterContainer");let zr=Kh;const Qi=class Qi extends $p{switchCheck;switchCheckCursor;constructor(){super(x.CONFIRM)}getWindowWidth(){return Qi.windowWidth}show(e){if(e.length===5&&e[0]instanceof Function&&e[1]instanceof Function&&e[2]instanceof Function&&e[3]instanceof Function&&e[4]==="fullParty"){const t={options:[{label:m.t("partyUiHandler:summary"),handler:c(()=>(e[0](),!0),"handler")},{label:m.t("partyUiHandler:pokedex"),handler:c(()=>(e[1](),!0),"handler")},{label:m.t("menu:yes"),handler:c(()=>(e[2](),!0),"handler")},{label:m.t("menu:no"),handler:c(()=>(e[3](),!0),"handler")}],delay:e.length>=9&&e[8]!==null?e[8]:0};super.show([t]),this.switchCheck=e.length>=6&&e[5]!==null&&e[5];const i=e.length>=7&&e[6]!==null?e[6]:0,n=e.length>=8&&e[7]!==null?e[7]:0;return this.optionSelectContainer.setPosition(s.scaledCanvas.width-1+i,-48+n),this.setCursor(this.switchCheck?this.switchCheckCursor:0),!0}if(e.length>=2&&e[0]instanceof Function&&e[1]instanceof Function){const t={options:[{label:m.t("menu:yes"),handler:c(()=>(e[0](),!0),"handler")},{label:m.t("menu:no"),handler:c(()=>(e[1](),!0),"handler")}],delay:e.length>=6&&e[5]!==null?e[5]:0,noCancel:e.length>=7&&e[6]!==null?e[6]:!1};super.show([t]),this.switchCheck=e.length>=3&&e[2]!==null&&e[2];const i=e.length>=4&&e[3]!==null?e[3]:0,n=e.length>=5&&e[4]!==null?e[4]:0;return this.optionSelectContainer.setPosition(s.scaledCanvas.width-1+i,-48+n),this.setCursor(this.switchCheck?this.switchCheckCursor:0),!0}return!1}processInput(e){return e===v.CANCEL&&this.blockInput&&!this.config?.noCancel&&this.unblockInput(),super.processInput(e)}setCursor(e){const t=super.setCursor(e);return t&&this.switchCheck&&(this.switchCheckCursor=this.cursor),t}};c(Qi,"ConfirmUiHandler"),qa(Qi,"windowWidth",48);let ca=Qi;const Ss=24,ci=[[0,-1],[.825,-.5],[.825,.5],[-.825,-.5],[-.825,.5],[0,1]],_T=-3,Fn=1,vp=[0,Fn,-Fn,Fn,-Fn,_T],AT=[0,5,0,5,0,0],ui=[0,1,2,5,4,3],Un=new Array(12).fill(0),zh=class zh extends Phaser.GameObjects.Container{showDiff;statsIvsCache;ivChart;ivStatValueTexts;constructor(e,t,i){super(s,e,t),this.showDiff=!!i,this.setup()}setup(){this.setName("stats");const e=new Array(6).fill(null).flatMap((a,r)=>[Ss*ci[ui[r]][0],Ss*ci[ui[r]][1]]),t=s.add.polygon(48,44,e,14213360,.625);t.setOrigin(0,0);const i=s.add.polygon(t.x,t.y,e).setStrokeStyle(1,4735056);i.setOrigin(0,0);const n=[[0,-1,0,1],[-.825,-.5,.825,.5],[.825,-.5,-.825,.5]].map(a=>{const r=new Phaser.GameObjects.Line(s,t.x,t.y,Ss*a[0],Ss*a[1],Ss*a[2],Ss*a[3],16777215).setLineWidth(.5);return r.setOrigin(0,0),r});this.ivChart=s.add.polygon(t.x,t.y,Un,10016928,.75),this.ivChart.setOrigin(0,0),this.add(t),n.map(a=>this.add(a)),this.add(this.ivChart),this.add(i),this.ivStatValueTexts=[];for(const a of Xi){const r=P(t.x+Ss*ci[a][0]*1.325+(this.showDiff?0:vp[a]),t.y+Ss*ci[a][1]*1.325-4+(this.showDiff?0:AT[a]),m.t(Xp(a)),A.STATS_HEXAGON);r.setOrigin(.5),this.ivStatValueTexts[a]=St(r.x-(this.showDiff?0:vp[a]),r.y+8,"0",A.STATS_HEXAGON),this.ivStatValueTexts[a].setOrigin(.5),this.add(r),this.add(this.ivStatValueTexts[a])}}updateIvs(e,t){if(e){const i=new Array(6).fill(null).flatMap((h,u)=>[e[ui[u]]/31*Ss*ci[ui[u]][0],e[ui[u]]/31*Ss*ci[ui[u]][1]]),n=this.statsIvsCache||Un,a=He(A.SUMMARY_GOLD,!1,s.uiTheme);this.statsIvsCache=i.slice(0),this.ivStatValueTexts.map((h,u)=>{let p="";e[u]===31?p+=`[color=${a}][shadow]${e[u].toString()}[/shadow][/color]`:p=e[u].toString(),this.showDiff&&t&&(t[u]<e[u]?p+=` ([color=${He(A.SUMMARY_BLUE,!1,s.uiTheme)}][shadow=${He(A.SUMMARY_BLUE,!0,s.uiTheme)}]+${e[u]-t[u]}[/shadow][/color])`:p+=" (-)"),h.setText(`[shadow]${p}[/shadow]`)});const r=e.every(h=>h===31)?Number.parseInt(a.substr(1),16):10016928,o=this.ivChart.fillColor,l=o!==r?[Phaser.Display.Color.IntegerToColor(o),Phaser.Display.Color.IntegerToColor(r)]:null;s.tweens.addCounter({from:0,to:1,duration:1e3,ease:"Cubic.easeOut",onUpdate:c(h=>{const u=h.getValue()??1,p=i.map((f,d)=>f*u+n[d]*(1-u));l&&this.ivChart.setFillStyle(Phaser.Display.Color.ValueToColor(Phaser.Display.Color.Interpolate.ColorWithColor(l[0],l[1],1,u)).color,.75),this.ivChart.setTo(p)},"onUpdate")})}else this.statsIvsCache=Un,this.ivChart.setTo(Un)}};c(zh,"StatsContainer");let cn=zh;const Vn={en:{infoContainerTextSize:"64px",infoContainerLabelXPos:-20,infoContainerTextXPos:-17},pt:{infoContainerTextSize:"60px",infoContainerLabelXPos:-15,infoContainerTextXPos:-12},ja:{infoContainerTextSize:"64px",infoContainerLabelXPos:-27,infoContainerTextXPos:-25}},jh=class jh extends Phaser.GameObjects.Container{infoWindowWidth=104;pokemonFormLabelText;pokemonFormText;pokemonGenderText;pokemonGenderNewText;pokemonAbilityLabelText;pokemonAbilityText;pokemonNatureLabelText;pokemonNatureText;pokemonShinyIcon;pokemonShinyNewIcon;pokemonFusionShinyIcon;pokemonMovesContainer;pokemonMovesContainers;pokemonMoveBgs;pokemonMoveLabels;infoBg;numCharsBeforeCutoff=16;initialX;movesContainerInitialX;statsContainer;shown;constructor(e=372,t=66){super(s,e,t),this.initialX=e}setup(){this.setName("pkmn-info");const e=m.resolvedLanguage,t=Object.keys(Vn).find(h=>e?.includes(h)),i=Vn[t];this.infoBg=ye(0,0,this.infoWindowWidth,132),this.infoBg.setOrigin(.5,.5),this.infoBg.setName("window-info-bg"),this.pokemonMovesContainer=s.add.container(6,14),this.pokemonMovesContainer.setName("pkmn-moves"),this.movesContainerInitialX=this.pokemonMovesContainer.x,this.pokemonMovesContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[];const n=ye(0,0,58,52);n.setOrigin(1,0),n.setName("window-moves-bg"),this.pokemonMovesContainer.add(n);const a=P(-n.width/2,6,m.t("pokemonInfoContainer:moveset"),A.WINDOW,{fontSize:"64px"});a.setOrigin(.5,0),a.setName("text-moves"),this.pokemonMovesContainer.add(a);for(let h=0;h<4;h++){const u=s.add.container(-6,18+7*h);u.setScale(.5),u.setName("move");const p=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);p.setOrigin(1,0),p.setName("nineslice-move-bg");const f=P(-p.width/2,0,"-",A.MOVE_LABEL);f.setOrigin(.5,0),f.setName("text-move-label"),this.pokemonMoveBgs.push(p),this.pokemonMoveLabels.push(f),u.add(p),u.add(f),this.pokemonMovesContainers.push(u),this.pokemonMovesContainer.add(u)}this.add(this.pokemonMovesContainer),this.statsContainer=new cn(-48,-64,!0),this.add(this.infoBg),this.add(this.statsContainer);const r=i?.infoContainerLabelXPos||-18,o=i?.infoContainerTextXPos||-14,l=i?.infoContainerTextSize||"64px";this.pokemonFormLabelText=P(r,19,m.t("pokemonInfoContainer:form"),A.WINDOW,{fontSize:l}),this.pokemonFormLabelText.setOrigin(1,0),this.pokemonFormLabelText.setVisible(!1),this.add(this.pokemonFormLabelText),this.pokemonFormText=P(o,19,"",A.WINDOW,{fontSize:l}),this.pokemonFormText.setOrigin(0,0),this.pokemonFormText.setVisible(!1),this.add(this.pokemonFormText),this.pokemonGenderText=P(-42,-61,"",A.WINDOW,{fontSize:l}),this.pokemonGenderText.setOrigin(0,0),this.pokemonGenderText.setVisible(!1),this.pokemonGenderText.setName("text-pkmn-gender"),this.add(this.pokemonGenderText),this.pokemonGenderNewText=P(-36,-61,"",A.WINDOW,{fontSize:"64px"}),this.pokemonGenderNewText.setOrigin(0,0),this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderNewText.setName("text-pkmn-new-gender"),this.add(this.pokemonGenderNewText),this.pokemonAbilityLabelText=P(r,29,m.t("pokemonInfoContainer:ability"),A.WINDOW,{fontSize:l}),this.pokemonAbilityLabelText.setOrigin(1,0),this.pokemonAbilityLabelText.setName("text-pkmn-ability-label"),this.add(this.pokemonAbilityLabelText),this.pokemonAbilityText=P(o,29,"",A.WINDOW,{fontSize:l}),this.pokemonAbilityText.setOrigin(0,0),this.pokemonAbilityText.setName("text-pkmn-ability"),this.add(this.pokemonAbilityText),this.pokemonNatureLabelText=P(r,39,m.t("pokemonInfoContainer:nature"),A.WINDOW,{fontSize:l}),this.pokemonNatureLabelText.setOrigin(1,0),this.pokemonNatureLabelText.setName("text-pkmn-nature-label"),this.add(this.pokemonNatureLabelText),this.pokemonNatureText=St(o,39,"",A.WINDOW,{fontSize:l,lineSpacing:3,maxLines:2}),this.pokemonNatureText.setOrigin(0,0),this.pokemonNatureText.setName("text-pkmn-nature"),this.add(this.pokemonNatureText),this.pokemonShinyIcon=s.add.image(-43.5,48.5,"shiny_star"),this.pokemonShinyIcon.setOrigin(0,0),this.pokemonShinyIcon.setScale(.75),this.pokemonShinyIcon.setInteractive(new Phaser.Geom.Rectangle(0,0,12,15),Phaser.Geom.Rectangle.Contains),this.pokemonShinyIcon.setName("img-pkmn-shiny-icon"),this.add(this.pokemonShinyIcon),this.pokemonShinyNewIcon=P(this.pokemonShinyIcon.x+12,this.pokemonShinyIcon.y,"",A.WINDOW,{fontSize:l}),this.pokemonShinyNewIcon.setOrigin(0,0),this.pokemonShinyNewIcon.setName("text-pkmn-shiny-new-icon"),this.add(this.pokemonShinyNewIcon),this.pokemonShinyNewIcon.setVisible(!1),this.pokemonFusionShinyIcon=s.add.image(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y,"shiny_star_2"),this.pokemonFusionShinyIcon.setOrigin(0,0),this.pokemonFusionShinyIcon.setScale(.75),this.pokemonFusionShinyIcon.setName("img-pkmn-fusion-shiny-icon"),this.add(this.pokemonFusionShinyIcon),this.setVisible(!1)}show(e,t=!1,i=1,n,a,r=!1){return new Promise(o=>{n||(n=s.gameData.dexData[e.species.speciesId]),a||(a=s.gameData.starterData[e.species.getRootSpeciesId()]);const l=BigInt(n.caughtAttr);if(e.gender>kt.GENDERLESS){this.pokemonGenderText.setText(hh(e.gender)),this.pokemonGenderText.setColor(Ai(e.gender)),this.pokemonGenderText.setShadowColor(Ai(e.gender,!0)),this.pokemonGenderText.setVisible(!0);const _=BigInt(1<<e.gender)*F.MALE;this.pokemonGenderNewText.setText("(+)"),this.pokemonGenderNewText.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonGenderNewText.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme)),this.pokemonGenderNewText.setVisible((_&l)===BigInt(0))}else this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderText.setVisible(!1);const h=e.species.getFormNameToDisplay(e.formIndex);h?(this.pokemonFormLabelText.setVisible(!0),this.pokemonFormText.setVisible(!0),(BigInt(1<<e.formIndex)*F.DEFAULT_FORM&l)===BigInt(0)?(this.pokemonFormLabelText.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonFormLabelText.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme))):(this.pokemonFormLabelText.setColor(He(A.WINDOW,!1,s.uiTheme)),this.pokemonFormLabelText.setShadowColor(He(A.WINDOW,!0,s.uiTheme))),this.pokemonFormText.setText(h.length>this.numCharsBeforeCutoff?`${h.substring(0,this.numCharsBeforeCutoff-3)}...`:h),h.length>this.numCharsBeforeCutoff?(this.pokemonFormText.setInteractive(new Phaser.Geom.Rectangle(0,0,this.pokemonFormText.width,this.pokemonFormText.height),Phaser.Geom.Rectangle.Contains),this.pokemonFormText.on("pointerover",()=>s.ui.showTooltip("",h,!0)),this.pokemonFormText.on("pointerout",()=>s.ui.hideTooltip())):this.pokemonFormText.disableInteractive()):(this.pokemonFormLabelText.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonFormText.disableInteractive());const u=e.abilityIndex===2?A.MONEY:A.WINDOW;this.pokemonAbilityText.setText(e.getAbility(!0).name),this.pokemonAbilityText.setColor(He(u,!1,s.uiTheme)),this.pokemonAbilityText.setShadowColor(He(u,!0,s.uiTheme)),e.checkIfPlayerHasAbilityOfStarter(a.abilityAttr)?(this.pokemonAbilityLabelText.setColor(He(A.WINDOW,!1,s.uiTheme)),this.pokemonAbilityLabelText.setShadowColor(He(A.WINDOW,!0,s.uiTheme))):(this.pokemonAbilityLabelText.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonAbilityLabelText.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme))),this.pokemonNatureText.setText(xi(e.getNature(),!0,!1,!1,s.uiTheme));const f=n.natureAttr,d=1<<e.nature+1;f&d?(this.pokemonNatureLabelText.setColor(He(A.WINDOW,!1,s.uiTheme)),this.pokemonNatureLabelText.setShadowColor(He(A.WINDOW,!0,s.uiTheme))):(this.pokemonNatureLabelText.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonNatureLabelText.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme)));const y=e.isFusion(),g=y&&e.shiny&&e.fusionShiny,T=g?e.variant:e.getVariant();if(this.pokemonShinyIcon.setTexture(`shiny_star${g?"_1":""}`),this.pokemonShinyIcon.setVisible(e.isShiny()),this.pokemonShinyIcon.setTint(mt(T)),this.pokemonShinyIcon.visible){let _="";(g||T)&&(_=" ("+Jd(T),g&&(_+="/"+Jd(e.fusionVariant)),_+=")"),this.pokemonShinyIcon.on("pointerover",()=>s.ui.showTooltip("",m.t("common:shinyOnHover")+_,!0)).on("pointerout",()=>s.ui.hideTooltip());const O=BigInt(1<<(e.shiny?1:0)),w=BigInt(1<<e.variant+4);this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonShinyNewIcon.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme));const U=(O&l)===BigInt(0)||(w&l)===BigInt(0);this.pokemonShinyNewIcon.setVisible(!!U)}else(l&F.NON_SHINY)===BigInt(0)&&(l&F.SHINY)===F.SHINY?(this.pokemonShinyNewIcon.setVisible(!0),this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(He(A.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonShinyNewIcon.setShadowColor(He(A.SUMMARY_BLUE,!0,s.uiTheme))):this.pokemonShinyNewIcon.setVisible(!1);this.pokemonFusionShinyIcon.setPosition(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y),this.pokemonFusionShinyIcon.setVisible(g),y&&this.pokemonFusionShinyIcon.setTint(mt(e.fusionVariant));const E=e.species.getRootSpeciesId(),b=r?n.caughtAttr?n.ivs:null:s.gameData.dexData[E].caughtAttr?s.gameData.dexData[E].ivs:null;this.statsContainer.updateIvs(e.ivs,b),r||(s.tweens.add({targets:this,duration:ge(Math.floor(750/i)),ease:"Cubic.easeInOut",x:this.initialX-this.infoWindowWidth,onComplete:c(()=>{o()},"onComplete")}),t&&s.tweens.add({delay:ge(Math.floor(325/i)),targets:this.pokemonMovesContainer,duration:ge(Math.floor(325/i)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX-57,onComplete:c(()=>o(),"onComplete")}));for(let _=0;_<4;_++){const O=_<e.moveset.length&&e.moveset[_]?e.moveset[_].getMove():null;this.pokemonMoveBgs[_].setFrame(Se[O?O.type:Se.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[_].setText(O?O.name:"-"),this.pokemonMovesContainers[_].setVisible(!!O)}this.setVisible(!0),this.shown=!0,s.hideEnemyModifierBar()})}changeToEggSummaryLayout(){const e=m.resolvedLanguage,t=Object.keys(Vn).find(o=>e?.includes(o)),i=Vn[t],n=43,a=(i?.infoContainerLabelXPos||-18)+n,r=(i?.infoContainerTextXPos||-14)+n;this.x=this.initialX-this.infoWindowWidth,this.pokemonGenderText.setPosition(89,-2),this.pokemonGenderNewText.setPosition(79,-2),this.pokemonShinyIcon.setPosition(82,87),this.pokemonShinyNewIcon.setPosition(72,87),this.pokemonFormLabelText.setPosition(a,153),this.pokemonFormText.setPosition(r,153),this.pokemonAbilityLabelText.setPosition(a,111),this.pokemonAbilityText.setPosition(r,111),this.pokemonNatureLabelText.setPosition(a,126),this.pokemonNatureText.setPosition(r,126),this.statsContainer.setScale(.7),this.statsContainer.setPosition(30,-3),this.infoBg.setVisible(!1),this.pokemonMovesContainer.setVisible(!1)}makeRoomForConfirmUi(e=1,t=!1){const i=t?this.initialX-this.infoWindowWidth-67:this.initialX-this.infoWindowWidth-ca.windowWidth;return new Promise(n=>{s.tweens.add({targets:this,duration:ge(Math.floor(150/e)),ease:"Cubic.easeInOut",x:i,onComplete:c(()=>{n()},"onComplete")})})}hide(e=1){return new Promise(t=>{if(!this.shown)return s.showEnemyModifierBar(),t();s.tweens.add({targets:this.pokemonMovesContainer,duration:ge(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX}),s.tweens.add({targets:this,duration:ge(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.initialX,onComplete:c(()=>{this.setVisible(!1),this.pokemonShinyIcon.off("pointerover"),this.pokemonShinyIcon.off("pointerout"),s.ui.hideTooltip(),s.showEnemyModifierBar(),t()},"onComplete")}),this.shown=!1})}};c(jh,"PokemonInfoContainer");let un=jh;const $h=class $h extends je{phaseName="EggHatchPhase";egg;eggHatchData;eggsToHatchCount;eggCounterContainer;eggHatchHandler;eggHatchContainer;eggHatchBg;eggHatchOverlay;eggContainer;eggSprite;eggCrackSprite;eggLightraysOverlay;pokemonSprite;pokemonShinySparkle;infoContainer;pokemon;eggMoveIndex;hatched;canSkip;skipped;evolutionBgm;eggLapsePhase;constructor(e,t,i){super(),this.eggLapsePhase=e,this.egg=t,this.eggsToHatchCount=i}start(){super.start(),s.ui.setModeForceTransition(x.EGG_HATCH_SCENE).then(()=>{if(!this.egg)return this.end();const e=s.gameData.eggs.findIndex(n=>n.id===this.egg.id);if(e===-1)return this.end();s.gameData.eggs.splice(e,1),s.fadeOutBgm(void 0,!1),this.eggHatchHandler=s.ui.getHandler(),this.eggHatchContainer=this.eggHatchHandler.eggHatchContainer,this.eggHatchBg=s.add.image(0,0,"default_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.eggContainer=s.add.container(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2),this.eggSprite=s.add.sprite(0,0,"egg",`egg_${this.egg.getKey()}`),this.eggCrackSprite=s.add.sprite(0,0,"egg_crack","0"),this.eggCrackSprite.setVisible(!1),this.eggLightraysOverlay=s.add.sprite(-this.eggHatchBg.displayWidth/2+4,-this.eggHatchBg.displayHeight/2,"egg_lightrays","3"),this.eggLightraysOverlay.setOrigin(0,0),this.eggLightraysOverlay.setVisible(!1),this.eggContainer.add(this.eggSprite),this.eggContainer.add(this.eggCrackSprite),this.eggContainer.add(this.eggLightraysOverlay),this.eggHatchContainer.add(this.eggContainer),this.eggCounterContainer=new zr(this.eggsToHatchCount),this.eggHatchContainer.add(this.eggCounterContainer);const t=c(()=>{const n=s.add.sprite(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2,"pkmn__sub");return n.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),n},"getPokemonSprite");this.eggHatchContainer.add(this.pokemonSprite=t()),this.pokemonShinySparkle=s.add.sprite(this.pokemonSprite.x,this.pokemonSprite.y,"shiny"),this.pokemonShinySparkle.setVisible(!1),this.eggHatchContainer.add(this.pokemonShinySparkle),this.eggHatchOverlay=s.add.rectangle(0,-s.scaledCanvas.height,s.scaledCanvas.width,s.scaledCanvas.height,16777215),this.eggHatchOverlay.setOrigin(0,0),this.eggHatchOverlay.setAlpha(0),s.fieldUI.add(this.eggHatchOverlay),this.infoContainer=new un,this.infoContainer.setup(),this.eggHatchContainer.add(this.infoContainer);const i=this.generatePokemon();i.fusionSpecies&&i.clearFusionSpecies(),this.pokemonSprite.setVisible(!1),this.pokemon=i,i.loadAssets().then(()=>{this.canSkip=!0,s.time.delayedCall(1e3,()=>{this.hatched||(this.evolutionBgm=s.playSoundWithoutBgm("evolution"))}),s.time.delayedCall(2e3,()=>{this.hatched||(this.eggCrackSprite.setVisible(!0),this.doSpray(1,this.eggSprite.displayHeight/-2),this.doEggShake(2).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(this.doSpray(2,this.eggSprite.displayHeight/-4),this.eggCrackSprite.setFrame("1"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("2")),this.doEggShake(4).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(s.playSound("se/egg_crack"),this.doSpray(4),this.eggCrackSprite.setFrame("3"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("4")),this.doEggShake(8,2).then(()=>{this.hatched||this.doHatch()}))})}))})}))})})})}end(){s.phaseManager.findPhase(e=>e.is("EggHatchPhase"))?this.eggHatchHandler.clear():s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),super.end()}doEggShake(e,t,i){return new Promise(n=>{t===void 0&&(t=0),i===void 0&&(i=0),s.playSound("se/pb_move"),s.tweens.add({targets:this.eggContainer,x:`-=${e/(i?1:2)}`,ease:"Sine.easeInOut",duration:125,onComplete:c(()=>{s.tweens.add({targets:this.eggContainer,x:`+=${e}`,ease:"Sine.easeInOut",duration:250,onComplete:c(()=>{if(i++,i<t)return this.doEggShake(e,t,i).then(()=>n());s.tweens.add({targets:this.eggContainer,x:`-=${e/2}`,ease:"Sine.easeInOut",duration:125,onComplete:c(()=>n(),"onComplete")})},"onComplete")})},"onComplete")})})}trySkip(){return!this.canSkip||this.skipped||this.eggCounterContainer.eggCountText?.data===void 0?!1:(this.skipped=!0,this.hatched?this.doReveal():this.doHatch(),!0)}doHatch(){this.canSkip=!1,this.hatched=!0,this.evolutionBgm&&Os.fadeOut(s,this.evolutionBgm,ge(100));for(let e=0;e<5;e++)s.time.delayedCall(ge(375*e),()=>s.playSound("se/egg_hatch",{volume:1-e*.2}));this.eggLightraysOverlay.setVisible(!0),this.eggLightraysOverlay.play("egg_lightrays"),s.tweens.add({duration:ge(125),targets:this.eggHatchOverlay,alpha:1,ease:"Cubic.easeIn",onComplete:c(()=>{this.skipped=!1,this.canSkip=!0},"onComplete")}),s.time.delayedCall(ge(1500),()=>{this.canSkip=!1,this.skipped||this.doReveal()})}doReveal(){const e=this.pokemon.isShiny();this.pokemon.species.subLegendary&&s.validateAchv(Pe.HATCH_SUB_LEGENDARY),this.pokemon.species.legendary&&s.validateAchv(Pe.HATCH_LEGENDARY),this.pokemon.species.mythical&&s.validateAchv(Pe.HATCH_MYTHICAL),e&&s.validateAchv(Pe.HATCH_SHINY),this.eggContainer.setVisible(!1);const t=this.pokemon.getSpriteKey(!0);try{this.pokemonSprite.play(t)}catch(i){console.error(`Failed to play animation for ${t}`,i)}this.pokemonSprite.setPipelineData("ignoreTimeTint",!0),this.pokemonSprite.setPipelineData("spriteKey",this.pokemon.getSpriteKey()),this.pokemonSprite.setPipelineData("shiny",this.pokemon.shiny),this.pokemonSprite.setPipelineData("variant",this.pokemon.variant),this.pokemonSprite.setVisible(!0),s.time.delayedCall(ge(250),()=>{this.eggsToHatchCount--,this.eggHatchHandler.eventTarget.dispatchEvent(new Kr(this.eggsToHatchCount)),this.pokemon.cry(),e&&s.time.delayedCall(ge(500),()=>{lg(this.pokemonShinySparkle,this.pokemon.variant)}),s.time.delayedCall(ge(this.skipped?e?750:250:e?1750:1250),()=>{this.infoContainer.show(this.pokemon,!1,this.skipped?2:1),s.playSoundWithoutBgm("evolution_fanfare"),s.ui.showText(m.t("egg:hatchFromTheEgg",{pokemonName:this.pokemon.species.getExpandedSpeciesName()}),null,()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setPokemonCaught(this.pokemon,!0,!0).then(()=>{s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex).then(i=>{this.eggHatchData.setEggMoveUnlocked(i),s.ui.showText("",0),this.end()})})},null,!0,3e3)})}),s.tweens.add({duration:ge(this.skipped?500:3e3),targets:this.eggHatchOverlay,alpha:0,ease:"Cubic.easeOut"})}sin(e,t){return t*Math.sin(e*(Math.PI/128))}doSpray(e,t){s.tweens.addCounter({repeat:e,duration:bs(1),onRepeat:c(()=>{this.doSprayParticle(ms(8),t||0)},"onRepeat")})}doSprayParticle(e,t){const i=this.eggHatchBg.displayWidth/2,n=this.eggHatchBg.displayHeight/2+t,a=this.egg.isManaphyEgg()?"1":this.egg.tier.toString(),r=s.add.image(i,n,"egg_shard",`${a}_${Math.floor(e/2)}`);this.eggHatchContainer.add(r);let o=0,l=0;const h=3-ms(8),u=24+ms(32),p=s.tweens.addCounter({repeat:-1,duration:bs(1),onRepeat:c(()=>{f()},"onRepeat")}),f=c(()=>{const d=this.skipped?6:1;l+=d,e<160?(r.setPosition(i+h*o/3,n+l),r.y+=-this.sin(e,u),o>108&&r.setScale(1-(o-108)/20),e+=2*d,o+=d):(r.destroy(),p.remove())},"updateParticle");f()}generatePokemon(){return this.eggHatchData=this.eggLapsePhase.generatePokemon(this.egg),this.eggMoveIndex=this.eggHatchData.eggMoveIndex,this.eggHatchData.pokemon}};c($h,"EggHatchPhase");let jr=$h;const Xh=class Xh{pokemon;eggMoveIndex;eggMoveUnlocked;dexEntryBeforeUpdate;starterDataEntryBeforeUpdate;constructor(e,t){this.pokemon=e,this.eggMoveIndex=t}setEggMoveUnlocked(e){this.eggMoveUnlocked=e}setDex(){const e=s.gameData.dexData[this.pokemon.species.speciesId],t=s.gameData.starterData[this.pokemon.species.getRootSpeciesId()];this.dexEntryBeforeUpdate={seenAttr:e.seenAttr,caughtAttr:e.caughtAttr,natureAttr:e.natureAttr,seenCount:e.seenCount,caughtCount:e.caughtCount,hatchedCount:e.hatchedCount,ivs:[...e.ivs],ribbons:e.ribbons},this.starterDataEntryBeforeUpdate={moveset:t.moveset,eggMoves:t.eggMoves,candyCount:t.candyCount,friendship:t.friendship,abilityAttr:t.abilityAttr,passiveAttr:t.passiveAttr,valueReduction:t.valueReduction,classicWinCount:t.classicWinCount}}getDex(){return this.dexEntryBeforeUpdate}getStarterEntry(){return this.starterDataEntryBeforeUpdate}updatePokemon(e=!1){return new Promise(t=>{s.gameData.setPokemonCaught(this.pokemon,!0,!0,e).then(()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex,e).then(i=>{this.setEggMoveUnlocked(i),t()})})})}};c(Xh,"EggHatchData");let $r=Xh;const qh=class qh extends je{phaseName="EggLapsePhase";eggHatchData=[];minEggsToSkip=2;start(){super.start();const e=s.currentBattle?.waveIndex??0,t=s.findModifiers(o=>o instanceof hg),i=Math.min(t?.[0]?.stackCount??0,3),n=1-.3*i;s.gameData.eggs.forEach(o=>{if(o.originalHatchWaves===void 0)switch(o.tier){case xs.COMMON:o.originalHatchWaves=10;break;case xs.RARE:o.originalHatchWaves=25;break;case xs.EPIC:o.originalHatchWaves=50;break;case xs.LEGENDARY:o.originalHatchWaves=100;break;default:o.originalHatchWaves=20}if(o.hatchWaves===void 0||o.hatchWaves===o.originalHatchWaves){const l=Math.max(Math.floor(o.originalHatchWaves*n),1);o.hatchWaves=l,`[EggLapsePhase] ${o.tier} : ${o.originalHatchWaves}  ${o.hatchWaves}`+(i?` (x${n.toFixed(2)})`:"")}else`${o.tier}${o.hatchWaves}`});const a=[];s.gameData.eggs.forEach(o=>{if(o.hatchWaves=Math.max(o.hatchWaves-1,0),o.hatchWaves<=0||le.EGG_IMMEDIATE_HATCH_OVERRIDE)a.push(o),`${o.tier}`;else{const l=e+o.hatchWaves;`${o.tier}${o.hatchWaves}${e}${l}`}});const r=a.length;this.eggHatchData=[],r>0?r>=this.minEggsToSkip&&s.eggSkipPreference===1?s.ui.showText(m.t("battle:eggHatching"),0,()=>{s.ui.showText(m.t("battle:eggSkipPrompt",{eggsToHatch:r}),0),s.ui.setModeWithoutClear(x.CONFIRM,()=>{this.hatchEggsSkipped(a),this.showSummary()},()=>{this.hatchEggsRegular(a),this.end()},null,null,null,1e3,!0)},100,!0):r>=this.minEggsToSkip&&s.eggSkipPreference===2?(s.phaseManager.queueMessage(m.t("battle:eggHatching")),this.hatchEggsSkipped(a),this.showSummary()):(s.phaseManager.queueMessage(m.t("battle:eggHatching")),this.hatchEggsRegular(a),this.end()):this.end()}hatchEggsRegular(e){let t=e.length;for(const i of e)s.phaseManager.unshiftNew("EggHatchPhase",this,i,t),t--}hatchEggsSkipped(e){for(const t of e)this.hatchEggSilently(t)}showSummary(){s.phaseManager.unshiftNew("EggSummaryPhase",this.eggHatchData),this.end()}hatchEggSilently(e){const t=s.gameData.eggs.findIndex(a=>a.id===e.id);if(t===-1)return this.end();s.gameData.eggs.splice(t,1);const n=this.generatePokemon(e).pokemon;n.fusionSpecies&&n.clearFusionSpecies(),n.species.subLegendary&&s.validateAchv(Pe.HATCH_SUB_LEGENDARY),n.species.legendary&&s.validateAchv(Pe.HATCH_LEGENDARY),n.species.mythical&&s.validateAchv(Pe.HATCH_MYTHICAL),n.isShiny()&&s.validateAchv(Pe.HATCH_SHINY)}generatePokemon(e){let t,i;return s.executeWithSeedOffset(()=>{t=e.generatePlayerPokemon(),i=new $r(t,e.eggMoveIndex),i.setDex(),this.eggHatchData.push(i)},e.id,Cr.toString()),i}};c(qh,"EggLapsePhase");let Xr=qh;const Qh=class Qh extends je{phaseName="EggSummaryPhase";eggHatchData;constructor(e){super(),this.eggHatchData=e}start(){super.start();const e=c(t=>{t>=this.eggHatchData.length?s.ui.setModeForceTransition(x.EGG_HATCH_SUMMARY,this.eggHatchData).then(()=>{s.fadeOutBgm(void 0,!1)}):(this.eggHatchData[t].setDex(),this.eggHatchData[t].updatePokemon().then(()=>{t<this.eggHatchData.length&&e(t+1)}))},"updateNextPokemon");e(0)}end(){s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),s.ui.setModeForceTransition(x.MESSAGE).then(()=>{super.end()})}};c(Qh,"EggSummaryPhase");let qr=Qh;const Zh=class Zh extends ut{phaseName="EncounterPhase";loaded;constructor(e=!1){super(),this.loaded=e}start(){super.start(),s.updateGameInfo(),s.initSession(),s.eventTarget.dispatchEvent(new cg),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&s.phaseManager.unshiftNew("GameOverPhase");const e=[],t=s.currentBattle;t.isBattleMysteryEncounter()&&!t.mysteryEncounter&&s.executeWithSeedOffset(()=>{const a=t.mysteryEncounterType;t.mysteryEncounter=s.getMysteryEncounter(a)},t.waveIndex*16);const i=t.mysteryEncounter;i&&(s.executeWithSeedOffset(()=>{i.onInit&&i.onInit(),i.populateDialogueTokensFromRequirements()},t.waveIndex),i.encounterAnimations&&i.encounterAnimations.length>0&&e.push(ug(i.encounterAnimations).then(()=>dg(!0))),i.initIntroVisuals(),s.field.add(i.introVisuals));let n=0;if(t.enemyLevels?.every((a,r)=>{if(t.isBattleMysteryEncounter())return!1;if(!this.loaded)if(t.battleType===ue.TRAINER)t.enemyParty[r]=t.trainer?.genPartyMember(r);else{let h=s.randomSpecies(t.waveIndex,a,!0);s.findModifier(u=>u instanceof pg)&&!s.gameMode.isBoss(t.waveIndex)&&s.arena.biomeType!==Je.END&&Ve(10)===0&&(h=fg(a)),t.enemyParty[r]=s.addEnemyPokemon(h,a,Ct.NONE,!!s.getEncounterBossSegments(t.waveIndex,a,h)),s.currentBattle.battleSpec===Ht.FINAL_BOSS&&(t.enemyParty[r].ivs=new Array(6).fill(31)),s.getPlayerParty().slice(0,t.double?2:1).reverse().forEach(u=>{Oe("SyncEncounterNatureAbAttr",{pokemon:u,target:t.enemyParty[r]})})}const o=s.getEnemyParty()[r];r<(t.double?2:1)&&(o.setX(-66+o.getFieldPositionOffset()[0]),o.fieldSetup(!0)),this.loaded||s.gameData.setPokemonSeen(o,!0,t.battleType===ue.TRAINER||t?.mysteryEncounter?.encounterMode===hs.TRAINER_BATTLE),o.species.speciesId===pe.ETERNATUS&&(s.gameMode.isClassic&&(t.battleSpec===Ht.FINAL_BOSS||s.gameMode.isWaveFinal(t.waveIndex))?(t.battleSpec!==Ht.FINAL_BOSS&&(o.formIndex=1,o.updateScale()),o.setBoss()):t.waveIndex%1e3||(o.formIndex=1,o.updateScale())),n+=o.getSpeciesForm().baseTotal,e.push(o.loadAssets()),`${o.stats[0]}${o.ivs[0]}`,`${o.stats[1]}${o.ivs[1]}`,`${o.stats[2]}${o.ivs[2]}`,`${o.stats[3]}${o.ivs[3]}`,`${o.stats[4]}${o.ivs[4]}`,`${o.stats[5]}${o.ivs[5]}`;const l=[];for(const h of o.getMoveset())l.push(h.getName());return`${Ne(o)}`,`${o.species.speciesId}`,`${o.level}`,`${xi(o.nature,!0,!0,!0)}`,`${o.getAbility().name}`,o.hasPassive(),`${o.getPassiveAbility().name}`,o.isBoss()&&`${o.bossSegments}`,!0}),s.getPlayerParty().filter(a=>a.isShiny()).length===Jn&&s.validateAchv(Pe.SHINY_PARTY),t.battleType===ue.TRAINER)e.push(t.trainer?.loadAssets().then(()=>t.trainer?.initSprite()));else if(t.isBattleMysteryEncounter())t.mysteryEncounter?.introVisuals&&e.push(t.mysteryEncounter.introVisuals.loadAssets().then(()=>t.mysteryEncounter.introVisuals.initSprite())),t.mysteryEncounter?.loadAssets&&t.mysteryEncounter.loadAssets.length>0&&e.push(...t.mysteryEncounter.loadAssets),e.push(new Promise(a=>{s.loadSe("GEN8- Exclaim","battle_anims","GEN8- Exclaim.wav"),s.loadImage("encounter_exclaim","mystery-encounters"),s.load.once(Phaser.Loader.Events.COMPLETE,()=>a()),s.load.isLoading()||s.load.start()}));else if(!(le.ENEMY_HEALTH_SEGMENTS_OVERRIDE>1)&&t.enemyParty.filter(r=>r.isBoss()).length>1)for(const r of t.enemyParty)r.isBoss()&&!r.isPopulatedFromDataSource&&(r.setBoss(!0,Math.ceil(r.bossSegments*(r.getSpeciesForm().baseTotal/n))),r.initBattleInfo());Promise.all(e).then(()=>{if(t.enemyParty.every((a,r)=>{if(t.isBattleMysteryEncounter())return!1;if(r<(t.double?2:1)){if(t.battleType===ue.WILD){for(const l of s.getField())Oe("PreSummonAbAttr",{pokemon:l});s.field.add(a),t.seenEnemyPartyMemberIds.add(a.id);const o=s.getPlayerPokemon();o?.isOnField()&&s.field.moveBelow(a,o),a.tint(0,.5)}else t.battleType===ue.TRAINER&&(a.setVisible(!1),s.currentBattle.trainer?.tint(0,.5));t.double&&a.setFieldPosition(r?cs.RIGHT:cs.LEFT)}return!0}),!this.loaded&&t.battleType!==ue.MYSTERY_ENCOUNTER){oh(s.getEnemyField(),t.battleType===ue.TRAINER?ei.TRAINER:ei.WILD),s.generateEnemyModifiers(),qp(!1);for(const a of s.getEnemyField())Qp(a,!1)}t.battleType===ue.TRAINER&&s.currentBattle.trainer&&s.currentBattle.trainer.genAI(s.getEnemyParty()),s.ui.setMode(x.MESSAGE).then(()=>{this.loaded?(this.doEncounter(),s.resetSeed()):(this.trySetWeatherIfNewBiome(),s.gameData.saveAll(!0,t.waveIndex%5===1||(s.lastSavePlayTime??0)>=300).then(a=>{if(s.disableMenu=!1,!a)return s.reset(!0);this.doEncounter(),s.resetSeed()}))})})}doEncounter(){s.playBgm(void 0,!0),s.updateModifiers(!1),s.setFieldScale(1);const{battleType:e,waveIndex:t}=s.currentBattle;s.isMysteryEncounterValidForWave(e,t)&&!s.currentBattle.isBattleMysteryEncounter()&&(s.mysteryEncounterSaveData.encounterSpawnChance+=gg);for(const a of s.getPlayerParty())a&&a.resetWaveData();const i=s.getEnemyField();s.tweens.add({targets:[s.arenaEnemy,s.currentBattle.trainer,i,s.arenaPlayer,s.trainer].flat(),x:c((a,r,o,l)=>l<2+i.length?o+300:o-300,"x"),duration:2e3,onComplete:c(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")});const n=s.currentBattle?.mysteryEncounter?.introVisuals;if(n){const a=n.enterFromRight;a&&(n.x+=500),s.tweens.add({targets:n,x:a?"-=200":"+=300",duration:2e3})}}getEncounterMessage(){const e=s.getEnemyField();return s.currentBattle.battleSpec===Ht.FINAL_BOSS?m.t("battle:bossAppeared",{bossName:Ne(e[0])}):s.currentBattle.battleType===ue.TRAINER?s.currentBattle.double?m.t("battle:trainerAppearedDouble",{trainerName:s.currentBattle.trainer?.getName(Ct.NONE,!0)}):m.t("battle:trainerAppeared",{trainerName:s.currentBattle.trainer?.getName(Ct.NONE,!0)}):e.length===1?m.t("battle:singleWildAppeared",{pokemonName:e[0].getNameToRender()}):m.t("battle:multiWildAppeared",{pokemonName1:e[0].getNameToRender(),pokemonName2:e[1].getNameToRender()})}doEncounterCommon(e=!0){const t=s.getEnemyField();if(s.currentBattle.battleType===ue.WILD){for(const i of t)i.untint(100,"Sine.easeOut"),i.cry(),i.showInfo(),i.isShiny()&&s.validateAchv(Pe.SEE_SHINY);s.updateFieldScale(),e?s.ui.showText(this.getEncounterMessage(),null,()=>this.end(),1500):this.end()}else if(s.currentBattle.battleType===ue.TRAINER){const i=s.currentBattle.trainer;i?.untint(100,"Sine.easeOut"),i?.playAnim();const n=c(()=>{s.currentBattle.started=!0,s.playBgm(void 0),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const r=c(()=>{this.hideEnemyTrainer();const o=s.getEnemyParty().filter(l=>!l.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&o>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.end()},"doTrainerSummon");e?s.ui.showText(this.getEncounterMessage(),null,r,1500,!0):r()},"doSummon"),a=s.currentBattle.trainer?.getEncounterMessages();if(!a?.length)n();else{let r;s.executeWithSeedOffset(()=>r=In(a),s.currentBattle.waveIndex),r=r;const o=c(()=>{s.ui.showDialogue(r,i?.getName(Ct.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>n()))})},"showDialogueAndSummon");s.currentBattle.trainer?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(r)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(i?.getKey(),Wa(a[0])).then(()=>o())):o()}}else if(s.currentBattle.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter){const i=s.currentBattle.mysteryEncounter,n=i.introVisuals;n?.playAnim(),i.onVisualsStart?i.onVisualsStart():i.spriteConfigs&&n&&n.playShinySparkles();const a=c(()=>{const o=c(()=>{s.ui.clearText(),s.ui.getMessageHandler().hideNameText(),s.phaseManager.unshiftNew("MysteryEncounterPhase"),this.end()},"doShowEncounterOptions");if(e){const l=i.dialogue.intro;if(!l)o();else{let u=0;const p=c(()=>{const f=u===l.length-1?o:p,d=l[u],y=jt(d?.speaker),g=jt(d.text);u++,y?s.ui.showDialogue(g,y,null,f,0,u===1?750:0):s.ui.showText(g,null,f,u===1?750:0,!0)},"showNextDialogue");l.length>0&&p()}}else o()},"doEncounter"),r=m.t("battle:mysteryEncounterAppeared");r?(mg(),s.ui.showDialogue(r,"???",null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>a()))})):a()}}end(){const e=s.getEnemyField();if(e.forEach((t,i)=>{if(t.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",ct.ENEMY+i),t.species.speciesId===pe.ETERNATUS&&(s.gameMode.isBattleClassicFinalBoss(s.currentBattle.waveIndex)||s.gameMode.isEndlessMajorBoss(s.currentBattle.waveIndex))){const n=s.findModifier(a=>a instanceof Zp,!1);n&&(s.removeModifier(n,!0),n.setTransferrableFalse(),s.addEnemyModifier(n))}}),[ue.TRAINER,ue.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||(e.map(i=>s.phaseManager.pushConditionalPhase(s.phaseManager.create("PostSummonPhase",i.getBattlerIndex()),()=>{if(!s.getPlayerParty().length)return!1;const n=s.getPlayerParty().filter(r=>r.isOnField()).length,a=Math.min(s.getPlayerParty().filter(r=>!r.isFainted()).length,2);return s.currentBattle.double?n===a:n===1})),s.findModifier(i=>i instanceof Jp)&&e.map(i=>s.phaseManager.pushNew("ScanIvsPhase",i.getBattlerIndex()))),!this.loaded){const t=s.getPokemonAllowedInBattle();if(t[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double?t.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),t[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1)):(t.length>1&&t[1].isOnField()&&s.phaseManager.pushNew("ReturnPhase",1),s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)),s.currentBattle.battleType!==ue.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const i=s.currentBattle.double?2:1;t.length>i&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}Oi(ws.Access_Menu).then(()=>super.end())}tryOverrideForBattleSpec(){switch(s.currentBattle.battleSpec){case Ht.FINAL_BOSS:{const e=s.getEnemyPokemon();return s.ui.showText(this.getEncounterMessage(),null,()=>{const t="battleSpecDialogue:encounter";if(s.ui.shouldSkipDialogue(t))this.doEncounterCommon(!1);else{const i=5643853+s.gameData.gameStats.classicSessionsPlayed,n=!m.exists(t,{fallbackLng:[]})||m.resolvedLanguage==="en"?m.t("battleSpecDialogue:key",{count:i,ordinal:!0}):"",a=i.toLocaleString()+n,r=s.gameData.gender??Be.UNSET,o=Be[r].toLowerCase(),l=m.t(t,{context:o,cycleCount:a});s.gameData.getSeenDialogues()[t]||s.gameData.saveSeenDialogue(t),s.ui.showDialogue(l,e?.species.name,null,()=>{this.doEncounterCommon(!1)})}},1500,!0),!0}}return!1}trySetWeatherIfNewBiome(){this.loaded||s.arena.trySetWeather(ef(s.arena))}};c(Zh,"EncounterPhase");let ua=Zh;const Jh=class Jh extends je{phaseName="EndCardPhase";endCard;text;start(){super.start(),s.ui.getMessageHandler().bg.setVisible(!1),s.ui.getMessageHandler().nameBoxContainer.setVisible(!1),this.endCard=s.add.image(0,0,`end_${s.gameData.gender===Be.FEMALE?"f":"m"}`),this.endCard.setOrigin(0),this.endCard.setScale(.5),s.field.add(this.endCard),this.text=P(s.scaledCanvas.width/2,s.scaledCanvas.height-16,m.t("battle:congratulations"),A.SUMMARY,{fontSize:"128px"}),this.text.setOrigin(.5),s.field.add(this.text),s.ui.clearText(),s.ui.fadeIn(1e3).then(()=>{s.ui.showText("",null,()=>{s.ui.getMessageHandler().bg.setVisible(!0),this.end()},null,!0)})}};c(Jh,"EndCardPhase");let Qr=Jh;const ec=class ec extends je{phaseName="EndEvolutionPhase";start(){super.start(),s.ui.setModeForceTransition(x.MESSAGE).then(()=>this.end())}};c(ec,"EndEvolutionPhase");let Zr=ec;const tc=class tc extends Ks{phaseName="EnemyCommandPhase";fieldIndex;skipTurn=!1;constructor(e){super(),this.fieldIndex=e,s.currentBattle.mysteryEncounter?.skipEnemyBattleTurns&&(this.skipTurn=!0)}start(){super.start();const e=s.getEnemyField()[this.fieldIndex],t=s.currentBattle,i=t.trainer;if(t.double&&e.hasAbility(Ha.COMMANDER)&&e.getAlly()?.getTag(Xe.COMMANDED)&&(this.skipTurn=!0),i&&!e.getMoveQueue().length){const a=e.getOpponents();if(!e.isTrapped()){const r=i.getPartyMemberMatchupScores(e.trainerSlot,!0);if(r.length){const o=a.map(p=>e.getMatchupScore(p)),l=o.reduce((p,f)=>p+=f,0)/o.length,h=i.getSortedPartyMemberMatchupScores(r),u=1-(t.enemySwitchCounter?Math.pow(.1,1/t.enemySwitchCounter):0);if(h[0][1]*u>=l*(i.config.isBoss?2:3)){const p=i.getNextSummonIndex(e.trainerSlot,r);return t.turnCommands[this.fieldIndex+ct.ENEMY]={command:Ke.POKEMON,cursor:p,args:[!1],skip:this.skipTurn},t.enemySwitchCounter++,this.end()}}}}const n=e.getNextMove();i?.shouldTera(e)&&(s.currentBattle.preTurnCommands[this.fieldIndex+ct.ENEMY]={command:Ke.TERA}),s.currentBattle.turnCommands[this.fieldIndex+ct.ENEMY]={command:Ke.FIGHT,move:n,skip:this.skipTurn},s.currentBattle.enemySwitchCounter=Math.max(s.currentBattle.enemySwitchCounter-1,0),this.end()}getFieldIndex(){return this.fieldIndex}};c(tc,"EnemyCommandPhase");let Jr=tc;const sc=class sc extends je{phaseName="EvolutionPhase";pokemon;lastLevel;evoChain=null;preEvolvedPokemonName;evolution;fusionSpeciesEvolved;evolutionBgm;evolutionHandler;evolutionContainer;evolutionBaseBg;evolutionBg;evolutionBgOverlay;evolutionOverlay;pokemonSprite;pokemonTintSprite;pokemonEvoSprite;pokemonEvoTintSprite;canCancel;constructor(e,t,i,n=!0){super(),this.pokemon=e,this.evolution=t,this.lastLevel=i,this.fusionSpeciesEvolved=t instanceof yg,this.canCancel=n}validate(){return!!this.evolution}setMode(){return s.ui.setModeForceTransition(x.EVOLUTION_SCENE)}setupEvolutionAssets(){this.evolutionHandler=s.ui.getHandler(),this.evolutionContainer=this.evolutionHandler.evolutionContainer,this.evolutionBaseBg=s.add.image(0,0,"default_bg").setOrigin(0),this.evolutionBg=s.add.video(0,0,"evo_bg").stop().setOrigin(0).setScale(.4359673025).setVisible(!1),this.evolutionBgOverlay=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,2500134).setOrigin(0).setAlpha(0),this.evolutionContainer.add([this.evolutionBaseBg,this.evolutionBgOverlay,this.evolutionBg]),this.evolutionOverlay=s.add.rectangle(0,-s.scaledCanvas.height,s.scaledCanvas.width,s.scaledCanvas.height-48,16777215),this.evolutionOverlay.setOrigin(0).setAlpha(0),s.ui.add(this.evolutionOverlay)}configureSprite(e,t,i=!0){const n=e.getSpriteKey(!0);try{t.play(n)}catch(a){console.error(`Failed to play animation for ${n}`,a)}i&&t.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:nn(e.getTeraType()),isTerastallized:e.isTerastallized}),t.setPipelineData("ignoreTimeTint",!0).setPipelineData("spriteKey",n).setPipelineData("shiny",e.shiny).setPipelineData("variant",e.variant);for(let a of["spriteColors","fusionSpriteColors"])e.summonData.speciesForm&&(a+="Base"),t.pipelineData[a]=e.getSprite().pipelineData[a];return t}getPokemonSprite(){const e=s.addPokemonSprite(this.pokemon,this.evolutionBaseBg.displayWidth/2,this.evolutionBaseBg.displayHeight/2,"pkmn__sub");return e.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),e}setupPokemonSprites(){this.pokemonSprite=this.configureSprite(this.pokemon,this.getPokemonSprite()),this.pokemonTintSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setAlpha(0).setTintFill(16777215)),this.pokemonEvoSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setVisible(!1)),this.pokemonEvoTintSprite=this.configureSprite(this.pokemon,this.getPokemonSprite().setVisible(!1).setTintFill(16777215)),this.evolutionContainer.add([this.pokemonSprite,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite])}async start(){if(super.start(),await this.setMode(),!this.validate())return this.end();this.setupEvolutionAssets(),this.setupPokemonSprites(),this.preEvolvedPokemonName=Ne(this.pokemon),this.doEvolution()}updateEvolvedPokemonSprites(e){this.configureSprite(e,this.pokemonEvoSprite,!1),this.configureSprite(e,this.pokemonEvoTintSprite,!1)}playEvolutionAnimation(e){s.time.delayedCall(1e3,()=>{this.evolutionBgm=s.playSoundWithoutBgm("evolution"),s.tweens.add({targets:this.evolutionBgOverlay,alpha:1,delay:500,duration:1500,ease:"Sine.easeOut",onComplete:c(()=>{s.time.delayedCall(1e3,()=>{this.evolutionBg.setVisible(!0).play()}),s.playSound("se/charge"),this.doSpiralUpward(),this.fadeOutPokemonSprite(e)},"onComplete")})})}fadeOutPokemonSprite(e){s.tweens.addCounter({from:0,to:1,duration:2e3,onUpdate:c(t=>{this.pokemonTintSprite.setAlpha(t.getValue()??1)},"onUpdate"),onComplete:c(()=>{this.pokemonSprite.setVisible(!1),s.time.delayedCall(1100,()=>{s.playSound("se/beam"),this.doArcDownward(),this.prepareForCycle(e)})},"onComplete")})}prepareForCycle(e){s.time.delayedCall(1500,()=>{this.pokemonEvoTintSprite.setScale(.25).setVisible(!0),this.evolutionHandler.canCancel=this.canCancel,this.doCycle(1,void 0,()=>{this.evolutionHandler.cancelled?this.handleFailedEvolution(e):this.handleSuccessEvolution(e)})})}doEvolution(){s.ui.showText(m.t("menu:evolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{this.pokemon.cry(),this.pokemon.getPossibleEvolution(this.evolution).then(e=>{this.updateEvolvedPokemonSprites(e),this.playEvolutionAnimation(e)})},1e3)}fadeOutEvolutionAssets(){s.tweens.add({targets:[this.evolutionBg,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite],alpha:0,duration:250,onComplete:c(()=>{this.evolutionBg.setVisible(!1)},"onComplete")}),Os.fadeOut(s,this.evolutionBgm,100)}showPauseEvolutionConfirmation(e){s.ui.setOverlayMode(x.CONFIRM,()=>{s.ui.revertMode(),this.pokemon.pauseEvolutions=!0,s.ui.showText(m.t("menu:evolutionsPaused",{pokemonName:this.preEvolvedPokemonName}),null,e,3e3)},()=>{s.ui.revertMode(),s.time.delayedCall(3e3,e)})}showFailedEvolutionUI(e){s.phaseManager.unshiftNew("EndEvolutionPhase"),s.ui.showText(m.t("menu:stoppedEvolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{s.ui.showText(m.t("menu:pauseEvolutionsQuestion",{pokemonName:this.preEvolvedPokemonName}),null,()=>{const t=c(()=>{s.ui.showText("",0),s.playBgm(),e.destroy(),this.end()},"end");this.showPauseEvolutionConfirmation(t)})},null,!0)}handleFailedEvolution(e){this.pokemonSprite.setVisible(!0),this.pokemonTintSprite.setScale(1),this.fadeOutEvolutionAssets(),s.phaseManager.unshiftNew("EndEvolutionPhase"),this.showFailedEvolutionUI(e)}onEvolutionComplete(e){Os.fadeOut(s,this.evolutionBgm,100),s.time.delayedCall(250,()=>{this.pokemon.cry(),s.time.delayedCall(1250,()=>{s.playSoundWithoutBgm("evolution_fanfare"),e.destroy(),s.ui.showText(m.t("menu:evolutionDone",{pokemonName:this.preEvolvedPokemonName,evolvedPokemonName:this.pokemon.name}),null,()=>this.end(),null,!0,ge(4e3)),s.time.delayedCall(ge(4250),()=>s.playBgm())})})}postEvolve(e){const t=this.fusionSpeciesEvolved?Qa.EVOLUTION_FUSED:this.pokemon.fusionSpecies?Qa.EVOLUTION_FUSED_BASE:Qa.EVOLUTION,i=this.pokemon.getLevelMoves(this.lastLevel+1,!0,!1,!1,t).filter(n=>n[0]===Tg);for(const n of i)s.phaseManager.unshiftNew("LearnMovePhase",s.getPlayerParty().indexOf(this.pokemon),n[1]);s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),s.tweens.chain({targets:null,tweens:[{targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:c(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1)},"onComplete")},{targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn"},{targets:this.evolutionBgOverlay,alpha:0,duration:250,onComplete:c(()=>this.onEvolutionComplete(e),"onComplete")}]})}handleSuccessEvolution(e){s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),s.time.delayedCall(900,()=>{this.evolutionHandler.canCancel=this.canCancel,this.pokemon.evolve(this.evolution,this.pokemon.species).then(()=>this.postEvolve(e))})}doSpiralUpward(){let e=0;s.tweens.addCounter({repeat:64,duration:bs(1),onRepeat:c(()=>{if(e<64){if(!(e&7))for(let t=0;t<4;t++)this.doSpiralUpwardParticle((e&120)*2+t*64);e++}},"onRepeat")})}doArcDownward(){let e=0;s.tweens.addCounter({repeat:96,duration:bs(1),onRepeat:c(()=>{if(e<96){if(e<6)for(let t=0;t<9;t++)this.doArcDownParticle(t*16);e++}},"onRepeat")})}doCycle(e,t=15,i=()=>{}){const n=[];for(let a=e;a<=t;a+=.5)n.push({targets:[this.pokemonTintSprite,this.pokemonEvoTintSprite],scale:c((r,o,l,h,u,p)=>h===0?.25:1,"scale"),ease:"Cubic.easeInOut",duration:500/a,yoyo:a!==t,onComplete:c(()=>{if(this.evolutionHandler.cancelled){this.pokemonEvoTintSprite.setScale(1),this.pokemonEvoTintSprite.setVisible(!1),this.evoChain?.complete?.();return}a===t&&this.pokemonEvoTintSprite.setScale(1)},"onComplete")});this.evoChain=s.tweens.chain({targets:null,tweens:n,onComplete:c(()=>{this.evoChain=null,i()},"onComplete")})}doCircleInward(){let e=0;s.tweens.addCounter({repeat:48,duration:bs(1),onRepeat:c(()=>{if(e){if(e===32)for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,8)}else for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,4);e++},"onRepeat")})}doSpray(){let e=0;s.tweens.addCounter({repeat:48,duration:bs(1),onRepeat:c(()=>{if(e)e<50&&this.doSprayParticle(ms(8));else for(let t=0;t<8;t++)this.doSprayParticle(t);e++},"onRepeat")})}doSpiralUpwardParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");this.evolutionContainer.add(i);let n=0,a=48;const r=s.tweens.addCounter({repeat:-1,duration:bs(1),onRepeat:c(()=>{o()},"onRepeat")}),o=c(()=>{!n||i.y>8?(i.setPosition(t,88-n*n/80),i.y+=Ri(e,a)/4,i.x+=Za(e,a),i.setScale(1-n/80),e+=4,n&1&&a--,n++):(i.destroy(),r.remove())},"updateParticle");o()}doArcDownParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");i.setScale(.5),this.evolutionContainer.add(i);let n=0,a=8;const r=s.tweens.addCounter({repeat:-1,duration:bs(1),onRepeat:c(()=>{o()},"onRepeat")}),o=c(()=>{!n||i.y<88?(i.setPosition(t,8+n*n/5),i.y+=Ri(e,a)/4,i.x+=Za(e,a),a=8+Ri(n*4,40),n++):(i.destroy(),r.remove())},"updateParticle");o()}doCircleInwardParticle(e,t){const i=this.evolutionBaseBg.displayWidth/2,n=this.evolutionBaseBg.displayHeight/2,a=s.add.image(i,n,"evo_sparkle");this.evolutionContainer.add(a);let r=120;const o=s.tweens.addCounter({repeat:-1,duration:bs(1),onRepeat:c(()=>{l()},"onRepeat")}),l=c(()=>{r>8?(a.setPosition(i,n),a.y+=Ri(e,r),a.x+=Za(e,r),r-=t,e+=4):(a.destroy(),o.remove())},"updateParticle");l()}doSprayParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=this.evolutionBaseBg.displayHeight/2,n=s.add.image(t,i,"evo_sparkle");this.evolutionContainer.add(n);let a=0,r=0;const o=3-ms(8),l=48+ms(64),h=s.tweens.addCounter({repeat:-1,duration:bs(1),onRepeat:c(()=>{u()},"onRepeat")}),u=c(()=>{a&3||r++,e<128?(n.setPosition(t+o*a/3,i+r),n.y+=-Ri(e,l),a>108&&n.setScale(1-(a-108)/20),e++,a++):(n.destroy(),h.remove())},"updateParticle");u()}};c(sc,"EvolutionPhase");let da=sc;const ic=class ic extends Ka{phaseName="ExpPhase";expValue;constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new Pt(this.expValue);s.applyModifiers(tf,!0,t),t.value=Math.floor(t.value),s.ui.showText(m.t("battle:expGain",{pokemonName:Ne(e),exp:t.value}),null,()=>{const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),e.updateInfo().then(()=>this.end())},null,!0)}};c(ic,"ExpPhase");let eo=ic;const nc=class nc extends Ut{phaseName="FaintPhase";preventInstantRevive;source;constructor(e,t=!1,i){super(e),this.preventInstantRevive=t,this.source=i}start(){super.start();const e=this.getPokemon();if(this.source&&(e.getTag(Xe.DESTINY_BOND)?.lapse(this.source,Ms.CUSTOM),e.getTag(Xe.GRUDGE)?.lapse(e,Ms.CUSTOM,this.source)),e.resetSummonData(),!this.preventInstantRevive){const t=s.applyModifier(Sg,this.player,e);if(t)return e.loseHeldItem(t),s.updateModifiers(this.player),this.end()}for(const t of s.getPlayerField())t?.isActive(!0)&&t.isPlayer()&&s.currentBattle.addParticipant(t);this.tryOverrideForBattleSpec()||this.doFaint()}doFaint(){const e=this.getPokemon();if(e.isPlayer()?(s.arena.playerFaints+=1,s.currentBattle.playerFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})):(s.currentBattle.enemyFaints+=1,s.currentBattle.enemyFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})),s.phaseManager.queueMessage(m.t("battle:fainted",{pokemonNameWithAffix:Ne(e)}),null,!0),s.triggerPokemonFormChange(e,za,!0),e.resetTera(),e.turnData.attacksReceived?.length){const n=e.turnData.attacksReceived[0];Oe("PostFaintAbAttr",{pokemon:e,attacker:s.getPokemonById(n.sourceId)??void 0,move:new ps(n.move).getMove(),hitResult:n.result})}else Oe("PostFaintAbAttr",{pokemon:e});const t=s.getField(!0);for(const n of t)n!==e&&Oe("PostKnockOutAbAttr",{pokemon:n,victim:e});if(e.turnData.attacksReceived?.length){const n=e.turnData.attacksReceived[0],a=this.source??(n?.sourceId?s.getPokemonById(n.sourceId):void 0);if(n&&a&&a.isOnField()){const r=s.applyModifier(Cg,a.isPlayer(),a,1);r&&r.applyPostVictory(a,e,new ps(n.move).getMove(),!1),Oe("PostVictoryAbAttr",{pokemon:a,victim:e,move:new ps(n.move).getMove(),hitResult:n.result});const o=Fe[n.move],l=o.getAttrs("PostVictoryStatStageChangeAttr");for(const h of l)h.applyPostVictory(a,a,o)}}if(this.player){const n=s.getPokemonAllowedInBattle(),a=n.filter(r=>!r.isActive(!0));n.length?s.currentBattle.double&&n.length===1&&a.length===0?s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0):a.length>0&&s.phaseManager.pushNew("SwitchPhase",gt.SWITCH,this.fieldIndex,!0,!1):s.phaseManager.unshiftNew("GameOverPhase")}else s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),[ue.TRAINER,ue.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)&&s.getEnemyParty().filter(a=>a.isActive()&&!a.isOnField()&&a.trainerSlot===e.trainerSlot).length&&s.phaseManager.pushNew("SwitchSummonPhase",gt.SWITCH,this.fieldIndex,-1,!1,!1);const i=e.getAlly();s.currentBattle.double&&i&&s.redirectPokemonMoves(e,i),e.faintCry(()=>{e.isPlayer()&&e.addFriendship(-2),e.hideInfo(),s.playSound("se/faint"),s.tweens.add({targets:e,duration:500,y:e.y+150,ease:"Sine.easeIn",onComplete:c(()=>{e.lapseTags(Ms.FAINT),e.y-=150,e.doSetStatus(Yt.FAINT),e.isPlayer()?s.currentBattle.removeFaintedParticipant(e):(s.addFaintedEnemyScore(e),s.currentBattle.addPostBattleLoot(e)),e.leaveField(),this.end()},"onComplete")})})}tryOverrideForBattleSpec(){if(s.currentBattle.battleSpec===Ht.FINAL_BOSS&&!this.player){const e=this.getPokemon();return e.formIndex?s.ui.showDialogue(sf[Ht.FINAL_BOSS].secondStageWin,e.species.name,null,()=>this.doFaint()):(e.hp++,s.phaseManager.unshiftNew("DamageAnimPhase",e.getBattlerIndex(),0,$e.INDIRECT),this.end()),!0}return!1}};c(nc,"FaintPhase");let to=nc;const ac=class ac extends da{phaseName="FormChangePhase";formChange;modal;constructor(e,t,i){super(e,null,0),this.formChange=t,this.modal=i}validate(){return!!this.formChange}setMode(){return this.modal?s.ui.setOverlayMode(x.EVOLUTION_SCENE):super.setMode()}postFormChangeTweens(e,t){s.tweens.chain({targets:null,tweens:[{targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:c(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1)},"onComplete")},{targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn"},{targets:this.evolutionBgOverlay,alpha:0,duration:250,completeDelay:250,onComplete:c(()=>this.pokemon.cry(),"onComplete")}],completeDelay:1250,onComplete:c(()=>{let i=!1;this.formChange.formKey.indexOf(os.MEGA)>-1?(s.validateAchv(Pe.MEGA_EVOLVE),i=!0):(this.formChange.formKey.indexOf(os.GIGANTAMAX)>-1||this.formChange.formKey.indexOf(os.ETERNAMAX)>-1)&&(s.validateAchv(Pe.GIGANTAMAX),i=!0);const n=i?4e3:1750;s.playSoundWithoutBgm(i?"evolution_fanfare":"minor_fanfare"),e.destroy(),s.ui.showText(Er(this.pokemon,this.formChange,t),null,()=>this.end(),null,!0,ge(n)),s.time.delayedCall(ge(n+250),()=>s.playBgm())},"onComplete")})}afterCycle(e,t){s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),s.time.delayedCall(900,()=>{this.pokemon.speciesKey,this.pokemon.formKey,this.pokemon.changeForm(this.formChange).then(()=>{this.pokemon.speciesKey,this.pokemon.formKey;const i=[os.GIGANTAMAX,os.GIGANTAMAX_SINGLE,os.GIGANTAMAX_RAPID,os.ETERNAMAX];this.pokemon.isDynamaxed=i.includes(this.pokemon.formKey),`${this.pokemon.isDynamaxed}`,s.hasModifier(Zi,this.pokemon.instanceId)||(console.debug(`[] ${this.pokemon.name} WishingStarModifier `),s.addModifier(Zi,this.pokemon.instanceId)),this.pokemon.summonData?.speciesForm&&this.pokemon.loadAssets(!1),this.modal||s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),this.postFormChangeTweens(t,e)})})}beginTweens(e,t){s.tweens.chain({targets:null,tweens:[{delay:250,targets:this.evolutionBgOverlay,alpha:1,duration:1500,ease:"Sine.easeOut",onComplete:c(()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250,delay:1e3}),this.evolutionBg.setVisible(!0).play()},"onComplete")},{targets:this.pokemonTintSprite,alpha:{from:0,to:1},duration:2e3,onStart:c(()=>{s.playSound("se/charge"),this.doSpiralUpward()},"onStart"),onComplete:c(()=>{this.pokemonSprite.setVisible(!1)},"onComplete")}],completeDelay:1100,onComplete:c(()=>{s.playSound("se/beam"),this.doArcDownward(),s.time.delayedCall(1e3,()=>{this.pokemonEvoTintSprite.setScale(.25).setVisible(!0),this.doCycle(1,1,()=>this.afterCycle(e,t))})},"onComplete")})}doEvolution(){const e=Ne(this.pokemon,!1);this.pokemon.getPossibleForm(this.formChange).then(t=>{this.configureSprite(t,this.pokemonEvoSprite,!1),this.configureSprite(t,this.pokemonEvoTintSprite,!1),this.beginTweens(e,t)})}end(){this.pokemon.findAndRemoveTags(e=>e.tagType===Xe.AUTOTOMIZED),this.modal?s.ui.revertMode().then(()=>{if(s.ui.getMode()===x.PARTY){const e=s.ui.getHandler();e.clearPartySlots(),e.populatePartySlots()}super.end()}):super.end()}};c(ac,"FormChangePhase");let so=ac;const rc=class rc extends ut{phaseName="ModifierRewardPhase";modifierType;constructor(e){super(),this.modifierType=nf(e)}start(){super.start(),this.doReward().then(()=>this.end())}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("item_fanfare"),s.ui.showText(m.t("battle:rewardGain",{modifierName:t?.type.name}),null,()=>e(),null,!0)})}};c(rc,"ModifierRewardPhase");let dn=rc;const oc=class oc extends dn{phaseName="GameOverModifierRewardPhase";doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.fadeIn(250).then(()=>{s.ui.showText(m.t("battle:rewardGain",{modifierName:t?.type.name}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),e()},null,!0,1500)})})}};c(oc,"GameOverModifierRewardPhase");let io=oc;const lc=class lc{biome;weather;terrain;tags;positionalTags=[];playerTerasUsed;constructor(e){if(this.tags=e.tags?.map(t=>Eg(t))?.filter(t=>t instanceof bg)??[],this.playerTerasUsed=e.playerTerasUsed??0,e instanceof af){this.biome=e.biomeType,this.weather=e.weather,this.terrain=e.terrain,this.positionalTags=e.positionalTagManager.tags??[];return}this.biome=e.biome,this.weather=e.weather?new Ig(e.weather.weatherType,e.weather.turnsLeft):null,this.terrain=e.terrain?new vg(e.terrain.terrainType,e.terrain.turnsLeft):null,this.positionalTags=e.positionalTags??[]}};c(lc,"ArenaData");let pn=lc;const hc=class hc{id;value;severity;constructor(e){this.id=e.id,this.value=e.value,this.severity=e.severity}toChallenge(){return Sr(this)}};c(hc,"ChallengeData");let fn=hc;const cc=class cc{player;typeId;typePregenArgs;args;stackCount;className;constructor(e,t){const i=e instanceof $n?e:null;this.player=t,this.typeId=i?i.type.id:e.typeId,i?"getPregenArgs"in e.type&&(this.typePregenArgs=e.type.getPregenArgs()):e.typePregenArgs&&(this.typePregenArgs=e.typePregenArgs),this.args=i?i.getArgs():e.args||[],this.stackCount=e.stackCount,this.className=i?i.constructor.name:e.className}toModifier(e){const t=_g(this.typeId);if(!t)return null;try{let i=t();i.id=this.typeId,i instanceof Ag&&(i=i.generateType(this.player?s.getPlayerParty():s.getEnemyField(),this.typePregenArgs));const n=Reflect.construct(e,[i].concat(this.args).concat(this.stackCount));return n.stackCount>n.getMaxStackCount()&&(n.stackCount=n.getMaxStackCount()),n}catch(i){return console.error(i),null}}};c(cc,"ModifierData");let si=cc;const uc=class uc{trainerType;variant;partyTemplateIndex;nameKey;partnerNameKey;constructor(e){const t=e instanceof Zt?e:null;this.trainerType=t?t.config.trainerType:e.trainerType,this.variant=e.hasOwnProperty("variant")?e.variant:e.female?tt.FEMALE:tt.DEFAULT,this.partyTemplateIndex=e.partyMemberTemplateIndex,this.nameKey=e.nameKey,this.partnerNameKey=e.partnerNameKey}toTrainer(){return new Zt(this.trainerType,this.variant,this.partyTemplateIndex,this.nameKey,this.partnerNameKey)}};c(uc,"TrainerData");let gn=uc;var _i;let xT=(_i=class extends ut{phaseName="GameOverPhase";isVictory;firstRibbons=[];constructor(e=!1){super(),this.isVictory=e}start(){if(super.start(),s.phaseManager.hideAbilityBar(),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&(this.isVictory=!0),!this.isVictory&&s.currentBattle.mysteryEncounter?.onGameOver&&!s.currentBattle.mysteryEncounter.onGameOver())return this.end();if(this.isVictory&&s.gameMode.isEndless){const e=s.gameData.gender??Be.UNSET,t=Be[e].toLowerCase();s.ui.showDialogue(m.t("miscDialogue:endingEndless",{context:t}),m.t("miscDialogue:endingName"),0,()=>this.handleGameOver())}else this.isVictory||!s.enableRetries?this.handleGameOver():s.ui.showText(m.t("battle:retryBattle"),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.fadeOut(1250).then(()=>{s.reset(),s.phaseManager.clearPhaseQueue(),s.gameData.loadSession(s.sessionSlotId).then(()=>{s.phaseManager.pushNew("EncounterPhase",!0);const e=s.getPokemonAllowedInBattle().length;s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("SummonPhase",1),s.currentBattle.waveIndex>1&&s.currentBattle.battleType!==ue.TRAINER&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double)),s.ui.fadeIn(1250),this.end()})})},()=>this.handleGameOver(),!1,0,0,1e3)})}awardRibbons(){let e=0n;for(const i of s.gameMode.challenges){const n=i.ribbonAwarded;i.value&&n&&(e|=n)}const t=e&(Gs.FLIP_STATS|Gs.INVERSE);t?e=t:(s.gameMode.isClassic&&(e|=Gs.CLASSIC),xg()&&(e|=Gs.NUZLOCKE));for(const i of s.getPlayerParty()){const n=i.species;Og(n,s.gameData.getSpeciesDexAttrProps(n,i.getDexAttr()),!1)&&wg(n.speciesId,e)}}handleGameOver(){const e=c(t=>{s.disableMenu=!0,s.time.delayedCall(1e3,()=>{let i=!1;if(this.isVictory)if(s.gameMode.isClassic){i=s.validateAchv(Pe.CLASSIC_VICTORY),s.validateAchv(Pe.UNEVOLVED_CLASSIC_VICTORY),s.gameData.gameStats.sessionsWon++;for(const r of s.getPlayerParty())this.awardFirstClassicCompletion(r),r.species.getRootSpeciesId()!==r.species.getRootSpeciesId(!0)&&this.awardFirstClassicCompletion(r,!0);this.awardRibbons()}else s.gameMode.isDaily&&t&&(s.gameData.gameStats.dailyRunSessionsWon++,s.validateAchv(Pe.DAILY_VICTORY));const n=this.isVictory?1e4:5e3;s.fadeOutBgm(n,!0);const a=s.getField().filter(r=>r?.isActive(!0));a.map(r=>r.hideInfo()),s.ui.fadeOut(n).then(()=>{a.map(o=>o.setVisible(!1)),s.setFieldScale(1,!0),s.phaseManager.clearPhaseQueue(),s.ui.clearText(),this.isVictory&&s.gameMode.isChallenge&&s.gameMode.challenges.forEach(o=>s.validateAchvs(Mg,o));const r=c(o=>{if(this.isVictory&&t){this.handleUnlocks();for(const l of this.firstRibbons)s.phaseManager.unshiftNew("RibbonModifierRewardPhase",st.VOUCHER_PLUS,l);i||s.phaseManager.unshiftNew("GameOverModifierRewardPhase",st.VOUCHER_PREMIUM)}this.getRunHistoryEntry().then(l=>{s.gameData.saveRunHistory(l,this.isVictory),s.phaseManager.pushNew("PostGameOverPhase",o),this.end()})},"clear");if(this.isVictory&&s.gameMode.isClassic){const o="miscDialogue:ending";if(!s.ui.shouldSkipDialogue(o))s.ui.fadeIn(500).then(()=>{const l=s.gameData.gender??Be.UNSET,h=Be[l].toLowerCase(),u=m.t(o,{context:h});s.charSprite.showCharacter(`rival_${s.gameData.gender===Be.FEMALE?"m":"f"}`,Wa(u)).then(()=>{s.ui.showDialogue(o,s.gameData.gender===Be.FEMALE?Ei[D.RIVAL].name:Ei[D.RIVAL].nameFemale,null,()=>{s.ui.fadeOut(500).then(()=>{s.charSprite.hide().then(()=>{const p=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(p),r(p)})})})})});else{const l=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(l),r(l)}}else r()})})},"doGameOver");!Ci||rf?nt.savedata.session.newclear({slot:s.sessionSlotId,isVictory:this.isVictory,clientSessionId:zt}).then(t=>e(!s.gameMode.isDaily||!!t)).catch(t=>{s.phaseManager.clearPhaseQueue(),s.phaseManager.clearPhaseQueueSplice(),s.phaseManager.unshiftNew("MessagePhase",m.t("menu:serverCommunicationFailed"),2500),setTimeout(()=>{window.location.reload()},2e3),this.end()}):this.isVictory?s.gameData.offlineNewClear().then(t=>{e(t)}):e(!1)}handleUnlocks(){this.isVictory&&s.gameMode.isClassic&&(s.gameData.unlocks[It.ENDLESS_MODE]||s.phaseManager.unshiftNew("UnlockPhase",It.ENDLESS_MODE),s.getPlayerParty().filter(e=>e.fusionSpecies).length&&!s.gameData.unlocks[It.SPLICED_ENDLESS_MODE]&&s.phaseManager.unshiftNew("UnlockPhase",It.SPLICED_ENDLESS_MODE),s.gameData.unlocks[It.MINI_BLACK_HOLE]||s.phaseManager.unshiftNew("UnlockPhase",It.MINI_BLACK_HOLE),!s.gameData.unlocks[It.EVIOLITE]&&s.getPlayerParty().some(e=>e.getSpeciesForm(!0).speciesId in Wi)&&s.phaseManager.unshiftNew("UnlockPhase",It.EVIOLITE))}awardFirstClassicCompletion(e,t=!1){const i=ns(e.species.speciesId);s.gameData.incrementRibbonCount(i,t)===1&&this.firstRibbons.push(ns(e.species.getRootSpeciesId(t)))}async getRunHistoryEntry(){const e=await s.gameData.getSession(s.sessionSlotId);return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(t=>new qi(t)),enemyParty:s.getEnemyParty().map(t=>new qi(t)),modifiers:e?e.modifiers:s.findModifiers(()=>!0).map(t=>new si(t,!0)),enemyModifiers:e?e.enemyModifiers:s.findModifiers(()=>!0,!1).map(t=>new si(t,!1)),arena:new pn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.trainer?new gn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:Date.now(),challenges:s.gameMode.challenges.map(t=>new fn(t)),mysteryEncounterType:s.currentBattle.mysteryEncounter?.encounterType??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}},c(_i,"GameOverPhase"),_i);const dc=class dc extends je{phaseName="HideAbilityPhase";start(){super.start(),s.abilityBar.hide().then(()=>{this.end()})}};c(dc,"HideAbilityPhase");let mn=dc;const pc=class pc extends ut{phaseName="HidePartyExpBarPhase";start(){super.start(),s.partyExpBar.hide().then(()=>this.end())}};c(pc,"HidePartyExpBarPhase");let no=pc;const fc=class fc extends Bt{evolutionContainer;messageBg;messageContainer;canCancel;cancelled;constructor(){super(x.EVOLUTION_SCENE)}setup(){this.canCancel=!1,this.cancelled=!1;const e=this.getUi();this.evolutionContainer=s.add.container(0,-s.scaledCanvas.height);const t=s.add.sprite(0,0,"bg",s.windowType).setOrigin(0,1).setVisible(!1);this.messageBg=t,this.messageContainer=s.add.container(12,-39).setVisible(!1);const i=P(0,0,"",A.MESSAGE,{maxLines:2,wordWrap:{width:1780}});this.messageContainer.add(i),e.add([this.evolutionContainer,this.messageBg,this.messageContainer]),this.message=i,this.initPromptSprite(this.messageContainer)}show(e){return super.show(e),s.ui.bringToTop(this.evolutionContainer),s.ui.bringToTop(this.messageBg.setVisible(!0)),s.ui.bringToTop(this.messageContainer.setVisible(!0)),!0}processInput(e){if(this.canCancel&&!this.cancelled&&e===v.CANCEL)return this.cancelled=!0,!0;const t=this.getUi();if(this.awaitingActionInput&&(e===v.CANCEL||e===v.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}setCursor(e){return!1}clear(){this.clearText(),this.canCancel=!1,this.cancelled=!1,this.evolutionContainer.removeAll(!0),this.messageContainer.setVisible(!1),this.messageBg.setVisible(!1)}};c(fc,"EvolutionSceneHandler");let pa=fc;const gc=class gc extends Ka{phaseName="LearnMovePhase";moveId;messageMode;learnMoveType;cost;constructor(e,t,i=On.LEARN_MOVE,n=-1){super(e),this.moveId=t,this.learnMoveType=i,this.cost=n}start(){this.moveId,Fe[this.moveId],super.start();const e=this.getPokemon();e.compatibleTrs;const t=Fe[this.moveId];if(!t)return console.warn("[DEBUG] move not found, aborting LearnMovePhase"),this.end();const i=e.getMoveset();if(i.some(a=>a.moveId===t.id)&&this.moveId!==Ot.SKETCH)return this.end();this.messageMode=s.ui.getHandler()instanceof pa?x.EVOLUTION_SCENE:x.MESSAGE,s.ui.setMode(this.messageMode),i.length<4?this.learnMove(i.length,t,e):this.replaceMoveCheck(t,e)}async replaceMoveCheck(e,t){const i=m.t("battle:learnMovePrompt",{pokemonName:Ne(t),moveName:e.name}),n=m.t("battle:learnMoveLimitReached",{pokemonName:Ne(t)}),a=m.t("battle:learnMoveReplaceQuestion",{moveName:e.name}),r=[i,n].join("$");await s.ui.showTextPromise(r),await s.ui.showTextPromise(a,void 0,!1),await s.ui.setModeWithoutClear(x.CONFIRM,()=>this.forgetMoveProcess(e,t),()=>{s.ui.setMode(this.messageMode),this.rejectMoveAndEnd(e,t)})}async forgetMoveProcess(e,t){s.ui.setMode(this.messageMode),await s.ui.showTextPromise(m.t("battle:learnMoveForgetQuestion"),void 0,!0),await s.ui.setModeWithoutClear(x.SUMMARY,t,jp.LEARN_MOVE,e,i=>{if(i===4){s.ui.setMode(this.messageMode).then(()=>this.rejectMoveAndEnd(e,t));return}const n=m.t("battle:learnMoveForgetSuccess",{pokemonName:Ne(t),moveName:t.moveset[i].getName()}),a=[m.t("battle:countdownPoof"),n,m.t("battle:learnMoveAnd")].join("$");s.ui.setMode(this.messageMode).then(()=>this.learnMove(i,e,t,a))})}async rejectMoveAndEnd(e,t){await s.ui.showTextPromise(m.t("battle:learnMoveStopTeaching",{moveName:e.name}),void 0,!1),s.ui.setModeWithoutClear(x.CONFIRM,()=>{s.ui.setMode(this.messageMode),s.ui.showTextPromise(m.t("battle:learnMoveNotLearned",{pokemonName:Ne(t),moveName:e.name}),void 0,!0).then(()=>this.end())},()=>{s.ui.setMode(this.messageMode),this.replaceMoveCheck(e,t)})}async learnMove(e,t,i,n){this.learnMoveType===On.TM||On.TR?(i.usedTMs||(i.usedTMs=[]),i.usedTMs.push(this.moveId),s.phaseManager.tryRemovePhase(r=>r.is("SelectModifierPhase"))):this.learnMoveType===On.MEMORY&&(this.cost!==-1?(le.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=this.cost,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy")):s.phaseManager.tryRemovePhase(r=>r.is("SelectModifierPhase"))),i.setMove(e,this.moveId),ch(this.moveId).then(()=>{uh([this.moveId],!0)}),s.ui.setMode(this.messageMode);const a=m.t("battle:learnMove",{pokemonName:Ne(i),moveName:t.name});n&&await s.ui.showTextPromise(n),s.playSound("level_up_fanfare"),s.ui.showText(a,null,()=>{s.triggerPokemonFormChange(i,of,!0),this.end()},this.messageMode===x.EVOLUTION_SCENE?1e3:void 0,!0)}};c(gc,"LearnMovePhase");let ao=gc;const mc=class mc extends Ks{phaseName="LevelCapPhase";start(){super.start(),s.ui.setMode(x.MESSAGE).then(()=>{s.playSound("level_up_fanfare"),s.ui.showText(m.t("battle:levelCapUp",{levelCap:s.getMaxExpLevel()}),null,()=>this.end(),null,!0),this.executeForAll(e=>e.updateInfo(!0))})}};c(mc,"LevelCapPhase");let ro=mc;var ii=(C=>(C[C.DEFAULT=0]="DEFAULT",C[C.ONLY_LEVEL_UP=1]="ONLY_LEVEL_UP",C[C.SKIP=2]="SKIP",C))(ii||{});const yc=class yc extends Ka{phaseName="LevelUpPhase";lastLevel;level;pokemon=this.getPlayerPokemon();constructor(e,t,i){super(e),this.lastLevel=t,this.level=i}start(){super.start(),this.level>s.gameData.gameStats.highestLevel&&(s.gameData.gameStats.highestLevel=this.level),s.validateAchvs(Ng,new Pt(this.level));const e=this.pokemon.stats.slice(0);this.pokemon.calculateStats(),this.pokemon.updateInfo(),s.expParty===ii.DEFAULT?(s.playSound("level_up_fanfare"),s.ui.showText(m.t("battle:levelUp",{pokemonName:Ne(this.pokemon),level:this.level}),null,()=>s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end()),null,!0)):s.expParty===ii.SKIP?this.end():s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end())}end(){if(this.lastLevel<100){const e=this.getPokemon().getLevelMoves(this.lastLevel+1);for(const t of e)s.phaseManager.unshiftNew("LearnMovePhase",this.partyMemberIndex,t[1])}if(!this.pokemon.pauseEvolutions){const e=this.pokemon.getEvolution();e&&(this.pokemon.breakIllusion(),s.phaseManager.unshiftNew("EvolutionPhase",this.pokemon,e,this.lastLevel))}return super.end()}};c(yc,"LevelUpPhase");let oo=yc;const Tc=class Tc extends je{constructor(e){super(),this.moveId=e}phaseName="LoadMoveAnimPhase";start(){ch(this.moveId).then(()=>uh([this.moveId],!0)).then(()=>this.end())}};c(Tc,"LoadMoveAnimPhase");let lo=Tc;const Sc=class Sc extends je{phaseName="LoginPhase";showText;constructor(e=!0){super(),this.showText=e}start(){super.start();const e=!!br(Qs);s.ui.setMode(x.LOADING,{buttonActions:[]}),dh(e,ts).then(t=>{const i=t?t[0]:!1,n=t?t[1]:null;if(!i){if(!n||n===400){this.showText&&s.ui.showText(m.t("menu:logInOrCreateAccount")),s.playSound("menu_open");const a=c(()=>{ts().then(r=>{if(!r[0]){Xn(Qs),s.reset(!0,!0);return}s.gameData.loadSystem().then(()=>this.end())})},"loadData");s.ui.setMode(x.LOGIN_FORM,{buttonActions:[()=>{s.ui.playSelect(),a()},()=>{s.playSound("menu_open"),s.ui.setMode(x.REGISTRATION_FORM,{buttonActions:[()=>{s.ui.playSelect(),ts().then(r=>{if(!r[0]){Xn(Qs),s.reset(!0,!0);return}this.end()})},()=>{s.phaseManager.unshiftNew("LoginPhase",!1),this.end()}]})},()=>{const l=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(l,"_self")},()=>{const l=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&response_type=code&scope=openid`;window.open(l,"_self")}]})}else n===401?(Xn(Qs),s.reset(!0,!0)):(s.phaseManager.unshiftNew("UnavailablePhase"),super.end());return null}s.gameData.loadSystem().then(a=>{a||ra?this.end():(s.ui.setMode(x.MESSAGE),s.ui.showText(eT("menu:failedToLoadSaveData")))})})}end(){s.ui.setMode(x.MESSAGE),s.gameData.gender||s.phaseManager.unshiftNew("SelectGenderPhase"),Oi(ws.Intro).then(()=>super.end())}};c(Sc,"LoginPhase");let ho=Sc;const Cc=class Cc extends je{phaseName="MessagePhase";text;callbackDelay;prompt;promptDelay;speaker;constructor(e,t,i,n,a){super(),this.text=e,this.callbackDelay=t,this.prompt=i,this.promptDelay=n,this.speaker=a}start(){if(super.start(),this.text.indexOf("$")>-1){const e=[],t=["#POKEMON1","#POKEMON2"];for(let n=0;n<s.getPlayerField().length;n++)e.push(s.getPlayerField()[n].getNameToRender()),this.text=this.text.split(e[n]).join(t[n]);const i=this.text.indexOf("$");if(i!==-1){let n=this.text.slice(0,i),a=this.text.slice(i+1);for(let r=0;r<s.getPlayerField().length;r++)n=n.split(t[r]).join(e[r]),a=a.split(t[r]).join(e[r]);s.phaseManager.unshiftNew("MessagePhase",a,this.callbackDelay,this.prompt,this.promptDelay,this.speaker),this.text=n.trim()}else for(let n=0;n<s.getPlayerField().length;n++)this.text=this.text.split(t[n]).join(e[n])}this.speaker?s.ui.showDialogue(this.text,this.speaker,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.promptDelay??0):s.ui.showText(this.text,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.prompt,this.promptDelay)}};c(Cc,"MessagePhase");let fa=Cc;const Ec=class Ec extends ut{phaseName="MoneyRewardPhase";moneyMultiplier;constructor(e){super(),this.moneyMultiplier=e}start(){const e=new Pt(s.getWaveMoneyAmount(this.moneyMultiplier));s.applyModifiers(kg,!0,e),s.arena.getTag(Ya.HAPPY_HOUR)&&(e.value*=2),s.addMoney(e.value);const t=navigator.language||"en-US",i=e.value.toLocaleString(t),n=m.t("battle:moneyWon",{moneyAmount:i});s.ui.showText(n,null,()=>this.end(),null,!0)}};c(Ec,"MoneyRewardPhase");let co=Ec;const bc=class bc extends je{constructor(e,t=!1){super(),this.anim=e,this.onSubstitute=t}phaseName="MoveAnimPhase";start(){super.start(),this.anim.play(this.onSubstitute,()=>this.end())}};c(bc,"MoveAnimPhase");let uo=bc;const Ic=class Ic extends Ut{phaseName="MoveChargePhase";move;targetIndex;useMode;constructor(e,t,i,n){super(e),this.move=i,this.targetIndex=t,this.useMode=n}start(){super.start();const e=this.getUserPokemon(),t=this.getTargetPokemon(),i=this.move.getMove();if(!t||!i.isChargingMove()){console.warn("Invalid parameters for MoveChargePhase"),super.end();return}new Pg(i.chargeAnim,i.id,e).play(!1,()=>{i.showChargeText(e,t),ep("MoveEffectAttr",e,t,i),e.addTag(Xe.CHARGING,1,i.id,e.id),this.end()})}end(){const e=this.getUserPokemon(),t=this.move.getMove(),i=new ot(!1);ep("InstantChargeAttr",e,null,t,i),i.value?(s.phaseManager.tryRemovePhase(n=>n.is("MoveEndPhase")&&n.getPokemon()===e),s.phaseManager.unshiftNew("MovePhase",e,[this.targetIndex],this.move,this.useMode)):e.pushMoveQueue({move:t.id,targets:[this.targetIndex],useMode:this.useMode}),e.pushMoveHistory({move:this.move.moveId,targets:[this.targetIndex],result:pi.OTHER,useMode:this.useMode}),super.end()}getUserPokemon(){return(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]}getTargetPokemon(){return s.getField(!0).find(e=>this.targetIndex===e.getBattlerIndex())}};c(Ic,"MoveChargePhase");let po=Ic;const et={PENDING:0,HIT:1,NO_EFFECT:2,NO_EFFECT_NO_MESSAGE:3,PROTECTED:4,MISS:5,REFLECTED:6,TARGET_NOT_ON_FIELD:7,ERROR:8},Ti=class Ti extends Ut{phaseName="MoveEffectPhase";move;targets;useMode;hitChecks;moveHistoryEntry;firstHit;lastHit;queuedPhases=[];constructor(e,t,i,n=!1,a=!1){if(super(e),this.move=i,this.reflected=n,this.virtual=a,!Array.isArray(t))console.warn("MoveEffectPhase constructor - invalid targets, resetting to []:",t),this.targets=[];else{if(t.includes(e)&&this.move.moveTarget===wn.ALL_NEAR_OTHERS){const r=t.indexOf(e);t.splice(r,1)}this.targets=t}this.hitChecks=Array(this.targets.length).fill([et.PENDING,0])}conductHitChecks(e,t){let i=!1,n=!0,a=this.getTargets();for(const[r,o]of a.entries()){const l=this.hitCheck(o);if(t&&l[0]===et.REFLECTED){a=[o],this.hitChecks=[l];break}l[0]===et.HIT?i=!0:n||=l[0]===et.MISS,this.hitChecks[r]=l}if(i){if(this.moveHistoryEntry.result=pi.SUCCESS,s.arena.ignoreAbilities){for(const r of a)if(r.getHeldItems().some(o=>o instanceof Bg)){console.debug(`[DEBUG] ${r.name} AbilityGuard   ignoreAbilities `),s.arena.setIgnoreAbilities(!1,e.getBattlerIndex());break}}}else e.turnData.hitCount=1,e.turnData.hitsLeft=1,this.moveHistoryEntry.result=n?pi.MISS:pi.FAIL;return a}queueReflectedMove(e,t){const i=this.move.isMultiTarget()?lh(t,this.move.id).targets:[e.getBattlerIndex()];t.getTag(Xe.MAGIC_COAT)||(this.queuedPhases.push(s.phaseManager.create("ShowAbilityPhase",t.getBattlerIndex(),t.getPassiveAbility().hasAttr("ReflectStatusMoveAbAttr"))),this.queuedPhases.push(s.phaseManager.create("HideAbilityPhase"))),this.queuedPhases.push(s.phaseManager.create("MovePhase",t,i,new ps(this.move.id),ti.REFLECTED))}applyToTargets(e,t){let i=!0;for(const[n,a]of t.entries()){const[r,o]=this.hitChecks[n];switch(r){case et.HIT:if(this.applyMoveEffects(a,o,i),i=!1,Mn(this.move))return;break;case et.NO_EFFECT:s.phaseManager.queueMessage(m.t(this.move.id===Ot.SHEER_COLD?"battle:hitResultImmune":"battle:hitResultNoEffect",{pokemonName:Ne(a)}));case et.NO_EFFECT_NO_MESSAGE:case et.PROTECTED:case et.TARGET_NOT_ON_FIELD:fi("NoEffectAttr",e,a,this.move);break;case et.MISS:s.phaseManager.queueMessage(m.t("battle:attackMissed",{pokemonNameWithAffix:Ne(a)})),fi("MissEffectAttr",e,a,this.move);const l=s.getModifiers(tp);for(const h of l)h instanceof tp&&h.pokemonId===e.id&&h.apply(e,this.move)&&s.updateModifiers(this.player);break;case et.REFLECTED:this.queueReflectedMove(e,a);break;case et.PENDING:case et.ERROR:throw new Error("Unexpected hit check result")}}}start(){super.start();const e=this.getUserPokemon();if(!e){super.end();return}e.isPlayer()?s.currentBattle.lastPlayerInvolved=this.fieldIndex:s.currentBattle.lastEnemyInvolved=this.fieldIndex;const t=this.move,i=new ot(!1);if(fi("OverrideMoveEffectAttr",e,this.getFirstTarget()??null,t,i,this.useMode),i.value){this.end();return}if(e.lapseTags(Ms.MOVE_EFFECT),e.turnData.hitsLeft===0&&e.turnData.hitCount>0&&e.turnData.extraTurns>0&&(e.turnData.hitsLeft=-1,e.turnData.hitCount=0,e.turnData.extraTurns--),e.turnData.hitsLeft===-1){const r=new Pt(1);if(fi("MultiHitAttr",e,this.getFirstTarget()??null,t,r),Oe("AddSecondStrikeAbAttr",{pokemon:e,move:t,hitCount:r}),s.getModifiers(Lg).find(l=>l.pokemonId===e.id)){const l=t.getAttrs("MultiHitAttr")[0];if(l){const h=l.getMaxHitCount?l.getMaxHitCount():l.getMultiHitType()===Dg._2_TO_5?5:r.value;console.debug(`[DEBUG] Loaded Dice :   ${h} `),r.value=h}}else s.applyModifiers(Rg,e.isPlayer(),e,t.id,r);e.turnData.hitCount=r.value,e.turnData.hitsLeft=r.value}this.moveHistoryEntry={move:this.move.id,targets:this.targets,result:pi.PENDING,useMode:this.useMode};const n=Mn(t),a=this.conductHitChecks(e,n);if(this.firstHit=e.turnData.hitCount===e.turnData.hitsLeft,this.lastHit=e.turnData.hitsLeft===1||!a.some(r=>r.isActive(!0)),!t||typeof t.getAttrs!="function"){console.warn("[MoveEffectPhase.start] move is invalid or missing getAttrs, skipping phase",t),this.end();return}if(this.moveHistoryEntry.result===pi.SUCCESS||Array.isArray(t.getAttrs("MoveEffectAttr"))&&t.getAttrs("MoveEffectAttr").some(r=>r.trigger===Fi.POST_TARGET)){const r=this.getFirstTarget(),o=t;new Fg(o.id,e,r?.getBattlerIndex()??ct.ATTACKER,n||(s.currentBattle?.mysteryEncounter?.hasBattleAnimationsWithoutTargets??!1)).play(o.hitsSubstitute(e,r),()=>this.postAnimCallback(e,a,o));return}this.postAnimCallback(e,a,t)}postAnimCallback(e,t){this.firstHit&&this.useMode!==ti.DELAYED_ATTACK&&(e.pushMoveHistory(this.moveHistoryEntry),Oe("ExecutedMoveAbAttr",{pokemon:e}));try{this.applyToTargets(e,t)}catch(n){console.warn(n.message||"Unexpected error in move effect phase"),this.end();return}this.queuedPhases.length&&s.phaseManager.appendToPhase(this.queuedPhases,"MoveEndPhase");const i=e.getMoveType(this.move,!0);this.move.category!==Ja.STATUS&&!e.stellarTypesBoosted.includes(i)&&e.stellarTypesBoosted.push(i),this.lastHit&&this.triggerMoveEffects(Fi.POST_TARGET,e,null),this.updateSubstitutes(),this.end()}end(){const e=this.getUserPokemon();if(!e){super.end();return}if(--e.turnData.hitsLeft>=1&&this.getFirstTarget()){this.addNextHitPhase(),super.end();return}const t=e.turnData.hitCount-Math.max(e.turnData.hitsLeft,0);(t>1||e.turnData.hitsLeft>0)&&s.phaseManager.queueMessage(m.t("battle:attackHitsCount",{count:t})),s.applyModifiers(Ug,this.player,e),this.getTargets().forEach(i=>{i.turnData.moveEffectiveness=null}),super.end()}applyOnGetHitAbEffects(e,t,i,n,a=!1){if(!t.isFainted()||t.canApplyAbility()){const l={pokemon:t,opponent:e,move:this.move,hitResult:i,damage:n};Oe("PostDefendAbAttr",l);const h=this.move;if(h&&h.hasFlag(Ui.MAKES_CONTACT,e,t)&&(s.getModifiers(sp).find(f=>f.pokemonId===t.id)||t.hasRockyHelmet?.name===""&&s.applyModifier(sp,this.player,t))){const f=e.getMaxHp(),d=Math.floor(f/6);if(e.damageAndUpdate(d,{result:$e.INDIRECT}),s){const y=m.t("modifier:contactDamageApplied",{pokemonNameWithAffix:Ne(e),itemName:""});s.phaseManager.queueMessage(y)}}}s.getModifiers(Vg).filter(l=>l.pokemonId===t.id).forEach(l=>{if(s.removeModifier(l),l.sourceItem?.name==="air_balloon"&&t.heldItem?.name==="air_balloon"){const h=m.t("modifier:balloonPopped",{pokemonNameWithAffix:Ne(t),itemName:t.heldItem.name});s.queueMessage(h),t.loseHeldItem(t.heldItem),s.updateModifiers(t.player)}});const o={pokemon:t,opponent:e,move:this.move,hitResult:i,damage:0};a&&Oe("PostReceiveCritStatStageChangeAbAttr",o),t.lapseTags(Ms.AFTER_HIT)}applyHeldItemFlinchCheck(e,t,i){if(!this.move.hasAttr("FlinchAttr")&&i&&!t.hasAbilityWithAttr("IgnoreMoveEffectsAbAttr")&&!this.move.hitsSubstitute(e,t)){const n=new ot(!1);if(s.applyModifiers(er,e.isPlayer(),e,t,null,!1,n),!!s.getModifiers(er).find(o=>o.pokemonId===t.id)||t.isPlayer()&&s.applyModifier(er,t.player,t))return;s.applyModifiers(Hg,e.isPlayer(),e,n),n.value&&t.addTag(Xe.FLINCHED,void 0,this.move.id,e.id)}}protectedCheck(e,t){const i=t.isPlayer()?sn.PLAYER:sn.ENEMY,n=new ot(!1),a=new ot(!1);return this.move.isAllyTarget()||s.arena.applyTagsForSide(Yg,i,!1,n,e,t,this.move.id,a),![wn.ENEMY_SIDE,wn.BOTH_SIDES].includes(this.move.moveTarget)&&(a.value||!this.move.doesFlagEffectApply({flag:Ui.IGNORE_PROTECT,user:e,target:t}))&&(n.value||!t.findTags(r=>r instanceof ip).length&&t.findTags(r=>r instanceof Gg).some(r=>t.lapseTag(r.tagType))||this.move.category!==Ja.STATUS&&t.findTags(r=>r instanceof ip).some(r=>t.lapseTag(r.tagType)))}hitCheck(e){const t=this.getUserPokemon(),i=this.move;if(!t)return[et.ERROR,0];if(i.moveTarget===wn.USER)return[et.HIT,1];const n=Mn(i);if(!e.isActive(!0)&&!n)return[et.TARGET_NOT_ON_FIELD,0];if(!n&&s.currentBattle.double&&e.getAlly()?.getTag(Xe.COMMANDED)?.getSourcePokemon()===e)return[et.MISS,0];const a=n||this.checkBypassAccAndInvuln(e),r=e.getTag(lf);if(r&&!a&&!this.checkBypassSemiInvuln(r))return[et.MISS,0];if(!n&&this.protectedCheck(t,e))return[et.PROTECTED,0];if(!Wg(this.useMode)&&i.doesFlagEffectApply({flag:Ui.REFLECTABLE,user:t,target:e}))return[et.REFLECTED,0];if(n)return[et.HIT,1];const o=new ot(!1),l=e.getMoveEffectiveness(t,i,!1,!1,o);if(l===0)return[o.value?et.NO_EFFECT_NO_MESSAGE:et.NO_EFFECT,l];const h=i.calculateBattleAccuracy(t,e);if(t.turnData.hitsLeft<t.turnData.hitCount&&(!i.hasFlag(Ui.CHECK_ALL_HITS)||t.hasAbilityWithAttr("MaxMultiHitAbAttr")))return[et.HIT,l];const u=a||e.getTag(Xe.ALWAYS_GET_HIT)||e.getTag(Xe.TELEKINESIS)&&!this.move.hasAttr("OneHitKOAttr");if(h===-1||u)return[et.HIT,l];const p=t.getAccuracyMultiplier(e,this.move);return t.randBattleSeedInt(100)<h*p?[et.HIT,l]:[et.MISS,0]}checkBypassAccAndInvuln(e){const t=this.getUserPokemon();if(!t)return!1;if(t.hasAbilityWithAttr("AlwaysHitAbAttr")||e.hasAbilityWithAttr("AlwaysHitAbAttr")||this.move.hasAttr("ToxicAccuracyAttr")&&t.isOfType(Se.POISON)||t.getTag(Xe.IGNORE_ACCURACY)&&(t.getLastXMoves().find(()=>!0)?.targets||[]).indexOf(e.getBattlerIndex())!==-1||Mn(this.move))return!0}checkBypassSemiInvuln(e){return e?this.move.getAttrs("HitsTagAttr").some(i=>i.tagType===e.tagType):!1}getUserPokemon(){return this.battlerIndex>ct.ENEMY_2?s.getPokemonById(this.battlerIndex):(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]}getTargets(){Array.isArray(this.targets)||(console.warn("MoveEffectPhase.getTargets() - this.targets is invalid:",this.targets),this.targets=[]);const e=s.getField?.(!0);return Array.isArray(e)?e.filter(t=>this.targets.includes(t.getBattlerIndex())):(console.warn("MoveEffectPhase.getTargets() - globalScene.getField(true) returned invalid:",e),[])}getFirstTarget(){return this.getTargets()[0]}removeTarget(e){this.targets.indexOf(e.getBattlerIndex())!==-1&&this.targets.splice(this.targets.indexOf(e.getBattlerIndex()),1)}stopMultiHit(e){e&&this.removeTarget(e);const t=this.getUserPokemon();t&&(!e||this.targets.length===0)&&(t.turnData.hitCount=1,t.turnData.hitsLeft=1)}addNextHitPhase(){s.phaseManager.unshiftNew("MoveEffectPhase",this.battlerIndex,this.targets,this.move,this.useMode)}updateSubstitutes(){const e=this.getTargets();for(const t of e){const i=t.getTag(vs);i&&i.hp<=0&&t.lapseTag(Xe.SUBSTITUTE)}}triggerMoveEffects(e,t,i,n,a){Kg(r=>r.is("MoveEffectAttr")&&r.trigger===e&&(ve(a)||r.selfTarget===a)&&(!r.firstHitOnly||this.firstHit)&&(!r.lastHitOnly||this.lastHit)&&(!r.firstTargetOnly||(n??!0)),t,i,this.move)}applyMoveEffects(e,t,i){const n=this.getUserPokemon();if(ve(n))return;this.triggerMoveEffects(Fi.PRE_APPLY,n,e);const[a,r,o]=this.applyMove(n,e,t);this.triggerMoveEffects(Fi.POST_APPLY,n,e,i,!0),this.move.hitsSubstitute(n,e)||this.applyOnTargetEffects(n,e,a,i,o,r),this.lastHit&&(s.triggerPokemonFormChange(n,zg),n.turnData.hitCount>1&&Oe("PostDamageAbAttr",{pokemon:e,damage:0,source:n}))}applyMoveDamage(e,t,i){const n=t.getCriticalHitResult(e,this.move);fi("StatChangeBeforeDmgCalcAttr",e,t,this.move);const{result:a,damage:r}=t.getAttackDamage({source:e,move:this.move,ignoreAbility:!1,ignoreSourceAbility:!1,ignoreAllyAbility:!1,ignoreSourceAllyAbility:!1,simulated:!1,effectiveness:i,isCritical:n}),o=e.findTag(f=>f instanceof jg&&f.boostedType===e.getMoveType(this.move));o?.oneUse&&e.removeTag(o.tagType);const l=a===$e.ONE_HIT_KO;if(!r)return[a,!1,0];t.lapseTags(Ms.HIT);const h=t.getTag(vs),u=h&&this.move.hitsSubstitute(e,t);u?(e.turnData.totalDamageDealt+=Math.min(r,h.hp),h.hp-=r):!t.isPlayer()&&r>=t.hp&&s.applyModifiers($g,!1,t);const p=u?0:t.damageAndUpdate(r,{result:a,ignoreFaintPhase:!0,ignoreSegments:l,isCritical:n,source:e});return n&&s.phaseManager.queueMessage(m.t("battle:hitResultCriticalHit")),p<=0?[a,n,p]:(e.isPlayer()&&(s.validateAchvs(Xg,new Pt(p)),p>s.gameData.gameStats.highestDamage&&(s.gameData.gameStats.highestDamage=p)),e.turnData.totalDamageDealt+=p,e.turnData.singleHitDamageDealt=p,t.battleData.hitCount++,t.turnData.damageTaken+=p,t.turnData.attacksReceived.unshift({move:this.move.id,result:a,damage:p,critical:n,sourceId:e.id,sourceBattlerIndex:e.getBattlerIndex()}),e.isPlayer()&&t.isEnemy()&&s.applyModifiers(qg,!0,e,new Pt(p)),[a,n,p])}onFaintTarget(e,t){s.phaseManager.setPhaseQueueSplice(),s.phaseManager.unshiftNew("FaintPhase",t.getBattlerIndex(),!1,e),t.destroySubstitute(),t.lapseTag(Xe.COMMANDED),!this.lastHit&&e.turnData.hitsLeft>1&&(this.lastHit=!0)}queueHitResultMessage(e){let t;switch(e){case $e.SUPER_EFFECTIVE:t=m.t("battle:hitResultSuperEffective");break;case $e.NOT_VERY_EFFECTIVE:t=m.t("battle:hitResultNotVeryEffective");break;case $e.ONE_HIT_KO:t=m.t("battle:hitResultOneHitKO");break}t&&s.phaseManager.queueMessage(t)}applyMove(e,t,i){if(e.getMoveCategory(t,this.move)===Ja.STATUS)return[$e.STATUS,!1,0];const a=this.applyMoveDamage(e,t,i);return(e.turnData.hitsLeft===1||t.isFainted())&&this.queueHitResultMessage(a[0]),t.isFainted()&&this.onFaintTarget(e,t),a}applyOnTargetEffects(e,t,i,n,a,r=!1){console.debug("[applyOnTargetEffects] ",{user:e.name,target:t.name,hitResult:i,damage:a,move:this.move.id,moveClass:this.move.constructor.name,isAttackMove:this.move.is("AttackMove")});const o=[$e.EFFECTIVE,$e.SUPER_EFFECTIVE,$e.NOT_VERY_EFFECTIVE,$e.ONE_HIT_KO].includes(i);if(this.triggerMoveEffects(Fi.POST_APPLY,e,t,n,!1),this.applyHeldItemFlinchCheck(e,t,o),this.applyOnGetHitAbEffects(e,t,i,a,r),Oe("PostAttackAbAttr",{pokemon:e,opponent:t,move:this.move,hitResult:i,damage:a}),!(s.phaseManager.findPhase(h=>h instanceof Ti&&h.battlerIndex===this.battlerIndex)instanceof Ti)&&this.move.hasFlag(Ui.SOUND_BASED)){e.currentMove=this.move;const h=s.getModifiers(np);if(h.length>0)for(const u of h)u instanceof np&&u.apply(e,this.move.type,this.move.power)&&(s.phaseManager.unshiftPhase(new Ti(e.getBattlerIndex(),!0,[Ws.SPATK],1)),e.loseHeldItem(u),s.updateModifiers(this.player))}!e.isPlayer()&&this.move.is("AttackMove")&&s.applyShuffledModifiers(hf,!1,t),this.move.is("AttackMove")&&(console.debug("[applyOnTargetEffects] ContactHeldItemTransferChanceModifier  "),s.applyModifiers(Qg,this.player,e,t))}};c(Ti,"MoveEffectPhase");let fo=Ti;const vc=class vc extends ut{phaseName="MoveHeaderPhase";pokemon;move;constructor(e,t){super(),this.pokemon=e,this.move=t}canMove(){return this.pokemon.isActive(!0)&&this.move.isUsable(this.pokemon)}start(){super.start(),this.canMove()&&fi("MoveHeaderAttr",this.pokemon,null,this.move.getMove()),this.end()}};c(vc,"MoveHeaderPhase");let go=vc;const _c=class _c{type;tier;waveIndex;selectedOption;constructor(e,t,i,n){this.type=e,this.tier=t,this.waveIndex=i,this.selectedOption=n??-1}};c(_c,"SeenEncounterData");let mo=_c;const Ac=class Ac{encounteredEvents=[];encounterSpawnChance=cf;queuedEncounters=[];constructor(e){ve(e)||Object.assign(this,e),this.encounteredEvents=this.encounteredEvents??[],this.queuedEncounters=this.queuedEncounters??[]}};c(Ac,"MysteryEncounterSaveData");let Pi=Ac;const xc=class xc extends je{phaseName="MysteryEncounterPhase";FIRST_DIALOGUE_PROMPT_DELAY=300;optionSelectSettings;constructor(e){super(),this.optionSelectSettings=e}start(){super.start(),s.phaseManager.clearPhaseQueue(),s.phaseManager.clearPhaseQueueSplice();const e=s.currentBattle.mysteryEncounter;e.updateSeedOffset(),this.optionSelectSettings||s.mysteryEncounterSaveData.encounteredEvents.push(new mo(e.encounterType,e.encounterTier,s.currentBattle.waveIndex)),s.ui.setMode(x.MYSTERY_ENCOUNTER,this.optionSelectSettings)}handleOptionSelect(e,t){if(s.currentBattle.mysteryEncounter.selectedOption=e,!this.optionSelectSettings){const i=s.mysteryEncounterSaveData.encounteredEvents[s.mysteryEncounterSaveData.encounteredEvents.length-1];i.type===s.currentBattle.mysteryEncounter?.encounterType&&(i.selectedOption=t)}return e.onOptionPhase?(s.currentBattle.mysteryEncounter.populateDialogueTokensFromRequirements(),e.onPreOptionPhase?s.executeWithSeedOffset(async()=>await e.onPreOptionPhase().then(i=>{(ve(i)||i)&&this.continueEncounter()}),s.currentBattle.mysteryEncounter?.getSeedOffset()):this.continueEncounter(),!0):!1}continueEncounter(){const e=c(()=>{s.phaseManager.pushNew("MysteryEncounterOptionSelectedPhase"),this.end()},"endDialogueAndContinueEncounter"),t=s.currentBattle?.mysteryEncounter?.selectedOption?.dialogue;if(t?.selected&&t.selected.length>0){s.ui.setMode(x.MESSAGE);const i=t.selected;let n=0;const a=c(()=>{const r=n===i.length-1?e:a,o=i[n];let l=null;const h=jt(o.text);o.speaker&&(l=jt(o.speaker)),n++,l?s.ui.showDialogue(h??"",l,null,r,0,n===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(h??"",null,r,n===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");a()}else e()}end(){s.ui.setMode(x.MESSAGE).then(()=>super.end())}};c(xc,"MysteryEncounterPhase");let yo=xc;const Oc=class Oc extends je{phaseName="MysteryEncounterOptionSelectedPhase";onOptionSelect;constructor(){super(),this.onOptionSelect=s.currentBattle.mysteryEncounter.selectedOption.onOptionPhase}start(){super.start(),s.currentBattle.mysteryEncounter?.autoHideIntroVisuals?Zg().then(()=>{s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},s.currentBattle.mysteryEncounter?.getSeedOffset()*500)}):s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},s.currentBattle.mysteryEncounter?.getSeedOffset()*500)}};c(Oc,"MysteryEncounterOptionSelectedPhase");let To=Oc;const wc=class wc extends je{phaseName="MysteryEncounterBattleStartCleanupPhase";start(){super.start();const e=[Xe.FLINCHED,Xe.ENDURING];for(s.getField(!0).forEach(a=>{const r=a.summonData.tags;r.filter(o=>e.includes(o.tagType)&&o.lapseTypes.includes(Ms.TURN_END)&&!o.lapse(a,Ms.TURN_END)).forEach(o=>{o.onRemove(a),r.splice(r.indexOf(o),1)})});s.phaseManager.findPhase(a=>a.is("PostTurnStatusEffectPhase"));)s.phaseManager.tryRemovePhase(a=>a.is("PostTurnStatusEffectPhase"));const t=s.getPokemonAllowedInBattle(),i=t.filter(a=>!a.isActive(!0));if(!t.length)return s.phaseManager.unshiftNew("GameOverPhase"),this.end();s.getPlayerField().forEach((a,r)=>{!a.isAllowedInBattle()&&i.length>r&&s.phaseManager.unshiftNew("SwitchPhase",gt.SWITCH,r,!0,!1)}),s.currentBattle.double&&t.length===1&&i.length===0&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0),this.end()}};c(wc,"MysteryEncounterBattleStartCleanupPhase");let So=wc;const Mc=class Mc extends je{phaseName="MysteryEncounterBattlePhase";disableSwitch;constructor(e=!1){super(),this.disableSwitch=e}start(){super.start(),this.doMysteryEncounterBattle()}getBattleMessage(){const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;return s.currentBattle.battleSpec===Ht.FINAL_BOSS?m.t("battle:bossAppeared",{bossName:e[0].name}):t===hs.TRAINER_BATTLE?s.currentBattle.double?m.t("battle:trainerAppearedDouble",{trainerName:s.currentBattle.trainer?.getName(Ct.NONE,!0)}):m.t("battle:trainerAppeared",{trainerName:s.currentBattle.trainer?.getName(Ct.NONE,!0)}):e.length===1?m.t("battle:singleWildAppeared",{pokemonName:e[0].name}):m.t("battle:multiWildAppeared",{pokemonName1:e[0].name,pokemonName2:e[1].name})}doMysteryEncounterBattle(){const e=s.currentBattle.mysteryEncounter.encounterMode;if(e===hs.WILD_BATTLE||e===hs.BOSS_BATTLE){e===hs.BOSS_BATTLE&&s.playBgm();const t=s.getEnemyParty().filter(i=>!i.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&t>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),s.currentBattle.mysteryEncounter?.hideBattleIntroMessage?this.endBattleSetup():s.ui.showText(this.getBattleMessage(),null,()=>this.endBattleSetup(),0)}else if(e===hs.TRAINER_BATTLE){this.showEnemyTrainer();const t=c(()=>{s.currentBattle.started=!0,s.playBgm(),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const n=c(()=>{this.hideEnemyTrainer();const a=s.getEnemyParty().filter(r=>!r.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&a>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.endBattleSetup()},"doTrainerSummon");s.currentBattle.mysteryEncounter?.hideBattleIntroMessage?n():s.ui.showText(this.getBattleMessage(),null,n,1e3,!0)},"doSummon"),i=s.currentBattle.trainer?.getEncounterMessages();if(!i||!i.length)t();else{const n=s.currentBattle.trainer;let a;s.executeWithSeedOffset(()=>a=In(i),s.currentBattle.mysteryEncounter?.getSeedOffset()),a=a;const r=c(()=>{s.ui.showDialogue(a,n?.getName(Ct.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>t()))})},"showDialogueAndSummon");s.currentBattle.trainer?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(a)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(n?.getKey(),Wa(i[0])).then(()=>r())):r()}}}endBattleSetup(){const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;t!==hs.TRAINER_BATTLE&&s.findModifier(a=>a instanceof Jp)&&e.map(a=>s.phaseManager.pushNew("ScanIvsPhase",a.getBattlerIndex()));const i=s.getPlayerParty().filter(n=>n.isAllowedInBattle());if(i[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double?i.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1)):(i.length>1&&i[1].isOnField()&&(s.getPlayerField().forEach(n=>n.lapseTag(Xe.COMMANDED)),s.phaseManager.pushNew("ReturnPhase",1)),s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)),t!==hs.TRAINER_BATTLE&&!this.disableSwitch){const n=s.currentBattle.double?2:1;i.length>n&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}this.end()}showEnemyTrainer(){const e=s.currentBattle.trainer;e&&(e.alpha=0,e.x+=16,e.y-=16,e.setVisible(!0),s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,ease:"Sine.easeInOut",duration:750,onComplete:c(()=>{e.untint(100,"Sine.easeOut"),e.playAnim()},"onComplete")}))}hideEnemyTrainer(){s.tweens.add({targets:s.currentBattle.trainer,x:"+=16",y:"-=16",alpha:0,ease:"Sine.easeInOut",duration:750})}};c(Mc,"MysteryEncounterBattlePhase");let Co=Mc;const Nc=class Nc extends je{phaseName="MysteryEncounterRewardsPhase";addHealPhase;constructor(e=!1){super(),this.addHealPhase=e}start(){super.start();const e=s.currentBattle.mysteryEncounter;e.doContinueEncounter?e.doContinueEncounter().then(()=>{this.end()}):s.executeWithSeedOffset(()=>{e.onRewards?e.onRewards().then(()=>{this.doEncounterRewardsAndContinue()}):this.doEncounterRewardsAndContinue()},s.currentBattle.waveIndex*1e3)}doEncounterRewardsAndContinue(){const e=s.currentBattle.mysteryEncounter;e.doEncounterExp&&e.doEncounterExp(),e.doEncounterRewards?e.doEncounterRewards():this.addHealPhase&&(s.phaseManager.tryRemovePhase(t=>t.is("SelectModifierPhase")),s.phaseManager.unshiftNew("SelectModifierPhase",0,void 0,{fillRemaining:!1,rerollMultiplier:-1})),s.phaseManager.pushNew("PostMysteryEncounterPhase"),this.end()}};c(Nc,"MysteryEncounterRewardsPhase");let Eo=Nc;const kc=class kc extends je{phaseName="PostMysteryEncounterPhase";FIRST_DIALOGUE_PROMPT_DELAY=750;onPostOptionSelect;constructor(){super(),this.onPostOptionSelect=s.currentBattle.mysteryEncounter?.selectedOption?.onPostOptionPhase}start(){super.start(),this.onPostOptionSelect?s.executeWithSeedOffset(async()=>await this.onPostOptionSelect().then(e=>{(ve(e)||e)&&this.continueEncounter()}),s.currentBattle.mysteryEncounter?.getSeedOffset()*2e3):this.continueEncounter()}continueEncounter(){const e=c(()=>{(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase"),this.end()},"endPhase"),t=s.currentBattle?.mysteryEncounter?.dialogue?.outro;if(t&&t.length>0){let i=0;const n=c(()=>{const a=i===t.length-1?e:n,r=t[i];let o=null;const l=jt(r.text);r.speaker&&(o=jt(r.speaker)),i++,s.ui.setMode(x.MESSAGE),o?s.ui.showDialogue(l??"",o,null,a,0,i===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(l??"",null,a,i===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");n()}else e()}};c(kc,"PostMysteryEncounterPhase");let bo=kc;const Pc=class Pc extends ut{phaseName="NewBattlePhase";start(){for(super.start(),s.phaseManager.phaseQueue=s.phaseManager.phaseQueue.filter(e=>!e.is("NewBattlePhase"));s.phaseManager.tryRemoveUnshiftedPhase(e=>e.is("NewBattlePhase")););s.newBattle(),this.end()}};c(Pc,"NewBattlePhase");let Io=Pc;const Bc=class Bc extends ua{phaseName="NextEncounterPhase";start(){super.start()}doEncounter(){s.playBgm(void 0,!0);for(const a of s.getPlayerParty())a&&a.resetWaveData();s.arenaNextEnemy.setBiome(s.arena.biomeType),s.arenaNextEnemy.setVisible(!0);const e=s.getEnemyField(),t=[s.arenaEnemy,s.arenaNextEnemy,s.currentBattle.trainer,e,s.lastEnemyTrainer],i=s.lastMysteryEncounter?.introVisuals;i&&t.push(i);const n=s.currentBattle.mysteryEncounter?.introVisuals;n&&(n.enterFromRight?(n.x+=500,s.tweens.add({targets:n,x:"-=200",duration:2e3})):t.push(n)),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:c(()=>{s.arenaEnemy.setBiome(s.arena.biomeType),s.arenaEnemy.setX(s.arenaNextEnemy.x),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setX(s.arenaNextEnemy.x-300),s.arenaNextEnemy.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),i&&(s.field.remove(i,!0),s.lastMysteryEncounter.introVisuals=void 0),this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){}};c(Bc,"NextEncounterPhase");let ga=Bc;const Lc=class Lc extends ga{phaseName="NewBiomeEncounterPhase";doEncounter(){s.playBgm(void 0,!0);for(const n of s.getPlayerParty())n&&(n.resetBattleAndWaveData(),n.isOnField()&&Oe("PostBiomeChangeAbAttr",{pokemon:n}));const e=s.getEnemyField(),t=[s.arenaEnemy,e],i=s.currentBattle?.mysteryEncounter?.introVisuals;i&&t.push(i),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:c(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){s.arena.trySetWeather(ef(s.arena))}};c(Lc,"NewBiomeEncounterPhase");let vo=Lc;const Dc=class Dc extends Ut{constructor(e,t,i=null,n,a=null,r=""){super(e),this.statusEffect=t,this.sourcePokemon=i,this.sleepTurnsRemaining=n,this.statusMessage=r,this.statusMessage||=Jg(t,Ne(this.getPokemon()),a??void 0)}phaseName="ObtainStatusEffectPhase";start(){const e=this.getPokemon();e.doSetStatus(this.statusEffect,this.sleepTurnsRemaining),e.updateInfo(!0),new Ga(ni.POISON+(this.statusEffect-1),e).play(!1,()=>{s.phaseManager.queueMessage(this.statusMessage),this.statusEffect&&this.statusEffect!==Yt.FAINT&&(s.triggerPokemonFormChange(e,em,!0),s.arena.setIgnoreAbilities(!1),Oe("PostSetStatusAbAttr",{pokemon:e,effect:this.statusEffect,sourcePokemon:this.sourcePokemon??void 0})),this.end()})}};c(Dc,"ObtainStatusEffectPhase");let _o=Dc;const Rc=class Rc extends je{phaseName="PartyExpPhase";expValue;useWaveIndexMultiplier;pokemonParticipantIds;constructor(e,t,i){super(),this.expValue=e,this.useWaveIndexMultiplier=t,this.pokemonParticipantIds=i}start(){super.start(),s.applyPartyExp(this.expValue,!1,this.useWaveIndexMultiplier,this.pokemonParticipantIds),this.end()}};c(Rc,"PartyExpPhase");let Ao=Rc;const Fc=class Fc extends ut{phaseName="PartyHealPhase";resumeBgm;constructor(e){super(),this.resumeBgm=e}start(){super.start();const e=s.isBgmPlaying();e&&s.fadeOutBgm(1e3,!1),s.ui.fadeOut(1e3).then(()=>{const t=new ot(!1);fs(gs.PREVENT_REVIVE,t);for(const n of s.getPlayerParty())if(!(n.isFainted()&&t.value)){n.hp=n.getMaxHp(),n.resetStatus(!0,!1,!1,!0);for(const a of n.moveset)a.ppUsed=0;n.updateInfo(!0)}const i=s.playSoundWithoutBgm("heal");s.time.delayedCall(ge(i.totalDuration*1e3),()=>{i.destroy(),this.resumeBgm&&e&&s.playBgm(),s.ui.fadeIn(500).then(()=>this.end())})}),s.arena.playerTerasUsed=0}};c(Fc,"PartyHealPhase");let xo=Fc;const Uc=class Uc extends ut{phaseName="PokemonAnimPhase";key;pokemon;fieldAssets;constructor(e,t,i=[]){super(),this.key=e,this.pokemon=t,this.fieldAssets=i}start(){switch(super.start(),this.key){case li.SUBSTITUTE_ADD:this.doSubstituteAddAnim();break;case li.SUBSTITUTE_PRE_MOVE:this.doSubstitutePreMoveAnim();break;case li.SUBSTITUTE_POST_MOVE:this.doSubstitutePostMoveAnim();break;case li.SUBSTITUTE_REMOVE:this.doSubstituteRemoveAnim();break;case li.COMMANDER_APPLY:this.doCommanderApplyAnim();break;case li.COMMANDER_REMOVE:this.doCommanderRemoveAnim();break;default:this.end()}}doSubstituteAddAnim(){const e=this.pokemon.getTag(vs);if(ve(e)){this.end();return}const t=c(()=>{const r=s.addFieldSprite(this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return r.setOrigin(.5,1),s.field.add(r),r},"getSprite"),[i,n]=[t(),t()],a=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setVisible(!1),i.setScale(a),n.setTintFill(16777215),n.setScale(.01),this.pokemon.isPlayer()&&s.field.bringToTop(this.pokemon),s.playSound("PRSFX- Transform"),s.tweens.add({targets:this.pokemon,duration:500,x:this.pokemon.x+this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeIn"}),s.tweens.add({targets:n,delay:250,scale:a,ease:"Cubic.easeInOut",duration:500,onComplete:c(()=>{i.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:c(()=>{n.destroy(),e.sprite=i,this.end()},"onComplete")})},"onComplete")})}doSubstitutePreMoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}s.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:this.pokemon,x:e.x,y:e.y,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:c(()=>this.end(),"onComplete")})}doSubstitutePostMoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}s.tweens.add({targets:this.pokemon,x:e.x+this.pokemon.getSubstituteOffset()[0],y:e.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:e,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:c(()=>this.end(),"onComplete")})}doSubstituteRemoveAnim(){if(this.fieldAssets.length!==1){this.end();return}const e=this.fieldAssets[0];if(e===void 0){this.end();return}const i=c(()=>{const a=s.addFieldSprite(e.x,e.y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return a.setOrigin(.5,1),s.field.add(a),a},"getSprite")(),n=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setAlpha(0),i.setTintFill(16777215),i.setScale(n),s.tweens.add({targets:i,alpha:1,ease:"Sine.easeInOut",duration:500,onComplete:c(()=>{e.destroy();const a=s.time.addEvent({delay:100,repeat:7,startAt:200,callback:c(()=>{s.playSound("PRSFX- Substitute2.wav"),i.setVisible(a.repeatCount%2===0),a.repeatCount||(s.tweens.add({targets:i,scale:.01,ease:"Sine.cubicEaseIn",duration:500}),s.tweens.add({targets:this.pokemon,x:this.pokemon.x-this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y-this.pokemon.getSubstituteOffset()[1],alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:c(()=>{i.destroy(),this.end()},"onComplete")}))},"callback")})},"onComplete")})}doCommanderApplyAnim(){if(!s.currentBattle?.double){this.end();return}const e=this.pokemon.getAlly();if(e?.species?.speciesId!==pe.DONDOZO){this.end();return}const t=this.pokemon.x+this.pokemon.getSprite().x,i=this.pokemon.y+this.pokemon.getSprite().y,a=c(()=>{const l=s.addPokemonSprite(this.pokemon,t,i,this.pokemon.getSprite().texture,this.pokemon.getSprite().frame.name,!0);return["spriteColors","fusionSpriteColors"].map(h=>l.pipelineData[h]=this.pokemon.getSprite().pipelineData[h]),l.setPipelineData("spriteKey",this.pokemon.getBattleSpriteKey()),l.setPipelineData("shiny",this.pokemon.shiny),l.setPipelineData("variant",this.pokemon.variant),l.setPipelineData("ignoreFieldPos",!0),l.setOrigin(.5,1),this.pokemon.getSprite().on("animationupdate",(h,u)=>l.setFrame(u.textureFrame)),s.field.add(l),l},"getSourceSprite")();this.pokemon.setVisible(!1);const r=this.pokemon.getFieldPositionOffset(),o=e.getFieldPositionOffset();s.playSound("se/pb_throw"),s.tweens.add({targets:a,duration:375,scale:.5,x:{value:t+(o[0]-r[0])/2,ease:"Linear"},y:{value:(this.pokemon.isPlayer()?100:65)+r[1],ease:"Sine.easeOut"},onComplete:c(()=>{s.field.bringToTop(e),s.tweens.add({targets:a,duration:375,scale:.01,x:{value:e.x,ease:"Linear"},y:{value:e.y+e.height/2,ease:"Sine.easeIn"},onComplete:c(()=>{a.destroy(),s.playSound("battle_anims/PRSFX- Liquidation1.wav"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeInOut",scale:.85,yoyo:!0,onComplete:c(()=>this.end(),"onComplete")})},"onComplete")})},"onComplete")})}doCommanderRemoveAnim(){const e=this.pokemon.getAlly();if(ve(e)){console.warn("Aborting COMMANDER_REMOVE anim: Tatsugiri is undefined"),this.end();return}const t=s.addPokemonSprite(e,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y+this.pokemon.height/2,e.getSprite().texture,e.getSprite().frame.name,!0);["spriteColors","fusionSpriteColors"].map(i=>t.pipelineData[i]=e.getSprite().pipelineData[i]),t.setPipelineData("spriteKey",e.getBattleSpriteKey()),t.setPipelineData("shiny",e.shiny),t.setPipelineData("variant",e.variant),t.setPipelineData("ignoreFieldPos",!0),this.pokemon.getSprite().on("animationupdate",(i,n)=>t.setFrame(n.textureFrame)),t.setOrigin(.5,1),t.setScale(.01),s.field.add(t),s.field.bringToTop(this.pokemon),t.setVisible(!0),s.tweens.add({targets:this.pokemon,duration:250,ease:"Sine.easeInOut",scale:1.15,yoyo:!0,onComplete:c(()=>{s.playSound("battle_anims/PRSFX- Liquidation4.wav"),s.tweens.add({targets:t,duration:500,scale:1,x:{value:e.x+e.getSprite().x,ease:"Linear"},y:{value:e.y+e.getSprite().y,ease:"Sine.easeIn"},onComplete:c(()=>{e.setVisible(!0),t.destroy(),this.end()},"onComplete")})},"onComplete")})}};c(Uc,"PokemonAnimPhase");let Oo=Uc;const Vc=class Vc extends hn{phaseName="PokemonHealPhase";hpHealed;message;showFullHpMessage;skipAnim;revive;healStatus;preventFullHeal;fullRestorePP;constructor(e,t,i,n=!0,a=!1,r=!1,o=!1,l=!1,h=!1){super(e,void 0,ni.HEALTH_UP),this.hpHealed=t,this.message=i,this.showFullHpMessage=n,this.skipAnim=a,this.revive=r,this.healStatus=o,this.preventFullHeal=l,this.fullRestorePP=h}start(){!this.skipAnim&&(this.revive||this.getPokemon().hp)&&!this.getPokemon().isFullHp()?super.start():this.end()}end(){const e=this.getPokemon();if(!e.isOnField()||!this.revive&&!e.isActive())return super.end();const t=!!this.message,i=!e.isFullHp()||this.hpHealed<0,n=e.getTag(Xe.HEAL_BLOCK);let a=Yt.NONE;if(n&&this.hpHealed>0)return s.phaseManager.queueMessage(n.onActivation(e)),this.message=null,super.end();if(i){const r=new Pt(1);this.revive||s.applyModifiers(uf,this.player,r);const o=new Pt(Math.floor(this.hpHealed*r.value));if(o.value<0&&(e.damageAndUpdate(o.value*-1,{result:$e.INDIRECT}),o.value=0),this.preventFullHeal&&e.hp+o.value>=e.getMaxHp()&&(o.value=e.getMaxHp()-e.hp-1),o.value=e.heal(o.value),o.value&&s.damageNumberHandler.add(e,o.value,$e.HEAL),e.isPlayer()&&(s.validateAchvs(tm,o),o.value>s.gameData.gameStats.highestHeal&&(s.gameData.gameStats.highestHeal=o.value)),this.healStatus&&!this.revive&&e.status&&(a=e.status.effect,e.resetStatus()),this.fullRestorePP)for(const l of this.getPokemon().getMoveset())l&&(l.ppUsed=0);e.updateInfo().then(()=>super.end())}else this.healStatus&&!this.revive&&e.status?(a=e.status.effect,e.resetStatus(),e.updateInfo().then(()=>super.end())):this.showFullHpMessage&&(this.message=m.t("battle:hpIsFull",{pokemonName:Ne(e)}));this.message&&s.phaseManager.queueMessage(this.message),this.healStatus&&a&&!t&&s.phaseManager.queueMessage(sm(a,Ne(e))),!i&&!a&&super.end()}};c(Vc,"PokemonHealPhase");let wo=Vc;const Hc=class Hc extends Ut{phaseName="PokemonTransformPhase";targetIndex;playSound;constructor(e,t,i=!1){super(e),this.targetIndex=t,this.playSound=i}start(){const e=this.getPokemon(),t=s.getField()[this.targetIndex];if(!t){this.end();return}e.summonData.speciesForm=t.getSpeciesForm(),e.summonData.ability=t.getAbility().id,e.summonData.gender=t.getGender(),e.removeTag(Xe.POWER_TRICK);for(const n of Zn)e.setStat(n,t.getStat(n,!1),!1);for(const n of im)e.setStatStage(n,t.getStatStage(n));e.summonData.moveset=t.getMoveset().map(n=>n?new ps(n.moveId,0,0,Math.min(n.getMove().pp,5)):(console.warn(`Transform: somehow iterating over a ${n} value when copying moveset!`),new ps(Ot.NONE))),e.summonData.types=t.getTypes();const i=[e.updateInfo()];this.playSound&&s.playSound("battle_anims/PRSFX- Transform"),s.phaseManager.queueMessage(m.t("abilityTriggers:postSummonTransform",{pokemonNameWithAffix:Ne(e),targetName:t.name})),i.push(e.loadAssets(!1).then(()=>{e.playAnim(),e.updateInfo(),e.setTempAbility(t.getAbility())})),Promise.allSettled(i).then(()=>this.end())}};c(Hc,"PokemonTransformPhase");let Mo=Hc;const Yc=class Yc extends je{phaseName="PositionalTagPhase";start(){s.arena.positionalTagManager.activateAllTags(),super.end()}};c(Yc,"PositionalTagPhase");let No=Yc;const Gc=class Gc extends je{phaseName="PostGameOverPhase";endCardPhase;constructor(e){super(),this.endCardPhase=e}start(){super.start();const e=c(()=>{s.gameData.saveAll(!0,!0,!0).then(t=>{if(!t)return s.reset(!0);s.gameData.tryClearSession(s.sessionSlotId).then(i=>{if(!i[0])return s.reset(!0);s.reset(),s.phaseManager.unshiftNew("TitlePhase"),this.end()})})},"saveAndReset");this.endCardPhase?s.ui.fadeOut(500).then(()=>{s.ui.getMessageHandler().bg.setVisible(!0),this.endCardPhase?.endCard.destroy(),this.endCardPhase?.text.destroy(),e()}):e()}};c(Gc,"PostGameOverPhase");let ko=Gc;const Wc=class Wc extends Ut{phaseName="PostTurnStatusEffectPhase";constructor(e){super(e)}start(){const e=this.getPokemon();if(e?.isActive(!0)&&e.status&&e.status.isPostTurn()&&!e.switchOutStatus){e.status.incrementTurn();const t=new ot(!1);if(Oe("BlockNonDirectDamageAbAttr",{pokemon:e,cancelled:t}),Oe("BlockStatusDamageAbAttr",{pokemon:e,cancelled:t}),t.value)this.end();else{s.phaseManager.queueMessage(nm(e.status.effect,Ne(e)));const i=new Pt(0);switch(e.status.effect){case Yt.POISON:i.value=Math.max(e.getMaxHp()>>3,1);break;case Yt.TOXIC:i.value=Math.max(Math.floor(e.getMaxHp()/16*e.status.toxicTurnCount),1);break;case Yt.BURN:i.value=Math.max(e.getMaxHp()>>4,1),Oe("ReduceBurnDamageAbAttr",{pokemon:e,burnDamage:i});break;case Yt.FROSTBITE:i.value=Math.max(e.getMaxHp()>>4,1);break}i.value&&(s.damageNumberHandler.add(this.getPokemon(),e.damage(i.value,!1,!0)),e.updateInfo(),Oe("PostDamageAbAttr",{pokemon:e,damage:i.value})),new Ga(ni.POISON+(e.status.effect-1),e).play(!1,()=>this.end())}}else this.end()}end(){s.currentBattle.battleSpec===Ht.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};c(Wc,"PostTurnStatusEffectPhase");let Po=Wc;const Kc=class Kc extends ut{phaseName="QuietFormChangePhase";pokemon;formChange;constructor(e,t){super(),this.pokemon=e,this.formChange=t}start(){if(super.start(),this.pokemon.formIndex===this.pokemon.species.forms.findIndex(a=>a.formKey===this.formChange.formKey)){this.end();return}const e=Ne(this.pokemon);if(!this.pokemon.isOnField()||this.pokemon.getTag(lf)||this.pokemon.isFainted()){this.pokemon.isPlayer()||this.pokemon.isActive()?this.pokemon.changeForm(this.formChange).then(()=>{s.ui.showText(Er(this.pokemon,this.formChange,e),null,()=>this.end(),1500)}):this.end();return}const t=c(()=>{const a=s.addPokemonSprite(this.pokemon,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,"pkmn__sub");a.setOrigin(.5,1);const r=this.pokemon.getBattleSpriteKey();try{a.play(r).stop()}catch(o){console.error(`Failed to play animation for ${r}`,o)}return a.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:nn(this.pokemon.getTeraType()),isTerastallized:this.pokemon.isTerastallized}),["spriteColors","fusionSpriteColors"].map(o=>{this.pokemon.summonData.speciesForm&&(o+="Base"),a.pipelineData[o]=this.pokemon.getSprite().pipelineData[o]}),s.field.add(a),a},"getPokemonSprite"),[i,n]=[t(),t()];this.pokemon.getSprite().on("animationupdate",(a,r)=>{r.textureKey===i.texture.key?i.setFrame(r.textureFrame):n.setFrame(r.textureFrame)}),i.setAlpha(0),i.setTintFill(16777215),n.setVisible(!1),n.setTintFill(16777215),s.playSound("battle_anims/PRSFX- Transform"),s.tweens.add({targets:i,alpha:1,duration:1e3,ease:"Cubic.easeIn",onComplete:c(()=>{this.pokemon.setVisible(!1),this.pokemon.changeForm(this.formChange).then(()=>{n.setScale(.01);const a=this.pokemon.getBattleSpriteKey();try{n.play(a).stop()}catch(r){console.error(`Failed to play animation for ${a}`,r)}n.setVisible(!0),s.tweens.add({targets:i,delay:250,scale:.01,ease:"Cubic.easeInOut",duration:500,onComplete:c(()=>i.destroy(),"onComplete")}),s.tweens.add({targets:n,delay:250,scale:this.pokemon.getSpriteScale(),ease:"Cubic.easeInOut",duration:500,onComplete:c(()=>{this.pokemon.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:c(()=>{i.setVisible(!1),s.ui.showText(Er(this.pokemon,this.formChange,e),null,()=>this.end(),1500)},"onComplete")})},"onComplete")})})},"onComplete")})}end(){if(this.pokemon.findAndRemoveTags(e=>e.tagType===Xe.AUTOTOMIZED),s?.currentBattle.battleSpec===Ht.FINAL_BOSS&&this.pokemon.isEnemy()){s.playBgm(),s.phaseManager.unshiftNew("PokemonHealPhase",this.pokemon.getBattlerIndex(),this.pokemon.getMaxHp(),null,!1,!1,!1,!0),this.pokemon.findAndRemoveTags(()=>!0),this.pokemon.bossSegments=5,this.pokemon.bossSegmentIndex=4,this.pokemon.initBattleInfo(),this.pokemon.cry();const e=s.phaseManager.findPhase(t=>t.is("MovePhase")&&t.pokemon===this.pokemon);e&&e.cancel()}if(this.formChange.trigger instanceof df){const e={pokemon:this.pokemon};Oe("PostTeraFormChangeStatChangeAbAttr",e),Oe("ClearWeatherAbAttr",e),Oe("ClearTerrainAbAttr",e)}super.end()}};c(Kc,"QuietFormChangePhase");let Bo=Kc;const zc=class zc extends je{phaseName="ReloadSessionPhase";systemDataStr;constructor(e){super(),this.systemDataStr=e}start(){s.ui.setMode(x.SESSION_RELOAD);let e=!1,t=!1;s.time.delayedCall(ge(1500),()=>{t?this.end():e=!0}),s.gameData.clearLocalData(),(this.systemDataStr?s.gameData.initSystem(this.systemDataStr):s.gameData.loadSystem()).then(()=>{e?this.end():t=!0})}};c(zc,"ReloadSessionPhase");let Lo=zc;const jc=class jc extends ut{phaseName="ResetStatusPhase";pokemon;affectConfusion;reloadAssets;constructor(e,t,i){super(),this.pokemon=e,this.affectConfusion=t,this.reloadAssets=i}start(){this.pokemon.clearStatus(this.affectConfusion,this.reloadAssets),this.end()}};c(jc,"ResetStatusPhase");let Do=jc;const $c=class $c extends am{phaseName="SummonPhase";loaded;constructor(e,t=!0,i=!1){super(e,t),this.loaded=i}start(){super.start(),Oe("PreSummonAbAttr",{pokemon:this.getPokemon()}),this.preSummon()}preSummon(){const e=this.getPokemon();if(!e.isAllowedInBattle()||this.player&&!this.getParty().some(t=>t.id===e.id)){console.warn("The Pokemon about to be sent out is fainted or illegal under a challenge. Attempting to resolve..."),e.isOnField()&&e.leaveField();const t=this.getParty(),i=t.findIndex((n,a)=>a>this.partyMemberIndex&&n.isAllowedInBattle());if(i===-1){console.error(`Party Details:
`,t),console.error("All available Pokemon were fainted or illegal!"),s.clearPhaseQueue(),s.unshiftPhase(new GameOverPhase),this.end();return}[t[this.partyMemberIndex],t[i]]=[t[i],t[this.partyMemberIndex]],console.warn("Swapped %s %O with %s %O",Ne(e),e,Ne(t[0]),t[0])}if(this.player)s.ui.showText(m.t("battle:playerGo",{pokemonName:Ne(this.getPokemon())})),this.player&&s.pbTray.hide(),s.trainer.setTexture(`trainer_${s.gameData.gender===Be.FEMALE?"f":"m"}_back_pb`),s.time.delayedCall(562,()=>{s.trainer.setFrame("2"),s.time.delayedCall(64,()=>{s.trainer.setFrame("3")})}),s.tweens.add({targets:s.trainer,x:-36,duration:1e3,onComplete:c(()=>s.trainer.setVisible(!1),"onComplete")}),s.time.delayedCall(750,()=>this.summon());else if(s.currentBattle.battleType===ue.TRAINER||s.currentBattle.mysteryEncounter?.encounterMode===hs.TRAINER_BATTLE){const t=s.currentBattle.trainer?.getName(this.fieldIndex%2?Ct.TRAINER_PARTNER:Ct.TRAINER),i=this.getPokemon().getNameToRender(),n=m.t("battle:trainerSendOut",{trainerName:t,pokemonName:i});s.pbTrayEnemy.hide(),s.ui.showText(n,null,()=>this.summon())}else s.currentBattle.isMonsterHouseEncounter()?(s.pbTrayEnemy.hide(),this.summonMonsterHouse()):s.currentBattle.isBattleMysteryEncounter()&&(s.pbTrayEnemy.hide(),this.summonWild())}summon(){const e=this.getPokemon(),t=s.addFieldSprite(this.player?36:248,this.player?80:44,"pb",Ji(e.getPokeball(!0)));if(t.setVisible(!1),t.setOrigin(.5,.625),s.field.add(t),this.fieldIndex===1)e.setFieldPosition(cs.RIGHT,0);else{const n=this.getParty().filter(a=>a.isAllowedInBattle()).length;e.setFieldPosition(!s.currentBattle.double||n===1?cs.CENTER:cs.LEFT)}const i=e.getFieldPositionOffset();t.setVisible(!0),s.tweens.add({targets:t,duration:650,x:(this.player?100:236)+i[0]}),s.tweens.add({targets:t,duration:150,ease:"Cubic.easeOut",y:(this.player?70:34)+i[1],onComplete:c(()=>{s.tweens.add({targets:t,duration:500,ease:"Cubic.easeIn",angle:1440,y:(this.player?132:86)+i[1],onComplete:c(()=>{if(s.playSound("se/pb_rel"),t.destroy(),s.add.existing(e),s.field.add(e),!this.player){const n=s.getPlayerPokemon();n?.isOnField()&&s.field.moveBelow(e,n),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}zp(e.x,e.y-16,e.getPokeball(!0)),s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.5),e.tint(en(e.getPokeball(!0))),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:c(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),e.summonData.speciesForm&&e.loadAssets(!1),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})},"onComplete")})},"onComplete")})}summonWild(){const e=this.getPokemon();if(this.fieldIndex===1)e.setFieldPosition(cs.RIGHT,0);else{const t=this.getParty().filter(i=>!i.isFainted()).length;e.setFieldPosition(!s.currentBattle.double||t===1?cs.CENTER:cs.LEFT)}if(s.add.existing(e),s.field.add(e),!this.player){const t=s.getPlayerPokemon();t?.isOnField()&&s.field.moveBelow(e,t),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.75),e.tint(en(e.pokeball)),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),e.x+=16,e.y-=20,e.alpha=0,s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,duration:1e3,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:c(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),s.updateFieldScale(),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})}onEnd(){const e=this.getPokemon();e.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",e.getBattlerIndex()),e.resetTurnData(),(!this.loaded||[ue.TRAINER,ue.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||s.currentBattle.waveIndex%10===1)&&s.triggerPokemonFormChange(e,za,!0),this.queuePostSummon(),s.getModifiers(Zi)&&e.formKey?.includes("gigantamax")&&!e.isDynamaxed&&(e.setDynamax(!0),s.inBattle&&s.currentPhase&&s.unshiftPhase(new DynamaxPhase(e,s)))}queuePostSummon(){s.phaseManager.pushNew("PostSummonPhase",this.getPokemon().getBattlerIndex())}end(){this.onEnd(),super.end()}};c($c,"SummonPhase");let yn=$c;const Xc=class Xc extends yn{phaseName="SwitchSummonPhase";switchType;slotIndex;doReturn;lastPokemon;constructor(e,t,i,n,a=!0){super(t,a),this.switchType=e,this.slotIndex=i,this.doReturn=n}start(){super.start()}async preSummon(){if(this.player||(this.slotIndex===-1&&(this.slotIndex=s.currentBattle.trainer?.getNextSummonIndex(this.fieldIndex?Ct.TRAINER_PARTNER:Ct.TRAINER)),this.slotIndex>-1&&(this.showEnemyTrainer(this.fieldIndex%2?Ct.TRAINER_PARTNER:Ct.TRAINER),s.pbTrayEnemy.showPbTray(s.getEnemyParty()))),!this.doReturn||this.slotIndex!==-1&&!(this.player?s.getPlayerParty():s.getEnemyParty())[this.slotIndex]){if(this.player){this.switchAndSummon();return}s.time.delayedCall(750,()=>this.switchAndSummon());return}const e=this.getPokemon(),t=this.player?s.getEnemyField():s.getPlayerField();if(t){for(const i of t)if(i?.moves)for(const n of i.moves)n.hasAttr("PursuitInterceptAttr")&&await n.getAttr("PursuitInterceptAttr").onSwitchOutAsync(i,e);if((this.player?s.getEnemyField():s.getPlayerField()).forEach(i=>i.removeTagsBySourceId(e.id)),this.switchType===gt.SWITCH||this.switchType===gt.INITIAL_SWITCH){const i=e.getTag(vs);i&&s.tweens.add({targets:i.sprite,duration:250,scale:i.sprite.scale*.5,ease:"Sine.easeIn",onComplete:c(()=>i.sprite.destroy(),"onComplete")})}s.ui.showText(this.player?m.t("battle:playerComeBack",{pokemonName:Ne(e)}):m.t("battle:trainerComeBack",{trainerName:s.currentBattle.trainer?.getName(this.fieldIndex%2?Ct.TRAINER_PARTNER:Ct.TRAINER),pokemonName:e.getNameToRender()})),s.playSound("se/pb_rel"),e.hideInfo(),e.tint(en(e.getPokeball(!0)),1,250,"Sine.easeIn"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:.5,onComplete:c(()=>{s.time.delayedCall(750,()=>this.switchAndSummon()),e.leaveField(this.switchType===gt.SWITCH,!1)},"onComplete")})}}switchAndSummon(){const e=this.player?this.getParty():s.getEnemyParty(),t=e[this.slotIndex];if(this.lastPokemon=this.getPokemon(),t.resetSummonData(),t.loadAssets(!0),Oe("PreSummonAbAttr",{pokemon:t}),Oe("PreSwitchOutAbAttr",{pokemon:this.lastPokemon}),!t){this.end();return}if(this.switchType===gt.BATON_PASS&&((this.player?s.getEnemyField():s.getPlayerField()).forEach(n=>n.transferTagsBySourceId(this.lastPokemon.id,t.id)),!s.findModifier(n=>n instanceof ap&&n.pokemonId===t.id))){const n=s.findModifier(a=>a instanceof ap&&a.pokemonId===this.lastPokemon.id);n&&s.tryTransferHeldItemModifier(n,t,!1,void 0,void 0,void 0,!1)}e[this.slotIndex]=this.lastPokemon,e[this.fieldIndex]=t;const i=c(()=>{s.ui.showText(this.getSendOutText(t)),this.switchType===gt.BATON_PASS||this.switchType===gt.SHED_TAIL?this.lastPokemon.getTag(vs)&&(t.x+=this.lastPokemon.getSubstituteOffset()[0],t.y+=this.lastPokemon.getSubstituteOffset()[1],t.setAlpha(.5)):t.fieldSetup(!0),this.summon()},"showTextAndSummon");this.player?i():s.time.delayedCall(1500,()=>{this.hideEnemyTrainer(),s.pbTrayEnemy.hide(),i()})}onEnd(){super.onEnd();const e=this.getPokemon(),t=s.currentBattle.lastMove,i=t?Fe[t]:void 0,n=s.currentBattle.turnCommands[this.fieldIndex]?.command,a=i?.hasAttr("ForceSwitchOutAttr")&&!this.lastPokemon.isFainted(),r=this.lastPokemon.hasAbilityWithAttr("PostDamageForceSwitchAbAttr")&&!this.lastPokemon.isFainted();if((n===Ke.POKEMON||a||r)&&(e.tempSummonData.turnCount--,e.tempSummonData.waveTurnCount--),this.switchType===gt.BATON_PASS&&e)e.transferSummon(this.lastPokemon);else if(this.switchType===gt.SHED_TAIL&&e){const o=this.lastPokemon.getTag(vs);o&&e.summonData.tags.push(o)}this.switchType!==gt.INITIAL_SWITCH&&(e.resetTurnData(),e.turnData.switchedInThisTurn=!0),this.lastPokemon.resetSummonData(),s.triggerPokemonFormChange(e,za,!0),s.arena.triggerWeatherBasedFormChanges()}queuePostSummon(){s.phaseManager.startNewDynamicPhase("PostSummonPhase",this.getPokemon().getBattlerIndex())}getSendOutText(e){return this.switchType===gt.FORCE_SWITCH?m.t("battle:pokemonDraggedOut",{pokemonName:Ne(e)}):this.player?m.t("battle:playerGo",{pokemonName:Ne(e)}):m.t("battle:trainerGo",{trainerName:s.currentBattle.trainer?.getName(this.fieldIndex%2?Ct.TRAINER_PARTNER:Ct.TRAINER),pokemonName:this.getPokemon().getNameToRender()})}};c(Xc,"SwitchSummonPhase");let ma=Xc;const qc=class qc extends ma{phaseName="ReturnPhase";constructor(e){super(gt.SWITCH,e,-1,!0)}switchAndSummon(){this.end()}summon(){}onEnd(){const e=this.getPokemon();e.resetSprite(),e.resetTurnData(),e.resetSummonData(),s.updateFieldScale(),s.triggerPokemonFormChange(e,za)}};c(qc,"ReturnPhase");let Ro=qc;const Qc=class Qc extends ut{constructor(e){super(),this.user=e}phaseName="RevivalBlessingPhase";start(){s.ui.setMode(x.PARTY,tn.REVIVAL_BLESSING,this.user.getFieldIndex(),(e,t)=>{if(e>=0&&e<6){const i=s.getPlayerParty()[e];if(!i||!i.isFainted())return this.end();i.resetTurnData(),i.resetStatus(!0,!1,!1,!1),i.heal(Math.min(pf(.5*i.getMaxHp()),i.getMaxHp())),s.phaseManager.queueMessage(m.t("moveTriggers:revivalBlessing",{pokemonName:i.name}),0,!0);const n=this.user.getAlly();s.currentBattle.double&&s.getPlayerParty().length>1&&!ve(n)&&(e<=1?(s.phaseManager.unshiftNew("SwitchSummonPhase",gt.SWITCH,i.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)):n.isFainted()&&(s.phaseManager.unshiftNew("SwitchSummonPhase",gt.SWITCH,n.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)))}s.ui.setMode(x.MESSAGE).then(()=>this.end())},ph.FilterFainted)}};c(Qc,"RevivalBlessingPhase");let Fo=Qc;const Zc=class Zc extends dn{phaseName="RibbonModifierRewardPhase";species;constructor(e,t){super(e),this.species=t}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.showText(m.t("battle:beatModeFirstTime",{speciesName:this.species.name,gameMode:s.gameMode.getName(),newModifier:t?.type.name}),null,()=>{e()},null,!0,1500)})}};c(Zc,"RibbonModifierRewardPhase");let Uo=Zc;const Jc=class Jc extends Ut{phaseName="ScanIvsPhase";constructor(e){super(e)}start(){super.start();const e=this.getPokemon();let t=[],i=[],n=[];const a=s.getEnemyField(),r=s.uiTheme;for(let o=0;o<a.length;o++){t=a[o].ivs;const l=s.gameData.dexData[a[o].species.getRootSpeciesId()].ivs;i=a[o].getBattleInfo().getStatsValueContainer().list,n=i.filter(h=>h.name.indexOf("icon_stat_label")>=0);for(let h=0;h<n.length;h++){const u=Ws[n[h].frame.name];if(t[u]>l[u]&&Xi.indexOf(Number(u))>=0){const p=t[u]===31?He(A.PERFECT_IV,!1,r):He(A.SUMMARY_GREEN,!1,r),f=Phaser.Display.Color.HexStringToColor(p).color;n[h].setTint(f)}n[h].setVisible(!0)}}s.hideIvs?this.end():s.ui.showText(m.t("battle:ivScannerUseQuestion",{pokemonName:Ne(e)}),null,()=>{s.ui.setMode(x.CONFIRM,()=>{s.ui.setMode(x.MESSAGE),s.ui.clearText(),s.ui.getMessageHandler().promptIvs(e.id,e.ivs).then(()=>this.end())},()=>{s.ui.setMode(x.MESSAGE),s.ui.clearText(),this.end()})})}};c(Jc,"ScanIvsPhase");let Vo=Jc;const eu=class eu extends ut{phaseName="SelectBiomePhase";start(){super.start(),s.resetSeed();const e=s.gameMode,t=s.arena.biomeType,i=s.currentBattle.waveIndex,n=i+1,a=c(r=>{if(n%10===1){s.applyModifiers(om,!0);const o=new ot(!0);fs(gs.PARTY_HEAL,o),o.value?s.phaseManager.unshiftNew("PartyHealPhase",!1):s.phaseManager.unshiftNew("SelectModifierPhase",void 0,void 0,e.isFixedBattle(i)?e.getFixedBattle(i).customModifierRewardSettings:void 0)}s.phaseManager.unshiftNew("SwitchBiomePhase",r),this.end()},"setNextBiome");if(e.isClassic&&e.isWaveFinal(n+9)||e.isDaily&&e.isWaveFinal(n)||e.hasShortBiomes&&!(n%50))a(Je.END);else if(e.hasRandomBiomes)a(this.generateNextBiome(n));else if(Array.isArray(Nn[t])){const r=Nn[t].filter(o=>!Array.isArray(o)||!Ve(o[1])).map(o=>Array.isArray(o)?o[0]:o);if(r.length>1&&s.findModifier(o=>o instanceof rm)){const o=r.map(l=>({label:ea(l),handler:c(()=>(s.ui.setMode(x.MESSAGE),a(l),!0),"handler")}));s.ui.setMode(x.OPTION_SELECT,{options:o,delay:1e3})}else a(r[Ve(r.length)])}else Nn.hasOwnProperty(t)?a(Nn[t]):a(this.generateNextBiome(n))}generateNextBiome(e){return e%50===0?Je.END:s.generateRandomBiome(e)}};c(eu,"SelectBiomePhase");let Ho=eu;const tu=class tu extends je{phaseName="SelectChallengePhase";start(){super.start(),s.playBgm("menu"),s.ui.setMode(x.CHALLENGE_SELECT)}};c(tu,"SelectChallengePhase");let Yo=tu;const su=class su extends je{phaseName="SelectGenderPhase";start(){super.start(),s.ui.showText(m.t("menu:boyOrGirl"),null,()=>{s.ui.setMode(x.OPTION_SELECT,{options:[{label:m.t("settings:boy"),handler:c(()=>(s.gameData.gender=Be.MALE,s.gameData.saveSetting(ks.Player_Gender,0),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")},{label:m.t("settings:girl"),handler:c(()=>(s.gameData.gender=Be.FEMALE,s.gameData.saveSetting(ks.Player_Gender,1),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")}]})})}end(){s.ui.setMode(x.MESSAGE),super.end()}};c(su,"SelectGenderPhase");let Go=su;var Sh=(C=>(C[C.RUN_HISTORY=0]="RUN_HISTORY",C[C.SESSION_PREVIEW=1]="SESSION_PREVIEW",C))(Sh||{});const iu=class iu extends zs{runDisplayMode;runInfo;isVictory;pageMode;runContainer;runResultContainer;runInfoContainer;partyContainer;statsBgWidth;hallofFameContainer;endCardContainer;partyVisibility;modifiersModule;constructor(){super(x.RUN_INFO)}async setup(){this.runContainer=s.add.container(1,-s.scaledCanvas.height+1),this.modifiersModule=ta,this.runContainer.setVisible(!1),s.loadImage("encounter_exclaim","mystery-encounters")}show(e){super.show(e);const t=s.add.rectangle(0,0,s.game.canvas.width,s.game.canvas.height,26720);t.setOrigin(0,0),this.runContainer.add(t);const i=e[0];this.runDisplayMode=e[1],this.runDisplayMode===0?(this.runInfo=s.gameData.parseSessionData(JSON.stringify(i.entry)),this.isVictory=i.isVictory??!1):this.runDisplayMode===1&&(this.runInfo=e[0]),this.pageMode=0,this.addHeader(),this.statsBgWidth=(s.scaledCanvas.width-2)/3,this.runResultContainer=s.add.container(0,24);const n=ye(0,0,this.statsBgWidth-11,65);n.setOrigin(0,0),n.setName("Run_Result_Window"),this.runResultContainer.add(n),this.runDisplayMode===0?this.parseRunResult():this.runDisplayMode===1&&this.parseRunStatus(),this.runInfoContainer=s.add.container(0,89);const a=ye(0,0,this.statsBgWidth-11,90),r=a.getBottomRight();return this.runInfoContainer.add(a),this.parseRunInfo(r.x,r.y),this.partyContainer=s.add.container(this.statsBgWidth-10,23),this.parsePartyInfo(),this.showParty(!0),this.runContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.getUi().bringToTop(this.runContainer),this.runContainer.setVisible(!0),this.isVictory&&(this.createHallofFame(),this.getUi().bringToTop(this.hallofFameContainer)),this.setCursor(0),this.getUi().add(this.runContainer),this.getUi().hideTooltip(),!0}addHeader(){const e=ye(0,0,s.scaledCanvas.width-2,24);if(e.setOrigin(0,0),this.runContainer.add(e),this.runInfo.modifiers.length!==0){const a=e.getTopRight(),r=s.add.container(0,0),o=P(8,0,m.t("runHistory:viewHeldItems"),A.WINDOW,{fontSize:"34px"}),l=this.getUi().getGamepadType();let h;l==="touch"?h=new Phaser.GameObjects.Sprite(s,0,2,"keyboard","E.png"):h=new Phaser.GameObjects.Sprite(s,0,2,l,s.inputController?.getIconForLatestInputRecorded(ae.Button_Cycle_Ability)),r.add([o,h]),r.setPosition(a.x-o.displayWidth-h.displayWidth-8,10),this.runContainer.add(r)}const t=P(0,0,m.t("runHistory:runInfo"),A.HEADER_LABEL);t.setOrigin(0,0),t.setPositionRelative(e,8,4),this.runContainer.add(t);const i=P(0,0,this.runInfo.name,A.WINDOW);i.setOrigin(0,0);const n=t.width/6+t.x+4;i.setPositionRelative(e,n,4),this.runContainer.add(i)}async parseRunResult(){const e=s.gameData.gender??Be.UNSET,t=Be[e],i=this.isVictory?A.PERFECT_IV:A.SUMMARY_RED,n=this.isVictory?m.t("runHistory:victory"):m.t("runHistory:defeated",{context:t}),a=P(6,5,`${n} - ${m.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,i,{fontSize:"65px",lineSpacing:.1});if(this.isVictory){const r=s.add.container(0,0),o=P(8,0,m.t("runHistory:viewHallOfFame"),A.WINDOW,{fontSize:"65px"}),l=P(8,12,m.t("runHistory:viewEndingSplash"),A.WINDOW,{fontSize:"65px"}),h=this.getUi().getGamepadType();let u,p;h==="touch"?(u=new Phaser.GameObjects.Sprite(s,0,4,"keyboard","R.png"),p=new Phaser.GameObjects.Sprite(s,0,16,"keyboard","F.png")):(u=new Phaser.GameObjects.Sprite(s,0,4,h,s.inputController?.getIconForLatestInputRecorded(ae.Button_Cycle_Shiny)),p=new Phaser.GameObjects.Sprite(s,0,16,h,s.inputController?.getIconForLatestInputRecorded(ae.Button_Cycle_Form))),r.add([o,u]),r.add([l,p]),r.setPosition(12,25),this.runResultContainer.add(r)}if(this.runResultContainer.add(a),!this.isVictory){const r=s.add.container(0,0);if(this.runInfo.battleType===ue.WILD||this.runInfo.battleType===ue.MYSTERY_ENCOUNTER&&!this.runInfo.trainer)switch(this.runInfo.enemyParty.length){case 1:this.parseWildSingleDefeat(r);break;case 2:this.parseWildDoubleDefeat(r);break}else(this.runInfo.battleType===ue.TRAINER||this.runInfo.battleType===ue.MYSTERY_ENCOUNTER&&this.runInfo.trainer)&&this.parseTrainerDefeat(r);this.runResultContainer.add(r)}this.runContainer.add(this.runResultContainer)}parseRunStatus(){const e=s.add.container(0,0);if(this.runResultContainer.add(e),this.runInfo.battleType===ue.WILD)this.runInfo.enemyParty.length===1?this.parseWildSingleDefeat(e):this.runInfo.enemyParty.length===2&&this.parseWildDoubleDefeat(e);else if(this.runInfo.battleType===ue.TRAINER){this.showTrainerSprites(e);const o=3;this.runInfo.enemyParty.forEach((y,g)=>{const T=s.add.sprite(0,0,"pb");T.setFrame(Ji(y.pokeball)),T.setScale(.5),T.setPosition(58+g%o*8,g<=2?18:25),e.add(T)});const l=this.runInfo.trainer.toTrainer(),h=375;let u="";this.runInfo.trainer.trainerType>=h?u=l.variant===tt.FEMALE?m.t("trainerNames:rivalFemale"):m.t("trainerNames:rival"):u=l.getName(0,!0);const p=m.t(l.variant!==tt.DOUBLE?"battle:trainerAppeared":"battle:trainerAppearedDouble",{trainerName:u}).replace(/\n/g," "),f=s.add.container(0,0),d=P(0,0,p,A.WINDOW,{fontSize:"35px",wordWrap:{width:200}});f.add(d),f.setPosition(55,32),this.runResultContainer.add(f)}else if(this.runInfo.battleType===ue.MYSTERY_ENCOUNTER){const o=s.add.sprite(0,0,"encounter_exclaim");o.setPosition(34,26),o.setScale(.65);const l=s.add.sprite(56,-106,"pkmn__sub");l.setScale(.65),l.setPosition(34,46);const h=m.t(s.getMysteryEncounter(this.runInfo.mysteryEncounterType,!0).localizationKey+":title"),u=s.add.container(0,0),p=P(0,0,h,A.WINDOW,{fontSize:"45px",wordWrap:{width:160}});u.add(p),u.setPosition(47,37),this.runResultContainer.add([o,l,u])}const t=this.runResultContainer.getByName("Run_Result_Window"),i=t.getTopCenter().x,n=t.getBottomCenter().y,a=P(i,5,`${m.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,A.WINDOW,{fontSize:"60px",lineSpacing:.1});a.setOrigin(.5,0);const r=P(i,n-5,`${ea(this.runInfo.arena.biome)}`,A.WINDOW,{fontSize:"60px"});r.setOrigin(.5,1),this.runResultContainer.add([a,r]),this.runContainer.add(this.runResultContainer)}parseWildSingleDefeat(e){const t=s.add.container(0,0),i=this.runInfo.enemyParty[0],n=i.boss;i.boss=!1,i.player=!0;const a=i.toPokemon(),r=s.addPokemonIcon(a,0,0,0,0),o=n?A.PARTY_RED:A.PARTY,l=P(36,26,`${m.t("saveSlotSelectUiHandler:lv")}${bi(a.level,1e3)}`,o,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),t.add(r),t.add(l),e.add(t),e.setPosition(27,12),a.destroy()}parseWildDoubleDefeat(e){this.runInfo.enemyParty.forEach((t,i)=>{const n=s.add.container(0,0),a=t.boss;t.boss=!1,t.player=!0;const r=t.toPokemon(),o=s.addPokemonIcon(r,0,0,0,0),l=P(36,26,`${m.t("saveSlotSelectUiHandler:lv")}${bi(r.level,1e3)}`,a?A.PARTY_RED:A.PARTY,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),n.add(o),n.add(l),n.setPosition(i*35,0),e.add(n),r.destroy()}),e.setPosition(8,14)}showTrainerSprites(e){const t=this.runInfo.trainer.toTrainer();t.config.loadAssets(this.runInfo.trainer.variant).then(()=>{const i=t.config.getSpriteKey(this.runInfo.trainer.variant===tt.FEMALE,!1),n=s.add.sprite(0,5,i);if(this.runInfo.trainer.variant===tt.DOUBLE&&!t.config.doubleOnly){const a=s.add.container(5,8);n.setPosition(-3,-3);const r=t.config.getSpriteKey(!0,!0),o=s.add.sprite(5,-3,r);this.runDisplayMode===0?(o.setScale(.2),n.setScale(.2),a.add(n),a.add(o),a.setPosition(12,38)):(n.setScale(.55),n.setPosition(-9,-3),o.setScale(.55),a.add([n,o]),a.setPosition(28,34)),e.add(a)}else{const a=this.runDisplayMode===0?.35:.55,r=this.runDisplayMode===0?[12,28]:[30,32];n.setScale(a,a),n.setPosition(r[0],r[1]),e.add(n)}})}parseTrainerDefeat(e){this.showTrainerSprites(e);const t=s.add.container(0,0);this.runInfo.enemyParty.forEach((i,n)=>{const a=Math.floor(n/3),r=s.add.container(0,0);r.setScale(.6);const o=i.boss;i.boss=!1,i.player=!0;const l=i.toPokemon(),h=s.addPokemonIcon(l,0,0,0,0);h.setPosition(39*(n%3)+5,35*a);const u=P(43*(n%3),27*(a+1),`${m.t("saveSlotSelectUiHandler:lv")}${bi(l.level,1e3)}`,o?A.PARTY_RED:A.PARTY,{fontSize:"54px"});u.setShadow(0,0,void 0),u.setStroke("#424242",14),u.setOrigin(0,0),r.add(h),r.add(u),t.add(r),l.destroy()}),t.setPosition(25,15),e.add(t)}async parseRunInfo(e,t){const i=St(7,0,"",A.WINDOW,{fontSize:"50px",lineSpacing:3});switch(i.setPosition(7,5),i.appendText(m.t("runHistory:mode")+": ",!1),this.runInfo.gameMode){case ce.DAILY:i.appendText(`${m.t("gameMode:dailyRun")}`,!1);break;case ce.SPLICED_ENDLESS:i.appendText(`${m.t("gameMode:endlessSpliced")}`,!1);break;case ce.CHALLENGE:{i.appendText(`${m.t("gameMode:challenge")}`,!1),i.appendText(`${m.t("runHistory:challengeRules")}: `),i.setWrapMode(1),i.setWrapWidth(500);const d=this.challengeParser();if(d)for(let y=0;y<d.length;y++)y>0&&i.appendText(" + ",!1),i.appendText(d[y],!1);break}case ce.ENDLESS:i.appendText(`${m.t("gameMode:endless")}`,!1);break;case ce.CLASSIC:i.appendText(`${m.t("gameMode:classic")}`,!1);break}(this.runInfo.gameMode===ce.ENDLESS||this.runInfo.gameMode===ce.SPLICED_ENDLESS)&&this.runInfo.waveIndex===s.gameData.gameStats.highestEndlessWave&&(i.appendText(` [${m.t("runHistory:personalBest")}]`),i.setTint(16772956,4718441,7039999,16738665));const n=s.add.container(0,0),a=(m.resolvedLanguage==="ja",3),r=St(7,0,"",A.WINDOW,{fontSize:"50px",lineSpacing:a}),o=ff(this.runInfo.playTime);r.appendText(`${m.t("runHistory:runLength")}: ${o}`,!1);const l=gf(s.moneyFormat,this.runInfo.money),h=He(A.MONEY_WINDOW,!1,s.uiTheme);r.appendText(`[color=${h}]${m.t("battleScene:moneyOwned",{formattedMoney:l})}[/color]`),r.setPosition(7,70),n.add(r);const u=St(0,0,"",A.WINDOW,{fontSize:"55px"}),p=Phaser.Math.Clamp(this.runInfo.party.map(d=>d.toPokemon().getLuck()).reduce((d,y)=>d+=y,0),0,14);let f=m.t("runHistory:luck")+": "+mf(p);if(p<14?f="[color=#"+yf(p).toString(16)+"]"+f+"[/color]":u.setTint(16772956,4718441,7039999,16738665),u.appendText("[align=right]"+f+"[/align]",!1),u.setPosition(e-u.displayWidth-5,t-13),n.add(u),this.runInfo.modifiers.length){let d=0;const y=s.add.container(8,this.runInfo.gameMode===ce.CHALLENGE?20:15);y.setScale(.45);for(const g of this.runInfo.modifiers){const T=g.toModifier(this.modifiersModule[g.className]);if(T instanceof ls)continue;const E=T?.getIcon(!1);if(E){const b=Math.floor(d/7);E.setPosition(24*(d%7),20+35*b),y.add(E)}if(++d===20){const b=P(45,90,"+",A.WINDOW);b.setPositionRelative(y,70,45),this.runInfoContainer.add(b);break}}this.runInfoContainer.add(y)}this.runInfoContainer.add(i),this.runInfoContainer.add(n),this.runContainer.add(this.runInfoContainer)}challengeParser(){const e=[];for(let t=0;t<this.runInfo.challenges.length;t++)if(this.runInfo.challenges[t].value!==0)switch(this.runInfo.challenges[t].id){case xt.SINGLE_GENERATION:e.push(m.t(`runHistory:challengeMonoGen${this.runInfo.challenges[t].value}`));break;case xt.SINGLE_TYPE:{const i=Se[this.runInfo.challenges[t].value-1],n=`[color=${lm[i]}]`,a=`[shadow=${hm[i]}]`,r=n+a+m.t(`pokemonInfo:type.${Tt(i)}`)+"[/color][/shadow]";e.push(r);break}case xt.INVERSE_BATTLE:e.push(m.t("challenges:inverseBattle.shortName"));break;default:{const i=Tt(xt[this.runInfo.challenges[t].id]);e.push(m.t(`challenges:${i}.name`));break}}return e}parsePartyInfo(){const e=this.runInfo.party,t=m.resolvedLanguage??"en",i=(s.scaledCanvas.height-23)/6;e.forEach((n,a)=>{const r=new tT(s,0,14,this.statsBgWidth*2+10,i-2,3),o=n.toPokemon(),l=s.add.container(this.statsBgWidth+5,(i-.5)*a),h=o.getTypes(),u=nn(h[0]),p=new Phaser.Display.Color(u[0],u[1],u[2]),f=p.clone().darken(45);r.setFillStyle(f.color);const d=s.add.container(0,0),y=s.addPokemonIcon(o,0,0,0,0);y.setScale(.75),y.setPosition(-99,1);const g=h[1]?nn(h[1]):void 0,T=g?new Phaser.Display.Color(g[0],g[1],g[2]):void 0;T?r.setStrokeStyle(1,T.color,.95):r.setStrokeStyle(1,p.color,.95),this.getUi().bringToTop(y);const E=s.add.container(-85,3.5),b="34px",_=o.getNature(),O=xi(_),w=o.getNameToRender(),U=["ko","zh_CN","zh_TW"];let B=m.t("starterSelectUiHandler:passive")??"-",K=m.t("starterSelectUiHandler:ability")??"-";U.includes(t)||(B=B.charAt(0),K=K.charAt(0));const V=o.passive?B+": "+o.getPassiveAbility().name:"",te=K+": "+o.getAbility().name,de=(m.resolvedLanguage==="ja",3),k=St(0,0,w,A.SUMMARY,{fontSize:b,lineSpacing:de});k.appendText(`${m.t("saveSlotSelectUiHandler:lv")}${rp(o.level,1)} - ${O}`),k.appendText(te),k.appendText(V),E.add(k);const j=s.add.container(-35,6),I=[];o.stats.forEach(Ie=>I.push(rp(Ie,1)));for(let Ie=0;Ie<I.length;Ie++){const S=cm(_,Ie);I[Ie]=S<1?I[Ie]+"[color=#40c8f8][/color]":I[Ie],I[Ie]=S>1?I[Ie]+"[color=#f89890][/color]":I[Ie]}const $=m.t("pokemonInfo:stat.hpShortened")+": "+I[0],re=m.t("pokemonInfo:stat.atkShortened")+": "+I[1],H=m.t("pokemonInfo:stat.defShortened")+": "+I[2],ee=m.t("pokemonInfo:stat.spatkShortened")+": "+I[3],L=m.t("pokemonInfo:stat.spdefShortened")+": "+I[4],W=(t==="es-ES"||t==="pt_BR"?m.t("runHistory:spdShortened"):m.t("pokemonInfo:stat.spdShortened"))+": "+I[5],Y=St(-5,0,$,A.SUMMARY,{fontSize:b,lineSpacing:de});Y.appendText(re),Y.appendText(H),j.add(Y);const me=St(25,0,ee,A.SUMMARY,{fontSize:b,lineSpacing:de});me.appendText(L),me.appendText(W),j.add(me);const fe=s.add.container(0,0);if(o.fusionSpecies){const Ie=s.add.image(0,0,"icon_spliced");Ie.setScale(.35),Ie.setOrigin(0,0),o.isShiny()?Ie.setPositionRelative(E,35,0):Ie.setPositionRelative(E,28,0),fe.add(Ie),this.getUi().bringToTop(Ie)}if(o.isShiny()){const Ie=o.isFusion()&&o.shiny&&o.fusionShiny,S=s.add.image(0,0,`shiny_star_small${Ie?"_1":""}`);if(S.setOrigin(0,0),S.setScale(.65),S.setPositionRelative(E,28,0),S.setTint(mt(Ie?o.variant:o.getVariant())),fe.add(S),this.getUi().bringToTop(S),Ie){const Q=s.add.image(0,0,"shiny_star_small_2");Q.setOrigin(0,0),Q.setScale(.5),Q.setPosition(S.x+1,S.y+1),Q.setTint(mt(o.fusionVariant)),fe.add(Q),this.getUi().bringToTop(Q)}}const Z=o.getMoveset(),Ce=s.add.container(70,-29),Ue=[],xe=[],Le=[[-6.5,35.5],[37,35.5],[-6.5,43.5],[37,43.5]];for(let Ie=0;Ie<Z?.length;Ie++){const S=s.add.container(Le[Ie][0],Le[Ie][1]);S.setScale(.5);const Q=s.add.nineslice(0,0,"type_bgs","unknown",85,15,2,2,2,2);Q.setOrigin(1,0);const X=P(-Q.width/2,1,"-",A.MOVE_LABEL);X.setOrigin(.5,0),X.setName("text-move-label"),Ue.push(Q),xe.push(X),S.add(Q),S.add(X),Ce.add(S);const N=Z[Ie]?.getMove();Ue[Ie].setFrame(Se[N?N.type:Se.UNKNOWN].toString().toLowerCase()),xe[Ie].setText(N?N.name:"-")}const at=this.runInfo.gameMode===ce.SPLICED_ENDLESS||this.runInfo.gameMode===ce.ENDLESS?.25:.5,We=s.add.container(-82,2),pt=[];if(this.runInfo.modifiers.length){for(const Ie of this.runInfo.modifiers){const S=Ie.toModifier(this.modifiersModule[Ie.className]);S instanceof ls&&S.pokemonId===o.id&&(S.stackCount=Ie.stackCount,pt.push(S))}if(pt.length>0){pt.sort(um);let Ie=0;for(const[S,Q]of pt.entries()){if(S>36){const N=P(182,4,"+",A.WINDOW);We.add(N);break}const X=Q?.getIcon(!0);Q?.stackCount<Q?.getMaxHeldItemCount(o)&&X.list[1]instanceof Phaser.GameObjects.BitmapText&&X.list[1].clearTint(),X.setScale(at),X.setPosition(S%19*10,Ie*10),We.add(X),S!==0&&S%18===0&&Ie++}}}We.setName("heldItems"),We.setVisible(!1),l.add(r),d.add(y),l.add(d),fe.setName("PkmnMarks"),l.add(fe),Ce.setName("PkmnMoves"),l.add(Ce),E.setName("PkmnInfoText"),l.add(E),j.setName("PkmnStatsText"),l.add(j),l.add(We),l.setName("PkmnInfo"),this.partyContainer.add(l),o.destroy()}),this.runContainer.add(this.partyContainer)}showParty(e){this.partyContainer.getAll("name","PkmnInfo").forEach(i=>{i.getByName("PkmnMoves").setVisible(e),i.getByName("PkmnInfoText").setVisible(e),i.getByName("PkmnStatsText").setVisible(e),i.getByName("PkmnMarks").setVisible(e),i.getByName("heldItems").setVisible(!e),this.partyVisibility=e})}createVictorySplash(){this.endCardContainer=s.add.container(0,0);const t=(s.gameData.gender??Be.UNSET)===Be.FEMALE,i=s.add.image(0,0,`end_${t?"f":"m"}`);i.setOrigin(0),i.setScale(.5);const n=P(s.scaledCanvas.width/2,s.scaledCanvas.height-16,m.t("battle:congratulations"),A.SUMMARY,{fontSize:"128px"});n.setOrigin(.5),this.endCardContainer.add(i),this.endCardContainer.add(n)}createHallofFame(){const e=s.gameData.gender??Be.UNSET,t=e===Be.FEMALE,i=Be[e].toLowerCase();this.hallofFameContainer=s.add.container(0,0);const n=s.add.image(0,0,`end_${t?"f":"m"}`);n.setOrigin(0),n.setPosition(-1,-1),n.setScale(.5);const a=n.getBottomCenter(),r=t?"red":"blue",o=s.add.image(0,0,"hall_of_fame_"+r);o.setPosition(159,89),o.setSize(s.game.canvas.width,s.game.canvas.height+10),o.setAlpha(.8),this.hallofFameContainer.add(n),this.hallofFameContainer.add(o);const l=P(0,0,m.t("runHistory:hallofFameText",{context:i}),A.WINDOW);l.setPosition(a.x-l.displayWidth/2,164),this.hallofFameContainer.add(l),this.runInfo.party.forEach((h,u)=>{const p=h.toPokemon(),f=u%2,d=p.id,y=p.shiny,g=p.formIndex,T=p.variant,E=p.getSpeciesForm(),b=s.add.sprite(60+40*u,40+f*80,"pkmn__sub");b.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.hallofFameContainer.add(b);const _=new Map;_.set(d,!1);const O=p.gender===1;if(E.loadAssets(O,g,y,T,!0).then(()=>{_.set(d,!0),b.play(E.getSpriteKey(O,g,y,T)),b.setPipelineData("shiny",y),b.setPipelineData("variant",T),b.setPipelineData("spriteKey",E.getSpriteKey(O,g,y,T)),b.setVisible(!0)}),p.isFusion()){const w=s.add.sprite(80+40*u,50+f*80,p.getFusionIconAtlasKey());w.setName("sprite-fusion-icon"),w.setOrigin(.5,0),w.setFrame(p.getFusionIconId(!0)),this.hallofFameContainer.add(w)}p.destroy()}),this.hallofFameContainer.setVisible(!1),this.runContainer.add(this.hallofFameContainer)}processInput(e){const t=this.getUi();let i=!1;const n=!1;switch(e){case v.CANCEL:case v.LEFT:i=!0,this.pageMode===0?(this.runInfoContainer.removeAll(!0),this.runResultContainer.removeAll(!0),this.partyContainer.removeAll(!0),this.runContainer.removeAll(!0),this.isVictory&&this.hallofFameContainer.removeAll(!0),super.clear(),this.runContainer.setVisible(!1),t.revertMode()):this.pageMode===1?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):this.pageMode===2&&(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0);break;case v.DOWN:case v.UP:break;case v.CYCLE_FORM:case v.CYCLE_SHINY:case v.CYCLE_ABILITY:this.buttonCycleOption(e);break}return i&&t.playSelect(),i||n}buttonCycleOption(e){switch(e){case v.CYCLE_FORM:this.isVictory&&this.pageMode!==1&&(!this.endCardContainer||!this.endCardContainer.visible?(this.createVictorySplash(),this.endCardContainer.setVisible(!0),this.runContainer.add(this.endCardContainer),this.pageMode=2):(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0));break;case v.CYCLE_SHINY:this.isVictory&&this.pageMode!==2&&(this.hallofFameContainer.visible?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):(this.hallofFameContainer.setVisible(!0),this.pageMode=1));break;case v.CYCLE_ABILITY:this.runInfo.modifiers.length!==0&&this.pageMode===0&&(this.partyVisibility?this.showParty(!1):this.showParty(!0));break}}};c(iu,"RunInfoUiHandler");let ya=iu;const Hi=5,Fs=2;var Ta=(C=>(C[C.LOAD=0]="LOAD",C[C.SAVE=1]="SAVE",C))(Ta||{});const nu=class nu extends Bt{saveSlotSelectContainer;sessionSlotsContainer;saveSlotSelectMessageBox;saveSlotSelectMessageBoxContainer;sessionSlots;uiMode;saveSlotSelectCallback;manageDataConfig;scrollCursor=0;cursorObj;sessionSlotsContainerInitialY;constructor(){super(x.SAVE_SLOT)}setup(){const e=this.getUi();this.saveSlotSelectContainer=s.add.container(0,0),this.saveSlotSelectContainer.setVisible(!1),e.add(this.saveSlotSelectContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,-s.scaledCanvas.height,26720);t.setOrigin(0,0),this.saveSlotSelectContainer.add(t),this.sessionSlotsContainerInitialY=-s.scaledCanvas.height+8,this.sessionSlotsContainer=s.add.container(8,this.sessionSlotsContainerInitialY),this.saveSlotSelectContainer.add(this.sessionSlotsContainer),this.saveSlotSelectMessageBoxContainer=s.add.container(0,0),this.saveSlotSelectMessageBoxContainer.setVisible(!1),this.saveSlotSelectContainer.add(this.saveSlotSelectMessageBoxContainer),this.saveSlotSelectMessageBox=ye(1,-1,318,28),this.saveSlotSelectMessageBox.setOrigin(0,1),this.saveSlotSelectMessageBoxContainer.add(this.saveSlotSelectMessageBox),this.message=P(8,8,"",A.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.saveSlotSelectMessageBoxContainer.add(this.message),this.sessionSlots=[]}show(e){return e.length<2||!(e[1]instanceof Function)?!1:(super.show(e),this.uiMode=e[0],this.saveSlotSelectCallback=e[1],this.saveSlotSelectContainer.setVisible(!0),this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),!0)}processInput(e){const t=this.getUi(),i=[];let n=!1,a=!1;if(e===v.ACTION||e===v.CANCEL){const r=this.saveSlotSelectCallback;if(e===v.ACTION){const o=this.cursor+this.scrollCursor,l=this.sessionSlots[o];if(this.uiMode===0&&!l.hasData)a=!0;else{switch(this.uiMode){case 0:l.malformed||(i.push({label:m.t("menu:loadGame"),handler:c(()=>(s.ui.revertMode(),r?.(o),!0),"handler"),keepOpen:!1}),i.push({label:m.t("saveSlotSelectUiHandler:renameRun"),handler:c(()=>(s.ui.revertMode(),t.setOverlayMode(x.RENAME_RUN,{buttonActions:[h=>{const u=decodeURIComponent(atob(h));s.gameData.renameSession(o,u).then(p=>{p[0]===!1?s.reset(!0):(this.clearSessionSlots(),this.cursorObj=null,this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),t.revertMode(),t.showText("",0))})},()=>{t.revertMode()}]},""),!0),"handler")})),this.manageDataConfig={xOffset:0,yOffset:48,options:i,maxOptions:4},i.push({label:m.t("saveSlotSelectUiHandler:deleteRun"),handler:c(()=>(s.ui.revertMode(),t.showText(m.t("saveSlotSelectUiHandler:deleteData"),null,()=>{t.setOverlayMode(x.CONFIRM,()=>{s.gameData.deleteSession(o).then(h=>{h[0]===!1?s.reset(!0):(this.clearSessionSlots(),this.cursorObj=null,this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),t.revertMode(),t.showText("",0))})},()=>{t.revertMode(),t.showText("",0)},!1,0,19,2e3)}),!0),"handler"),keepOpen:!1}),i.push({label:m.t("menuUiHandler:cancel"),handler:c(()=>(s.ui.revertMode(),!0),"handler"),keepOpen:!0}),t.setOverlayMode(x.MENU_OPTION_SELECT,this.manageDataConfig);break;case 1:{const h=c(()=>{const u=this.saveSlotSelectCallback;this.saveSlotSelectCallback=null,t.revertMode(),t.showText("",0),t.setMode(x.MESSAGE),u?.(o)},"saveAndCallback");if(this.sessionSlots[o].hasData)t.showText(m.t("saveSlotSelectUiHandler:overwriteData"),null,()=>{t.setOverlayMode(x.CONFIRM,()=>{s.gameData.deleteSession(o).then(u=>{u===!1?s.reset(!0):h()})},()=>{t.revertMode(),t.showText("",0)},!1,0,19,2e3)});else if(this.sessionSlots[o].hasData===!1)h();else return!1;break}}n=!0}}else this.saveSlotSelectCallback=null,t.showText("",0),r?.(-1),n=!0}else{const r=this.cursor+this.scrollCursor;switch(e){case v.UP:this.cursor?n=this.cursor===0?this.setCursor(this.cursor):this.setCursor(this.cursor-1,r):this.scrollCursor?n=this.setScrollCursor(this.scrollCursor-1,r):this.cursor===0&&this.scrollCursor===0&&(this.setScrollCursor(Hi-Fs),this.revertSessionSlot(Hi-Fs),this.setCursor(Fs-1),n=!0);break;case v.DOWN:this.cursor<Fs-1?n=this.setCursor(this.cursor+1,r):this.scrollCursor<Hi-Fs?n=this.setScrollCursor(this.scrollCursor+1,r):this.cursor===Fs-1&&this.scrollCursor===Hi-Fs&&(this.setScrollCursor(0),this.revertSessionSlot(Fs-1),this.setCursor(0),n=!0);break;case v.RIGHT:this.sessionSlots[r].hasData&&this.sessionSlots[r].saveData&&(s.ui.setOverlayMode(x.RUN_INFO,this.sessionSlots[r].saveData,Sh.SESSION_PREVIEW),n=!0)}}return n?t.playSelect():a&&t.playError(),n||a}populateSessionSlots(){for(let e=0;e<Hi;e++){const t=new Ko(e);s.add.existing(t),this.sessionSlotsContainer.add(t),this.sessionSlots.push(t),t.load().then(i=>{i&&this.cursor+this.scrollCursor===e&&this.setCursor(e)})}}showText(e,t,i,n,a,r){super.showText(e,t,i,n,a,r),e?.indexOf(`
`)===-1?(this.saveSlotSelectMessageBox.setSize(318,28),this.message.setY(-22)):(this.saveSlotSelectMessageBox.setSize(318,42),this.message.setY(-37)),this.saveSlotSelectMessageBoxContainer.setVisible(!!e?.length)}setCursor(e,t){const i=super.setCursor(e);if(!this.cursorObj){this.cursorObj=s.add.container(0,0);const r=s.add.nineslice(0,15,"select_cursor_highlight_thick",void 0,294,this.sessionSlots[t??0]?.saveData?.name?50:60,6,6,6,6),o=s.add.image(0,0,"cursor");o.setPosition(160,15),o.setName("rightArrow"),this.cursorObj.add([r,o]),this.sessionSlotsContainer.add(this.cursorObj)}const n=e+this.scrollCursor,a=n*76;if(this.sessionSlots[n]&&this.cursorObj){const r=this.sessionSlots[n],o=r.hasData&&!r.malformed;o?(this.cursorObj.setPosition(145,20+a),this.sessionSlots[n].setPosition(-6,a)):(this.cursorObj.setPosition(151,20+a),this.sessionSlots[n].setPosition(0,a)),this.setArrowVisibility(o)}return ve(t)||this.revertSessionSlot(t),i}revertSessionSlot(e){const t=this.sessionSlots[e];t&&t.setPosition(0,e*76)}setArrowVisibility(e){this.cursorObj&&(this.cursorObj?.getByName("rightArrow")).setVisible(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;return i&&(this.scrollCursor=e,this.setCursor(this.cursor,t),s.tweens.add({targets:this.sessionSlotsContainer,y:this.sessionSlotsContainerInitialY-76*e,duration:ge(325),ease:"Sine.easeInOut"})),i}clear(){super.clear(),this.saveSlotSelectContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.saveSlotSelectCallback=null,this.clearSessionSlots()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearSessionSlots(){this.sessionSlots.splice(0,this.sessionSlots.length),this.sessionSlotsContainer.removeAll(!0)}};c(nu,"SaveSlotSelectUiHandler");let Wo=nu;const au=class au extends Phaser.GameObjects.Container{slotId;hasData;malformed;slotWindow;loadingLabel;saveData;constructor(e){super(s,0,e*76),this.slotId=e,this.setup()}setup(){this.slotWindow=ye(0,0,304,70),this.add(this.slotWindow),this.loadingLabel=P(152,33,m.t("saveSlotSelectUiHandler:loading"),A.WINDOW),this.loadingLabel.setOrigin(.5,.5),this.add(this.loadingLabel)}decideFallback(e){let t=`${Mt.getModeName(e.gameMode)}`;switch(e.gameMode){case ce.CLASSIC:t+=` (${s.gameData.gameStats.classicSessionsPlayed+1})`;break;case ce.ENDLESS:case ce.SPLICED_ENDLESS:t+=` (${s.gameData.gameStats.endlessSessionsPlayed+1})`;break;case ce.DAILY:{const i=new Date(e.timestamp).toLocaleDateString();t+=` (${i})`;break}case ce.CHALLENGE:{const i=e.challenges.filter(n=>n.value!==0);if(i.length===0)break;t="";for(const n of i.slice(0,3))t!==""&&(t+=", "),t+=n.toChallenge().getName();i.length>3?t+=", ...":t===""&&(t=`${Mt.getModeName(e.gameMode)}`);break}}return t}async setupWithData(e){const t=e?.name;if(this.remove(this.loadingLabel,!0),t){const h=P(8,5,e.name,A.WINDOW);this.add(h)}else{const h=this.decideFallback(e);await s.gameData.renameSession(this.slotId,h);const u=P(8,5,h,A.WINDOW);this.add(u)}const i=P(8,19,`${Mt.getModeName(e.gameMode)||m.t("gameMode:unknown")} - ${m.t("saveSlotSelectUiHandler:wave")} ${e.waveIndex}`,A.WINDOW);this.add(i);const n=P(8,33,new Date(e.timestamp).toLocaleString(),A.WINDOW);this.add(n);const a=P(8,47,ff(e.playTime),A.WINDOW);this.add(a);const r=s.add.container(144,16);e.party.forEach((h,u)=>{const p=s.add.container(26*u,0);p.setScale(.75);const f=h.toPokemon(),d=s.addPokemonIcon(f,0,0,0,0),y=P(32,20,`${m.t("saveSlotSelectUiHandler:lv")}${bi(f.level,1e3)}`,A.PARTY,{fontSize:"54px",color:"#f8f8f8"});y.setShadow(0,0,void 0).setStroke("#424242",14).setOrigin(1,0),p.add([d,y]),r.add(p),f.destroy()}),this.add(r);const o=s.add.container(148,38);o.setScale(.5);let l=0;for(const h of e.modifiers){const u=h.toModifier(ta[h.className]);if(u instanceof ls)continue;const p=u?.getIcon(!1);if(p&&(p.setPosition(24*l,0),o.add(p)),++l===12)break}this.add(o)}load(){return new Promise(e=>{s.gameData.getSession(this.slotId).then(async t=>{if(this.active){if(this.hasData=!!t,!t){this.loadingLabel.setText(m.t("saveSlotSelectUiHandler:empty")),e(!1);return}this.saveData=t,this.setupWithData(t),e(!0)}}).catch(t=>{this.active&&(console.warn(`Failed to load session slot #${this.slotId}:`,t),this.loadingLabel.setText(m.t("menu:failedToLoadSession")),this.hasData=!0,this.malformed=!0,e(!0))})})}};c(au,"SessionSlot");let Ko=au;const ru=class ru extends je{phaseName="SelectStarterPhase";start(){super.start(),s.playBgm("menu"),s.ui.setMode(x.STARTER_SELECT,e=>{s.ui.clearText(),s.ui.setMode(x.SAVE_SLOT,Ta.SAVE,t=>{if(t===-1){s.phaseManager.toTitleScreen(),this.end();return}s.sessionSlotId=t,this.initBattle(e)})})}initBattle(e){const t=s.getPlayerParty(),i=[];e.forEach((n,a)=>{!a&&le.STARTER_SPECIES_OVERRIDE&&(n.species=ns(le.STARTER_SPECIES_OVERRIDE));const r=s.gameData.getSpeciesDexAttrProps(n.species,n.dexAttr);let o=Math.min(r.formIndex,Math.max(n.species.forms.length-1,0));n.species.speciesId in le.STARTER_FORM_OVERRIDES&&!ve(le.STARTER_FORM_OVERRIDES[n.species.speciesId])&&n.species.forms[le.STARTER_FORM_OVERRIDES[n.species.speciesId]]&&(o=le.STARTER_FORM_OVERRIDES[n.species.speciesId]);let l=n.species.malePercent!==null?r.female?kt.FEMALE:kt.MALE:kt.GENDERLESS;le.GENDER_OVERRIDE!==null&&(l=le.GENDER_OVERRIDE);const h=s.gameData.dexData[n.species.speciesId].ivs.slice(0),u=s.addPlayerPokemon(n.species,s.gameMode.getStartingLevel(),n.abilityIndex,o,l,r.shiny,r.variant,h,n.nature);n.moveset&&u.tryPopulateMoveset(n.moveset),n.passive&&(u.passive=!0),u.luck=s.gameData.getDexAttrLuck(s.gameData.dexData[n.species.speciesId].caughtAttr),n.pokerus&&(u.pokerus=!0),n.nickname&&(u.nickname=n.nickname),ve(n.teraType)?u.teraType=u.species.type1:u.teraType=n.teraType,(s.gameMode.isSplicedOnly||le.STARTER_FUSION_OVERRIDE)&&u.generateFusionSpecies(!0),u.setVisible(!1);const p=fs(gs.STARTER_MODIFY,u);t.push(u),p&&i.push(u.updateInfo()),i.push(u.loadAssets())}),qp(),Qp(t[0]),Promise.all(i).then(()=>{Os.fadeOut(s,s.sound.get("menu"),500,!0),s.time.delayedCall(500,()=>s.playBgm()),s.gameMode.isClassic?s.gameData.gameStats.classicSessionsPlayed++:s.gameData.gameStats.endlessSessionsPlayed++,s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,s.getPlayerParty().forEach(n=>{s.triggerPokemonFormChange(n,of)}),this.end()})}};c(ru,"SelectStarterPhase");let zo=ru;const ou=class ou extends Ut{phaseName="SelectTargetPhase";constructor(e){super(e)}start(){super.start();const e=s.currentBattle.turnCommands[this.fieldIndex],t=e?.move?.move;s.ui.setMode(x.TARGET_SELECT,this.fieldIndex,t,i=>{s.ui.setMode(x.MESSAGE);const n=s.getField(),a=n[this.fieldIndex],r=Fe[t];if(r&&a.isMoveTargetRestricted(r.id,a,n[i[0]])){const o=a.getRestrictingTag(t,a,n[i[0]]).selectionDeniedText(a,r.id);s.phaseManager.queueMessage(m.t(o,{moveName:r.name}),0,!0),i=[]}i.length<1?(s.currentBattle.turnCommands[this.fieldIndex]=null,s.phaseManager.unshiftNew("CommandPhase",this.fieldIndex)):e.targets=i,e?.command===Ke.BALL&&this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),this.end()})}};c(ou,"SelectTargetPhase");let jo=ou;const lu=class lu extends Ut{phaseName="ShinySparklePhase";constructor(e){super(e)}start(){super.start(),this.getPokemon().sparkle(),s.time.delayedCall(1e3,()=>this.end())}};c(lu,"ShinySparklePhase");let $o=lu;const hu=class hu extends Ut{phaseName="ShowAbilityPhase";passive;pokemonName;abilityName;pokemonOnField;constructor(e,t=!1){super(e),this.passive=t;const i=this.getPokemon();i?(this.pokemonName=Ne(i),this.abilityName=(t?this.getPokemon().getPassiveAbility():this.getPokemon().getAbility()).name,this.pokemonOnField=!0):this.pokemonOnField=!1}start(){if(super.start(),!this.pokemonOnField||!this.getPokemon())return this.end();if(s.abilityBar.isVisible())return s.phaseManager.unshiftNew("HideAbilityPhase"),s.phaseManager.unshiftNew("ShowAbilityPhase",this.battlerIndex,this.passive),this.end();const e=this.getPokemon();e.isPlayer()?s.currentBattle.lastPlayerInvolved=e.getBattlerIndex()%2:s.currentBattle.lastEnemyInvolved=e.getBattlerIndex()%2,s.abilityBar.showAbility(this.pokemonName,this.abilityName,this.passive,this.player).then(()=>{e.waveData.abilityRevealed=!0,this.end()})}};c(hu,"ShowAbilityPhase");let Sa=hu;const cu=class cu extends Ka{phaseName="ShowPartyExpBarPhase";expValue;constructor(e,t){super(e),this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new Pt(this.expValue);s.applyModifiers(tf,!0,t),t.value=Math.floor(t.value);const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),s.phaseManager.unshiftNew("HidePartyExpBarPhase"),e.updateInfo(),s.expParty===ii.SKIP?this.end():s.expParty===ii.ONLY_LEVEL_UP?n>i?s.partyExpBar.showPokemonExp(e,t.value,s.expParty===ii.ONLY_LEVEL_UP,n).then(()=>{setTimeout(()=>this.end(),800/Math.pow(2,s.expGainsSpeed))}):this.end():s.expGainsSpeed<Tf.SKIP?s.partyExpBar.showPokemonExp(e,t.value,!1,n).then(()=>{setTimeout(()=>this.end(),500/Math.pow(2,s.expGainsSpeed))}):this.end()}};c(cu,"ShowPartyExpBarPhase");let Xo=cu;const uu=class uu extends ut{phaseName="ShowTrainerPhase";start(){super.start(),s.trainer.setVisible(!0),s.trainer.setTexture(`trainer_${s.gameData.gender===Be.FEMALE?"f":"m"}_back`),s.tweens.add({targets:s.trainer,x:106,duration:1e3,onComplete:c(()=>this.end(),"onComplete")})}};c(uu,"ShowTrainerPhase");let qo=uu;const du=class du extends yn{phaseName="SummonMissingPhase";preSummon(){s.ui.showText(m.t("battle:sendOutPokemon",{pokemonName:Ne(this.getPokemon())})),s.time.delayedCall(250,()=>this.summon())}};c(du,"SummonMissingPhase");let Qo=du;const pu=class pu extends ut{phaseName="SwitchBiomePhase";nextBiome;constructor(e){super(),this.nextBiome=e}start(){if(super.start(),this.nextBiome===void 0)return this.end();s.lastEnemyTrainer=s.currentBattle?.trainer??null,s.lastMysteryEncounter=s.currentBattle?.mysteryEncounter,s.tweens.add({targets:[s.arenaEnemy,s.lastEnemyTrainer],x:"+=300",duration:2e3,onComplete:c(()=>{s.arenaEnemy.setX(s.arenaEnemy.x-600),s.newArena(this.nextBiome);const t=`${Sf(this.nextBiome)}_bg`;s.arenaBgTransition.setTexture(t),s.arenaBgTransition.setAlpha(0),s.arenaBgTransition.setVisible(!0),s.arenaPlayerTransition.setBiome(this.nextBiome),s.arenaPlayerTransition.setAlpha(0),s.arenaPlayerTransition.setVisible(!0),s.tweens.add({targets:[s.arenaPlayer,s.arenaBgTransition,s.arenaPlayerTransition],duration:1e3,delay:1e3,ease:"Sine.easeInOut",alpha:c(i=>i===s.arenaPlayer?0:1,"alpha"),onComplete:c(()=>{s.arenaBg.setTexture(t),s.arenaPlayer.setBiome(this.nextBiome),s.arenaPlayer.setAlpha(1),s.arenaEnemy.setBiome(this.nextBiome),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setBiome(this.nextBiome),s.arenaBgTransition.setVisible(!1),s.arenaPlayerTransition.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),this.end()},"onComplete")})},"onComplete")})}};c(pu,"SwitchBiomePhase");let Zo=pu;const fu=class fu extends ut{phaseName="SwitchPhase";fieldIndex;switchType;isModal;doReturn;constructor(e,t,i,n){super(),this.switchType=e,this.fieldIndex=t,this.isModal=i,this.doReturn=n}start(){if(super.start(),this.isModal&&!s.getPlayerParty().filter(t=>t.isAllowedInBattle()&&!t.isActive(!0)).length)return super.end();if(this.isModal&&!this.doReturn&&!s.getPlayerParty()[this.fieldIndex].isFainted())return super.end();if(this.isModal&&s.getPlayerField().filter(t=>t.isAllowedInBattle()&&t.isActive(!0)).length>=s.currentBattle.getBattlerCount())return super.end();const e=s.currentBattle.getBattlerCount()===1||s.getPokemonAllowedInBattle().length>1?this.fieldIndex:0;s.ui.setMode(x.PARTY,this.isModal?tn.FAINT_SWITCH:tn.POST_BATTLE_SWITCH,e,(t,i)=>{if(t>=s.currentBattle.getBattlerCount()&&t<6){s.phaseManager.tryRemoveDynamicPhase(ha.POST_SUMMON,a=>a.is("PostSummonPhase")&&a.player&&a.fieldIndex===this.fieldIndex,"all");const n=i===dm.PASS_BATON?gt.BATON_PASS:this.switchType;s.phaseManager.unshiftNew("SwitchSummonPhase",n,e,t,this.doReturn)}s.ui.setMode(x.MESSAGE).then(()=>super.end())},ph.FilterNonFainted)}};c(fu,"SwitchPhase");let Jo=fu;const gu=class gu extends ut{phaseName="TeraPhase";pokemon;constructor(e){super(),this.pokemon=e}start(){super.start(),s.phaseManager.queueMessage(m.t("battle:pokemonTerastallized",{pokemonNameWithAffix:Ne(this.pokemon),type:m.t(`pokemonInfo:type.${Tt(Se[this.pokemon.getTeraType()])}`)})),new Ga(ni.TERASTALLIZE,this.pokemon).play(!1,()=>{this.end()})}end(){this.pokemon.isTerastallized=!0,this.pokemon.updateSpritePipelineData(),this.pokemon.isPlayer()&&(s.arena.playerTerasUsed+=1),s.triggerPokemonFormChange(this.pokemon,df),this.pokemon.isPlayer()&&(s.validateAchv(Pe.TERASTALLIZE),this.pokemon.getTeraType()===Se.STELLAR&&s.validateAchv(Pe.STELLAR_TERASTALLIZE)),super.end()}};c(gu,"TeraPhase");let el=gu;const mu=class mu extends je{phaseName="TitlePhase";loaded=!1;lastSessionData;gameMode;start(){super.start(),s.ui.clearText(),s.ui.fadeIn(250),s.playBgm("title",!0),s.gameData.getSession(ke?.lastSessionSlot??-1).then(e=>{if(e){this.lastSessionData=e;const i=`${Sf(e.arena.biome)}_bg`;s.arenaBg.setTexture(i)}this.showOptions()}).catch(e=>{console.error(e),this.showOptions()})}showOptions(){const e=[];ke&&ke.lastSessionSlot>-1&&e.push({label:m.t("continue",{ns:"menu"}),handler:c(()=>(this.loadSaveSlot(this.lastSessionData||!ke?-1:ke.lastSessionSlot),!0),"handler")}),e.push({label:m.t("menu:newGame"),handler:c(()=>{const i=c(r=>{this.gameMode=r,s.ui.setMode(x.MESSAGE),s.ui.clearText(),this.end()},"setModeAndEnd"),{gameData:n}=s,a=[];return a.push({label:Mt.getModeName(ce.CLASSIC),handler:c(()=>(i(ce.CLASSIC),!0),"handler")}),a.push({label:m.t("menu:dailyRun"),handler:c(()=>(this.initDailyRun(),!0),"handler")}),n.isUnlocked(It.ENDLESS_MODE)&&(a.push({label:Mt.getModeName(ce.CHALLENGE),handler:c(()=>(i(ce.CHALLENGE),!0),"handler")}),a.push({label:Mt.getModeName(ce.ENDLESS),handler:c(()=>(i(ce.ENDLESS),!0),"handler")}),n.isUnlocked(It.SPLICED_ENDLESS_MODE)&&a.push({label:Mt.getModeName(ce.SPLICED_ENDLESS),handler:c(()=>(i(ce.SPLICED_ENDLESS),!0),"handler")})),a.push({label:m.t("menu:cancel"),handler:c(()=>(s.phaseManager.toTitleScreen(),super.end(),!0),"handler")}),s.ui.showText(m.t("menu:selectGameMode"),null,()=>s.ui.setOverlayMode(x.OPTION_SELECT,{options:a})),!0},"handler")},{label:m.t("menu:loadGame"),handler:c(()=>(s.ui.setOverlayMode(x.SAVE_SLOT,Ta.LOAD,i=>{if(i===-1)return this.showOptions();this.loadSaveSlot(i)}),!0),"handler")},{label:m.t("menu:runHistory"),handler:c(()=>(s.ui.setOverlayMode(x.RUN_HISTORY),!0),"handler"),keepOpen:!0},{label:m.t("menu:settings"),handler:c(()=>(s.ui.setOverlayMode(x.SETTINGS),!0),"handler"),keepOpen:!0});const t={options:e,noCancel:!0,yOffset:47};s.ui.setMode(x.TITLE,t)}loadSaveSlot(e){s.sessionSlotId=e>-1||!ke?e:ke.lastSessionSlot,s.ui.setMode(x.MESSAGE),s.ui.resetModeChain(),s.gameData.loadSession(e,e===-1?this.lastSessionData:void 0).then(t=>{t?(this.loaded=!0,s.ui.showText(m.t("menu:sessionSuccess"),null,()=>this.end())):this.end()}).catch(t=>{console.error(t),s.ui.showText(m.t("menu:failedToLoadSession"),null)})}initDailyRun(){s.ui.clearText(),s.ui.setMode(x.SAVE_SLOT,Ta.SAVE,e=>{if(e===-1){s.phaseManager.toTitleScreen(),super.end();return}s.phaseManager.clearPhaseQueue(),s.sessionSlotId=e;const t=c(i=>{s.gameMode=oa(ce.DAILY),s.eventManager.startEventChallenges(),s.setSeed(i),s.resetSeed(),s.money=s.gameMode.getStartingMoney();const n=fm(i),a=s.gameMode.getStartingLevel(),r=s.getPlayerParty(),o=[];for(const h of n){const u=s.gameData.getSpeciesDexAttrProps(h.species,h.dexAttr),p=Math.min(u.formIndex,Math.max(h.species.forms.length-1,0)),f=h.species.malePercent!==null?u.female?kt.FEMALE:kt.MALE:kt.GENDERLESS,d=s.addPlayerPokemon(h.species,a,h.abilityIndex,p,f,u.shiny,u.variant,void 0,h.nature);d.setVisible(!1),r.push(d),o.push(d.loadAssets())}oh(r,ei.DAILY_STARTER);const l=Array(3).fill(null).map(()=>st.EXP_SHARE().withIdFromFunc(st.EXP_SHARE).newModifier()).concat(Array(3).fill(null).map(()=>st.GOLDEN_EXP_CHARM().withIdFromFunc(st.GOLDEN_EXP_CHARM).newModifier())).concat([st.MAP().withIdFromFunc(st.MAP).newModifier()]).concat(gm(r)).filter(h=>h!==null);for(const h of l)s.addModifier(h,!0,!1,!1,!0);s.updateModifiers(!0,!0),Promise.all(o).then(()=>{s.time.delayedCall(500,()=>s.playBgm()),s.gameData.gameStats.dailyRunSessionsPlayed++,s.newArena(s.gameMode.getStartingBiome()),s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,this.end()})},"generateDaily");if(!Ci||rf)pm().then(i=>{if(i)t(i);else throw new Error("Daily run seed is null!")}).catch(i=>{console.error(`Failed to load daily run:
`,i)});else{let i=btoa(new Date().toISOString().substring(0,10));ve(le.DAILY_RUN_SEED_OVERRIDE)||(i=le.DAILY_RUN_SEED_OVERRIDE),t(i)}})}end(){if(!this.loaded&&!s.gameMode.isDaily?(s.arena.preloadBgm(),s.gameMode=oa(this.gameMode),this.gameMode===ce.CHALLENGE?s.phaseManager.pushNew("SelectChallengePhase"):s.phaseManager.pushNew("SelectStarterPhase"),s.newArena(s.gameMode.getStartingBiome())):s.playBgm(),s.phaseManager.pushNew("EncounterPhase",this.loaded),this.loaded){const e=s.getPokemonAllowedInBattle().length;if(s.phaseManager.pushNew("SummonPhase",0,!0,!0),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("SummonPhase",1,!0,!0),s.currentBattle.battleType!==ue.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const t=s.currentBattle.double?2:1;e>t&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}for(const e of Object.keys(s.gameData.achvUnlocks))Ft.hasOwnProperty(e)&&e!=="CLASSIC_VICTORY"&&s.validateVoucher(Ft[e]);super.end()}};c(mu,"TitlePhase");let tl=mu;const yu=class yu extends ut{phaseName="ToggleDoublePositionPhase";double;constructor(e){super(),this.double=e}start(){super.start();const e=s.getPlayerField().find(t=>t.isActive(!0));e?e.setFieldPosition(this.double&&s.getPokemonAllowedInBattle().length>1?cs.LEFT:cs.CENTER,500).then(()=>{if(e.getFieldIndex()===1){const t=s.getPlayerParty();t[1]=t[0],t[0]=e}this.end()}):this.end()}};c(yu,"ToggleDoublePositionPhase");let sl=yu;const Tu=class Tu extends ut{phaseName="TrainerVictoryPhase";start(){s.disableMenu=!0,s.playBgm(s.currentBattle.trainer?.config.victoryBgm),s.phaseManager.unshiftNew("MoneyRewardPhase",s.currentBattle.trainer?.config.moneyMultiplier);const e=s.currentBattle.trainer?.config.modifierRewardFuncs;for(const i of e)s.phaseManager.unshiftNew("ModifierRewardPhase",i);const t=s.currentBattle.trainer?.config.trainerType;Ft.hasOwnProperty(D[t])&&!s.validateVoucher(Ft[D[t]])&&s.currentBattle.trainer?.config.isBoss&&(fh.getUpgradeUnlockedVouchers()?s.phaseManager.unshiftNew("ModifierRewardPhase",[st.VOUCHER_PLUS,st.VOUCHER_PLUS,st.VOUCHER_PLUS,st.VOUCHER_PREMIUM][Ft[D[t]].voucherType]):s.phaseManager.unshiftNew("ModifierRewardPhase",[st.VOUCHER,st.VOUCHER,st.VOUCHER_PLUS,st.VOUCHER_PREMIUM][Ft[D[t]].voucherType])),s.arena.biomeType===Je.SPACE&&(t===D.BREEDER||t===D.EXPERT_POKEMON_BREEDER)&&s.validateAchv(Pe.BREEDERS_IN_SPACE),s.ui.showText(m.t("battle:trainerDefeated",{trainerName:s.currentBattle.trainer?.getName(Ct.NONE,!0)}),null,()=>{const i=s.currentBattle.trainer?.getVictoryMessages();let n;s.executeWithSeedOffset(()=>n=In(i),s.currentBattle.waveIndex),n=n;const a=c(()=>{const o=r;r=c(()=>s.ui.showDialogue(n,s.currentBattle.trainer?.getName(Ct.TRAINER,!0),null,o),"showMessageOrEnd"),r()},"showMessage");let r=c(()=>this.end(),"showMessageOrEnd");if(i?.length)if(s.currentBattle.trainer?.config.hasCharSprite&&!s.ui.shouldSkipDialogue(n)){const o=r;r=c(()=>s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>o())),"showMessageOrEnd"),s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(s.currentBattle.trainer?.getKey(),Wa(i[0])).then(()=>a()))}else a();else r()},null,!0),this.showEnemyTrainer()}};c(Tu,"TrainerVictoryPhase");let il=Tu;const Su=class Su extends Ks{start(){super.start(),s.currentBattle.incrementTurn(),s.eventTarget.dispatchEvent(new mm(s.currentBattle.turn)),s.isMonsterHouseActive&&s.monsterHouseData&&s.monsterHouseData.turnCount++,s.phaseManager.hideAbilityBar();const e=c(r=>{if(!r.switchOutStatus){r.lapseTags(Ms.TURN_END),s.applyModifiers(ym,r.isPlayer(),r),s.arena.terrain?.terrainType===us.GRASSY&&r.isGrounded()&&s.phaseManager.unshiftNew("PokemonHealPhase",r.getBattlerIndex(),Math.max(r.getMaxHp()>>4,1),m.t("battle:turnEndHpRestore",{pokemonName:Ne(r)}),!0),r.isPlayer()||(s.applyModifiers(Tm,!1,r),s.applyModifier(Sm,!1,r)),Oe("PostTurnAbAttr",{pokemon:r});const h=s.getModifiers(Zi);for(const u of h){const p=u.getPokemon();if(!(!p||!p.isOnField())){if(u.isForbiddenSpecies(p)){`${p.name}`,s.removeModifier(u);continue}u.lapse()}}}if(s.applyModifiers(Cm,r.isPlayer(),r),s.applyModifiers(Zp,r.isPlayer(),r),s.getModifiers(tr).find(h=>h.pokemonId===r.id)||r.isPlayer()&&s.applyModifier(tr,this.player,r)){const h=[],u=Zn.filter(f=>r.getStatStage(f)<6&&!h.includes(f));let p=Zn.filter(f=>f!==u[0]&&r.getStatStage(f)>-6);if(u.length>0){const f=u[r.randBattleSeedInt(u.length)];p=p.filter(d=>d!==f),s.phaseManager.unshiftPhase(new Ir(r.getBattlerIndex(),!0,[f],2))}if(p.length>0){const f=p[r.randBattleSeedInt(p.length)];s.phaseManager.unshiftPhase(new Ir(r.getBattlerIndex(),!0,[f],-1))}s.applyModifiers(tr,r.isPlayer(),r)}r.tempSummonData.turnCount++,r.tempSummonData.waveTurnCount++},"handlePokemon");this.executeForAll(e),s.arena.lapseTags();const t=s.getModifiers(gi,!0).some(r=>r instanceof gi);!s.getModifiers(mi,!0).some(r=>r instanceof mi)&&s.arena.terrain&&!s.arena.terrain.lapse()&&s.arena.trySetTerrain(us.NONE),!t&&s.arena.weather&&!s.arena.weather.lapse()&&s.arena.trySetWeather(es.NONE);const n=s.getModifiers(gi,!0).filter(r=>r instanceof gi),a=s.getModifiers(mi,!0).filter(r=>r instanceof mi);for(const r of n)r.onTurnEnd();for(const r of a)r.onTurnEnd();this.end()}};c(Su,"TurnEndPhase");let nl=Su;const Cu=class Cu extends Ks{phaseName="TurnInitPhase";start(){if(super.start(),s.getPlayerField().forEach(t=>{if(t.isOnField()&&!t.isAllowedInBattle()){s.phaseManager.queueMessage(m.t("challenges:illegalEvolution",{pokemon:t.name}),null,!0);const i=s.getPokemonAllowedInBattle();i.length?i.length>=s.currentBattle.getBattlerCount()||s.currentBattle.double&&!i[0].isActive(!0)?t.switchOut():t.leaveField():(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase")),i.length===1&&s.currentBattle.double&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)}}),s.eventTarget.dispatchEvent(new Em),bm(),Im()){this.end();return}s.getField().forEach((t,i)=>{t?.isActive()&&(t.isPlayer()&&s.currentBattle.addParticipant(t),t.resetTurnData(),t.isPlayer()?s.phaseManager.pushNew("CommandPhase",i):s.phaseManager.pushNew("EnemyCommandPhase",i-ct.ENEMY))}),s.phaseManager.pushNew("TurnStartPhase");const e=new Set([Ae.POMEG,Ae.KELPSY,Ae.QUALOT,Ae.HONDEW,Ae.GREPA,Ae.TAMATO]);for(const t of s.getField()){if(!t?.isOnField?.()||!t.getHeldBerryType)continue;const i=t.getHeldBerryType();i!==void 0&&e.has(i)&&!t.getTag(BattlerTagType.BERRY_USED)&&(`${t.name}${Ae[i]}`,t.addTag(BattlerTagType.BERRY_USED,0),s.phaseManager.unshiftNew("BerryPhase"))}this.end()}};c(Cu,"TurnInitPhase");let Ca=Cu;const Eu=class Eu extends Ks{phaseName="TurnStartPhase";getSpeedOrder(){const e=s.getPlayerField().filter(a=>a.isActive()),t=s.getEnemyField().filter(a=>a.isActive());let i=e.concat(t);s.executeWithSeedOffset(()=>{i=Cf(i)},s.currentBattle.turn,s.waveSeed);const n=new ot(!1);return s.arena.applyTags(Kp,!1,n),i.sort((a,r)=>{const o=a.getEffectiveStat(Ws.SPD),l=r.getEffectiveStat(Ws.SPD);return n.value?o-l:l-o}),i.map(a=>a.getFieldIndex()+(a.isEnemy()?ct.ENEMY:ct.PLAYER))}getCommandOrder(){let e=this.getSpeedOrder();Ae.CHERI+"",Se.ELECTRIC,Ae.CHESTO+"",Se.FLYING,Ae.PECHA+"",Se.POISON,Ae.RAWST+"",Se.WATER,Ae.ASPEAR+"",Se.ICE,Ae.ORAN+"",Se.NORMAL,Ae.PERSIM+"",Se.PSYCHIC,Ae.WEPEAR+"",Se.GRASS,Ae.BELUE+"",Se.FAIRY,Ae.CORNN+"",Se.BUG,Ae.MAGOST+"",Se.GHOST,Ae.RABUTA+"",Se.DRAGON,Ae.NOMEL+"",Se.GROUND,Ae.SPELON+"",Se.FIRE,Ae.PAMTRE+"",Se.DARK,Ae.WATMEL+"",Se.FIGHTING,Ae.DURIN+"",Se.STEEL,Ae.PINAP+"",Se.ROCK;const t={},i={};return s.getField(!0).forEach(n=>{const a=new ot(!1),r=new ot(!1),o=new ot(!0);Oe("BypassSpeedChanceAbAttr",{pokemon:n,bypass:a}),Oe("PreventBypassSpeedChanceAbAttr",{pokemon:n,bypass:a,canCheckHeldItems:o}),o.value&&s.applyModifiers(vm,n.isPlayer(),n,a);let l=n.getHeldBerryType?.();if(l===void 0){const h=s.getModifiers(ds,n.isPlayer()).filter(u=>u instanceof ds&&u.pokemonId===n.id);h.length>0&&(l=h[0].berryType)}if(l&&_m.has(l)){const u=s.currentBattle.turnCommands[n.getBattlerIndex()]?.move?.move,p=u?Fe[u]:void 0,f=new NumberHolder(p?.type??Se.NONE);Oe("MoveTypeChangeAbAttr",{pokemon:n,simulated:!1,move:p,moveType:f});const d=f.value,y=xm[l];console.debug(`[TypePriorityBerry] ${n.name}  move=${p?.name}, moveType=${Se[d]}, berry=${Ae[l]}, mapped=${Se[y]}`),d===y&&(a.value=!0,n.tryUseBerry(l),s.phaseManager.queueMessage(m.t("battle:berryActivatedPriorityType",{pokemonName:Ne(n),typeName:m.t(`pokemonInfo:type.${Se[d].toLowerCase()}`)})))}s.applyModifiers(Am,n.isPlayer(),n,r),t[n.getBattlerIndex()]=a,i[n.getBattlerIndex()]=r}),e=e.slice(0),e.sort((n,a)=>{const r=s.currentBattle.turnCommands[n],o=s.currentBattle.turnCommands[a];if(r?.command!==o?.command){if(r?.command===Ke.FIGHT)return 1;if(o?.command===Ke.FIGHT)return-1}else if(r?.command===Ke.FIGHT){const u=s.getField(!0).find(E=>E.getBattlerIndex()===n),p=s.getField(!0).find(E=>E.getBattlerIndex()===a),f=u.getMoveset().find(E=>E.moveId===r.move.move),d=p.getMoveset().find(E=>E.moveId===o.move.move),y=f?.getMove().getPriority(u,!1)??0,g=d?.getMove().getPriority(p,!1)??0,T=Math.ceil(y)-Math.ceil(g)===0;if(y!==g)return T&&t[n].value!==t[a].value?t[n].value?-1:1:y<g?1:-1}if(i[n].value!==i[a].value)return i[n].value?1:-1;if(t[n].value!==t[a].value)return t[n].value?-1:1;const l=e.indexOf(n),h=e.indexOf(a);return l<h?-1:l>h?1:0}),e}start(){super.start();const e=new Set([Ae.POMEG,Ae.KELPSY,Ae.QUALOT,Ae.HONDEW,Ae.GREPA,Ae.TAMATO]);let t=!1;for(const r of s.getField()){if(!r?.isOnField?.()||!r.getHeldBerryType)continue;const o=r.getHeldBerryType();o!==void 0&&e.has(o)&&!r.getTag(BattlerTagType.BERRY_USED)&&(`${r.name}${Ae[o]}`,r.addTag(BattlerTagType.BERRY_USED,0),s.phaseManager.unshiftNew("BerryPhase"),t=!0)}if(t){this.end();return}const i=s.getField(),n=this.getCommandOrder();for(const r of this.getSpeedOrder()){const o=i[r],l=s.currentBattle.preTurnCommands[r];if(!l?.skip)switch(l?.command){case Ke.TERA:s.phaseManager.pushNew("TeraPhase",o)}}const a=s.phaseManager;n.forEach((r,o)=>{const l=i[r],h=s.currentBattle.turnCommands[r];!h||h.skip||(h.command===Ke.FIGHT&&(l.turnData.order=o),this.handleTurnCommand(h,l))}),a.pushNew("CheckInterludePhase"),a.pushNew("WeatherEffectPhase"),a.pushNew("BerryPhase"),a.pushNew("CheckStatusEffectPhase",n),a.pushNew("PositionalTagPhase"),a.pushNew("TurnEndPhase"),this.end()}handleTurnCommand(e,t){switch(e?.command){case Ke.FIGHT:this.handleFightCommand(e,t);break;case Ke.BALL:s.phaseManager.unshiftNew("AttemptCapturePhase",e.targets[0]%2,e.cursor);break;case Ke.POKEMON:s.phaseManager.unshiftNew("SwitchSummonPhase",e.args?.[0]?gt.BATON_PASS:gt.SWITCH,t.getFieldIndex(),e.cursor,!0,t.isPlayer());break;case Ke.RUN:s.phaseManager.unshiftNew("AttemptRunPhase");break}}handleFightCommand(e,t){const i=e.move;if(!i)return;const n=t.getMoveset().find(a=>a.moveId===i.move&&a.ppUsed<a.getMovePp())??new ps(i.move);n.getMove().hasAttr("MoveHeaderAttr")&&s.phaseManager.unshiftNew("MoveHeaderPhase",t,n),s.phaseManager.pushNew("MovePhase",t,e.targets??i.targets,n,i.useMode)}};c(Eu,"TurnStartPhase");let al=Eu;const bu=class bu extends je{phaseName="UnavailablePhase";start(){s.ui.setMode(x.UNAVAILABLE,()=>{s.phaseManager.unshiftNew("LoginPhase",!0),this.end()})}};c(bu,"UnavailablePhase");let rl=bu;function OT(C){switch(C){case It.ENDLESS_MODE:return`${Mt.getModeName(ce.ENDLESS)} Mode`;case It.MINI_BLACK_HOLE:return m.t("modifierType:ModifierType.MINI_BLACK_HOLE.name");case It.SPLICED_ENDLESS_MODE:return`${Mt.getModeName(ce.SPLICED_ENDLESS)} Mode`;case It.EVIOLITE:return m.t("modifierType:ModifierType.EVIOLITE.name")}}c(OT,"getUnlockableName");const Iu=class Iu extends je{phaseName="UnlockPhase";unlockable;constructor(e){super(),this.unlockable=e}start(){s.time.delayedCall(2e3,()=>{s.gameData.unlocks[this.unlockable]=!0,s.playSound("level_up_fanfare"),s.ui.setMode(x.MESSAGE),s.ui.showText(m.t("battle:unlockedSomething",{unlockedThing:OT(this.unlockable)}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),this.end()},null,!0,1500)})}};c(Iu,"UnlockPhase");let ol=Iu;const vu=class vu extends Ut{phaseName="VictoryPhase";isExpOnly;constructor(e,t=!1){super(e),this.isExpOnly=t}start(){super.start();const e=s.currentBattle.isBattleMysteryEncounter();(!e||!s.currentBattle.mysteryEncounter?.preventGameStatsUpdates)&&s.gameData.gameStats.pokemonDefeated++;const t=this.getPokemon().getExpValue();if(s.applyPartyExp(t,!0),e)return Om(!1,this.isExpOnly),this.end();if(!s.getEnemyParty().find(i=>s.currentBattle.battleType===ue.WILD?i.isOnField():!i?.isFainted(!0))){s.phaseManager.pushNew("BattleEndPhase",!0),s.currentBattle.battleType===ue.TRAINER&&s.phaseManager.pushNew("TrainerVictoryPhase");const i=s.gameMode,n=s.currentBattle.waveIndex;if(i.isEndless||!i.isWaveFinal(n)){if(s.phaseManager.pushNew("EggLapsePhase"),i.isClassic)switch(n){case Ge.RIVAL_1:case Ge.RIVAL_2:fh.getFixedBattleEventRewards(n).map(a=>s.phaseManager.pushNew("ModifierRewardPhase",st[a]));break;case Ge.EVIL_BOSS_2:s.phaseManager.pushNew("ModifierRewardPhase",st.LOCK_CAPSULE);break}if(n%10)s.phaseManager.pushNew("SelectModifierPhase",void 0,void 0,i.isFixedBattle(n)?i.getFixedBattle(n).customModifierRewardSettings:void 0);else if(i.isDaily)s.phaseManager.pushNew("ModifierRewardPhase",st.EXP_CHARM),n>10&&!i.isWaveFinal(n)&&s.phaseManager.pushNew("ModifierRewardPhase",st.GOLDEN_POKEBALL);else{const a=i.isEndless?10:s.offsetGym?0:20;i.isEndless&&n===10&&s.phaseManager.pushNew("ModifierRewardPhase",st.EXP_SHARE),n<=750&&(n<=500||n%30===a)&&s.phaseManager.pushNew("ModifierRewardPhase",n%30!==a||n>250?st.EXP_CHARM:st.SUPER_EXP_CHARM),n<=150&&!(n%50)&&s.phaseManager.pushNew("ModifierRewardPhase",st.GOLDEN_POKEBALL),i.isEndless&&!(n%50)&&(s.phaseManager.pushNew("ModifierRewardPhase",n%250?st.VOUCHER_PLUS:st.VOUCHER_PREMIUM),s.phaseManager.pushNew("AddEnemyBuffModifierPhase"))}(i.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")}else s.currentBattle.battleType=ue.CLEAR,s.score+=i.getClearScoreBonus(),s.updateScoreText(),s.phaseManager.pushNew("GameOverPhase",!0)}this.end()}};c(vu,"VictoryPhase");let ll=vu;const _u=class _u extends hn{weather;constructor(){super(void 0,void 0,ni.SUNNY+((s?.arena?.weather?.weatherType||es.NONE)-1)),this.weather=s?.arena?.weather}start(){if(this.weather=s?.arena?.weather,!this.weather){this.end();return}if(this.setAnimation(ni.SUNNY+(this.weather.weatherType-1)),this.weather.isDamaging()){const e=new ot(!1);if(this.executeForAll(t=>Oe("SuppressWeatherEffectAbAttr",{pokemon:t,weather:this.weather,cancelled:e})),!e.value){const t=c(i=>{const n=this.weather.weatherType,a=s.getModifiers(Mm).find(o=>o.pokemonId===i.id),r=s.getModifiers(Nm).some(o=>o.pokemonId===i.id);if(!(a||r)&&[es.HAIL,es.SANDSTORM].includes(n)){const o=pf(i.getMaxHp()/16);s.phaseManager.queueMessage(km(this.weather?.weatherType,i)),i.damageAndUpdate(o,$e.EFFECTIVE,!1,!1,!0)}},"inflictDamage");this.executeForAll(i=>{!i||!!i.getTypes(!0,!0).filter(a=>this.weather?.isTypeDamageImmune(a)).length||i.switchOutStatus||t(i)})}}s.ui.showText(wm(this.weather.weatherType)??"",null,()=>{this.executeForAll(e=>{e.switchOutStatus||Oe("PostWeatherLapseAbAttr",{pokemon:e,weather:this.weather})}),super.start()})}};c(_u,"WeatherEffectPhase");let hl=_u;const ur=Object.freeze({ActivatePriorityQueuePhase:ki,AddEnemyBuffModifierPhase:Lr,AttemptCapturePhase:Dr,AttemptRunPhase:Rr,BattleEndPhase:Fr,BerryPhase:Ur,CheckInterludePhase:Vr,CheckStatusEffectPhase:Hr,CheckSwitchPhase:Yr,CommandPhase:Gr,CommonAnimPhase:hn,DamageAnimPhase:Wr,EggHatchPhase:jr,EggLapsePhase:Xr,EggSummaryPhase:qr,EncounterPhase:ua,EndCardPhase:Qr,EndEvolutionPhase:Zr,EnemyCommandPhase:Jr,EvolutionPhase:da,ExpPhase:eo,FaintPhase:to,FormChangePhase:so,GameOverPhase:xT,GameOverModifierRewardPhase:io,HideAbilityPhase:mn,HidePartyExpBarPhase:no,LearnMovePhase:ao,LevelCapPhase:ro,LevelUpPhase:oo,LoadMoveAnimPhase:lo,LoginPhase:ho,MessagePhase:fa,ModifierRewardPhase:dn,MoneyRewardPhase:co,MoveAnimPhase:uo,MoveChargePhase:po,MoveEffectPhase:fo,MoveEndPhase:Lm,MoveHeaderPhase:go,MovePhase:Bm,MysteryEncounterPhase:yo,MysteryEncounterOptionSelectedPhase:To,MysteryEncounterBattlePhase:Co,MysteryEncounterBattleStartCleanupPhase:So,MysteryEncounterRewardsPhase:Eo,PostMysteryEncounterPhase:bo,NewBattlePhase:Io,NewBiomeEncounterPhase:vo,NextEncounterPhase:ga,ObtainStatusEffectPhase:_o,PartyExpPhase:Ao,PartyHealPhase:xo,PokemonAnimPhase:Oo,PokemonHealPhase:wo,PokemonTransformPhase:Mo,PositionalTagPhase:No,PostGameOverPhase:ko,PostSummonPhase:ln,PostTurnStatusEffectPhase:Po,QuietFormChangePhase:Bo,ReloadSessionPhase:Lo,ResetStatusPhase:Do,ReturnPhase:Ro,RevivalBlessingPhase:Fo,RibbonModifierRewardPhase:Uo,ScanIvsPhase:Vo,SelectBiomePhase:Ho,SelectChallengePhase:Yo,SelectGenderPhase:Go,SelectModifierPhase:Pm,SelectStarterPhase:zo,SelectTargetPhase:jo,ShinySparklePhase:$o,ShowAbilityPhase:Sa,ShowPartyExpBarPhase:Xo,ShowTrainerPhase:qo,StatStageChangePhase:Ir,SummonMissingPhase:Qo,SummonPhase:yn,SwitchBiomePhase:Zo,SwitchPhase:Jo,SwitchSummonPhase:ma,TeraPhase:el,TitlePhase:tl,ToggleDoublePositionPhase:sl,TrainerVictoryPhase:il,TurnEndPhase:nl,TurnInitPhase:Ca,TurnStartPhase:al,UnavailablePhase:rl,UnlockPhase:ol,VictoryPhase:ll,WeatherEffectPhase:hl}),Au=class Au{phaseQueue=[];conditionalQueue=[];phaseQueuePrepend=[];phaseQueuePrependSpliceIndex=-1;nextCommandPhaseQueue=[];dynamicPhaseQueues;dynamicPhaseTypes;currentPhase=null;standbyPhase=null;constructor(){this.dynamicPhaseQueues=[new Br],this.dynamicPhaseTypes=[ln]}toTitleScreen(e=!1){this.clearAllPhases(),e&&this.unshiftNew("LoginPhase"),this.unshiftNew("TitlePhase")}getCurrentPhase(){return this.currentPhase}getStandbyPhase(){return this.standbyPhase}pushConditionalPhase(e,t){this.conditionalQueue.push([t,e])}pushPhase(e,t=!1){this.getDynamicPhaseType(e)!==void 0?this.pushDynamicPhase(e):(t?this.nextCommandPhaseQueue:this.phaseQueue).push(e)}unshiftPhase(...e){this.phaseQueuePrependSpliceIndex===-1?this.phaseQueuePrepend.push(...e):this.phaseQueuePrepend.splice(this.phaseQueuePrependSpliceIndex,0,...e)}clearPhaseQueue(){this.phaseQueue.splice(0,this.phaseQueue.length)}clearAllPhases(){for(const e of[this.phaseQueue,this.phaseQueuePrepend,this.conditionalQueue,this.nextCommandPhaseQueue])e.splice(0,e.length);this.dynamicPhaseQueues.forEach(e=>e.clear()),this.standbyPhase=null,this.clearPhaseQueueSplice()}setPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=this.phaseQueuePrepend.length}clearPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=-1}shiftPhase(){if(this.standbyPhase){this.currentPhase=this.standbyPhase,this.standbyPhase=null;return}this.phaseQueuePrependSpliceIndex>-1&&this.clearPhaseQueueSplice(),this.phaseQueue.unshift(...this.phaseQueuePrepend),this.phaseQueuePrepend.splice(0);const e=[];for(const[t,i]of this.conditionalQueue)t()?this.pushPhase(i):e.push([t,i]);this.conditionalQueue=e,this.phaseQueue.length||(this.populatePhaseQueue(),this.conditionalQueue=[]),this.currentPhase=this.phaseQueue.shift()??null,this.currentPhase&&(`${this.currentPhase.constructor.name}`,this.currentPhase.start())}overridePhase(e){return this.standbyPhase?!1:(this.standbyPhase=this.currentPhase,this.currentPhase=e,`${e.constructor.name}`,e.start(),!0)}findPhase(e){return this.phaseQueue.find(e)}tryReplacePhase(e,t){const i=this.phaseQueue.findIndex(e);return i>-1?(this.phaseQueue[i]=t,!0):!1}tryRemovePhase(e){const t=this.phaseQueue.findIndex(e);return t>-1?(this.phaseQueue.splice(t,1),!0):!1}tryRemoveUnshiftedPhase(e){const t=this.phaseQueuePrepend.findIndex(e);return t>-1?(this.phaseQueuePrepend.splice(t,1),!0):!1}prependToPhase(e,t){e=sa(e);const i=ur[t],n=this.phaseQueue.findIndex(a=>a instanceof i);return n!==-1?(this.phaseQueue.splice(n,0,...e),!0):(this.unshiftPhase(...e),!1)}appendToPhase(e,t,i){e=sa(e);const n=ur[t],a=this.phaseQueue.findIndex(r=>r instanceof n&&(!i||i(r)));return a!==-1&&this.phaseQueue.length>a?(this.phaseQueue.splice(a+1,0,...e),!0):(this.unshiftPhase(...e),!1)}getDynamicPhaseType(e){let t;return this.dynamicPhaseTypes.forEach((i,n)=>{e instanceof i&&(t=n)}),t}pushDynamicPhase(e){const t=this.getDynamicPhaseType(e);t!==void 0&&(this.pushPhase(new ki(t)),this.dynamicPhaseQueues[t].push(e))}tryRemoveDynamicPhase(e,t,i=1){const n=this.dynamicPhaseQueues[e].tryRemovePhase(t,i);for(let a=0;a<n;a++)this.tryRemovePhase(r=>r.is("ActivatePriorityQueuePhase"))}startDynamicPhaseType(e){const t=this.dynamicPhaseQueues[e].pop();t&&this.unshiftPhase(t)}startDynamicPhase(e){const t=this.getDynamicPhaseType(e);t!==void 0&&(this.unshiftPhase(new ki(t)),this.dynamicPhaseQueues[t].push(e))}queueMessage(e,t,i,n,a){const r=new fa(e,t,i,n);a?this.pushPhase(r):this.unshiftPhase(r)}queueAbilityDisplay(e,t,i){this.unshiftPhase(i?new Sa(e.getBattlerIndex(),t):new mn)}hideAbilityBar(){s.abilityBar.isVisible()&&this.unshiftPhase(new mn)}populatePhaseQueue(){this.nextCommandPhaseQueue.length&&(this.phaseQueue.push(...this.nextCommandPhaseQueue),this.nextCommandPhaseQueue.splice(0,this.nextCommandPhaseQueue.length)),this.phaseQueue.push(new Ca)}create(e,...t){const i=ur[e];if(!i)throw new Error(`Phase ${e} does not exist in PhaseMap.`);return new i(...t)}pushNew(e,...t){this.pushPhase(this.create(e,...t))}unshiftNew(e,...t){this.unshiftPhase(this.create(e,...t))}prependNewToPhase(e,t,...i){return this.prependToPhase(this.create(t,...i),e)}appendNewToPhase(e,t,...i){return this.appendToPhase(this.create(t,...i),e)}startNewDynamicPhase(e,...t){this.startDynamicPhase(this.create(e,...t))}onInterlude(){const e=["WeatherEffectPhase","BerryPhase","CheckStatusEffectPhase"];this.phaseQueue=this.phaseQueue.filter(i=>!e.includes(i.phaseName));const t=this.findPhase(i=>i.phaseName==="TurnEndPhase");t&&(t.upcomingInterlude=!0)}};c(Au,"PhaseManager");let cl=Au;const wT=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform vec3 terrainColor;
uniform float terrainColorRatio;

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;

	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);

		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;

	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;

		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);

		float f1 = 2.0 * hsl.z - f2;

		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}

	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

void main() {
	vec4 texture;

	%forloop%

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color = vec4(blendHardLight(color.rgb, dayNightTint), color.a);
	}

	if (terrainColorRatio > 0.0 && (1.0 - terrainColorRatio) < outTexCoord.y) {
		if (color.a > 0.0 && (terrainColor.r > 0.0 || terrainColor.g > 0.0 || terrainColor.b > 0.0)) {
			color.rgb = mix(color.rgb, blendHue(color.rgb, terrainColor), 1.0);
		}
	}

	gl_FragColor = color;
}`,Vf=`precision mediump float;

uniform mat4 uProjectionMatrix;
uniform int uRoundPixels;
uniform vec2 uResolution;

attribute vec2 inPosition;
attribute vec2 inTexCoord;
attribute float inTexId;
attribute float inTintEffect;
attribute vec4 inTint;

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

void main()
{
	gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);
	if (uRoundPixels == 1)
	{
		gl_Position.xy = floor(((gl_Position.xy + 1.0) * 0.5 * uResolution) + 0.5) / uResolution * 2.0 - 1.0;
	}
	outTexCoord = inTexCoord;
	outTexId = inTexId;
	outPosition = inPosition;
	outTint = inTint;
	outTintEffect = inTintEffect;
}`,xu=class xu extends rs.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e,t){super(t||{game:e,name:"field-sprite",fragShader:wT,vertShader:Vf})}onPreRender(){this.set1f("time",0),this.set1i("ignoreTimeTint",0),this.set1f("terrainColorRatio",0),this.set3fv("terrainColor",[0,0,0])}onBind(e){super.onBind();const i=e.pipelineData,n=i.ignoreTimeTint,a=i.terrainColorRatio||0,r=s.currentBattle?.waveIndex?(s.currentBattle.waveIndex+s.waveCycleOffset)%40/40:Dm();this.set1f("time",r),this.set1i("ignoreTimeTint",n?1:0),this.set1i("isOutside",s.arena.isOutside()?1:0),this.set3fv("dayTint",s.arena.getDayTint().map(o=>o/255)),this.set3fv("duskTint",s.arena.getDuskTint().map(o=>o/255)),this.set3fv("nightTint",s.arena.getNightTint().map(o=>o/255)),this.set3fv("terrainColor",Rm(s.arena.terrain?.terrainType||us.NONE).map(o=>o/255)),this.set1f("terrainColorRatio",a)}onBatch(e){e&&this.flush()}};c(xu,"FieldSpritePipeline");let Ea=xu;const MT=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform float teraTime;
uniform vec3 teraColor;
uniform int hasShadow;
uniform int yCenter;
uniform float fieldScale;
uniform float vCutoff;
uniform vec2 relPosition;
uniform vec2 texFrameUv;
uniform vec2 size;
uniform vec2 texSize;
uniform float yOffset;
uniform float yShadowOffset;
uniform vec4 tone;
uniform vec4 baseVariantColors[32];
uniform vec4 variantColors[32];
uniform vec4 spriteColors[32];
uniform ivec4 fusionSpriteColors[32];

const vec3 lumaF = vec3(.299, .587, .114);

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);

		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;

	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;

		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);

		float f1 = 2.0 * hsl.z - f2;

		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b= hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}

	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

vec3 rgb2hsv(vec3 c) {
	vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
	vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
	vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

	float d = q.x - min(q.w, q.y);
	float e = 1.0e-10;
	return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
	vec4 texture = texture2D(uMainSampler[0], outTexCoord);

	for (int i = 0; i < 32; i++) {
		if (baseVariantColors[i].a == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - baseVariantColors[i].rgb), vec3(0.5/255.0)))) {
			texture.rgb = variantColors[i].rgb;
			break;
		}
	}

	for (int i = 0; i < 32; i++) {
		if (spriteColors[i][3] == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - spriteColors[i].rgb), vec3(0.5/255.0)))) {
			vec3 fusionColor = vec3(fusionSpriteColors[i].rgb) / 255.0;
			vec3 bg = spriteColors[i].rgb;
			float gray = (bg.r + bg.g + bg.b) / 3.0;
			bg = vec3(gray);
			vec3 fg = fusionColor;
			texture.rgb = mix(1.0 - 2.0 * (1.0 - bg) * (1.0 - fg), 2.0 * bg * fg, step(bg, vec3(0.5)));
			break;
		}
	}

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (color.a > 0.0 && teraColor.r > 0.0 && teraColor.g > 0.0 && teraColor.b > 0.0) {
		vec2 relUv = (outTexCoord.xy - texFrameUv.xy) / (size.xy / texSize.xy);
		vec2 teraTexCoord = vec2(relUv.x * (size.x / 200.0), relUv.y * (size.y / 120.0));
		vec4 teraCol = texture2D(uMainSampler[1], teraTexCoord);
		float floorValue = 86.0 / 255.0;
		vec3 teraPatternHsv = rgb2hsv(teraCol.rgb);
		teraCol.rgb = hsv2rgb(vec3((teraPatternHsv.b - floorValue) * 4.0 + teraTexCoord.x * fieldScale / 2.0 + teraTexCoord.y * fieldScale / 2.0 + teraTime * 255.0, teraPatternHsv.b, teraPatternHsv.b));

		color.rgb = mix(color.rgb, blendHue(color.rgb, teraColor), 0.625);
		teraCol.rgb = mix(teraCol.rgb, teraColor, 0.5);
		color.rgb = blendOverlay(color.rgb, teraCol.rgb);

		if (any(lessThan(teraCol.rgb, vec3(1.0)))) {
			vec3 teraColHsv = rgb2hsv(teraColor);
			color.rgb = mix(color.rgb, teraColor, (1.0 - teraColHsv.g) / 2.0);
		}
	}

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply gray */
	float luma = dot(color.rgb, lumaF);
	color.rgb = mix(color.rgb, vec3(luma), tone.w);

	/* Apply tone */
	color.rgb += tone.rgb * (color.a / 255.0);

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color.rgb = blendHardLight(color.rgb, dayNightTint);
	}

	if (hasShadow == 1) {
		float width = size.x - (yOffset / 2.0);

		float spriteX = ((floor(outPosition.x / fieldScale) - relPosition.x) / width) + 0.5;
		float spriteY = ((floor(outPosition.y / fieldScale) - relPosition.y - yShadowOffset) / size.y);

		if (yCenter == 1) {
			spriteY += 0.5;
		} else {
			spriteY += 1.0;
		}

		bool yOverflow = outTexCoord.y >= vCutoff;

		if ((spriteY >= 0.9 && (color.a == 0.0 || yOverflow))) {
			float shadowSpriteY = (spriteY - 0.9) * (1.0 / 0.15);
			if (distance(vec2(spriteX, shadowSpriteY), vec2(0.5)) < 0.5) {
				color = vec4(vec3(0.0), 0.5);
			} else if (yOverflow) {
				discard;
			}
		} else if (yOverflow) {
			discard;
		}
	}

	gl_FragColor = color;
}`,Ou=class Ou extends Ea{_tone;constructor(e){super(e,{game:e,name:"sprite",fragShader:MT,vertShader:Vf}),this._tone=[0,0,0,0]}onPreRender(){super.onPreRender(),this.set1f("teraTime",0),this.set3fv("teraColor",[0,0,0]),this.set1i("hasShadow",0),this.set1i("yCenter",0),this.set2f("relPosition",0,0),this.set2f("texFrameUv",0,0),this.set2f("size",0,0),this.set2f("texSize",0,0),this.set1f("yOffset",0),this.set1f("yShadowOffset",0),this.set4fv("tone",this._tone)}onBind(e){super.onBind(e);const t=e,i=t.pipelineData,n=i.tone,a=i.isTerastallized?i.teraColor??[0,0,0]:[0,0,0],r=i.hasShadow,o=i.yShadowOffset,l=i.ignoreFieldPos,h=i.ignoreOverride,u=t.parentContainer instanceof Ys||t.parentContainer instanceof Zt||t.parentContainer instanceof op,p=u?t.parentContainer.parentContainer:t.parentContainer,f=u?[t.parentContainer.x,t.parentContainer.y]:[t.x,t.y];if(p&&(f[0]+=p.x/p.scale,f[1]+=p.y/p.scale),f[0]+=-(t.width-t.frame.width)/2+t.frame.x+(l?0:t.x-p.x),t.originY===.5&&(f[1]+=t.height/2*((u?t.parentContainer:t).scale-1)+(l?0:t.y-p.y)),this.set1f("teraTime",this.game.getTime()%5e5/5e5),this.set3fv("teraColor",a.map(d=>d/255)),this.set1i("hasShadow",r?1:0),this.set1i("yCenter",t.originY===.5?1:0),this.set1f("fieldScale",p?.scale||1),this.set2f("relPosition",f[0],f[1]),this.set2f("texFrameUv",t.frame.u0,t.frame.v0),this.set2f("size",t.frame.width,t.height),this.set2f("texSize",t.texture.source[0].width,t.texture.source[0].height),this.set1f("yOffset",t.height-t.frame.height*(u?t.parentContainer.scale:t.scale)),this.set1f("yShadowOffset",o??0),this.set4fv("tone",n),this.bindTexture(this.game.textures.get("tera").source[0].glTexture,1),s.fusionPaletteSwaps){const d=h&&i.spriteColorsBase||i.spriteColors||[],y=h&&i.fusionSpriteColorsBase||i.fusionSpriteColors||[],g=[0,0,0,0],T=[],E=[];for(let b=0;b<32;b++)T.splice(T.length,0,...b<d.length?d[b].map(_=>_/255):g),E.splice(E.length,0,...b<y.length?y[b]:g);this.set4fv("spriteColors",T.flat()),this.set4iv("fusionSpriteColors",E.flat())}}onBatch(e){if(e){const t=e,i=t.pipelineData,n=i.hasOwnProperty("variant")?i.variant:t.parentContainer instanceof Ys?t.parentContainer.variant:0;let a;const r=[0,0,0,0],o=[],l=[];if((t.parentContainer instanceof Ys?t.parentContainer.shiny:i.shiny)&&(a=Fm[t.parentContainer instanceof Ys?t.parentContainer.getSprite().texture.key:i.spriteKey])&&a.hasOwnProperty(n)){const h=Object.keys(a[n]);for(let u=0;u<32;u++)if(u<h.length){const p=Array.from(Object.values(Gt(h[u]))),f=Array.from(Object.values(Gt(a[n][h[u]])));o.splice(o.length,0,...p.map(d=>d/255)),l.splice(l.length,0,...f.map(d=>d/255))}else o.splice(o.length,0,...r),l.splice(l.length,0,...r)}else for(let h=0;h<32;h++)o.splice(o.length,0,...r),l.splice(l.length,0,...r);this.set4fv("baseVariantColors",o.flat()),this.set4fv("variantColors",l.flat())}super.onBatch(e)}batchQuad(e,t,i,n,a,r,o,l,h,u,p,f,d,y,g,T,E,b,_,O){const w=e;this.set1f("vCutoff",d);const U=w.pipelineData.hasShadow,B=w.pipelineData.yShadowOffset??0;if(U){const K=w.parentContainer instanceof Ys||w.parentContainer instanceof Zt||w.parentContainer instanceof op,V=K?w.parentContainer.parentContainer:w.parentContainer,te=V.scale/6,de=(K?w.parentContainer.y:w.y+w.height)*6/te,k=Math.ceil(w.height*.05+Math.max(B,0))*6/te,j=(de-a)/V.scale;o=a=de+k;const I=(d-p)/(w.frame.height*(K?w.parentContainer.scale:w.scale));d+=(j+k/V.scale)*I}return super.batchQuad(e,t,i,n,a,r,o,l,h,u,p,f,d,y,g,T,E,b,_,O)}get tone(){return this._tone}set tone(e){this._tone=e}};c(Ou,"SpritePipeline");let ul=Ou;var bt=(C=>(C[C.UNLOCKED=1]="UNLOCKED",C[C.ENABLED=2]="ENABLED",C))(bt||{});const _p=120,Us=8,NT=["HP","ATK","DEF","SPATK","SPDEF","SPD"],Fa=class Fa extends Phaser.GameObjects.Container{active=!1;statsLabels=[];statsRectangles=[];statsShadows=[];statsTotalLabel;statsBg;scale;width;constructor(e){super(s,e?.x,e?.y),this.scale=e?.scale||1,this.setScale(this.scale),this.width=(e?.width||Fa.getWidth(this.scale))/this.scale,this.statsBg=ye(0,0,this.width,_p),this.statsBg.setOrigin(0,0),this.add(this.statsBg);for(let t=0;t<6;t++){const i=s.add.rectangle(this.width-Us+1,Us+3+t*15,100,5,26720);i.setOrigin(1,0),this.statsShadows.push(i),this.add(i);const n=s.add.rectangle(this.width-Us,Us+2+t*15,100,5,6728345);n.setOrigin(1,0),this.statsRectangles.push(n),this.add(n);const a=P(Us,Us-2+t*15,"A",A.BATTLE_INFO);this.statsLabels.push(a),this.add(a)}this.statsTotalLabel=P(Us,Us+90,"A",A.MONEY_WINDOW),this.add(this.statsTotalLabel),this.setVisible(!1)}show(e,t){for(let i=0;i<6;i++)this.statsLabels[i].setText(m.t(`pokemonInfo:stat.${Tt(NT[i])}Shortened`)+`: ${e[i]}`),this.statsShadows[i].setSize(e[i]/2,5),this.statsRectangles[i].setSize(e[i]/2,5);return this.statsTotalLabel.setText(m.t("pokedexUiHandler:baseTotal")+`: ${t}`),this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.statsLabels,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return s.scaledCanvas.width/2}static getHeight(e,t){return _p*e}};c(Fa,"BaseStatsOverlay");let dl=Fa;const dr=48,Kt=8,kT=6,Ua=class Ua extends Phaser.GameObjects.Container{active=!1;desc;descScroll=null;descBg;options;textMaskRect;maskPointOriginX;maskPointOriginY;width;constructor(e){super(s,e?.x,e?.y),this.setScale(1),this.options=e||{},this.width=e?.width||Ua.getWidth(),this.descBg=ye(0,0,this.width,dr),this.descBg.setOrigin(0,0),this.add(this.descBg),this.desc=P(Kt,Kt-2,"",A.BATTLE_INFO,{wordWrap:{width:(this.width-(Kt-2)*2)*kT}}),this.maskPointOriginX=e?.x||0,this.maskPointOriginY=e?.y||0,this.maskPointOriginX<0&&(this.maskPointOriginX+=s.scaledCanvas.width),this.maskPointOriginY<0&&(this.maskPointOriginY+=s.scaledCanvas.height),this.textMaskRect=s.make.graphics(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Kt,this.maskPointOriginY+(Kt-2),this.width-Kt*2,dr-(Kt-2)*2),this.textMaskRect.setScale(6);const t=this.createGeometryMask(this.textMaskRect);this.add(this.desc),this.desc.setMask(t),e?.hideBg&&this.descBg.setVisible(!1),this.setVisible(!1)}show(e){if(!s.enableMoveInfo)return!1;this.desc.setText(e??""),this.descScroll&&(this.descScroll.remove(),this.descScroll=null,this.desc.y=Kt-2);const t=Math.floor(this.desc.displayHeight*(96/72)/14.83),i=t>=3?48:t===2?36:24;this.textMaskRect.clear(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Kt,this.maskPointOriginY+(Kt-2)+(48-i),this.width-Kt*2,i-(Kt-2)*2);const n=this.createGeometryMask(this.textMaskRect);return this.desc.setMask(n),this.descBg.setSize(this.descBg.width,i),this.descBg.setY(48-i),this.desc.setY(Kt-2+(48-i)),t>3&&(this.descScroll=s.tweens.add({targets:this.desc,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((t-3)*2e3),y:`-=${14.83*(72/96)*(t-3)}`})),this.options.delayVisibility||this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.desc,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(){return s.scaledCanvas.width/2}static getHeight(){return dr}};c(Ua,"PokedexInfoOverlay");let ba=Ua;const Ap={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"54px",instructionTextSize:"35px",starterInfoXPos:35},"es-ES":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},"es-MX":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"pt-BR":{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:33},zh:{starterInfoTextSize:"56px",instructionTextSize:"36px",starterInfoXPos:26},ko:{starterInfoTextSize:"60px",instructionTextSize:"38px",starterInfoYOffset:-.5,starterInfoXPos:30},ja:{starterInfoTextSize:"48px",instructionTextSize:"40px",starterInfoYOffset:1,starterInfoXPos:32},ca:{starterInfoTextSize:"48px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:29},da:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tr:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ro:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ru:{starterInfoTextSize:"46px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:26}},xp=2,PT=109;var ji=(C=>(C[C.BASE_STATS=0]="BASE_STATS",C[C.ABILITIES=1]="ABILITIES",C[C.LEVEL_MOVES=2]="LEVEL_MOVES",C[C.EGG_MOVES=3]="EGG_MOVES",C[C.TM_MOVES=4]="TM_MOVES",C[C.BIOMES=5]="BIOMES",C[C.NATURES=6]="NATURES",C[C.TOGGLE_IVS=7]="TOGGLE_IVS",C[C.EVOLUTIONS=8]="EVOLUTIONS",C))(ji||{});const wu=class wu extends Bt{starterSelectContainer;shinyOverlay;pokemonNumberText;pokemonSprite;pokemonNameText;pokemonGrowthRateLabelText;pokemonGrowthRateText;type1Icon;type2Icon;pokemonLuckLabelText;pokemonLuckText;pokemonGenderText;pokemonUncaughtText;pokemonCandyContainer;pokemonCandyIcon;pokemonCandyDarknessOverlay;pokemonCandyOverlayIcon;pokemonCandyCountText;pokemonCaughtHatchedContainer;pokemonCaughtCountText;pokemonFormText;pokemonCategoryText;pokemonHatchedIcon;pokemonHatchedCountText;pokemonShinyIcons;activeTooltip;instructionsContainer;filterInstructionsContainer;shinyIconElement;formIconElement;genderIconElement;variantIconElement;shinyLabel;formLabel;genderLabel;variantLabel;candyUpgradeIconElement;candyUpgradeLabel;showBackSpriteIconElement;showBackSpriteLabel;starterSelectMessageBox;starterSelectMessageBoxContainer;statsContainer;moveInfoOverlay;infoOverlay;baseStatsOverlay;statsMode;allSpecies=[];species;starterId;formIndex;speciesLoaded=new Map;levelMoves;eggMoves=[];hasEggMoves=[];tmMoves=[];ability1;ability2;abilityHidden;passive;hasPassive;hasAbilities;biomes;preBiomes;baseStats;baseTotal;evolutions;battleForms;prevolutions;speciesStarterDexEntry;canCycleShiny;canCycleForm;canCycleGender;assetLoadCancelled;cursorObj;instructionRowX=0;instructionRowY=0;instructionRowTextOffset=9;filterInstructionRowX=0;filterInstructionRowY=0;starterAttributes;savedStarterAttributes;previousSpecies;previousStarterAttributes;blockInput=!1;blockInputOverlay=!1;showBackSprite=!1;menuContainer;menuBg;optionSelectText;menuOptions;scale=.1666666667;menuDescriptions;isFormGender;filteredIndices=null;availableVariants;unlockedVariants;canUseCandies;exitCallback;constructor(){super(x.POKEDEX_PAGE)}setup(){const e=this.getUi(),t=m.resolvedLanguage??"en",i=Object.keys(Ap).find(u=>t.includes(u))??"en",n=Ap[i];this.starterSelectContainer=s.add.container(0,-s.scaledCanvas.height),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=s.add.image(0,0,"pokedex_summary_bg");r.setOrigin(0,0),this.starterSelectContainer.add(r),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.shinyOverlay=s.add.image(6,6,"summary_overlay_shiny"),this.shinyOverlay.setOrigin(0,0),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay),this.pokemonNumberText=P(17,1,"0000",A.SUMMARY_DEX_NUM),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=P(6,112,"",A.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=P(8,106,m.t("pokedexUiHandler:growthRate"),A.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=P(34,106,"",A.GROWTH_RATE_TYPE,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=P(96,112,"",A.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=P(6,127,m.t("pokedexUiHandler:uncaught"),A.WINDOW,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const o=s.add.container(PT+6,9);for(const u of it)!ze.hasOwnProperty(u.speciesId)||!u.isObtainable()||(this.speciesLoaded.set(u.speciesId,!1),this.allSpecies.push(u));this.starterSelectContainer.add(o),this.type1Icon=s.add.sprite(8,98,Ns("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(26,98,Ns("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=P(8,89,m.t("common:luckIndicator"),A.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=P(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",A.LUCK_VALUE,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=s.add.container(4.5,18),this.pokemonCandyIcon=s.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=P(9.5,0,"x0",A.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=P(6,42,"Form",A.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCategoryText=P(100,18,"Category",A.WINDOW_ALT,{fontSize:"42px"}),this.pokemonCategoryText.setOrigin(1,0),this.starterSelectContainer.add(this.pokemonCategoryText),this.pokemonCaughtHatchedContainer=s.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const l=s.add.sprite(1,0,"items","pb");l.setOrigin(0,0),l.setScale(.75),this.pokemonCaughtHatchedContainer.add(l),this.pokemonCaughtCountText=P(24,4,"0",A.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcons=[];for(let u=0;u<3;u++){const p=s.add.sprite(153+u*13,160,"shiny_icons");p.setOrigin(.15,.2),p.setScale(1),p.setFrame(Qt(u)),p.setVisible(!1),this.pokemonCaughtHatchedContainer.add(p),this.pokemonShinyIcons.push(p)}this.pokemonHatchedCountText=P(24,19,"0",A.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText);const h=n.instructionTextSize;this.instructionsContainer=s.add.container(4,128),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.candyUpgradeIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","C.png"),this.candyUpgradeIconElement.setName("sprite-candyUpgrade-icon-element"),this.candyUpgradeIconElement.setScale(.675),this.candyUpgradeIconElement.setOrigin(0,0),this.candyUpgradeLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,m.t("pokedexUiHandler:candyUpgrade"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.candyUpgradeLabel.setName("text-candyUpgrade-label"),this.shinyIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,m.t("pokedexUiHandler:cycleShiny"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,m.t("pokedexUiHandler:cycleForm"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,m.t("pokedexUiHandler:cycleGender"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.genderLabel.setName("text-gender-label"),this.variantIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.variantIconElement.setName("sprite-variant-icon-element"),this.variantIconElement.setScale(.675),this.variantIconElement.setOrigin(0,0),this.variantLabel=P(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,m.t("pokedexUiHandler:cycleVariant"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.variantLabel.setName("text-variant-label"),this.showBackSpriteIconElement=new Phaser.GameObjects.Sprite(s,50,7,"keyboard","E.png"),this.showBackSpriteIconElement.setName("show-backSprite-icon-element"),this.showBackSpriteIconElement.setScale(.675),this.showBackSpriteIconElement.setOrigin(0,0),this.showBackSpriteLabel=P(60,7,m.t("pokedexUiHandler:showBackSprite"),A.INSTRUCTIONS_TEXT,{fontSize:h}),this.showBackSpriteLabel.setName("show-backSprite-label"),this.starterSelectContainer.add(this.showBackSpriteIconElement),this.starterSelectContainer.add(this.showBackSpriteLabel),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=ye(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=P(8,8,"",A.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new cn(6,16),s.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer),this.menuContainer=s.add.container(-130,0),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.menuContainer.setVisible(!1),this.menuOptions=Is(ji),this.optionSelectText=St(0,0,this.menuOptions.map(u=>`${m.t(`pokedexUiHandler:${Tt(`menu${ji[u]}`)}`)}`).join(`
`),A.WINDOW,{maxLines:this.menuOptions.length,lineSpacing:12}),this.menuDescriptions=[m.t("pokedexUiHandler:showBaseStats"),m.t("pokedexUiHandler:showAbilities"),m.t("pokedexUiHandler:showLevelMoves"),m.t("pokedexUiHandler:showEggMoves"),m.t("pokedexUiHandler:showTmMoves"),m.t("pokedexUiHandler:showBiomes"),m.t("pokedexUiHandler:showNatures"),m.t("pokedexUiHandler:toggleIVs"),m.t("pokedexUiHandler:showEvolutions")],this.scale=gh(A.WINDOW,s.uiTheme).scale,this.menuBg=ye(s.scaledCanvas.width-83,0,this.optionSelectText.displayWidth+19+24*this.scale,s.scaledCanvas.height-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPosition(this.menuBg.x+10+24*this.scale,this.menuBg.y+6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.starterSelectContainer.add(this.menuContainer),this.baseStatsOverlay=new dl({x:317,y:0,width:133}),this.menuContainer.add(this.baseStatsOverlay),this.menuContainer.bringToTop(this.baseStatsOverlay),this.moveInfoOverlay=new ia({top:!0,x:1,y:s.scaledCanvas.height-ia.getHeight()-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.infoOverlay=new ba({x:1,y:s.scaledCanvas.height-ba.getHeight()-29}),this.starterSelectContainer.add(this.infoOverlay),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.previousSpecies=[],this.previousStarterAttributes=[]}show(e){return this.canUseCandies=["TitlePhase","SelectStarterPhase","CommandPhase"].includes(s.phaseManager.getCurrentPhase()?.phaseName??""),e.length>=1&&e[0]==="refresh"?!1:(this.species=e[0],this.savedStarterAttributes=e[1]??{shiny:!1,female:!0,variant:0,form:0},this.formIndex=this.savedStarterAttributes.form??0,this.filteredIndices=e[2]??null,this.starterSetup(),e[4]instanceof Function&&(this.exitCallback=e[4]),this.moveInfoOverlay.clear(),this.infoOverlay.clear(),super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.starterAttributes=this.initStarterPrefs(),this.menuOptions=Is(ji),this.menuContainer.setVisible(!0),this.speciesStarterDexEntry=this.species?s.gameData.dexData[this.species.speciesId]:null,this.setSpecies(),this.updateInstructions(),this.optionSelectText.setText(this.getMenuText()),this.setCursor(0),!0)}getMenuText(){const e=this.isSeen(),t=!!this.isCaught(this.getStarterSpecies(this.species));return this.menuOptions.map(i=>{const n=m.t(`pokedexUiHandler:${Tt(`menu${ji[i]}`)}`),a=!e||!t&&(i===7||i===6)||this.tmMoves.length<1&&i===4,r=He(a?A.SHADOW_TEXT:A.SETTINGS_VALUE,!1,s.uiTheme);return`[shadow=${He(a?A.SHADOW_TEXT:A.SETTINGS_VALUE,!0,s.uiTheme)}][color=${r}]${n}[/color][/shadow]`}).join(`
`)}starterSetup(){this.evolutions=[],this.prevolutions=[],this.battleForms=[];const e=this.species;let t=this.species?.forms.length>0?this.species.forms[this.formIndex].formKey:"";this.isFormGender=t==="male"||t==="female",this.isFormGender&&(this.savedStarterAttributes.female===!0&&t==="male"||this.savedStarterAttributes.female===!1&&t==="female")&&(this.formIndex=(this.formIndex+1)%2,t=this.species.forms[this.formIndex].formKey);const i=this.formIndex??0;this.starterId=this.getStarterSpeciesId(this.species.speciesId);const n=Wi.hasOwnProperty(e.speciesId)?Wi[e.speciesId]:[];if(e.forms.length>0){const g=e.forms[i];this.levelMoves=i>0&&Zs.hasOwnProperty(e.speciesId)&&Zs[e.speciesId].hasOwnProperty(i)?Zs[e.speciesId][i]:vr[e.speciesId],this.ability1=g.ability1,this.ability2=g.ability2===g.ability1?void 0:g.ability2,this.abilityHidden=g.abilityHidden===g.ability1?void 0:g.abilityHidden,this.evolutions=n.filter(T=>T.preFormKey===g.formKey||T.preFormKey===null),this.baseStats=g.baseStats,this.baseTotal=g.baseTotal}else this.levelMoves=vr[e.speciesId],this.ability1=e.ability1,this.ability2=e.ability2===e.ability1?void 0:e.ability2,this.abilityHidden=e.abilityHidden===e.ability1?void 0:e.abilityHidden,this.evolutions=n,this.baseStats=e.baseStats,this.baseTotal=e.baseTotal;this.eggMoves=Lt[this.starterId]??[],this.hasEggMoves=Array.from({length:4},(g,T)=>(s.gameData.starterData[this.starterId].eggMoves&1<<T)!==0),this.tmMoves=Ef[e.speciesId]?.filter(g=>Array.isArray(g)?g[0]===t:!0).map(g=>Array.isArray(g)?g[1]:g).sort((g,T)=>Fe[g].name>Fe[T].name?1:-1)??[];const a=sr.hasOwnProperty(e.speciesId)?e.speciesId:sr.hasOwnProperty(this.starterId)?this.starterId:wt[this.starterId],r=sr[a];this.passive=this.formIndex in r?r[i]:r[0];const o=s.gameData.starterData[this.starterId],l=o.abilityAttr;this.hasPassive=o.passiveAttr>0;const h=l&rt.ABILITY_1,u=l&rt.ABILITY_2,p=l&rt.ABILITY_HIDDEN;this.hasAbilities=[h,u,p];const f=na[e.speciesId]??[];this.preBiomes=this.sanitizeBiomes((na[this.starterId]??[]).filter(g=>!f.some(T=>g.biome===T.biome&&g.tier===T.tier)&&g.biome!==Je.TOWN),this.starterId),this.biomes=this.sanitizeBiomes(f,e.speciesId);const d=ai.hasOwnProperty(e.speciesId)?ai[e.speciesId]:[];this.battleForms=d.filter(g=>g.preFormKey===this.species.forms[this.formIndex].formKey);const y=wt.hasOwnProperty(this.species.speciesId)?it.find(g=>g.speciesId===wt[this.species.speciesId]):null;if(y){const g=Wi.hasOwnProperty(y.speciesId)?Wi[y.speciesId]:[];this.prevolutions=g.filter(T=>T.speciesId===e.speciesId&&((T.evoFormKey===""||T.evoFormKey===null)&&(y.forms.some(E=>E.formKey===e.forms[i]?.formKey)||y.forms.length>0&&e.forms.length===0||y.forms.length===0&&(e.forms.length===0||e.forms[i]?.formKey===""))||T.evoFormKey===e.forms[i]?.formKey))}this.availableVariants=e.getFullUnlocksData()&F.VARIANT_3?3:1}sanitizeBiomes(e,t){return t===pe.BURMY||t===pe.WORMADAM?e.filter(i=>{const n=(()=>{switch(i.biome){case Je.BEACH:return 1;case Je.SLUM:return 2;default:return 0}})();return this.formIndex===n}):t===pe.ROTOM?e.filter(i=>{const n=(()=>{switch(i.biome){case Je.VOLCANO:return 1;case Je.SEA:return 2;case Je.ICE_CAVE:return 3;case Je.MOUNTAIN:return 4;case Je.TALL_GRASS:return 5;default:return 0}})();return this.formIndex===n}):t===pe.LYCANROC?e.filter(i=>{const n=(()=>{switch(i.tod[0]){case Jt.DAY:case Jt.DAWN:return 0;case Jt.DUSK:return 2;case Jt.NIGHT:return 1;default:return 0}})();return this.formIndex===n}):e}isCaught(e){const t=e||this.species;return s.dexForDevs&&t.getFullUnlocksData(),(s.gameData.dexData[t.speciesId]?.caughtAttr??0n)&t.getFullUnlocksData()}isFormCaught(e,t){if(s.dexForDevs)return!0;const i=e||this.species,n=t!==void 0?t:this.formIndex,a=this.isCaught(i);return a&&(!i.forms.length||i.forms.length===1)?!0:(a&s.gameData.getFormAttr(n??0))>0n}isSeen(){return this.speciesStarterDexEntry?.seenAttr?!0:!!this.isCaught(this.getStarterSpecies(this.species))}initStarterPrefs(){const e=this.species?{...this.savedStarterAttributes}:null,t=this.isCaught();if(!e||!this.isSeen())return{};const i=t&F.SHINY,n=t&F.NON_SHINY;if(!i||e.shiny===void 0&&n?(e.shiny=!1,e.variant=0):(!n||e.shiny===void 0&&i)&&(e.shiny=!0,e.variant=0),this.unlockedVariants=[!!(i&&t&F.DEFAULT_VARIANT),!!(i&&t&F.VARIANT_2),!!(i&&t&F.VARIANT_3)],e.variant===void 0||Number.isNaN(e.variant)||e.variant<0)e.variant=0;else if(!this.unlockedVariants[e.variant]){let a=-1;for(let r=0;r<=e.variant&&r<this.unlockedVariants.length;r++)this.unlockedVariants[r]&&(a=r);e.variant=a!==-1?a:0}return e.female!==void 0?(e.female&&!(t&F.FEMALE)||!e.female&&!(t&F.MALE))&&(e.female=!e.female):t&F.FEMALE?e.female=!0:t&F.MALE&&(e.female=!1),e}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!e?.length)}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return e===pe.PIKACHU?[0,1,8].includes(this.formIndex)?pe.PICHU:pe.PIKACHU:ze.hasOwnProperty(e)?e:_r[e]}getStarterSpecies(e){return ze.hasOwnProperty(e.speciesId)?e:it.find(t=>t.speciesId===_r[e.speciesId])??e}processInput(e){if(this.blockInput)return!1;const t=this.getUi();let i=!1,n=!1;const a=this.isCaught(),r=this.isFormCaught(),o=this.isSeen(),l=!!this.isCaught(this.getStarterSpecies(this.species));if(this.blockInputOverlay){if(e===v.CANCEL||e===v.ACTION)return this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText(""),!0;if(e===v.UP||e===v.DOWN)this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText("");else return!1}if(e===v.SUBMIT)i=!0;else if(e===v.CANCEL)this.statsMode?(this.toggleStatsMode(!1),i=!0):this.previousSpecies.length>0?(this.blockInput=!0,t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{const h=this.previousSpecies.pop(),u=this.previousStarterAttributes.pop();this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,h,u),i=!0}),this.blockInput=!1):(t.revertMode().then(()=>{if(this.exitCallback instanceof Function){const h=this.exitCallback;this.exitCallback=null,h()}}),i=!0);else{const h=s.gameData.starterData[this.starterId],u=this.starterAttributes;if(e===v.ACTION)switch(this.cursor){case 0:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(m.t("pokedexUiHandler:showBaseStats"),null,()=>(this.baseStatsOverlay.show(this.baseStats,this.baseTotal),this.blockInput=!1,this.blockInputOverlay=!0,!0)),i=!0})):n=!0;break;case 2:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(m.t("pokedexUiHandler:showLevelMoves"),null,()=>{this.moveInfoOverlay.show(Fe[this.levelMoves[0][1]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:this.levelMoves.map(p=>({label:(p[0]>0?String(p[0]):"").padEnd(4," ")+Fe[p[1]].name,handler:c(()=>!1,"handler"),onHover:c(()=>{this.moveInfoOverlay.show(Fe[p[1]]),p[0]===0?this.showText(m.t("pokedexUiHandler:onlyEvolutionMove")):p[0]===-1?this.showText(m.t("pokedexUiHandler:onlyRecallMove")):p[0]<=5?this.showText(m.t("pokedexUiHandler:onStarterSelectMove")):this.showText(m.t("pokedexUiHandler:byLevelUpMove"))},"onHover")})).concat({label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 3:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{if(this.eggMoves.length===0)return t.showText(m.t("pokedexUiHandler:noEggMoves")),this.blockInput=!1,!0;t.showText(m.t("pokedexUiHandler:showEggMoves"),null,()=>{this.moveInfoOverlay.show(Fe[this.eggMoves[0]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:[{label:m.t("pokedexUiHandler:common"),skip:!0,style:A.MONEY_WINDOW,handler:c(()=>!1,"handler"),onHover:c(()=>this.moveInfoOverlay.clear(),"onHover")},...this.eggMoves.slice(0,3).map((p,f)=>({label:Fe[p].name,style:this.hasEggMoves[f]?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.moveInfoOverlay.show(Fe[p]),"onHover")})),{label:m.t("pokedexUiHandler:rare"),skip:!0,style:A.MONEY_WINDOW,handler:c(()=>!1,"handler"),onHover:c(()=>this.moveInfoOverlay.clear(),"onHover")},{label:Fe[this.eggMoves[3]].name,style:this.hasEggMoves[3]?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.moveInfoOverlay.show(Fe[this.eggMoves[3]]),"onHover")},{label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>this.moveInfoOverlay.clear(),"onHover")}],supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 4:o?this.tmMoves.length<1?(t.showText(m.t("pokedexUiHandler:noTmMoves")),n=!0):(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(m.t("pokedexUiHandler:showTmMoves"),null,()=>{this.moveInfoOverlay.show(Fe[this.tmMoves[0]]),t.setModeWithoutClear(x.OPTION_SELECT,{options:this.tmMoves.map(p=>({label:Fe[p].name,handler:c(()=>!1,"handler"),onHover:c(()=>{this.moveInfoOverlay.show(Fe[p])},"onHover")})).concat({label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 1:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(m.t("pokedexUiHandler:showAbilities"),null,()=>{this.infoOverlay.show(Et[this.ability1].description);const p=[];if(this.ability1&&p.push({label:Et[this.ability1].name,style:this.hasAbilities[0]>0?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.show(Et[this.ability1].description),"onHover")}),this.ability2){const f=Et[this.ability2];p.push({label:f?.name,style:this.hasAbilities[1]>0?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.show(f?.description),"onHover")})}if(this.abilityHidden){p.push({label:m.t("pokedexUiHandler:hidden"),skip:!0,style:A.MONEY_WINDOW,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.clear(),"onHover")});const f=Et[this.abilityHidden];p.push({label:Et[this.abilityHidden].name,style:this.hasAbilities[2]>0?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.show(f?.description),"onHover")})}this.passive&&(p.push({label:m.t("pokedexUiHandler:passive"),skip:!0,style:A.MONEY_WINDOW,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.clear(),"onHover")}),p.push({label:Et[this.passive].name,style:this.hasPassive?A.SETTINGS_VALUE:A.SHADOW_TEXT,handler:c(()=>!1,"handler"),onHover:c(()=>this.infoOverlay.show(Et[this.passive].description),"onHover")})),p.push({label:m.t("menu:cancel"),handler:c(()=>(this.infoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>this.infoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 5:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{if((!this.biomes||this.biomes?.length===0)&&(!this.preBiomes||this.preBiomes?.length===0))return t.showText(m.t("pokedexUiHandler:noBiomes")),t.playError(),this.blockInput=!1,!0;const p=[];t.showText(m.t("pokedexUiHandler:showBiomes"),null,()=>{this.biomes.map(f=>{p.push({label:m.t(`biome:${Tt(Je[f.biome])}`)+" - "+m.t(`biome:${Tt(lp[f.tier])}`)+(f.tod.length===1&&f.tod[0]===-1?"":" ("+f.tod.map(d=>m.t(`biome:${Tt(Jt[d])}`)).join(", ")+")"),handler:c(()=>!1,"handler")})}),this.preBiomes.length>0&&(p.push({label:m.t("pokedexUiHandler:preBiomes"),skip:!0,handler:c(()=>!1,"handler")}),this.preBiomes.map(f=>{p.push({label:m.t(`biome:${Tt(Je[f.biome])}`)+" - "+m.t(`biome:${Tt(lp[f.tier])}`)+(f.tod.length===1&&f.tod[0]===-1?"":" ("+f.tod.map(d=>m.t(`biome:${Tt(Jt[d])}`)).join(", ")+")"),handler:c(()=>!1,"handler")})})),p.push({label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 8:o?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{const p=[];if((!this.prevolutions||this.prevolutions?.length===0)&&(!this.evolutions||this.evolutions?.length===0)&&(!this.battleForms||this.battleForms?.length===0))return t.showText(m.t("pokedexUiHandler:noEvolutions")),t.playError(),this.blockInput=!1,!0;t.showText(m.t("pokedexUiHandler:showEvolutions"),null,()=>{this.prevolutions?.length>0&&(p.push({label:m.t("pokedexUiHandler:prevolutions"),style:A.MONEY_WINDOW,skip:!0,handler:c(()=>!1,"handler")}),this.prevolutions.map(f=>{const d=it.find(T=>T.speciesId===wt[this.species.speciesId]),y=d?.forms.find(T=>T.formKey===f.preFormKey)?.formIndex??0,g=f.description;p.push({label:f.preFormKey?(d??this.species).getFormNameToDisplay(y,!0):(d??this.species).getExpandedSpeciesName(),handler:c(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const T=it.find(O=>O.speciesId===wt[f.speciesId]),E=f.preFormKey?f.preFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",b=T?.forms.find(O=>O.formKey===E),_=b?b.formIndex:0;return this.starterAttributes.form=_,this.savedStarterAttributes.form=_,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,T,this.savedStarterAttributes),!0},"handler"),onHover:c(()=>this.showText(g),"onHover")})})),this.evolutions.length>0&&(p.push({label:m.t("pokedexUiHandler:evolutions"),style:A.MONEY_WINDOW,skip:!0,handler:c(()=>!1,"handler")}),this.evolutions.map(f=>{const d=it.find(O=>O.speciesId===f.speciesId),y=!!this.isCaught(d),g=f.evoFormKey?f.evoFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",T=d?.forms.find(O=>O.formKey===g),E=T?T.formIndex:0,b=this.isFormCaught(d,E),_=f.description;p.push({label:f.evoFormKey?(d??this.species).getFormNameToDisplay(E,!0):(d??this.species).getExpandedSpeciesName(),style:y&&b?A.WINDOW:A.SHADOW_TEXT,handler:c(()=>(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}),this.starterAttributes.form=E,this.savedStarterAttributes.form=E,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,d,this.savedStarterAttributes),!0),"handler"),onHover:c(()=>this.showText(_),"onHover")})})),this.battleForms.length>0&&(p.push({label:m.t("pokedexUiHandler:forms"),style:A.MONEY_WINDOW,skip:!0,handler:c(()=>!1,"handler")}),this.battleForms.map(f=>{const d=this.species?.forms.find(b=>b.formKey===f.formKey),y=d?d.formIndex:0;let g="";f.trigger?g=f.trigger.description:g="";let T=this.species.getFormNameToDisplay(y);T===""&&(T=this.species.name);const E=this.isFormCaught(this.species,y);g&&p.push({label:T,style:E?A.WINDOW:A.SHADOW_TEXT,handler:c(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const b=this.species,_=this.species.forms.find(O=>O.formKey===f.formKey)?.formIndex;return this.starterAttributes.form=_,this.savedStarterAttributes.form=_,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,b,this.savedStarterAttributes,this.filteredIndices),!0},"handler"),onHover:c(()=>this.showText(g),"onHover")})})),p.push({label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:c(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(x.OPTION_SELECT,{options:p,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 7:l?(this.toggleStatsMode(),t.setMode(x.POKEDEX_PAGE,"refresh"),i=!0):n=!0;break;case 6:l?(this.blockInput=!0,t.setMode(x.POKEDEX_PAGE,"refresh").then(()=>{t.showText(m.t("pokedexUiHandler:showNature"),null,()=>{const p=s.gameData.dexData[this.getStarterSpeciesId(this.species.speciesId)],f=s.gameData.getNaturesForAttr(p.natureAttr);t.setModeWithoutClear(x.OPTION_SELECT,{options:f.map((d,y)=>({label:xi(d,!0,!0,!0,s.uiTheme),handler:c(()=>!1,"handler")})).concat({label:m.t("menu:cancel"),handler:c(()=>(this.clearText(),t.setMode(x.POKEDEX_PAGE,"refresh"),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})}),i=!0):n=!0;break}else{const p=s.gameData.getSpeciesDexAttrProps(this.species,this.getCurrentDexProps(this.species.speciesId));switch(e){case v.CYCLE_SHINY:if(this.canCycleShiny)if(u.shiny){let f=p.variant;do if(f=(f+1)%3,f===0){if(this.isCaught()&F.DEFAULT_VARIANT)break}else if(f===1){if(this.isCaught()&F.VARIANT_2)break}else if(this.isCaught()&F.VARIANT_3)break;while(f!==p.variant);u.variant=f,this.savedStarterAttributes.variant=u.variant,this.isCaught()&F.NON_SHINY&&f<=p.variant?(this.setSpeciesDetails(this.species,{shiny:!1,variant:0}),i=!0,u.shiny=!1,this.savedStarterAttributes.shiny=u.shiny):(this.setSpeciesDetails(this.species,{variant:f}),i=!0)}else{const f=u.variant?u.variant:0;this.setSpeciesDetails(this.species,{shiny:!0,variant:f}),s.playSound("se/sparkle"),u.shiny=!0,this.savedStarterAttributes.shiny=u.shiny}break;case v.CYCLE_FORM:if(this.canCycleForm){const f=this.species.forms.length;let d=this.formIndex;do if(d=(d+1)%f,this.species.forms[d].isStarterSelectable||s.dexForDevs)break;while(d!==p.formIndex||this.species.forms[d].isUnobtainable);u.form=d,this.savedStarterAttributes.form=u.form,this.formIndex=d;let y=p.female;this.isFormGender&&(y=!p.female),u.female=y,this.savedStarterAttributes.female=u.female,this.starterSetup(),this.setSpeciesDetails(this.species,{formIndex:d,female:y}),i=this.setCursor(this.cursor)}break;case v.CYCLE_GENDER:if(this.canCycleGender){u.female=!p.female,this.savedStarterAttributes.female=u.female;let f=this.formIndex;this.isFormGender&&(f=this.formIndex===0?1:0),u.form=f,this.savedStarterAttributes.form=u.form,this.formIndex=f,this.starterSetup(),this.setSpeciesDetails(this.species,{female:!p.female,formIndex:f}),i=!0}break;case v.STATS:if(!a||!r||!this.canUseCandies)n=!0;else{const f=this.getUi();f.showText("");const d=[],y=h.passiveAttr,g=h.candyCount;if(!(y&bt.UNLOCKED)){const b=an(ze[this.starterId]);d.push({label:`${b} ${m.t("pokedexUiHandler:unlockPassive")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||g>=b?(h.passiveAttr|=bt.UNLOCKED|bt.ENABLED,le.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=b),this.pokemonCandyCountText.setText(`${h.candyCount}`),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),this.setSpeciesDetails(this.species),s.playSound("se/buy"),f.setMode(x.POKEDEX_PAGE,"refresh"),!0):!1,"handler"),style:this.isPassiveAvailable()?A.WINDOW:A.SHADOW_TEXT,item:"candy",itemArgs:this.isPassiveAvailable()?yt[this.starterId]:["808080","808080"]})}const T=h.valueReduction;if(T<xp){const b=rn(ze[this.starterId])[T];d.push({label:`${b} ${m.t("pokedexUiHandler:reduceCost")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||g>=b?(h.valueReduction++,le.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=b),this.pokemonCandyCountText.setText(`${h.candyCount}`),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),f.setMode(x.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isValueReductionAvailable()?A.WINDOW:A.SHADOW_TEXT,item:"candy",itemArgs:this.isValueReductionAvailable()?yt[this.starterId]:["808080","808080"]})}const E=on(ze[this.starterId]);d.push({label:`${E} ${m.t("pokedexUiHandler:sameSpeciesEgg")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||g>=E?s.gameData.eggs.length>=99&&!le.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(m.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(le.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=E),this.pokemonCandyCountText.setText(`${h.candyCount}`),new Ii({scene:s,species:this.starterId,sourceType:bf.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(_=>{if(!_)return s.reset(!0)}),f.setMode(x.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isSameSpeciesEggAvailable()?A.WINDOW:A.SHADOW_TEXT,item:"candy",itemArgs:this.isSameSpeciesEggAvailable()?yt[this.starterId]:["808080","808080"]}),d.push({label:m.t("menu:cancel"),handler:c(()=>(f.setMode(x.POKEDEX_PAGE,"refresh"),!0),"handler")}),f.setModeWithoutClear(x.OPTION_SELECT,{options:d,yOffset:47}),i=!0}break;case v.CYCLE_ABILITY:this.showBackSprite=!this.showBackSprite,this.showBackSprite?this.showBackSpriteLabel.setText(m.t("pokedexUiHandler:showFrontSprite")):this.showBackSpriteLabel.setText(m.t("pokedexUiHandler:showBackSprite")),this.setSpeciesDetails(this.species,{},!0),i=!0;break;case v.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case v.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break;case v.LEFT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;this.blockInput=!0,t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const g=this.filteredIndices.indexOf(this.species.speciesId),T=g<=0?this.filteredIndices.length-1:g-1;f=ns(this.filteredIndices[T])}else{const g=it.findIndex(E=>E.speciesId===this.species.speciesId),T=g<=0?it.length-1:g-1;f=it[T]}const d=f?.forms.find(g=>g.formKey===this.species?.forms[this.formIndex]?.formKey),y=d?d.formIndex:0;this.starterAttributes.form=y,this.savedStarterAttributes.form=y,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)}),this.blockInput=!1;break;case v.RIGHT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;t.setModeWithoutClear(x.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const g=this.filteredIndices.indexOf(this.species.speciesId),T=g>=this.filteredIndices.length-1?0:g+1;f=ns(this.filteredIndices[T])}else{const g=it.findIndex(E=>E.speciesId===this.species.speciesId),T=g>=it.length-1?0:g+1;f=it[T]}const d=f?.forms.find(g=>g.formKey===this.species?.forms[this.formIndex]?.formKey),y=d?d.formIndex:0;this.starterAttributes.form=y,this.savedStarterAttributes.form=y,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(x.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)});break}}}return i?t.playSelect():n&&t.playError(),i||n}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case ae.Button_Cycle_Shiny:a="R.png";break;case ae.Button_Cycle_Form:a="F.png";break;case ae.Button_Cycle_Gender:a="G.png";break;case ae.Button_Cycle_Ability:a="E.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setPosition(this.instructionRowX,this.instructionRowY),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),i.setVisible(!0),n.setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=8,this.instructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;if(s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[Me.GAMEPAD]).padType:e=s.inputMethod,!e)return;const t=this.isFormCaught();this.isCaught()&&(t?(this.canUseCandies&&this.updateButtonIcon(ae.Button_Stats,e,this.candyUpgradeIconElement,this.candyUpgradeLabel),this.canCycleShiny&&this.updateButtonIcon(ae.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleGender&&this.updateButtonIcon(ae.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel)):this.instructionRowY+=8,this.canCycleForm&&this.updateButtonIcon(ae.Button_Cycle_Form,e,this.formIconElement,this.formLabel))}setCursor(e){const t=super.setCursor(e);this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale);const i=this.getUi();return this.isCaught()&&this.isFormCaught()||this.isSeen()?i.showText(this.menuDescriptions[e]):i.showText(""),t}getFriendship(e){let t=s.gameData.starterData[this.starterId].friendship;(!t||t===void 0)&&(t=0);const i=mh(ze[this.starterId]);return{currentFriendship:t,friendshipCap:i}}isPassiveAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=an(ze[this.starterId])&&!(e.passiveAttr&bt.UNLOCKED)}isValueReductionAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=rn(ze[this.starterId])[e.valueReduction]&&e.valueReduction<xp}isSameSpeciesEggAvailable(){return s.gameData.starterData[this.starterId].candyCount>=on(ze[this.starterId])}setSpecies(){const e=this.species,t=e?{...this.starterAttributes}:null;if(!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.statsMode&&(this.isCaught()?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),e&&(this.isSeen()||this.isCaught()))if(this.pokemonNumberText.setText(ri(e.speciesId,4)),this.isCaught()){const i=this.getCurrentDexProps(e.speciesId),n=s.gameData.getSpeciesDexAttrProps(e,i);t?.variant&&!Number.isNaN(t.variant)&&n.shiny&&(n.variant=t.variant),n.form=t?.form??n.form,n.female=t?.female??n.female,this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.form,female:n.female,variant:n.variant??0})}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const a of this.pokemonShinyIcons)a.setVisible(!1);this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonCategoryText.setVisible(!1);const i=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),n=s.gameData.getSpeciesDexAttrProps(e,i);this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.formIndex,female:n.female,variant:n.variant}),this.pokemonSprite.setTint(8421504)}else{this.pokemonNumberText.setText(e?ri(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const i of this.pokemonShinyIcons)i.setVisible(!1);this.pokemonUncaughtText.setVisible(!!e),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonCategoryText.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0}),this.pokemonSprite.setTint(0)}}setSpeciesDetails(e,t={},i){let{shiny:n,formIndex:a,female:r,variant:o}=t;const l=e?this.starterAttributes:null,h=e?.genderDiffs&&!ve(r)||!ve(a)||!ve(n)||!ve(o)||i;if(this.activeTooltip==="CANDY")if(this.species&&this.pokemonCandyContainer.visible){const{currentFriendship:u,friendshipCap:p}=this.getFriendship(this.species.speciesId);s.ui.editTooltip("",`${u}/${p}`)}else s.ui.hideTooltip();if(e?.forms?.find(u=>u.formKey==="female")&&(r!==void 0?a=r?1:0:a!==void 0&&(r=a===1)),e&&(n===void 0&&(n=l?.shiny??!1),r===void 0&&(r=l?.female??!1),o===void 0&&(o=l?.variant??0),a===void 0&&(a=l?.form??0)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const u=this.isCaught(e);if(!u){const _=this.starterAttributes;(n===void 0||n!==_.shiny)&&(n=_.shiny),(a===void 0||a!==_.form)&&(a=_.form),(r===void 0||r!==_.female)&&(r=_.female),(o===void 0||o!==_.variant)&&(o=_.variant)}const p=this.isFormCaught(),f=this.isSeen();this.shinyOverlay.setVisible(n??!1),this.pokemonNumberText.setColor(this.getTextColor(n?A.SUMMARY_DEX_NUM_GOLD:A.SUMMARY_DEX_NUM,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(n?A.SUMMARY_DEX_NUM_GOLD:A.SUMMARY_DEX_NUM,!0));const d=new ot(!1);if(this.assetLoadCancelled=d,h){const _=!!this.showBackSprite;e.loadAssets(r,a,n,o,!0,_).then(()=>{d.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,a,n,o,_)),this.pokemonSprite.setPipelineData("shiny",n),this.pokemonSprite.setPipelineData("variant",o),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(r,a,n,o,_)),this.pokemonSprite.setVisible(!this.statsMode))})}else this.pokemonSprite.setVisible(!this.statsMode);const y=!!(u&F.NON_SHINY),g=!!(u&F.SHINY),T=[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(_=>u&_);this.canCycleShiny=y&&g||g&&T.length>1;const E=!!(u&F.MALE),b=!!(u&F.FEMALE);if(this.canCycleGender=E&&b,this.canCycleForm=s.dexForDevs?e.forms.length>1:e.forms.filter(_=>_.isStarterSelectable).filter(_=>_).length>1,u&&e.malePercent!==null){const _=r?kt.FEMALE:kt.MALE;this.pokemonGenderText.setText(hh(_)),this.pokemonGenderText.setColor(Ai(_)),this.pokemonGenderText.setShadowColor(Ai(_,!0))}else this.pokemonGenderText.setText("");if(p||f?this.pokemonNameText.setText(e.name):this.pokemonNameText.setText(e?"???":""),p?this.pokemonCategoryText.setText(e.category):this.pokemonCategoryText.setText(""),p?(this.species.loadAssets(r,a,n,o,!0).then(()=>{(this.species.forms&&this.species.forms.length>0?this.species.forms[a??this.formIndex]:this.species).cry()}),this.pokemonSprite.clearTint()):f?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),p){const _=s.gameData.getDexAttrLuck(this.isCaught());this.pokemonLuckText.setVisible(!!_),this.pokemonLuckText.setText(_.toString()),this.pokemonLuckText.setTint(mt(Math.min(_-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible)}else this.pokemonLuckText.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1);if(p){let _=wi(If[e.growthRate]);const O=Tt(_);m.exists("growth:"+O)&&(_=m.t("growth:"+O)),this.pokemonGrowthRateText.setText(_),this.pokemonGrowthRateText.setColor(aa(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(aa(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0)}else this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1);if(p){const _=yt[this.starterId];this.pokemonUncaughtText.setVisible(!1),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry?.caughtCount}`),e.speciesId===pe.MANAPHY||e.speciesId===pe.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Js(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry?.hatchedCount}`);const O=this.getCurrentDexProps(e.speciesId),U=s.gameData.getSpeciesDexAttrProps(e,O).variant;for(let B=0;B<3;B++){const K=this.pokemonShinyIcons[B];if(B<this.availableVariants){if(!this.unlockedVariants[B])K.setTint(0);else if(n&&B===U){const V=mt(B);K.setTint(V)}else K.setTint(8421504);K.setVisible(!0)}else K.setVisible(!1)}if(this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCaughtHatchedContainer.setY(25),this.pokemonCandyIcon.setTint(ss(Gt(_[0]))),this.pokemonCandyOverlayIcon.setTint(ss(Gt(_[1]))),this.pokemonCandyCountText.setText(`${e.speciesId===pe.PIKACHU?0:s.gameData.starterData[this.starterId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),wt.hasOwnProperty(e.speciesId))this.pokemonHatchedIcon.setVisible(!1),this.pokemonHatchedCountText.setVisible(!1),this.pokemonFormText.setY(36);else{this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0),this.pokemonFormText.setY(42);const{currentFriendship:B,friendshipCap:K}=this.getFriendship(this.species.speciesId),V=16-16*(B/K);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,V),this.pokemonCandyContainer.on("pointerover",()=>{s.ui.showTooltip("",`${B}/${K}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}}else{this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1);for(const _ of this.pokemonShinyIcons)_.setVisible(!1)}if(p||f){const _=$t(e.speciesId,a);this.setTypeIcons(_.type1,_.type2),vf.includes(e.speciesId)&&!a?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(a)),this.pokemonFormText.setVisible(!0),p||this.pokemonFormText.setY(18)}else this.setTypeIcons(null,null),this.pokemonFormText.setText(""),this.pokemonFormText.setVisible(!1)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(A.SUMMARY)),this.pokemonNumberText.setShadowColor(this.getTextColor(A.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.setTypeIcons(null,null);this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Se[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Se[t].toLowerCase())):this.type2Icon.setVisible(!1)}getCurrentDexProps(e){let t=0n;const i=it.find(a=>a.speciesId===e),n=s.gameData.dexData[e].caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&(i?.getFullUnlocksData()??0n);return this.starterAttributes?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterAttributes?.shiny||(n&F.SHINY)>0n&&this.starterAttributes?.shiny!==!1?(t+=F.SHINY,this.starterAttributes?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterAttributes?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterAttributes?.form?t+=BigInt(Math.pow(2,this.starterAttributes?.form))*F.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}toggleStatsMode(e){e===void 0&&(e=!this.statsMode),e?(this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1)):(this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!0),this.statsContainer.updateIvs(null))}showStats(){if(!this.speciesStarterDexEntry)return;this.statsContainer.setVisible(!0);const e=s.gameData.dexData[this.getStarterSpeciesId(this.species.speciesId)].ivs;this.statsContainer.updateIvs(e)}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.candyUpgradeIconElement.setVisible(!1),this.candyUpgradeLabel.setVisible(!1),this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.variantIconElement.setVisible(!1),this.variantLabel.setVisible(!1)}clear(){super.clear(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1,this.showBackSprite=!1,this.showBackSpriteLabel.setText(m.t("pokedexUiHandler:showBackSprite")),this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};c(wu,"PokedexPageUiHandler");let Tn=wu;var we=(C=>(C[C.GEN=0]="GEN",C[C.TYPES=1]="TYPES",C[C.BIOME=2]="BIOME",C[C.CAUGHT=3]="CAUGHT",C[C.UNLOCKS=4]="UNLOCKS",C[C.MISC=5]="MISC",C[C.SORT=6]="SORT",C))(we||{});const Mu=class Mu extends Phaser.GameObjects.Container{bg;handleBody;handleBottom;currentRow;totalRows;maxRows;constructor(e,t,i,n,a){super(s,e,t),this.maxRows=a,this.totalRows=a,this.currentRow=0;const r=2;i=Math.max(i,4),this.bg=s.add.nineslice(0,0,"scroll_bar",void 0,i,n,r,r,r,r),this.bg.setOrigin(0,0),this.add(this.bg),this.handleBody=s.add.rectangle(1,1,i-2,4,11184810),this.handleBody.setOrigin(0,0),this.add(this.handleBody),this.handleBottom=s.add.nineslice(1,1,"scroll_bar_handle",void 0,i-2,2,2,0,0,0),this.handleBottom.setOrigin(0,0),this.add(this.handleBottom)}setScrollCursor(e){this.currentRow=e,this.updateHandlePosition()}setTotalRows(e){this.totalRows=e,this.handleBody.height=(this.bg.displayHeight-1-this.handleBottom.displayHeight)*this.maxRows/this.totalRows,this.updateHandlePosition(),this.setVisible(this.totalRows>this.maxRows)}updateHandlePosition(){this.handleBody.y=1+(this.bg.displayHeight-1-this.handleBottom.displayHeight)/this.totalRows*this.currentRow,this.handleBottom.y=this.handleBody.y+this.handleBody.displayHeight}};c(Mu,"ScrollBar");let _s=Mu;var J=(C=>(C[C.ON=0]="ON",C[C.OFF=1]="OFF",C[C.EXCLUDE=2]="EXCLUDE",C[C.UNLOCKABLE=3]="UNLOCKABLE",C[C.ONE=4]="ONE",C[C.TWO=5]="TWO",C))(J||{}),Dt=(C=>(C[C.SINGLE=0]="SINGLE",C[C.MULTI=1]="MULTI",C[C.HYBRID=2]="HYBRID",C[C.RADIAL=3]="RADIAL",C))(Dt||{}),Qe=(C=>(C[C.NUMBER=0]="NUMBER",C[C.COST=1]="COST",C[C.CANDY=2]="CANDY",C[C.IV=3]="IV",C[C.NAME=4]="NAME",C[C.CAUGHT=5]="CAUGHT",C[C.HATCHED=6]="HATCHED",C))(Qe||{});const Nu=class Nu{state;text;sprite;constructor(e,t,i=1){this.text=e||"",this.sprite=t,this.state=i}};c(Nu,"DropDownLabel");let ne=Nu;const ku=class ku extends Phaser.GameObjects.Container{state=0;toggle;text;val;dir=-1;currentLabelIndex;labels;onColor=3390463;offColor=2565927;excludeColor=16733525;unlockableColor=16776960;oneColor=3390463;twoColor=3390463;constructor(e,t){super(s),this.val=e,Array.isArray(t)?this.labels=t:this.labels=t?[t]:[new ne("")],this.currentLabelIndex=0;const i=this.labels[this.currentLabelIndex];this.state=i.state,this.text=P(0,0,i.text||"",A.TOOLTIP_CONTENT),this.text.setOrigin(0,.5),this.add(this.text);for(let n=0;n<this.labels.length;n++){const a=this.labels[n].sprite;a&&(this.add(a),a.setOrigin(0,.5),n!==this.currentLabelIndex&&a.setVisible(!1))}}setupToggleIcon(e,t){e===0?(this.toggle=s.add.sprite(0,0,"cursor"),this.toggle.setScale(.5),this.toggle.setOrigin(0,.5),this.toggle.setRotation(Math.PI/180*-90)):(this.toggle=s.add.sprite(0,0,"candy"),this.toggle.setScale(.3),this.toggle.setOrigin(0,.5)),this.add(this.toggle),this.toggle.setVisible(t),this.updateToggleIconColor()}updateToggleIconColor(){switch(this.state){case 0:this.toggle.setTint(this.onColor);break;case 1:this.toggle.setTint(this.offColor);break;case 2:this.toggle.setTint(this.excludeColor);break;case 3:this.toggle.setTint(this.unlockableColor);break;case 4:this.toggle.setTint(this.oneColor);break;case 5:this.toggle.setTint(this.twoColor);break}}toggleOptionState(){if(this.labels.length>1)return this.setCurrentLabel((this.currentLabelIndex+1)%this.labels.length);const e=this.state===0?1:0;return this.setOptionState(e)}setOptionState(e){const t=this.labels.findIndex(i=>i.state===e);return t!==-1&&t!==this.currentLabelIndex?this.setCurrentLabel(t):(this.state=e,this.updateToggleIconColor(),e)}setCurrentLabel(e){const t=this.labels[this.currentLabelIndex],i=this.labels[e];return i?(this.currentLabelIndex=e,this.state=i.state,this.updateToggleIconColor(),t.sprite&&(this.text.x-=t.sprite.displayWidth+2,t.sprite.setVisible(!1)),i.sprite&&(this.text.x+=i.sprite.displayWidth+2,i.sprite.setVisible(!0)),this.text.setText(i.text),this.state):this.state}setDirection(e){this.dir=e,this.toggle.flipX=this.dir===1}toggleDirection(){this.setDirection(this.dir*-1)}setLabelPosition(e,t){let i=e;for(let n=0;n<this.labels.length;n++){const a=this.labels[n];a.sprite&&(a.sprite.x=e,a.sprite.y=t,n===this.currentLabelIndex&&(i+=a.sprite.displayWidth+2))}this.text&&(this.text.x=i,this.text.y=t)}setTogglePosition(e,t){this.toggle&&(this.toggle.x=e,this.toggle.y=t)}getCurrentLabelX(){return this.labels[this.currentLabelIndex].sprite?this.labels[this.currentLabelIndex].sprite?.x:this.text.x}getWidth(){let e=0;const t=this.text.text;for(const i of this.labels){this.text.setText(i.text);const n=i.sprite?i.sprite.displayWidth+2:0;e=Math.max(e,this.text.displayWidth+n)}return this.text.setText(t),e}};c(ku,"DropDownOption");let be=ku;const Pu=class Pu extends Phaser.GameObjects.Container{options;window;cursorObj;dropDownType=1;cursor=0;lastCursor=-1;defaultCursor=0;onChange;lastDir=-1;defaultSettings;dropDownScrollBar;totalOptions=0;maxOptions=0;shownOptions=0;tooManyOptions=!1;firstShown=0;optionHeight=0;optionSpacing=0;optionPaddingX=4;optionPaddingY=6;optionWidth=100;cursorOffset=0;constructor(e,t,i,n,a=1,r=2){super(s,e-7-5,t),this.optionWidth=100,this.optionHeight=7,this.optionSpacing=r,this.optionPaddingX=4,this.optionPaddingY=6,this.cursorOffset=7,this.options=i,this.dropDownType=a,this.onChange=n,this.cursorObj=s.add.image(this.optionPaddingX+3,0,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setOrigin(0,.5),this.cursorObj.setVisible(!1),(this.dropDownType===1||this.dropDownType===2)&&this.options.unshift(new be("ALL",new ne(m.t("filterBar:all"),void 0,this.checkForAllOn()?0:1))),this.maxOptions=19,this.totalOptions=this.options.length,this.tooManyOptions=this.totalOptions>this.maxOptions,this.shownOptions=this.tooManyOptions?this.maxOptions:this.totalOptions,this.defaultSettings=this.getSettings(),i.forEach((h,u)=>{const p=a!==0||h.state===0;h.setupToggleIcon(a,p),h.width=this.optionWidth,h.y=u*this.optionHeight+u*r+this.optionPaddingY;const f=7+this.optionPaddingX+3,d=this.optionHeight/2;h.setLabelPosition(f+8,d),a===0?h.setTogglePosition(f+3,d+1):h.setTogglePosition(f,d),u>=this.shownOptions&&(h.visible=!1),this.firstShown=0}),this.window=ye(0,0,this.optionWidth,i[this.shownOptions-1].y+this.optionHeight+this.optionPaddingY,!1,!1,void 0,void 0,is.XTHIN),this.add(this.window),this.add(i),this.add(this.cursorObj),this.setVisible(!1),this.tooManyOptions&&(this.dropDownScrollBar=new _s(this.window.width-3,5,5,this.window.height-10,1),this.add(this.dropDownScrollBar),this.dropDownScrollBar.setTotalRows(this.totalOptions),this.dropDownScrollBar.setScrollCursor(0))}getWidth(){return this.window?this.window.width:this.width}toggleVisibility(){this.setVisible(!this.visible)}setVisible(e){return super.setVisible(e),e&&this.autoSize(),this}resetCursor(){return this.dropDownType===2&&this.checkForAllOff()?this.setCursor(this.lastCursor):this.setCursor(this.defaultCursor)}setCursor(e){return this.tooManyOptions&&this.setLabels(e),this.cursor=e,e<0?(e=0,this.cursorObj.setVisible(!1),!1):e>=this.options.length?(e=this.options.length-1,this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),!1):(this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),this.dropDownType===2&&(this.lastCursor=e,this.onChange()),!0)}setLabels(e){e===0&&this.lastCursor===this.totalOptions-1?this.firstShown=0:e===this.totalOptions-1&&this.lastCursor===0?this.firstShown=this.totalOptions-this.shownOptions:e-this.firstShown>=this.shownOptions&&e>this.lastCursor?this.firstShown+=1:e<this.firstShown&&e<this.lastCursor&&(this.firstShown-=1),this.options.forEach((t,i)=>{t.y=(i-this.firstShown)*(this.optionHeight+this.optionSpacing)+this.optionPaddingY;const n=this.cursorOffset+this.optionPaddingX+3,a=this.optionHeight/2;t.setLabelPosition(n+8,a),this.dropDownType===0?t.setTogglePosition(n+3,a+1):t.setTogglePosition(n,a),i<this.firstShown||i>=this.firstShown+this.shownOptions?t.visible=!1:t.visible=!0}),this.dropDownScrollBar.setScrollCursor(e)}toggleOptionState(e=this.cursor){const t=this.options[e];if(this.dropDownType===1||this.dropDownType===2){const i=t.toggleOptionState();e===0?this.setAllOptions(i):i===0&&this.checkForAllOn()?this.options[0].setOptionState(0):this.options[0].setOptionState(1)}else this.dropDownType===0?t.state===1?(this.options.forEach(i=>{i.setOptionState(1),i.setDirection(-1),i.toggle.setVisible(!1)}),t.setOptionState(0),t.setDirection(this.lastDir),t.toggle.setVisible(!0)):(t.toggleDirection(),this.lastDir=this.options[this.cursor].dir):this.dropDownType===3&&t.toggleOptionState();this.onChange()}checkForAllOn(){return this.options.every((e,t)=>t===0||e.state===0)}checkForAllOff(){return this.options.every((e,t)=>t===0||e.state===1)}getVals(){if(this.dropDownType===1)return this.options.filter((e,t)=>t>0&&e.state===0).map(e=>e.val);if(this.dropDownType===2){const e=this.options.filter((t,i)=>i>0&&t.state===0).map(t=>t.val);return e.length>0?e:this.cursor===0?this.options.filter((t,i)=>i>0).map(t=>t.val):[this.options[this.cursor].val]}return this.dropDownType===3?this.options.map(e=>({val:e.val,state:e.state})):this.options.filter(e=>e.state===0).map(e=>({val:e.val,dir:e.dir}))}getSettings(){const e=[];for(let t=0;t<this.options.length;t++)e.push({val:this.options[t].val,state:this.options[t].state,cursor:this.cursor===t,dir:this.options[t].dir});return e}hasDefaultValues(){const e=this.getSettings(),t=c(i=>e.length===this.defaultSettings.length&&e.every((n,a)=>i.every(r=>n[r]===this.defaultSettings[a][r])),"compareValues");switch(this.dropDownType){case 1:case 3:return t(["val","state"]);case 2:return t(["val","state","cursor"]);case 0:return t(["val","state","dir"]);default:return!1}}resetToDefault(){if(this.defaultSettings.length>0){this.setCursor(this.defaultCursor),this.lastDir=-1;for(let e=0;e<this.options.length;e++)this.dropDownType===0?this.defaultSettings[e].state===1?(this.options[e].setOptionState(1),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!1)):(this.options[e].setOptionState(0),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!0)):this.defaultSettings[e]&&this.options[e].setOptionState(this.defaultSettings[e].state);this.onChange()}}setAllOptions(e){if(this.dropDownType!==0)for(const t of this.options)t.setOptionState(e)}selectAllOptions(){this.setAllOptions(0)}unselectAllOptions(){this.setAllOptions(1)}autoSize(){let e=0,t=0;for(let i=0;i<this.options.length;i++){const n=this.options[i].getWidth();n>e&&(e=n,t=this.options[i].getCurrentLabelX()??0)}this.window.width=e+t-this.window.x+9,this.tooManyOptions&&(this.window.width+=6,this.dropDownScrollBar.x=this.window.width-9),this.x+this.window.width>this.parentContainer.width&&(this.x=this.parentContainer.width-this.window.width)}};c(Pu,"DropDown");let Rt=Pu;const Bu=class Bu extends Phaser.GameObjects.Container{window;labels=[];dropDowns=[];columns=[];cursorObj;numFilters=0;openDropDown=!1;lastCursor=-1;uiTheme;leftPaddingX;rightPaddingX;cursorOffset;constructor(e,t,i,n,a=6,r=6,o=8){super(s,e,t),this.width=i,this.height=n,this.leftPaddingX=a,this.rightPaddingX=r,this.cursorOffset=o,this.window=ye(0,0,i,n,!1,!1,void 0,void 0,is.THIN),this.cursorObj=s.add.image(1,1,"cursor").setScale(.5).setVisible(!1).setOrigin(0),this.add([this.window,this.cursorObj])}addFilter(e,t,i){if(this.columns.includes(e))return!1;this.columns.push(e);const n=P(0,3,t,A.FILTER_BAR_MAIN);return this.labels.push(n),this.add(n),this.dropDowns.push(i),this.add(i),this.calcFilterPositions(),this.numFilters++,!0}getFilter(e){return this.dropDowns[this.columns.indexOf(e)]}getColumn(e){return this.columns[e]}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.dropDowns[e].hasDefaultValues()?this.labels[e].setColor(He(A.TOOLTIP_CONTENT,!1,s.uiTheme)):this.labels[e].setColor(He(A.STATS_LABEL,!1,s.uiTheme))}calcFilterPositions(){let e=this.leftPaddingX+this.rightPaddingX+this.cursorOffset;this.labels.forEach(i=>{e+=i.displayWidth+this.cursorOffset});const t=(this.width-e)/(this.labels.length-1);for(let i=0;i<this.labels.length;i++){if(i===0)this.labels[i].x=this.leftPaddingX+this.cursorOffset;else{const n=this.labels[i-1].x+this.labels[i-1].displayWidth;this.labels[i].x=n+t+this.cursorOffset}this.dropDowns[i].x=this.labels[i].x-this.cursorOffset-this.leftPaddingX,this.dropDowns[i].y=this.height}}offsetHybridFilters(){for(let e=0;e<this.dropDowns.length;e++)this.dropDowns[e].dropDownType===Dt.HYBRID&&(this.dropDowns[e].autoSize(),this.dropDowns[e].x=-this.dropDowns[e].getWidth(),this.dropDowns[e].y=0)}setCursor(e){this.lastCursor>-1&&this.dropDowns[this.lastCursor].visible&&(this.dropDowns[this.lastCursor].setVisible(!1),this.dropDowns[e].setVisible(!0),this.dropDowns[e].resetCursor()),this.cursorObj.setPosition(this.labels[e].x-this.cursorOffset+2,6),this.lastCursor=e}toggleDropDown(e){this.dropDowns[e].toggleVisibility(),this.openDropDown=this.dropDowns[e].visible,this.dropDowns[e].resetCursor()}hideDropDowns(){this.dropDowns.forEach(e=>{e.setVisible(!1)}),this.openDropDown=!1}incDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===this.dropDowns[this.lastCursor].options.length-1?this.dropDowns[this.lastCursor].setCursor(0):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor+1)}decDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===0?this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].options.length-1):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor-1)}toggleOptionState(){this.dropDowns[this.lastCursor].toggleOptionState()}getVals(e){return this.getFilter(e).getVals()}resetSelection(e){this.dropDowns[e].resetToDefault(),this.updateFilterLabels()}setValsToDefault(){for(const e of this.dropDowns)e.resetToDefault()}getNearestFilter(e){const t=e.x+e.icon.displayWidth/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].x+this.labels[a].displayWidth/3));r<n&&(i=a,n=r)}return i}};c(Bu,"FilterBar");let Ia=Bu;var dt=(C=>(C[C.NAME=0]="NAME",C[C.MOVE_1=1]="MOVE_1",C[C.MOVE_2=2]="MOVE_2",C[C.ABILITY_1=3]="ABILITY_1",C[C.ABILITY_2=4]="ABILITY_2",C))(dt||{});const Lu=class Lu extends Phaser.GameObjects.Container{window;labels=[];selections=[];rows=[];cursorObj;numFilters=0;lastCursor=-1;uiTheme;menuMessageBoxContainer;dialogueMessageBox;message;textPadding=8;defaultWordWrapWidth=1224;onChange;defaultText="---";constructor(e,t,i,n,a){super(s,e,t),this.onChange=a,this.width=i,this.height=n,this.window=ye(0,0,i,n,!1,!1,void 0,void 0,is.THIN),this.add(this.window),this.cursorObj=s.add.image(1,1,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setVisible(!1),this.cursorObj.setOrigin(0,0),this.add(this.cursorObj),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.dialogueMessageBox=ye(-this.textPadding,0,s.scaledCanvas.width+this.textPadding*2,49,!1,!1,0,0,is.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const r=P(this.textPadding,this.textPadding,"",A.WINDOW,{maxLines:2});r.setName("menu-message"),r.setOrigin(0,0),this.menuMessageBoxContainer.add(r),this.message=r}addFilter(e,t){if(this.rows.includes(e))return!1;this.rows.push(e);const r=P(14,3,t,A.TOOLTIP_CONTENT);this.labels.push(r),this.add(r);const o=P(54,3,this.defaultText,A.TOOLTIP_CONTENT);return this.selections.push(o),this.add(o),this.calcFilterPositions(),this.numFilters++,!0}resetSelection(e){this.selections[e].setText(this.defaultText),this.onChange()}setValsToDefault(){for(let e=0;e<this.numFilters;e++)this.resetSelection(e)}startSearch(e,t){t.playSelect();const i="",n={};n.buttonActions=[a=>{t.playSelect();const o=decodeURIComponent(escape(atob(a))),l=t.getHandler();l.tutorialActive=!0,this.selections[e].setText(o===""?this.defaultText:String(m.t(o))),t.revertMode(),this.onChange()},()=>{t.revertMode(),this.onChange}],t.setOverlayMode(x.POKEDEX_SCAN,n,i,e)}setCursor(e){this.cursorObj.setPosition(8,this.labels[e].y+3),this.lastCursor=e}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.selections[e].text===this.defaultText?this.labels[e].setColor(He(A.TOOLTIP_CONTENT,!1,s.uiTheme)):this.labels[e].setColor(He(A.STATS_LABEL,!1,s.uiTheme))}calcFilterPositions(){let t=16;this.labels.forEach(n=>{t+=n.displayHeight});const i=(this.height-t)/(this.labels.length-1);for(let n=0;n<this.labels.length;n++)if(n===0)this.labels[n].y=8,this.selections[n].y=8;else{const a=this.labels[n-1].y+this.labels[n-1].displayHeight;this.labels[n].y=a+i,this.selections[n].y=a+i}}getValue(e){return this.selections[e].getWrappedText()[0]}setValue(e,t){this.selections[e].setText(t),this.onChange()}getNearestFilter(e){const t=e.y+e.icon.displayHeight/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].y+this.labels[a].displayHeight/3));r<n&&(i=a,n=r)}return i}};c(Lu,"FilterText");let pl=Lu;const Du=class Du extends Phaser.GameObjects.Container{species;icon;shinyIcons=[];label;starterPassiveBgs;hiddenAbilityIcon;favoriteIcon;classicWinIcon;candyUpgradeIcon;candyUpgradeOverlayIcon;eggMove1Icon;tmMove1Icon;eggMove2Icon;tmMove2Icon;passive1Icon;passive2Icon;passive1OverlayIcon;passive2OverlayIcon;cost=0;constructor(e,t={}){super(s,0,0),this.setSpecies(e,t);const i=s.add.image(2,5,"passive_bg");i.setOrigin(0,0),i.setScale(.75),i.setVisible(!1),this.add(i),this.starterPassiveBgs=i;for(let b=0;b<3;b++){const _=s.add.image(b*-3+12,2,"shiny_star_small");_.setScale(.5),_.setOrigin(0,0),_.setVisible(!1),this.shinyIcons.push(_)}this.add(this.shinyIcons);const n=P(1,2,"0",A.WINDOW,{fontSize:"32px"});n.setShadowOffset(2,2),n.setOrigin(0,0),n.setVisible(!1),this.add(n),this.label=n;const a=s.add.image(12,7,"ha_capsule");a.setOrigin(0,0),a.setScale(.5),a.setVisible(!1),this.add(a),this.hiddenAbilityIcon=a;const r=s.add.image(0,7,"favorite");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.favoriteIcon=r;const o=s.add.image(0,12,"champion_ribbon");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.classicWinIcon=o;const l=s.add.image(12,12,"candy");l.setOrigin(0,0),l.setScale(.25),l.setVisible(!1),this.add(l),this.candyUpgradeIcon=l;const h=s.add.image(12,12,"candy_overlay");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeOverlayIcon=h;const u=s.add.image(0,12,"common_egg");u.setOrigin(0,-.03),u.setScale(.24),u.setVisible(!1),this.add(u),this.eggMove1Icon=u;const p=s.add.image(0,12,"normal_memory");p.setOrigin(0,0),p.setScale(.25),p.setVisible(!1),this.add(p),this.tmMove1Icon=p;const f=s.add.image(7,12,"common_egg");f.setOrigin(0,0),f.setScale(.25),f.setVisible(!1),this.add(f),this.eggMove2Icon=f;const d=s.add.image(7,12,"normal_memory");d.setOrigin(0,0),d.setScale(.25),d.setVisible(!1),this.add(d),this.tmMove2Icon=d;const y=s.add.image(3,3,"candy");y.setOrigin(0,0),y.setScale(.25),y.setVisible(!1),this.add(y),this.passive1Icon=y;const g=s.add.image(12,12,"candy_overlay");g.setOrigin(0,0),g.setScale(.25),g.setVisible(!1),this.add(g),this.passive1OverlayIcon=g;const T=s.add.image(12,3,"candy");T.setOrigin(0,0),T.setScale(.25),T.setVisible(!1),this.add(T),this.passive2Icon=T;const E=s.add.image(12,12,"candy_overlay");E.setOrigin(0,0),E.setScale(.25),E.setVisible(!1),this.add(E),this.passive2OverlayIcon=E}setSpecies(e,t={}){this.species=e;const{shiny:i,formIndex:n,female:a,variant:r}=t,o=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),l=s.gameData.getSpeciesDexAttrProps(e,o);ve(n)||(l.formIndex=n),ve(i)||(l.shiny=i),ve(r)||(l.variant=r),ve(a)||(l.female=a),this.icon&&(this.remove(this.icon),this.icon.destroy()),this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(l.female,l.formIndex,l.shiny,l.variant),this.add(this.icon),[this.hiddenAbilityIcon,this.favoriteIcon,this.classicWinIcon,this.candyUpgradeIcon,this.candyUpgradeOverlayIcon,this.eggMove1Icon,this.tmMove1Icon,this.eggMove2Icon,this.tmMove2Icon,this.passive1Icon,this.passive2Icon,this.passive1OverlayIcon,this.passive2OverlayIcon].forEach(h=>{h&&this.bringToTop(h)})}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};c(Du,"PokedexMonContainer");let va=Du;const Op={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},BT=2,Hn=17,Yn=143;function pr(C){const i=C%9*18,n=13+Math.floor(C/9)*17;return{x:i,y:n}}c(pr,"calcStarterPosition$1");const Ru=class Ru extends Bt{starterSelectContainer;starterSelectScrollBar;filterBarContainer;filterBar;pokemonContainers=[];filteredPokemonData=[];pokemonNumberText;pokemonSprite;pokemonNameText;pokemonFormText;type1Icon;type2Icon;starterSelectMessageBox;starterSelectMessageBoxContainer;filterMode;filterBarCursor=0;scrollCursor;oldCursor=-1;lastSpecies;speciesLoaded=new Map;pokerusSpecies=[];speciesStarterDexEntry;assetLoadCancelled;cursorObj;pokerusCursorObjs;iconAnimHandler;starterPreferences;blockInput=!1;textPadding=8;defaultMessageBoxWidth=220;defaultWordWrapWidth=1224;menuMessageBoxContainer;menuMessageBox;dialogueMessageBox;manageDataConfig;filterTextOptions;optionSelectText;scale=.1666666667;menuBg;filterTextContainer;filterText;filterTextMode;filterTextCursor=0;showDecorations=!1;goFilterIconElement1;goFilterIconElement2;goFilterLabel;toggleDecorationsIconElement;toggleDecorationsLabel;formTrayContainer;trayBg;trayForms;trayContainers=[];trayNumIcons;trayRows;trayColumns;trayCursorObj;trayCursor=0;showingTray=!1;showFormTrayIconElement;showFormTrayLabel;canShowFormTray;filteredIndices;constructor(){super(x.POKEDEX)}setup(){const e=this.getUi(),t=m.resolvedLanguage??"en",i=Object.keys(Op).find(H=>t.includes(H))??"en",n=Op[i];this.starterSelectContainer=s.add.container(0,-s.scaledCanvas.height),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=ye(Yn,Hn+1,175,161),o=s.add.image(Yn+1,Hn+2,"starter_container_bg");o.setOrigin(0,0),this.starterSelectContainer.add(o),this.starterSelectContainer.add(r),this.filterTextContainer=s.add.container(0,0),this.filterText=new pl(1,Hn+2,140,100,this.updateStarters),this.filterText.addFilter(dt.NAME,m.t("filterText:nameField")),this.filterText.addFilter(dt.MOVE_1,m.t("filterText:move1Field")),this.filterText.addFilter(dt.MOVE_2,m.t("filterText:move2Field")),this.filterText.addFilter(dt.ABILITY_1,m.t("filterText:ability1Field")),this.filterText.addFilter(dt.ABILITY_2,m.t("filterText:ability2Field")),this.filterTextContainer.add(this.filterText),this.starterSelectContainer.add(this.filterTextContainer),this.filterBarContainer=s.add.container(0,0),this.filterBar=new Ia(Yn,1,175,Hn,2,0,6);const l=[new be(1,new ne(m.t("pokedexUiHandler:gen1"))),new be(2,new ne(m.t("pokedexUiHandler:gen2"))),new be(3,new ne(m.t("pokedexUiHandler:gen3"))),new be(4,new ne(m.t("pokedexUiHandler:gen4"))),new be(5,new ne(m.t("pokedexUiHandler:gen5"))),new be(6,new ne(m.t("pokedexUiHandler:gen6"))),new be(7,new ne(m.t("pokedexUiHandler:gen7"))),new be(8,new ne(m.t("pokedexUiHandler:gen8"))),new be(9,new ne(m.t("pokedexUiHandler:gen9")))],h=new Rt(0,0,l,this.updateStarters,Dt.HYBRID);this.filterBar.addFilter(we.GEN,m.t("filterBar:genFilter"),h);const u=Object.keys(Se).filter(H=>Number.isNaN(Number(H))),p=[];u.forEach((H,ee)=>{if(ee===0||ee===19)return;const L=s.add.sprite(0,0,Ns("types"));L.setScale(.5),L.setFrame(H.toLowerCase()),p.push(new be(ee,new ne("",L)))}),this.filterBar.addFilter(we.TYPES,m.t("filterBar:typeFilter"),new Rt(0,0,p,this.updateStarters,Dt.HYBRID,.5));const f=Object.values(Je).filter(H=>typeof H=="number").map((H,ee)=>new be(ee,new ne(m.t(`biome:${Tt(Je[H])}`))));f.push(new be(f.length,new ne(m.t("filterBar:uncatchable"))));const d=new Rt(0,0,f,this.updateStarters,Dt.HYBRID);this.filterBar.addFilter(we.BIOME,m.t("filterBar:biomeFilter"),d);const y=s.add.sprite(0,0,"shiny_icons");y.setOrigin(.15,.2),y.setScale(.6),y.setFrame(Qt(0)),y.setTint(mt(0));const g=s.add.sprite(0,0,"shiny_icons");g.setOrigin(.15,.2),g.setScale(.6),g.setFrame(Qt(1)),g.setTint(mt(1));const T=s.add.sprite(0,0,"shiny_icons");T.setOrigin(.15,.2),T.setScale(.6),T.setFrame(Qt(2)),T.setTint(mt(2));const E=[new be("SHINY3",new ne("",T)),new be("SHINY2",new ne("",g)),new be("SHINY",new ne("",y)),new be("NORMAL",new ne(m.t("filterBar:normal"))),new be("UNCAUGHT",new ne(m.t("filterBar:uncaught")))];this.filterBar.addFilter(we.CAUGHT,m.t("filterBar:caughtFilter"),new Rt(0,0,E,this.updateStarters,Dt.HYBRID));const b=[new ne(m.t("filterBar:passive"),void 0,J.OFF),new ne(m.t("filterBar:passiveUnlocked"),void 0,J.ON),new ne(m.t("filterBar:passiveUnlockable"),void 0,J.UNLOCKABLE),new ne(m.t("filterBar:passiveLocked"),void 0,J.EXCLUDE)],_=[new ne(m.t("filterBar:costReduction"),void 0,J.OFF),new ne(m.t("filterBar:costReductionUnlocked"),void 0,J.ON),new ne(m.t("filterBar:costReductionUnlockedOne"),void 0,J.ONE),new ne(m.t("filterBar:costReductionUnlockedTwo"),void 0,J.TWO),new ne(m.t("filterBar:costReductionUnlockable"),void 0,J.UNLOCKABLE),new ne(m.t("filterBar:costReductionLocked"),void 0,J.EXCLUDE)],O=[new be("PASSIVE",b),new be("COST_REDUCTION",_)];this.filterBar.addFilter(we.UNLOCKS,m.t("filterBar:unlocksFilter"),new Rt(0,0,O,this.updateStarters,Dt.RADIAL));const w=[new ne(m.t("filterBar:starter"),void 0,J.OFF),new ne(m.t("filterBar:isStarter"),void 0,J.ON),new ne(m.t("filterBar:notStarter"),void 0,J.EXCLUDE)],U=[new ne(m.t("filterBar:favorite"),void 0,J.OFF),new ne(m.t("filterBar:isFavorite"),void 0,J.ON),new ne(m.t("filterBar:notFavorite"),void 0,J.EXCLUDE)],B=[new ne(m.t("filterBar:ribbon"),void 0,J.OFF),new ne(m.t("filterBar:hasWon"),void 0,J.ON),new ne(m.t("filterBar:hasNotWon"),void 0,J.EXCLUDE)],K=[new ne(m.t("filterBar:hiddenAbility"),void 0,J.OFF),new ne(m.t("filterBar:hasHiddenAbility"),void 0,J.ON),new ne(m.t("filterBar:noHiddenAbility"),void 0,J.EXCLUDE)],V=[new ne(m.t("filterBar:seenSpecies"),void 0,J.OFF),new ne(m.t("filterBar:isSeen"),void 0,J.ON),new ne(m.t("filterBar:isUnseen"),void 0,J.EXCLUDE)],te=[new ne(m.t("filterBar:encounteredSpecies"),void 0,J.OFF),new ne(m.t("filterBar:isEncountered"),void 0,J.ON),new ne(m.t("filterBar:isNotEncountered"),void 0,J.EXCLUDE)],de=[new ne(m.t("filterBar:egg"),void 0,J.OFF),new ne(m.t("filterBar:eggPurchasable"),void 0,J.ON)],k=[new ne(m.t("filterBar:pokerus"),void 0,J.OFF),new ne(m.t("filterBar:hasPokerus"),void 0,J.ON)],j=[new be("STARTER",w),new be("FAVORITE",U),new be("WIN",B),new be("HIDDEN_ABILITY",K),new be("SEEN_SPECIES",V),new be("ENCOUNTERED_SPECIES",te),new be("EGG",de),new be("POKERUS",k)];this.filterBar.addFilter(we.MISC,m.t("filterBar:miscFilter"),new Rt(0,0,j,this.updateStarters,Dt.RADIAL));const I=[new be(Qe.NUMBER,new ne(m.t("filterBar:sortByNumber"),void 0,J.ON)),new be(Qe.COST,new ne(m.t("filterBar:sortByCost"))),new be(Qe.CANDY,new ne(m.t("filterBar:sortByCandies"))),new be(Qe.IV,new ne(m.t("filterBar:sortByIVs"))),new be(Qe.NAME,new ne(m.t("filterBar:sortByName"))),new be(Qe.CAUGHT,new ne(m.t("filterBar:sortByNumCaught"))),new be(Qe.HATCHED,new ne(m.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(we.SORT,m.t("filterBar:sortFilter"),new Rt(0,0,I,this.updateStarters,Dt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),s.uiTheme||r.setVisible(!1),this.iconAnimHandler=new ja,this.iconAnimHandler.setup(),this.pokemonNumberText=P(6,141,"",A.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=P(6,128,"",A.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonFormText=P(6,121,"",A.INSTRUCTIONS_TEXT,{fontSize:n.instructionTextSize}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText);const $=s.add.container(Yn+6,9);this.starterSelectScrollBar=new _s(161,12,5,r.height-6,9),$.add(this.starterSelectScrollBar),this.pokerusCursorObjs=[];for(let H=0;H<_f;H++){const ee=s.add.image(0,0,"select_cursor_pokerus");ee.setVisible(!1),ee.setOrigin(0,0),$.add(ee),this.pokerusCursorObjs.push(ee)}this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),$.add(this.cursorObj);for(const H of it)this.speciesLoaded.set(H.speciesId,!1);for(let H=0;H<81;H++){const ee=new va(it[H]).setVisible(!1),L=pr(H);ee.setPosition(L.x,L.y),this.iconAnimHandler.addOrUpdate(ee.icon,Nt.NONE),this.pokemonContainers.push(ee),$.add(ee)}this.formTrayContainer=s.add.container(0,0),this.trayBg=ye(0,0,0,0),this.trayBg.setOrigin(0,0),this.formTrayContainer.add(this.trayBg),this.trayCursorObj=s.add.image(0,0,"select_cursor"),this.trayCursorObj.setOrigin(0,0),this.formTrayContainer.add(this.trayCursorObj),$.add(this.formTrayContainer),$.bringToTop(this.formTrayContainer),this.formTrayContainer.setVisible(!1),this.starterSelectContainer.add($),this.pokemonSprite=s.add.sprite(96,143,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.type1Icon=s.add.sprite(10,158,Ns("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(28,158,Ns("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.starterSelectMessageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=ye(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox);const re=n.instructionTextSize;this.goFilterIconElement1=new Phaser.GameObjects.Sprite(s,10,2,"keyboard","C.png"),this.goFilterIconElement1.setName("sprite-goFilter1-icon-element"),this.goFilterIconElement1.setScale(.675),this.goFilterIconElement1.setOrigin(0,0),this.goFilterIconElement2=new Phaser.GameObjects.Sprite(s,20,2,"keyboard","V.png"),this.goFilterIconElement2.setName("sprite-goFilter2-icon-element"),this.goFilterIconElement2.setScale(.675),this.goFilterIconElement2.setOrigin(0,0),this.goFilterLabel=P(30,2,m.t("pokedexUiHandler:goFilters"),A.INSTRUCTIONS_TEXT,{fontSize:re}),this.goFilterLabel.setName("text-goFilter-label"),this.starterSelectContainer.add(this.goFilterIconElement1),this.starterSelectContainer.add(this.goFilterIconElement2),this.starterSelectContainer.add(this.goFilterLabel),this.toggleDecorationsIconElement=new Phaser.GameObjects.Sprite(s,10,10,"keyboard","R.png"),this.toggleDecorationsIconElement.setName("sprite-toggleDecorations-icon-element"),this.toggleDecorationsIconElement.setScale(.675),this.toggleDecorationsIconElement.setOrigin(0,0),this.toggleDecorationsLabel=P(20,10,m.t("pokedexUiHandler:toggleDecorations"),A.INSTRUCTIONS_TEXT,{fontSize:re}),this.toggleDecorationsLabel.setName("text-toggleDecorations-label"),this.starterSelectContainer.add(this.toggleDecorationsIconElement),this.starterSelectContainer.add(this.toggleDecorationsLabel),this.showFormTrayIconElement=new Phaser.GameObjects.Sprite(s,6,168,"keyboard","F.png"),this.showFormTrayIconElement.setName("sprite-showFormTray-icon-element"),this.showFormTrayIconElement.setScale(.675),this.showFormTrayIconElement.setOrigin(0,0),this.showFormTrayLabel=P(16,168,m.t("pokedexUiHandler:showForms"),A.INSTRUCTIONS_TEXT,{fontSize:re}),this.showFormTrayLabel.setName("text-showFormTray-label"),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.starterSelectContainer.add(this.showFormTrayIconElement),this.starterSelectContainer.add(this.showFormTrayLabel),this.message=P(8,8,"",A.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.pokemonNameText),this.starterSelectContainer.bringToTop(this.pokemonFormText)}show(e){return this.starterPreferences||(this.starterPreferences=Ar()),this.pokerusSpecies=Af(),e.length>=1&&e[0]==="refresh"?!1:(super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.pokemonContainers.forEach(t=>{const i=t.icon,n=t.species;this.starterPreferences[n.speciesId]=this.initStarterPrefs(n),this.setUpgradeAnimation(i,n)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setFilterTextMode(!1),this.filterTextCursor=0,this.setCursor(0),this.filterTextContainer.setVisible(!0),!0)}initStarterPrefs(e){const t=this.starterPreferences[e.speciesId],i=s.gameData.dexData[e.speciesId],n=s.gameData.starterData[e.speciesId];if(!t||!i.caughtAttr)return{};const a=i.caughtAttr&e.getFullUnlocksData(),r=a&F.SHINY,o=a&F.NON_SHINY;if(t.shiny&&!r?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const h=[r&&a&F.DEFAULT_VARIANT,r&&a&F.VARIANT_2,r&&a&F.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!h[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&((t.female?a&F.FEMALE:a&F.MALE)||(t.female=void 0)),t.ability!==void 0){const h=e.ability2===e.ability1,u=n.abilityAttr,p=u&rt.ABILITY_1,f=u&rt.ABILITY_2,d=u&rt.ABILITY_HIDDEN;[p,h?f&&!p:f,d][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!e.forms[l]?.isStarterSelectable||!(a&s.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&s.gameData.getNaturesForAttr(i.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.filterText.setValsToDefault()}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!e?.length)}isSeen(e,t,i){return t?.seenAttr?!0:i?!1:!!s.gameData.dexData[this.getStarterSpeciesId(e.speciesId)]?.caughtAttr}isEncountered(e,t,i){return!!t.seenCount}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return ze.hasOwnProperty(e)?e:_r[e]}isPassiveAvailable(e){const t=s.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=an(ze[this.getStarterSpeciesId(e)])&&!(t.passiveAttr&bt.UNLOCKED)}isValueReductionAvailable(e){const t=s.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=rn(ze[this.getStarterSpeciesId(e)])[t.valueReduction]&&t.valueReduction<BT}isSameSpeciesEggAvailable(e){return s.gameData.starterData[this.getStarterSpeciesId(e)].candyCount>=on(ze[this.getStarterSpeciesId(e)])}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,loop:-1,paused:i,delay:xf(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:-3,duration:ge(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:-1,duration:ge(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!t?.speciesId;if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}processInput(e){if(this.blockInput)return!1;const t=9,i=this.filteredPokemonData.length,n=Math.ceil(i/t),a=this.scrollCursor*t,r=Math.floor((a+this.cursor)/t),o=this.getUi();let l=!1,h=!1;if(e===v.SUBMIT)h=!0;else if(e===v.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),l=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBarCursor).hasDefaultValues()?(this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),l=!0):this.filterTextMode&&this.filterText.getValue(this.filterTextCursor)!==this.filterText.defaultText?(this.filterText.resetSelection(this.filterTextCursor),l=!0):this.showingTray?l=this.closeFormTray():(this.tryExit(),l=!0);else if(e===v.STATS)!this.filterMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterText.cursorObj.setVisible(!1),this.filterTextMode=!1,this.filterBarCursor=0,this.setFilterMode(!0)):h=!0;else if(e===v.CYCLE_TERA)!this.filterTextMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterBar.cursorObj.setVisible(!1),this.filterMode=!1,this.filterTextCursor=0,this.setFilterTextMode(!0)):h=!0;else if(e===v.CYCLE_SHINY)this.showingTray?h=!0:(this.showDecorations=!this.showDecorations,this.updateScroll(),l=!0);else if(this.filterMode)switch(e){case v.LEFT:this.filterBarCursor>0?l=this.setCursor(this.filterBarCursor-1):l=this.setCursor(this.filterBar.numFilters-1);break;case v.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?l=this.setCursor(this.filterBarCursor+1):l=this.setCursor(0);break;case v.UP:if(this.filterBar.openDropDown)l=this.filterBar.decDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,n-9),this.updateScroll();const u=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),p=Math.min(8,u<.5?Math.floor(u*8):Math.ceil(u*8));i%9>p?this.setCursor(i-i%9+p-this.scrollCursor*9):this.setCursor(Math.max(i-i%9+p-9-this.scrollCursor*9,0)),l=!0}break;case v.DOWN:if(this.filterBar.openDropDown)l=this.filterBar.incDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const u=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),p=Math.min(8,u<.5?Math.floor(u*8):Math.ceil(u*8));this.setCursor(Math.min(p,i-1)),l=!0}break;case v.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),l=!0;break}else if(this.filterTextMode)switch(e){case v.LEFT:if(i>0){this.setFilterTextMode(!1);const u=this.filterTextCursor;this.setCursor(u<n-1?(u+1)*t-1:i-1),l=!0}break;case v.RIGHT:if(i>0){this.setFilterTextMode(!1);const u=this.filterTextCursor;this.setCursor(u<n?u*t:(n-1)*t),l=!0}break;case v.UP:this.filterTextCursor>0?l=this.setCursor(this.filterTextCursor-1):l=this.setCursor(this.filterText.numFilters-1);break;case v.DOWN:this.filterTextCursor<this.filterText.numFilters-1?l=this.setCursor(this.filterTextCursor+1):l=this.setCursor(0);break;case v.ACTION:this.filterText.startSearch(this.filterTextCursor,this.getUi()),l=!0;break}else if(this.showingTray)if(e===v.ACTION){const u=this.trayForms[this.trayCursor].formIndex;o.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,{form:u},this.filteredIndices),l=!0}else{const u=this.trayContainers.length,p=Math.ceil(u/t),f=Math.floor(this.trayCursor/t);switch(e){case v.UP:if(f>0)l=this.setTrayCursor(this.trayCursor-9);else{const d=this.trayCursor;u%9>d?l=this.setTrayCursor(u-u%9+d):l=this.setTrayCursor(Math.max(u-u%9+d-9,0))}break;case v.DOWN:f<p-1?l=this.setTrayCursor(this.trayCursor+9):l=this.setTrayCursor(this.trayCursor%9);break;case v.LEFT:this.trayCursor%9!==0?l=this.setTrayCursor(this.trayCursor-1):l=this.setTrayCursor(f<p-1?(f+1)*t-1:u-1);break;case v.RIGHT:this.trayCursor%9<(f<p-1?8:(u-1)%9)?l=this.setTrayCursor(this.trayCursor+1):l=this.setTrayCursor(f*9);break;case v.CYCLE_FORM:l=this.closeFormTray();break}}else if(e===v.ACTION)o.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,null,this.filteredIndices),l=!0;else switch(e){case v.UP:r>0?this.scrollCursor>0&&r-this.scrollCursor===0?(this.scrollCursor--,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor-9):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case v.DOWN:r<n-1&&this.cursor+9<this.filteredPokemonData.length?r-this.scrollCursor===8?(this.scrollCursor++,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor+9):n>1?(this.scrollCursor=0,this.updateScroll(),l=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case v.LEFT:this.cursor%9!==0?l=this.setCursor(this.cursor-1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case v.RIGHT:this.cursor%9<(r<n-1?8:(i-1)%9)?l=this.setCursor(this.cursor+1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case v.CYCLE_FORM:{const u=this.pokemonContainers[this.cursor].species;this.canShowFormTray&&(l=this.openFormTray(u));break}}return l?o.playSelect():h&&o.playError(),l||h}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case ae.Button_Cycle_Shiny:a="R.png";break;case ae.Button_Cycle_Form:a="F.png";break;case ae.Button_Stats:a="C.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}updateFilterButtonIcon(e,t,i,n){let a;t==="touch"?(t="keyboard",a="C.png"):a=s.inputController?.getIconForLatestInputRecorded(e),i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}getSanitizedProps(e){return{shiny:!1,female:e.female,variant:0,formIndex:e.formIndex}}hasFormLevelMove(e,t){return!pokemonFormLevelMoves.hasOwnProperty(e.speciesId)||!pokemonFormLevelMoves[e.speciesId].hasOwnProperty(e.formIndex)?!1:pokemonFormLevelMoves[e.speciesId][e.formIndex].map(n=>Fe[n[1]].name).includes(t)}updateStarters=c(()=>{this.scrollCursor=0,this.filteredPokemonData=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),this.filterText.updateFilterLabels(),this.filteredPokemonData=[],it.forEach(t=>{const i=this.getStarterSpeciesId(t.speciesId),n=this.getCurrentDexProps(t.speciesId),a=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(t,n)),r={species:t,cost:s.gameData.getSpeciesStarterValue(i),props:a},o=(s.gameData.dexData[t.speciesId]?.caughtAttr||BigInt(0))&(s.gameData.dexData[this.getStarterSpeciesId(t.speciesId)]?.caughtAttr||BigInt(0))&t.getFullUnlocksData(),l=s.gameData.starterData[i],h=Lt.hasOwnProperty(i),u=this.filterText.getValue(dt.NAME),p=t.name===u||u===this.filterText.defaultText,f=pokemonSpeciesLevelMoves[t.speciesId].map(q=>Fe[q[1]].name),d=Lt[i]?.map(q=>Fe[q].name)??[],y=Ef[t.speciesId]?.map(q=>Fe[Array.isArray(q)?q[1]:q].name)??[],g=this.filterText.getValue(dt.MOVE_1),T=this.filterText.getValue(dt.MOVE_2),E=t.forms.some(q=>this.hasFormLevelMove(q,g)),b=t.forms.some(q=>this.hasFormLevelMove(q,T)),_=f.includes(g)||E,O=d.includes(g),w=y.includes(g),U=f.includes(T)||b,B=d.includes(T),K=y.includes(T),V=_||O||w||g===this.filterText.defaultText,te=U||B||K||T===this.filterText.defaultText,de=V&&te;if(O&&!_){const q=d.indexOf(g);(l.eggMoves&1<<q)===0?r.eggMove1=!1:r.eggMove1=!0}else w&&!_&&(r.tmMove1=!0);if(B&&!U){const q=d.indexOf(T);(l.eggMoves&1<<q)===0?r.eggMove2=!1:r.eggMove2=!0}else K&&!U&&(r.tmMove2=!0);const k=[t.ability1,t.ability2,t.abilityHidden].map(q=>Et[q].name),j=[t.getPassiveAbility()];for(const q of t.forms)j.push(q.getPassiveAbility());const I=this.filterText.getValue(dt.ABILITY_1),$=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(ys=>Et[ys].name).includes(I)),re=k.includes(I)||$||I===this.filterText.defaultText,H=Object.values(j).some(q=>Et[q].name===I),ee=this.filterText.getValue(dt.ABILITY_2),L=t.forms.some(q=>[q.ability1,q.ability2,q.abilityHidden].map(ys=>Et[ys].name).includes(ee)),Ee=k.includes(ee)||L||ee===this.filterText.defaultText,W=Object.values(j).some(q=>Et[q].name===ee),Y=re&&(W||ee===this.filterText.defaultText)||Ee&&(H||I===this.filterText.defaultText);(H||W)&&(H?l.passiveAttr>0?r.passive1=!0:r.passive1=!1:l.passiveAttr>0?r.passive2=!0:r.passive2=!1);const me=this.filterBar.getVals(we.GEN).includes(t.generation),fe=this.filterBar.getVals(we.TYPES).some(q=>t.isOfType(q-1)),Z=new Map(Object.values(Je).map((q,ys)=>typeof q=="string"?[ys,q]:void 0).filter(q=>q!==void 0));Z.set(35,"Uncatchable");const Ce=na[t.speciesId].concat(na[i]).map(q=>Je[q.biome]);Ce.length===0&&Ce.push("Uncatchable");const Ue=Ce.length===0&&this.filterBar.getVals(we.BIOME).length===36,xe=this.filterBar.getVals(we.BIOME).some(q=>Ce.includes(Z.get(q)??""))||Ue,Le=!!(o&F.NON_SHINY),at=!!(o&F.SHINY),We=at&&!!(o&F.DEFAULT_VARIANT),pt=at&&!!(o&F.VARIANT_2),Ie=at&&!!(o&F.VARIANT_3),S=!Le&&!We&&!pt&&!Ie,Q=this.filterBar.getVals(we.CAUGHT).some(q=>{if(q==="SHINY3")return Ie;if(q==="SHINY2")return pt&&!Ie;if(q==="SHINY")return We&&!pt&&!Ie;if(q==="NORMAL")return Le&&!We&&!pt&&!Ie;if(q==="UNCAUGHT")return S}),X=l.passiveAttr>0,N=this.isPassiveAvailable(t.speciesId)&&!X,M=this.filterBar.getVals(we.UNLOCKS).some(q=>{if(q.val==="PASSIVE"&&q.state===J.ON)return X;if(q.val==="PASSIVE"&&q.state===J.EXCLUDE)return h&&!X;if(q.val==="PASSIVE"&&q.state===J.UNLOCKABLE)return N;if(q.val==="PASSIVE"&&q.state===J.OFF)return!0}),R=l.valueReduction===1,se=l.valueReduction===2,ie=this.isValueReductionAvailable(t.speciesId),z=this.filterBar.getVals(we.UNLOCKS).some(q=>{if(q.val==="COST_REDUCTION"&&q.state===J.ON)return R||se;if(q.val==="COST_REDUCTION"&&q.state===J.ONE)return R;if(q.val==="COST_REDUCTION"&&q.state===J.TWO)return se;if(q.val==="COST_REDUCTION"&&q.state===J.EXCLUDE)return h&&!(R||se);if(q.val==="COST_REDUCTION"&&q.state===J.UNLOCKABLE)return ie;if(q.val==="COST_REDUCTION"&&q.state===J.OFF)return!0}),oe=this.getStarterSpeciesId(t.speciesId)===t.speciesId,Te=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="STARTER"&&q.state===J.ON)return oe;if(q.val==="STARTER"&&q.state===J.EXCLUDE)return!oe;if(q.val==="STARTER"&&q.state===J.OFF)return!0}),he=this.starterPreferences[t.speciesId]?.favorite??!1,_e=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="FAVORITE"&&q.state===J.ON)return he;if(q.val==="FAVORITE"&&q.state===J.EXCLUDE)return!he;if(q.val==="FAVORITE"&&q.state===J.OFF)return!0}),Ze=l.classicWinCount>0,De=l.classicWinCount===0,Vt=l.classicWinCount===void 0,js=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="WIN"&&q.state===J.ON)return Ze;if(q.val==="WIN"&&q.state===J.EXCLUDE)return De||Vt;if(q.val==="WIN"&&q.state===J.OFF)return!0}),qt=t.abilityHidden!==t.ability1&&t.abilityHidden!==Ha.NONE,Ps=l.abilityAttr&rt.ABILITY_HIDDEN,lt=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="HIDDEN_ABILITY"&&q.state===J.ON)return Ps;if(q.val==="HIDDEN_ABILITY"&&q.state===J.EXCLUDE)return qt&&!Ps;if(q.val==="HIDDEN_ABILITY"&&q.state===J.OFF)return!0}),Bs=s.gameData.dexData[t.speciesId],oi=this.isSeen(t,Bs,!0)||!!Bs.caughtAttr,as=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="SEEN_SPECIES"&&q.state===J.ON)return oi;if(q.val==="SEEN_SPECIES"&&q.state===J.EXCLUDE)return!oi;if(q.val==="SEEN_SPECIES"&&q.state===J.OFF)return!0}),Di=this.isEncountered(t,Bs,!0),$a=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="ENCOUNTERED_SPECIES"&&q.state===J.ON)return Di;if(q.val==="ENCOUNTERED_SPECIES"&&q.state===J.EXCLUDE)return!Di;if(q.val==="ENCOUNTERED_SPECIES"&&q.state===J.OFF)return!0}),An=this.isSameSpeciesEggAvailable(t.speciesId),Xa=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="EGG"&&q.state===J.ON)return An;if(q.val==="EGG"&&q.state===J.EXCLUDE)return h&&!An;if(q.val==="EGG"&&q.state===J.OFF)return!0}),xn=this.filterBar.getVals(we.MISC).some(q=>{if(q.val==="POKERUS"&&q.state===J.ON)return this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===J.EXCLUDE)return!this.pokerusSpecies.includes(t);if(q.val==="POKERUS"&&q.state===J.OFF)return!0});p&&Y&&de&&me&&xe&&fe&&Q&&M&&z&&Te&&_e&&js&&lt&&as&&$a&&Xa&&xn&&this.filteredPokemonData.push(r)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredPokemonData.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(we.SORT)[0];this.filteredPokemonData.sort((t,i)=>{switch(e.val){case Qe.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case Qe.COST:return(t.cost-i.cost)*-e.dir;case Qe.CANDY:{const n=s.gameData.starterData[this.getStarterSpeciesId(t.species.speciesId)].candyCount,a=s.gameData.starterData[this.getStarterSpeciesId(i.species.speciesId)].candyCount;return(n-a)*-e.dir}case Qe.IV:{const n=s.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[t.species.speciesId].ivs.length,a=s.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case Qe.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case Qe.CAUGHT:return(s.gameData.dexData[t.species.speciesId].caughtCount-s.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case Qe.HATCHED:return(s.gameData.dexData[this.getStarterSpeciesId(t.species.speciesId)].hatchedCount-s.gameData.dexData[this.getStarterSpeciesId(i.species.speciesId)].hatchedCount)*-e.dir}return 0}),this.filteredIndices=this.filteredPokemonData.map(t=>t.species.speciesId),this.updateScroll()},"updateStarters");updateScroll=c(()=>{const t=this.scrollCursor*9;this.starterSelectScrollBar.setScrollCursor(this.scrollCursor),this.pokerusCursorObjs.forEach(n=>n.setVisible(!1));let i=0;this.pokemonContainers.forEach((n,a)=>{const r=a+t;if(r>=this.filteredPokemonData.length)n.setVisible(!1);else{n.setVisible(!0);const o=this.filteredPokemonData[r],l=o.props;n.setSpecies(o.species,l),n.icon.setTexture(o.species.getIconAtlasKey(l.formIndex,l.shiny,l.variant),n.species.getIconId(l.female,l.formIndex,l.shiny,l.variant)),n.checkIconId(l.female,l.formIndex,l.shiny,l.variant);const u=o.species.speciesId,p=s.gameData.dexData[u],f=p.caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(u)].caughtAttr&o.species.getFullUnlocksData();if(f&o.species.getFullUnlocksData()||s.dexForDevs?n.icon.clearTint():this.isSeen(o.species,p)?n.icon.setTint(8421504):n.icon.setTint(0),[[o.eggMove1,n.eggMove1Icon],[o.eggMove2,n.eggMove2Icon],[o.tmMove1,n.tmMove1Icon],[o.tmMove2,n.tmMove2Icon],[o.passive1,n.passive1Icon],[o.passive2,n.passive2Icon]].forEach(([y,g])=>{y?(g.setVisible(!0),g.clearTint()):y===!1?(g.setVisible(!0),g.setTint(8421504)):g.setVisible(!1)}),this.showDecorations){this.pokerusSpecies.includes(o.species)&&(this.pokerusCursorObjs[i].setPosition(n.x-1,n.y+1),this.pokerusCursorObjs[i].setVisible(!0),i++),this.updateStarterValueLabel(n),n.label.setVisible(!0);const y=u&&f&F.SHINY?[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(g=>!!(f&g)):[];for(let g=0;g<3;g++){const T=y.length>g;n.shinyIcons[g].setVisible(T),T&&n.shinyIcons[g].setTint(mt(y[g]===F.DEFAULT_VARIANT?0:y[g]===F.VARIANT_2?1:2))}n.starterPassiveBgs.setVisible(!!s.gameData.starterData[this.getStarterSpeciesId(u)].passiveAttr),n.hiddenAbilityIcon.setVisible(!!f&&!!(s.gameData.starterData[this.getStarterSpeciesId(u)].abilityAttr&4)),n.classicWinIcon.setVisible(s.gameData.starterData[this.getStarterSpeciesId(u)].classicWinCount>0),n.favoriteIcon.setVisible(this.starterPreferences[u]?.favorite??!1),s.candyUpgradeDisplay===0?(yt[this.getStarterSpeciesId(u)]||(yt[this.getStarterSpeciesId(u)]=["ffffff","ffffff"]),n.candyUpgradeIcon.setTint(ss(Gt(yt[this.getStarterSpeciesId(u)][0]))),n.candyUpgradeOverlayIcon.setTint(ss(Gt(yt[this.getStarterSpeciesId(u)][1])))):s.candyUpgradeDisplay===1&&(n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1))}else{n.label.setVisible(!1);for(let y=0;y<3;y++)n.shinyIcons[y].setVisible(!1);n.starterPassiveBgs.setVisible(!1),n.hiddenAbilityIcon.setVisible(!1),n.classicWinIcon.setVisible(!1),n.favoriteIcon.setVisible(!1),n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1)}}})},"updateScroll");setCursor(e){let t=!1;if(this.oldCursor=this.cursor,this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else if(this.filterTextMode)t=this.filterTextCursor!==e,this.filterTextCursor=e,this.filterText.setCursor(e);else{e=Math.max(Math.min(this.pokemonContainers.length-1,e),0),t=super.setCursor(e);const i=pr(e);this.cursorObj.setPosition(i.x-1,i.y+1);const n=this.pokemonContainers[e]?.species;if(n)return this.setSpecies(n),!0}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&this.setSpecies(null),!0):!1}setFilterTextMode(e){return this.cursorObj.setVisible(!e),this.filterText.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterTextMode?(this.filterTextMode=e,this.setCursor(e?this.filterTextCursor:this.cursor),e&&this.setSpecies(null),!0):!1}openFormTray(e){this.trayForms=e.forms.filter(g=>!g.isUnobtainable),this.trayNumIcons=this.trayForms.length,this.trayRows=Math.floor(this.trayNumIcons/9)+(this.trayNumIcons%9===0?0:1),this.trayColumns=Math.min(this.trayNumIcons,9);const t=9,i=this.cursor,n=Math.floor(i/t),a=i-n*9,r=8-n,o=9-a,l=pr(this.cursor),h=this.trayRows<=r-1?0:1,u=this.trayColumns<=o?0:1;this.trayBg.setSize(13+this.trayColumns*17,8+this.trayRows*18),this.formTrayContainer.setX((u?l.x-18*(this.trayColumns-o):l.x)-3),this.formTrayContainer.setY(h?l.y-this.trayBg.height:l.y+17);const p=s.gameData.dexData[e.speciesId],f=this.getCurrentDexProps(e.speciesId),d=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(this.lastSpecies,f));this.trayContainers=[];const y=this.isSeen(e,p);return this.trayForms.map((g,T)=>{const E=p?(p.caughtAttr&e.getFullUnlocksData()&s.gameData.getFormAttr(g.formIndex??0))>0n:!1,b=new va(e,{formIndex:g.formIndex,female:d.female,shiny:d.shiny,variant:d.variant});this.iconAnimHandler.addOrUpdate(b.icon,Nt.NONE),E||s.dexForDevs?b.icon.clearTint():y?b.icon.setTint(8421504):b.icon.setTint(0),b.setPosition(5+T%9*18,4+Math.floor(T/9)*17),this.formTrayContainer.add(b),this.trayContainers.push(b)}),this.showingTray=!0,this.setTrayCursor(0),this.formTrayContainer.setVisible(!0),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),!0}closeFormTray(){return this.trayContainers.forEach(e=>{this.formTrayContainer.remove(e,!0)}),this.trayContainers=[],this.formTrayContainer.setVisible(!1),this.showingTray=!1,this.setSpeciesDetails(this.lastSpecies),!0}setTrayCursor(e){if(!this.showingTray)return!1;e=Phaser.Math.Clamp(this.trayContainers.length-1,e,0);const t=this.trayCursor!==e;t&&(this.trayCursor=e),this.trayCursorObj.setPosition(5+e%9*18,4+Math.floor(e/9)*17);const i=this.lastSpecies,n=this.trayForms[e].formIndex;return this.setSpeciesDetails(i,{formIndex:n}),t}getFriendship(e){let t=s.gameData.starterData[this.getStarterSpeciesId(e)].friendship;(!t||t===void 0)&&(t=0);const i=mh(ze[e]);return{currentFriendship:t,friendshipCap:i}}startIconAnimation(e){const i=this.pokemonContainers[e].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(i).forEach(n=>n.pause()),i.x=-2,i.y=2),this.iconAnimHandler.addOrUpdate(i,Nt.PASSIVE)}stopIconAnimation(e){const t=this.pokemonContainers[e];if(t){const i=t.icon,n=this.getCurrentDexProps(t.species.speciesId),a=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(t.species,n));this.checkIconId(i,t.species,a.female,a.formIndex,a.shiny,a.variant),this.iconAnimHandler.addOrUpdate(i,Nt.NONE),s.tweens.getTweensOf(i).forEach(r=>r.play())}}setSpecies(e){if(this.speciesStarterDexEntry=e?s.gameData.dexData[e.speciesId]:null,!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.lastSpecies&&this.stopIconAnimation(this.oldCursor),e&&(this.lastSpecies=e),e&&(this.speciesStarterDexEntry?.seenAttr||this.speciesStarterDexEntry?.caughtAttr||s.dexForDevs))if(this.pokemonNumberText.setText(m.t("pokedexUiHandler:pokemonNumber")+ri(e.speciesId,4)),this.pokemonNameText.setText(e.name),this.speciesStarterDexEntry?.caughtAttr||s.dexForDevs){this.startIconAnimation(this.cursor);const t=$t(e.speciesId,0);this.setTypeIcons(t.type1,t.type2),this.setSpeciesDetails(e,{}),this.pokemonSprite.clearTint(),this.type1Icon.clearTint(),this.type2Icon.clearTint()}else this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.setSpeciesDetails(e),this.pokemonSprite.setTint(8421504);else this.pokemonNumberText.setText(e?m.t("pokedexUiHandler:pokemonNumber")+ri(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonFormText.setText(""),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),e&&(this.pokemonSprite.setTint(0),this.setSpeciesDetails(e,{}))}setSpeciesDetails(e,t={}){let{shiny:i,formIndex:n,female:a,variant:r}=t;if(e?.forms?.find(o=>o.formKey==="female")&&(a!==void 0?n=a?1:0:n!==void 0&&(a=n===1)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const o=s.gameData.dexData[e.speciesId],l=o.caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e.speciesId)].caughtAttr&e.getFullUnlocksData();if(l){const f=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)));i===void 0&&(i=f.shiny),n===void 0&&(n=f.formIndex),a===void 0&&(a=f.female),r===void 0&&(r=f.variant)}const h=o?(l&s.gameData.getFormAttr(n??0))>0n:!1,u=this.isSeen(e,o),p=new ot(!1);if(this.assetLoadCancelled=p,e.loadAssets(a,n,i,r,!0).then(()=>{p.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setPipelineData("shiny",i),this.pokemonSprite.setPipelineData("variant",r),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setVisible(!0))}),h||s.dexForDevs?this.pokemonSprite.clearTint():u?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),h||u||s.dexForDevs?vf.includes(e.speciesId)&&!n?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(n,!1)):this.pokemonFormText.setText(""),h||u||s.dexForDevs){const f=$t(e.speciesId,n??0);this.setTypeIcons(f.type1,f.type2)}else this.setTypeIcons(null,null);e?.forms?.filter(f=>!f.isUnobtainable).length>1?(this.showingTray||(this.showFormTrayIconElement.setVisible(!0),this.showFormTrayLabel.setVisible(!0)),this.canShowFormTray=!0):(this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.canShowFormTray=!1)}else this.setTypeIcons(null,null)}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(Se[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(Se[t].toLowerCase())):this.type2Icon.setVisible(!1)}updateStarterValueLabel(e){const t=e.species.speciesId,i=ze[t],n=s.gameData.getSpeciesStarterValue(this.getStarterSpeciesId(t));e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=A.WINDOW;break;case 1:case .5:r=A.SUMMARY_BLUE;break;default:r=A.SUMMARY_GOLD;break}i-n>0&&(e.label.setColor(this.getTextColor(r)),e.label.setShadowColor(this.getTextColor(r,!0)))}tryExit(){this.blockInput=!0;const e=this.getUi(),t=c(()=>{e.setMode(x.POKEDEX,"refresh"),this.clearText(),this.blockInput=!1},"cancel");return e.showText(m.t("pokedexUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(x.CONFIRM,()=>{e.setMode(x.POKEDEX,"refresh"),this.clearText(),this.clear(),e.revertMode()},t,null,null,19)}),!0}getCurrentDexProps(e){let t=0n;const i=it.find(a=>a.speciesId===e),n=s.gameData.dexData[e].caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&(i?.getFullUnlocksData()??0n);return this.starterPreferences[e]?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterPreferences[e]?.shiny||(n&F.SHINY)>0n&&this.starterPreferences[e]?.shiny!==!1?(t+=F.SHINY,this.starterPreferences[e]?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterPreferences[e]?.form?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.form))*F.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}destroy(){this.pokemonContainers=[],this.filteredPokemonData=[]}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}clear(){super.clear(),this.cursor=-1,this.oldCursor=-1,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};c(Ru,"PokedexUiHandler");let Sn=Ru;const fl="LEFT",Hf="RIGHT",Hs=class Hs{modes;selectedMode=x.SETTINGS;navigationMenus=[];labels;constructor(){this.modes=[x.SETTINGS,x.SETTINGS_DISPLAY,x.SETTINGS_AUDIO,x.SETTINGS_GAMEPAD,x.SETTINGS_KEYBOARD],this.labels=[m.t("settings:general"),m.t("settings:display"),m.t("settings:audio"),m.t("settings:gamepad"),m.t("settings:keyboard")]}reset(){this.selectedMode=x.SETTINGS,this.updateNavigationMenus()}static getInstance(){return Hs.instance||(Hs.instance=new Hs),Hs.instance}navigate(e){const t=this.modes.indexOf(this.selectedMode),i=this.modes.length-1,n=e===fl?-1:1;t===0&&e===fl?this.selectedMode=this.modes[i]:t===i&&e===Hf?this.selectedMode=this.modes[0]:this.selectedMode=this.modes[t+n],s.ui.setMode(this.selectedMode),this.updateNavigationMenus()}updateNavigationMenus(){for(const e of this.navigationMenus)e.update()}updateIcons(){for(const e of this.navigationMenus)e.updateIcons()}clearNavigationMenus(){this.navigationMenus.length=0}};c(Hs,"NavigationManager"),qa(Hs,"instance");let Xt=Hs;const Fu=class Fu extends Phaser.GameObjects.Container{navigationIcons;headerTitles=[];constructor(e,t){super(s,e,t),this.setup()}setup(){const e=Xt.getInstance(),t=ye(0,0,s.scaledCanvas.width-2,24);t.setOrigin(0,0),this.add(t),this.width=t.width,this.height=t.height,this.navigationIcons={};const i=s.add.sprite(8,4,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,8,4),this.navigationIcons.BUTTON_CYCLE_FORM=i;const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(t,t.width-20,4),this.navigationIcons.BUTTON_CYCLE_SHINY=n;let a=i,r=i.width*6;for(const o of e.labels){const l=P(0,0,o,A.SETTINGS_LABEL_NAVBAR);l.setOrigin(0,0),l.setPositionRelative(a,6+r/6,0),this.add(l),this.headerTitles.push(l),a=l,r=l.width}this.add(i),this.add(n),e.navigationMenus.push(this),e.updateNavigationMenus()}update(){const e=Xt.getInstance(),t=e.modes.indexOf(e.selectedMode);for(const[i,n]of this.headerTitles.entries())Um(n,i===t?A.SETTINGS_SELECTED:A.SETTINGS_LABEL)}updateIcons(){const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const t of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(t)){this.navigationIcons[t].setTexture("keyboard"),this.navigationIcons[t].setFrame(e[t]),this.navigationIcons[t].alpha=1;continue}const i=s.inputController?.getIconForLatestInputRecorded(t);if(i){const n=s.inputController?.getLastSourceType();this.navigationIcons[t].setTexture(n),this.navigationIcons[t].setFrame(i),this.navigationIcons[t].alpha=1}else this.navigationIcons[t].alpha=0}}navigate(e){const t=Xt.getInstance();switch(e){case v.CYCLE_FORM:return t.navigate(fl),!0;case v.CYCLE_SHINY:return t.navigate(Hf),!0}return!1}};c(Fu,"NavigationMenu");let _a=Fu;const Uu=class Uu extends Bt{settingsContainer;optionsContainer;messageBoxContainer;navigationContainer;scrollCursor;scrollBar;optionsBg;optionCursors;settingLabels;optionValueLabels;navigationIcons;cursorObj;reloadSettings;reloadRequired;rowsToDisplay;title;settings;localStorageKey;constructor(e,t=null){super(t),this.settings=Of.filter(i=>i.type===e&&!i?.isHidden?.()),this.reloadRequired=!1,this.rowsToDisplay=8}setup(){const e=this.getUi();this.settingsContainer=s.add.container(1,-s.scaledCanvas.height+1),this.settingsContainer.setName(`settings-${this.title}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height-20),Phaser.Geom.Rectangle.Contains),this.navigationIcons={},this.navigationContainer=new _a(0,0),this.optionsBg=ye(0,this.navigationContainer.height,s.scaledCanvas.width-2,s.scaledCanvas.height-16-this.navigationContainer.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const t=ye(0,s.scaledCanvas.height-this.navigationContainer.height,s.scaledCanvas.width-2,22);t.setOrigin(0,0);const i=s.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=i;const n=P(0,0,m.t("settings:action"),A.SETTINGS_LABEL);n.setOrigin(0,.15),n.setPositionRelative(i,-n.width/6-2,0);const a=s.add.sprite(0,0,"keyboard");a.setOrigin(0,-.1),a.setPositionRelative(t,n.x-28,4),this.navigationIcons.BUTTON_CANCEL=a;const r=P(0,0,m.t("settings:back"),A.SETTINGS_LABEL);r.setOrigin(0,.15),r.setPositionRelative(a,-r.width/6-2,0),this.optionsContainer=s.add.container(0,0),this.settingLabels=[],this.optionValueLabels=[],this.reloadSettings=this.settings.filter(u=>u?.requireReload);let o=!1;this.settings.forEach((u,p)=>{let f=u.label;u?.requireReload&&(f+="*",o=!0),this.settingLabels[p]=P(8,28+p*16,f,A.SETTINGS_LABEL),this.settingLabels[p].setOrigin(0,0),this.optionsContainer.add(this.settingLabels[p]),this.optionValueLabels.push(u.options.map((b,_)=>{const O=P(0,0,b.label,u.default===_?A.SETTINGS_SELECTED:A.SETTINGS_VALUE);return O.setOrigin(0,0),this.optionsContainer.add(O),O}));const d=this.optionValueLabels[p].map(b=>b.width).reduce((b,_)=>b+=_,0),y=Math.max(78,this.settingLabels[p].displayWidth+8),g=297-y-d/6,T=Math.floor(g/(this.optionValueLabels[p].length-1));let E=0;for(const b of this.optionValueLabels[p])b.setPositionRelative(this.settingLabels[p],y+E,0),E+=b.width/6+T}),this.optionCursors=this.settings.map(u=>u.default),this.scrollBar=new _s(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.scrollBar.setTotalRows(this.settings.length),this.messageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.messageBoxContainer.setName("settings-message-box"),this.messageBoxContainer.setVisible(!1);const l=ye(0,-1,s.scaledCanvas.width-2,48);l.setOrigin(0,1),this.messageBoxContainer.add(l);const h=P(8,-40,"",A.WINDOW,{maxLines:2});if(h.setWordWrapWidth(s.game.canvas.width-60),h.setName("settings-message"),h.setOrigin(0,0),this.messageBoxContainer.add(h),this.message=h,this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.scrollBar),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(this.optionsContainer),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(n),o){const u=P(0,0,`*${m.t("settings:requireReload")}`,A.SETTINGS_LABEL).setOrigin(0,.15).setPositionRelative(t,6,0).setY(n.y);this.settingsContainer.add(u)}this.settingsContainer.add(r),this.settingsContainer.add(this.messageBoxContainer),e.add(this.settingsContainer),this.setCursor(0),this.setScrollCursor(0),this.settingsContainer.setVisible(!1)}updateBindings(){for(const e of Object.keys(this.navigationIcons)){if(e==="BUTTON_HOME"){this.navigationIcons[e].setTexture("keyboard"),this.navigationIcons[e].setFrame("HOME.png"),this.navigationIcons[e].alpha=1;continue}const t=s.inputController?.getIconForLatestInputRecorded(e);if(t){const i=s.inputController?.getLastSourceType();this.navigationIcons[e].setTexture(i),this.navigationIcons[e].setFrame(t),this.navigationIcons[e].alpha=1}else this.navigationIcons[e].alpha=0}Xt.getInstance().updateIcons()}show(e){super.show(e),this.updateBindings();const t=localStorage.hasOwnProperty(this.localStorageKey)?JSON.parse(localStorage.getItem(this.localStorageKey)):{};return this.settings.forEach((i,n)=>this.setOptionCursor(n,t.hasOwnProperty(i.key)?t[i.key]:this.settings[n].default)),this.settingsContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}processInput(e){const t=this.getUi();let i=!1;if(e===v.CANCEL)i=!0,Xt.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor;switch(e){case v.UP:if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const a=this.setCursor(this.rowsToDisplay-1),r=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=a&&r}break;case v.DOWN:if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const a=this.setCursor(0),r=this.setScrollCursor(0);i=a&&r}break;case v.LEFT:this.optionCursors[n]&&(i=this.setOptionCursor(n,this.optionCursors[n]-1,!0));break;case v.RIGHT:this.optionCursors[n]<this.optionValueLabels[n].length-1&&(i=this.setOptionCursor(n,this.optionCursors[n]+1,!0));break;case v.CYCLE_FORM:case v.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break;case v.ACTION:{const a=this.settings[n];a?.activatable&&(i=this.activateSetting(a));break}}}return i&&t.playSelect(),i}activateSetting(e){switch(e.key){case ks.Move_Touch_Controls:return s.inputController.moveTouchControlsHandler.enableConfigurationMode(this.getUi()),!0}return!1}setCursor(e){const t=super.setCursor(e);if(!this.cursorObj){const i=s.scaledCanvas.width-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setOptionCursor(e,t,i){e===-1&&(e=this.cursor+this.scrollCursor);const n=this.settings[e],a=this.optionCursors[e],r=this.optionValueLabels[e][a];r.setColor(this.getTextColor(A.SETTINGS_VALUE)),r.setShadowColor(this.getTextColor(A.SETTINGS_VALUE,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];if(o.setColor(this.getTextColor(A.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(A.SETTINGS_SELECTED,!0)),i){const l=c(()=>{s.gameData.saveSetting(n.key,t),n.requireReload&&(this.reloadRequired=!0)},"saveSetting");if(n.options[t].needConfirmation){const h=c(()=>{s.ui.revertMode(),this.showText(""),l()},"confirmUpdateSetting"),u=c(()=>{s.ui.revertMode(),this.showText(""),this.setOptionCursor(e,a,!1)},"cancelUpdateSetting"),p=n.options[t].confirmationMessage??m.t("settings:defaultConfirmMessage");s.ui.showText(p,null,()=>{s.ui.setOverlayMode(x.CONFIRM,h,u,null,null,1,750)})}else l()}return!0}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}updateSettingsScroll(){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.getUi().bgmBar.toggleBgmBar(s.showBgmBar),this.reloadRequired&&(this.reloadRequired=!1,s.reset(!0,!1,!0))}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}showText(e,t,i,n,a,r){this.messageBoxContainer.setVisible(!!e?.length),super.showText(e,t,i,n,a,r)}};c(Uu,"AbstractSettingsUiHandler");let Cn=Uu;const Vu=class Vu extends Cn{constructor(e=null){super(yh.AUDIO,e),this.title="Audio",this.localStorageKey="settings",this.rowsToDisplay=6}};c(Vu,"SettingsAudioUiHandler");let Aa=Vu;const Hu=class Hu extends Cn{constructor(e=null){super(yh.DISPLAY,e),this.title="Display";const t=this.settings.findIndex(i=>i.key===ks.Language);if(t>=0)switch(localStorage.getItem("prLang")){case"en":this.settings[t].options[0]={value:"English",label:"English"};break;case"es-ES":this.settings[t].options[0]={value:"Espaol (ES)",label:"Espaol (ES)"};break;case"es-MX":this.settings[t].options[0]={value:"Espaol (LATAM)",label:"Espaol (LATAM)"};break;case"fr":this.settings[t].options[0]={value:"Franais",label:"Franais"};break;case"de":this.settings[t].options[0]={value:"Deutsch",label:"Deutsch"};break;case"it":this.settings[t].options[0]={value:"Italiano",label:"Italiano"};break;case"pt-BR":this.settings[t].options[0]={value:"Portugus (BR)",label:"Portugus (BR)"};break;case"ko":case"ko-KR":this.settings[t].options[0]={value:"",label:""};break;case"ja":this.settings[t].options[0]={value:"",label:""};break;case"zh-CN":this.settings[t].options[0]={value:"",label:""};break;case"zh-TW":this.settings[t].options[0]={value:"",label:""};break;case"ca":this.settings[t].options[0]={value:"Catal",label:"Catal (Needs Help)"};break;case"tr":this.settings[t].options[0]={value:"Trke",label:"Trke (Needs Help)"};break;case"ru":this.settings[t].options[0]={value:"",label:" (Needs Help)"};break;case"da":this.settings[t].options[0]={value:"Dansk",label:"Dansk (Needs Help)"};break;case"ro":this.settings[t].options[0]={value:"Romn",label:"Romn (Needs Help)"};break;case"tl":this.settings[t].options[0]={value:"Tagalog",label:"Tagalog (Needs Help)"};break;default:this.settings[t].options[0]={value:"English",label:"English"};break}this.localStorageKey="settings"}};c(Hu,"SettingsDisplayUiHandler");let xa=Hu;const Yu=class Yu extends zs{settingsContainer;optionsContainer;navigationContainer;scrollBar;scrollCursor;optionCursors;cursorObj;optionsBg;actionsBg;settingLabels;optionValueLabels;layout=new Map;inputsIcons;navigationIcons;keys;bindingSettings;setting;settingBlacklisted;settingDeviceDefaults;settingDeviceOptions;configs;commonSettingsCount;textureOverride;titleSelected;localStoragePropertyName;rowsToDisplay;device;constructor(e=null){super(e),this.rowsToDisplay=8}getLocalStorageSetting(){return localStorage.hasOwnProperty(this.localStoragePropertyName)?JSON.parse(localStorage.getItem(this.localStoragePropertyName)):{}}setup(){const e=this.getUi();this.navigationIcons={},this.settingsContainer=s.add.container(1,-s.scaledCanvas.height+1),this.settingsContainer.setName(`settings-${this.titleSelected}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.navigationContainer=new _a(0,0),this.optionsBg=ye(0,this.navigationContainer.height,s.scaledCanvas.width-2,s.scaledCanvas.height-16-this.navigationContainer.height-2),this.optionsBg.setOrigin(0,0),this.actionsBg=ye(0,s.scaledCanvas.height-this.navigationContainer.height,s.scaledCanvas.width-2,22),this.actionsBg.setOrigin(0,0);const t=s.add.sprite(0,0,"keyboard");t.setOrigin(0,-.1),t.setPositionRelative(this.actionsBg,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=t;const i=P(0,0,m.t("settings:action"),A.SETTINGS_LABEL);i.setOrigin(0,.15),i.setPositionRelative(t,-i.width/6-2,0);const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(this.actionsBg,i.x-28,4),this.navigationIcons.BUTTON_CANCEL=n;const a=P(0,0,m.t("settings:back"),A.SETTINGS_LABEL);a.setOrigin(0,.15),a.setPositionRelative(n,-a.width/6-2,0);const r=s.add.sprite(0,0,"keyboard");r.setOrigin(0,-.1),r.setPositionRelative(this.actionsBg,a.x-28,4),this.navigationIcons.BUTTON_HOME=r;const o=P(0,0,m.t("settings:reset"),A.SETTINGS_LABEL);o.setOrigin(0,.15),o.setPositionRelative(r,-o.width/6-2,0),this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.actionsBg),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(n),this.settingsContainer.add(r),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(o);for(const l of this.configs){this.layout[l.padType]=new Map;const h=s.add.container(0,0);h.setVisible(!1);const u=Object.keys(l.settings),p=[],f=[],d={},g=[...Object.keys(this.setting).slice(0,this.commonSettingsCount).map(b=>this.setting[b]),...Object.keys(l.settings)],T=Object.values(Object.keys(this.settingDeviceDefaults).filter(b=>g.includes(b)).map(b=>this.settingDeviceDefaults[b]));Object.keys(this.setting).filter(b=>g.includes(this.setting[b])).forEach((b,_)=>{const O=Tt(b.replace(/Alt(_| )/,"")),w=this.settingBlacklisted.includes(this.setting[b]),U=w?A.SETTINGS_LOCKED:A.SETTINGS_LABEL,B=b.includes("Alt");let K;B?K=`${m.t(`settings:${O}`)}${m.t("settings:alt")}`:K=m.t(`settings:${O}`),p[_]=P(8,28+_*16,K,U),p[_].setOrigin(0,0),h.add(p[_]);const V=[];for(const[$,re]of this.settingDeviceOptions[this.setting[b]].entries()){if(u.includes(this.setting[b])){if($){const L=P(0,0,w?"":re,A.WINDOW);L.setOrigin(0,0),h.add(L),V.push(L);continue}const ee=s.add.sprite(0,0,this.textureOverride?this.textureOverride:l.padType);ee.setOrigin(0,-.15),d[this.setting[b]]=ee,h.add(ee),V.push(ee);continue}const H=P(0,0,re,this.settingDeviceDefaults[this.setting[b]]===$?A.SETTINGS_SELECTED:A.WINDOW);H.setOrigin(0,0),h.add(H),V.push(H)}f.push(V);const te=f[_].map($=>$.width).reduce(($,re)=>$+=re,0),de=Math.max(130,p[_].displayWidth+8),k=297-de-te/6,j=Math.floor(k/(f[_].length-1));let I=0;for(const $ of f[_])$.setPositionRelative(p[_],de+I,0),I+=$.width/6+j}),this.layout[l.padType].optionsContainer=h,this.layout[l.padType].inputsIcons=d,this.layout[l.padType].settingLabels=p,this.layout[l.padType].optionValueLabels=f,this.layout[l.padType].optionCursors=T,this.layout[l.padType].keys=g,this.layout[l.padType].bindingSettings=u,this.settingsContainer.add(h)}this.scrollBar=new _s(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.settingsContainer.add(this.scrollBar),e.add(this.settingsContainer),this.settingsContainer.setVisible(!1)}getActiveConfig(){return s.inputController.getActiveConfig(this.device)}updateBindings(){Object.keys(this.layout).forEach(i=>this.layout[i].optionsContainer.setVisible(!1));const e=this.getActiveConfig();if(!this.setLayout(e))return;const t=this.getLocalStorageSetting();if(this.keys.forEach((i,n)=>{this.setOptionCursor(n,t.hasOwnProperty(i)?t[i]:this.optionCursors[n])}),!!e.custom){for(const i of this.bindingSettings){const n=la(e,i);n?(this.inputsIcons[i].setFrame(n),this.inputsIcons[i].alpha=1):this.inputsIcons[i].alpha=0}this.setCursor(this.cursor),this.setScrollCursor(this.scrollCursor)}}updateNavigationDisplay(){const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const t of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(t)){this.navigationIcons[t].setTexture("keyboard"),this.navigationIcons[t].setFrame(e[t]),this.navigationIcons[t].alpha=1;continue}const i=s.inputController?.getIconForLatestInputRecorded(t);if(i){const n=s.inputController?.getLastSourceType();this.navigationIcons[t].setTexture(n),this.navigationIcons[t].setFrame(i),this.navigationIcons[t].alpha=1}else this.navigationIcons[t].alpha=0}}show(e){return super.show(e),this.updateNavigationDisplay(),Xt.getInstance().updateIcons(),this.updateBindings(),this.settingsContainer.setVisible(!0),this.resetScroll(),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}setLayout(e){if(!e)return this.layout.noGamepads.optionsContainer.setVisible(!0),!1;const t=e.padType,i=this.layout[t];return this.keys=i.keys,this.optionsContainer=i.optionsContainer,this.optionsContainer.setVisible(!0),this.settingLabels=i.settingLabels,this.optionValueLabels=i.optionValueLabels,this.optionCursors=i.optionCursors,this.inputsIcons=i.inputsIcons,this.bindingSettings=i.bindingSettings,this.scrollBar.setTotalRows(i.settingLabels.length),this.scrollBar.setScrollCursor(0),!0}processInput(e){const t=this.getUi();let i=!1;if(this.updateNavigationDisplay(),e===v.CANCEL)i=!0,Xt.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor,a=this.setting[Object.keys(this.setting)[n]];switch(e){case v.ACTION:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||!a.includes("BUTTON_")?i=!1:i=this.setSetting(a,1);break;case v.UP:if(!this.optionValueLabels)return!1;if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const r=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=r&&o}break;case v.DOWN:if(!this.optionValueLabels)return!1;if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const r=this.setCursor(0),o=this.setScrollCursor(0);i=r&&o}break;case v.LEFT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:this.optionCursors[n]&&(i=this.setOptionCursor(n,this.optionCursors[n]-1,!0));break;case v.RIGHT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:this.optionCursors[n]<this.optionValueLabels[n].length-1&&(i=this.setOptionCursor(n,this.optionCursors[n]+1,!0));break;case v.CYCLE_FORM:case v.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break}}return i&&t.playSelect(),i}resetScroll(){this.cursorObj?.destroy(),this.cursorObj=null,this.cursor=0,this.setCursor(0),this.setScrollCursor(0),this.updateSettingsScroll()}setCursor(e){const t=super.setCursor(e);if(!this.optionsContainer)return t;if(!this.cursorObj){const i=s.scaledCanvas.width-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}setOptionCursor(e,t,i){const n=this.setting[Object.keys(this.setting)[e]],a=this.optionCursors[e];if(!this.bindingSettings.includes(n)&&!n.includes("BUTTON_")){const r=this.optionValueLabels[e][a];r.setColor(this.getTextColor(A.WINDOW)),r.setShadowColor(this.getTextColor(A.WINDOW,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];o.setColor(this.getTextColor(A.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(A.SETTINGS_SELECTED,!0))}return i&&this.saveSettingToLocalStorage(n,t),!0}updateSettingsScroll(){if(this.optionsContainer){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};c(Yu,"AbstractControlSettingsUiHandler");let Oa=Yu;const Gu=class Gu extends Oa{constructor(e=null){super(e),this.titleSelected="Gamepad",this.setting=G,this.settingDeviceDefaults=Lf,this.settingDeviceOptions=Bf,this.configs=[Ff,Df,Rf],this.commonSettingsCount=2,this.localStoragePropertyName="settingsGamepad",this.settingBlacklisted=TT,this.device=Me.GAMEPAD}setSetting=qn;setup(){super.setup(),this.layout.noGamepads=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=P(8,28,m.t("settings:gamepadPleasePlug"),A.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e),this.layout.noGamepads.optionsContainer=e,this.layout.noGamepads.label=t}setLayout(e){return e?super.setLayout(e):(this.layout.noGamepads.optionsContainer.setVisible(!0),!1)}updateChosenGamepadDisplay(){this.updateBindings(),this.resetScroll();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Controller)for(const n of Object.keys(this.layout))n!=="noGamepads"&&this.layout[n].optionValueLabels[e][0].setText(ah(s.inputController.selectedDevice[Me.GAMEPAD],20))}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Controller&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};c(Gu,"SettingsGamepadUiHandler");let wa=Gu;const Wu=class Wu extends Oa{constructor(e=null){super(e),this.titleSelected="Keyboard",this.setting=ae,this.settingDeviceDefaults=hT,this.settingDeviceOptions=lT,this.configs=[Or],this.commonSettingsCount=0,this.textureOverride="keyboard",this.localStoragePropertyName="settingsKeyboard",this.settingBlacklisted=cT,this.device=Me.KEYBOARD;const t=s.input.keyboard?.addKey(Phaser.Input.Keyboard.KeyCodes.DELETE),i=s.input.keyboard?.addKey(Phaser.Input.Keyboard.KeyCodes.HOME);t?.on("up",this.onDeleteDown,this),i?.on("up",this.onHomeDown,this)}setSetting=kf;setup(){super.setup(),this.layout.noKeyboard=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=P(8,28,m.t("settings:keyboardPleasePress"),A.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e);const i=s.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(this.actionsBg,this.navigationContainer.width-260,4),this.navigationIcons.BUTTON_DELETE=i;const n=P(0,0,m.t("settings:delete"),A.SETTINGS_LABEL);n.setOrigin(0,.15),n.setPositionRelative(i,-n.width/6-2,0),this.settingsContainer.add(i),this.settingsContainer.add(n),this.layout.noKeyboard.optionsContainer=e,this.layout.noKeyboard.label=t}onHomeDown(){[x.SETTINGS_KEYBOARD,x.SETTINGS_GAMEPAD].includes(s.ui.getMode())&&(s.gameData.resetMappingToFactory(),Xt.getInstance().updateIcons())}onDeleteDown(){if(s.ui.getMode()!==x.SETTINGS_KEYBOARD)return;const e=this.cursor+this.scrollCursor,t=this.settingLabels[e].text,i=sT(t),n=ae[i],a=this.getActiveConfig();gT(this.getActiveConfig(),n)&&(this.saveCustomKeyboardMappingToLocalStorage(a),this.updateBindings(),Xt.getInstance().updateIcons())}setLayout(e){return e?super.setLayout(e):(this.layout.noKeyboard.optionsContainer.setVisible(!0),!1)}updateChosenKeyboardDisplay(){this.updateBindings();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Default_Layout)for(const n of Object.keys(this.layout))n!=="noKeyboard"&&this.layout[n].optionValueLabels[e][0].setText(ah(s.inputController.selectedDevice[Me.KEYBOARD],22))}saveCustomKeyboardMappingToLocalStorage(e){s.gameData.saveMappingConfigs(s.inputController?.selectedDevice[Me.KEYBOARD],e)}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Default_Layout&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};c(Wu,"SettingsKeyboardUiHandler");let Ma=Wu;const Ku=class Ku extends Cn{constructor(e=null){super(yh.GENERAL,e),this.title="General",this.localStorageKey="settings"}};c(Ku,"SettingsUiHandler");let Na=Ku;const zu=class zu extends Phaser.GameObjects.Container{species;icon;shinyIcons=[];label;starterPassiveBgs;hiddenAbilityIcon;favoriteIcon;classicWinIcon;candyUpgradeIcon;candyUpgradeOverlayIcon;cost=0;constructor(e){super(s,0,0),this.species=e;const t=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),i=s.gameData.getSpeciesDexAttrProps(e,t),n=s.add.image(2,5,"passive_bg");n.setOrigin(0,0),n.setScale(.75),n.setVisible(!1),this.add(n),this.starterPassiveBgs=n,this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(i.female,i.formIndex,i.shiny,i.variant),this.icon.setTint(0),this.add(this.icon);for(let p=0;p<3;p++){const f=s.add.image(p*-3+12,2,"shiny_star_small");f.setScale(.5),f.setOrigin(0,0),f.setVisible(!1),this.shinyIcons.push(f)}this.add(this.shinyIcons);const a=P(1,2,"0",A.WINDOW,{fontSize:"32px"});a.setShadowOffset(2,2),a.setOrigin(0,0),a.setVisible(!1),this.add(a),this.label=a;const r=s.add.image(12,7,"ha_capsule");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.hiddenAbilityIcon=r;const o=s.add.image(0,7,"favorite");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.favoriteIcon=o;const l=s.add.image(0,12,"champion_ribbon");l.setOrigin(0,0),l.setScale(.5),l.setVisible(!1),this.add(l),this.classicWinIcon=l;const h=s.add.image(12,12,"candy");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeIcon=h;const u=s.add.image(12,12,"candy_overlay");u.setOrigin(0,0),u.setScale(.25),u.setVisible(!1),this.add(u),this.candyUpgradeOverlayIcon=u}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};c(zu,"StarterContainer");let gl=zu;const wp={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"54px",instructionTextSize:"35px",starterInfoXPos:35},"es-ES":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},"es-MX":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"pt-BR":{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:33},zh:{starterInfoTextSize:"56px",instructionTextSize:"36px",starterInfoXPos:26},ko:{starterInfoTextSize:"60px",instructionTextSize:"38px",starterInfoYOffset:-.5,starterInfoXPos:30},ja:{starterInfoTextSize:"48px",instructionTextSize:"40px",starterInfoYOffset:1,starterInfoXPos:32},ca:{starterInfoTextSize:"48px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:29},da:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tr:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ro:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ru:{starterInfoTextSize:"46px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:26},tl:{starterInfoTextSize:"56px",instructionTextSize:"38px"}},Mp=2,fr=17,Gn=109,Cs=285,Qn=38,Wn=34,En=107,Np=20;function ml(C,e=0){const n=C%9*18,a=13+(Math.floor(C/9)-e)*17;return{x:n,y:a}}c(ml,"calcStarterPosition");function Ch(C){const e=En/7,t=Qn+e/2;return Math.round(t+e*C)}c(Ch,"calcStarterIconY");function kp(C,e=6){let t=En,i=0;for(let n=0;n<e;n++){const a=Math.abs(C-(Ch(n)-13));a<t&&(i=n,t=a)}return i}c(kp,"findClosestStarterIndex");function Pp(C,e){const t=Ch(C)-13;let i=En,n=0;for(let a=0;a<e;a++){const r=Math.abs(t-ml(a*9).y);r<i&&(n=a,i=r)}return n}c(Pp,"findClosestStarterRow");const ju=class ju extends Bt{starterSelectContainer;starterSelectScrollBar;filterBarContainer;filterBar;shinyOverlay;starterContainers=[];filteredStarterContainers=[];validStarterContainers=[];pokemonNumberText;pokemonSprite;pokemonNameText;pokemonGrowthRateLabelText;pokemonGrowthRateText;type1Icon;type2Icon;pokemonLuckLabelText;pokemonLuckText;pokemonGenderText;pokemonUncaughtText;pokemonAbilityLabelText;pokemonAbilityText;pokemonPassiveLabelText;pokemonPassiveText;pokemonNatureLabelText;pokemonNatureText;pokemonMovesContainer;pokemonMoveContainers;pokemonMoveBgs;pokemonMoveLabels;pokemonAdditionalMoveCountLabel;eggMovesLabel;pokemonEggMovesContainer;pokemonEggMoveContainers;pokemonEggMoveBgs;pokemonEggMoveLabels;pokemonCandyContainer;pokemonCandyIcon;pokemonCandyDarknessOverlay;pokemonCandyOverlayIcon;pokemonCandyCountText;pokemonCaughtHatchedContainer;pokemonCaughtCountText;pokemonFormText;pokemonHatchedIcon;pokemonHatchedCountText;pokemonShinyIcon;pokemonPassiveDisabledIcon;pokemonPassiveLockedIcon;teraIcon;activeTooltip;instructionsContainer;filterInstructionsContainer;shinyIconElement;formIconElement;abilityIconElement;genderIconElement;natureIconElement;teraIconElement;goFilterIconElement;shinyLabel;formLabel;genderLabel;abilityLabel;natureLabel;teraLabel;goFilterLabel;starterSelectMessageBox;starterSelectMessageBoxContainer;statsContainer;moveInfoOverlay;statsMode;starterIconsCursorXOffset=-3;starterIconsCursorYOffset=1;starterIconsCursorIndex;filterMode;dexAttrCursor=0n;abilityCursor=-1;natureCursor=-1;teraCursor=Se.UNKNOWN;filterBarCursor=0;starterMoveset;scrollCursor;allSpecies=[];lastSpecies;speciesLoaded=new Map;starterSpecies=[];pokerusSpecies=[];starterAttr=[];starterAbilityIndexes=[];starterNatures=[];starterTeras=[];starterMovesets=[];speciesStarterDexEntry;speciesStarterMoves;canCycleShiny;canCycleForm;canCycleGender;canCycleAbility;canCycleNature;canCycleTera;assetLoadCancelled;cursorObj;starterCursorObjs;pokerusCursorObjs;starterIcons;starterIconsCursorObj;valueLimitLabel;startCursorObj;randomCursorObj;iconAnimHandler;instructionRowX=0;instructionRowY=0;instructionRowTextOffset=9;filterInstructionRowX=0;filterInstructionRowY=0;starterSelectCallback;starterPreferences;originalStarterPreferences;hasSwappedMoves=!1;blockInput=!1;allowTera;constructor(){super(x.STARTER_SELECT)}setup(){const e=this.getUi(),t=m.resolvedLanguage??"en",i=Object.keys(wp).find(Z=>t.includes(Z))??"en",n=wp[i],a=s.scaledCanvas.height,r=s.scaledCanvas.width;this.starterSelectContainer=s.add.container(0,-a).setVisible(!1),e.add(this.starterSelectContainer);const o=s.add.rectangle(0,0,r,a,26720).setOrigin(0),l=s.add.image(0,0,"starter_select_bg").setOrigin(0);this.shinyOverlay=s.add.image(6,6,"summary_overlay_shiny").setOrigin(0).setVisible(!1);const h=ye(Gn,fr+1,175,161),u=s.add.image(Gn+1,fr+2,"starter_container_bg").setOrigin(0);this.filterBarContainer=s.add.container(0,0),this.filterBar=new Ia(Math.min(Gn,Cs),1,210,fr);const p=Array.from({length:9},(Z,Ce)=>new be(Ce+1,new ne(m.t(`starterSelectUiHandler:gen${Ce+1}`)))),f=new Rt(0,0,p,this.updateStarters,Dt.HYBRID);this.filterBar.addFilter(we.GEN,m.t("filterBar:genFilter"),f);const d=Object.keys(Se).filter(Z=>Number.isNaN(Number(Z))),y=[];d.forEach((Z,Ce)=>{if(Ce===0||Ce===19)return;const Ue=s.add.sprite(0,0,Ns("types"));Ue.setScale(.5),Ue.setFrame(Z.toLowerCase()),y.push(new be(Ce,new ne("",Ue)))}),this.filterBar.addFilter(we.TYPES,m.t("filterBar:typeFilter"),new Rt(0,0,y,this.updateStarters,Dt.HYBRID,.5));const g=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(Qt(0)).setTint(mt(0)),T=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(Qt(1)).setTint(mt(1)),E=s.add.sprite(0,0,"shiny_icons").setOrigin(.15,.2).setScale(.6).setFrame(Qt(2)).setTint(mt(2)),b=[new be("SHINY3",new ne("",E)),new be("SHINY2",new ne("",T)),new be("SHINY",new ne("",g)),new be("NORMAL",new ne(m.t("filterBar:normal"))),new be("UNCAUGHT",new ne(m.t("filterBar:uncaught")))];this.filterBar.addFilter(we.CAUGHT,m.t("filterBar:caughtFilter"),new Rt(0,0,b,this.updateStarters,Dt.HYBRID));const _=[new ne(m.t("filterBar:passive"),void 0,J.OFF),new ne(m.t("filterBar:passiveUnlocked"),void 0,J.ON),new ne(m.t("filterBar:passiveUnlockable"),void 0,J.UNLOCKABLE),new ne(m.t("filterBar:passiveLocked"),void 0,J.EXCLUDE)],O=[new ne(m.t("filterBar:costReduction"),void 0,J.OFF),new ne(m.t("filterBar:costReductionUnlocked"),void 0,J.ON),new ne(m.t("filterBar:costReductionUnlockedOne"),void 0,J.ONE),new ne(m.t("filterBar:costReductionUnlockedTwo"),void 0,J.TWO),new ne(m.t("filterBar:costReductionUnlockable"),void 0,J.UNLOCKABLE),new ne(m.t("filterBar:costReductionLocked"),void 0,J.EXCLUDE)],w=[new be("PASSIVE",_),new be("COST_REDUCTION",O)];this.filterBar.addFilter(we.UNLOCKS,m.t("filterBar:unlocksFilter"),new Rt(0,0,w,this.updateStarters,Dt.RADIAL));const U=[new ne(m.t("filterBar:favorite"),void 0,J.OFF),new ne(m.t("filterBar:isFavorite"),void 0,J.ON),new ne(m.t("filterBar:notFavorite"),void 0,J.EXCLUDE)],B=[new ne(m.t("filterBar:ribbon"),void 0,J.OFF),new ne(m.t("filterBar:hasWon"),void 0,J.ON),new ne(m.t("filterBar:hasNotWon"),void 0,J.EXCLUDE)],K=[new ne(m.t("filterBar:hiddenAbility"),void 0,J.OFF),new ne(m.t("filterBar:hasHiddenAbility"),void 0,J.ON),new ne(m.t("filterBar:noHiddenAbility"),void 0,J.EXCLUDE)],V=[new ne(m.t("filterBar:egg"),void 0,J.OFF),new ne(m.t("filterBar:eggPurchasable"),void 0,J.ON)],te=[new ne(m.t("filterBar:pokerus"),void 0,J.OFF),new ne(m.t("filterBar:hasPokerus"),void 0,J.ON)],de=[new be("FAVORITE",U),new be("WIN",B),new be("HIDDEN_ABILITY",K),new be("EGG",V),new be("POKERUS",te)];this.filterBar.addFilter(we.MISC,m.t("filterBar:miscFilter"),new Rt(0,0,de,this.updateStarters,Dt.RADIAL));const k=[new be(Qe.NUMBER,new ne(m.t("filterBar:sortByNumber"),void 0,J.ON)),new be(Qe.COST,new ne(m.t("filterBar:sortByCost"))),new be(Qe.CANDY,new ne(m.t("filterBar:sortByCandies"))),new be(Qe.IV,new ne(m.t("filterBar:sortByIVs"))),new be(Qe.NAME,new ne(m.t("filterBar:sortByName"))),new be(Qe.CAUGHT,new ne(m.t("filterBar:sortByNumCaught"))),new be(Qe.HATCHED,new ne(m.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(we.SORT,m.t("filterBar:sortFilter"),new Rt(0,0,k,this.updateStarters,Dt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.filterBar.offsetHybridFilters(),s.uiTheme||h.setVisible(!1),this.iconAnimHandler=new ja,this.iconAnimHandler.setup(),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonNumberText=P(17,1,"0000",A.SUMMARY_DEX_NUM).setOrigin(0),this.pokemonNameText=P(6,112,"",A.SUMMARY).setOrigin(0),this.pokemonGrowthRateLabelText=P(8,106,m.t("starterSelectUiHandler:growthRate"),A.SUMMARY_ALT,{fontSize:"36px"}).setOrigin(0).setVisible(!1),this.pokemonGrowthRateText=P(34,106,"",A.GROWTH_RATE_TYPE,{fontSize:"36px"}).setOrigin(0),this.pokemonGenderText=P(96,112,"",A.SUMMARY_ALT).setOrigin(0),this.pokemonUncaughtText=P(6,127,m.t("starterSelectUiHandler:uncaught"),A.SUMMARY_ALT,{fontSize:"56px"}).setOrigin(0);const j=n?.starterInfoXPos||31,I=n?.starterInfoYOffset||0,$=n?.starterInfoTextSize||56;this.pokemonAbilityLabelText=P(6,127+I,m.t("starterSelectUiHandler:ability"),A.SUMMARY_ALT,{fontSize:$}).setOrigin(0).setVisible(!1),this.pokemonAbilityText=P(j,127+I,"",A.SUMMARY_ALT,{fontSize:$}).setOrigin(0).setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.pokemonPassiveLabelText=P(6,136+I,m.t("starterSelectUiHandler:passive"),A.SUMMARY_ALT,{fontSize:$}).setOrigin(0).setVisible(!1),this.pokemonPassiveText=P(j,136+I,"",A.SUMMARY_ALT,{fontSize:$}).setOrigin(0).setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.pokemonPassiveDisabledIcon=s.add.sprite(j,137+I,"icon_stop").setOrigin(0,.5).setScale(.35).setVisible(!1),this.pokemonPassiveLockedIcon=s.add.sprite(j,137+I,"icon_lock").setOrigin(0,.5).setScale(.42,.38).setVisible(!1),this.pokemonNatureLabelText=P(6,145+I,m.t("starterSelectUiHandler:nature"),A.SUMMARY_ALT,{fontSize:$}).setOrigin(0).setVisible(!1),this.pokemonNatureText=St(j,145+I,"",A.SUMMARY_ALT,{fontSize:$}).setOrigin(0),this.pokemonMoveContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[],this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.valueLimitLabel=P(Cs+17,150,"0/10",A.STARTER_VALUE_LIMIT).setOrigin(.5,0);const re=P(Cs+17,162,m.t("common:start"),A.TOOLTIP_CONTENT).setOrigin(.5,0);this.startCursorObj=s.add.nineslice(Cs+4,160,"select_cursor",void 0,26,15,6,6,6,6).setVisible(!1).setOrigin(0);const H=P(Cs+17,23,m.t("starterSelectUiHandler:randomize"),A.TOOLTIP_CONTENT).setOrigin(.5,0);this.randomCursorObj=s.add.nineslice(Cs+4,21,"select_cursor",void 0,26,15,6,6,6,6).setVisible(!1).setOrigin(0);const ee=[],L=s.add.container(Gn+6,9);this.starterSelectScrollBar=new _s(161,12,5,h.height-6,9),L.add(this.starterSelectScrollBar),this.pokerusCursorObjs=[];for(let Z=0;Z<_f;Z++){const Ce=s.add.image(0,0,"select_cursor_pokerus");Ce.setVisible(!1),Ce.setOrigin(0),L.add(Ce),this.pokerusCursorObjs.push(Ce)}this.starterCursorObjs=[];for(let Z=0;Z<6;Z++){const Ce=s.add.image(0,0,"select_cursor_highlight");Ce.setVisible(!1),Ce.setOrigin(0),L.add(Ce),this.starterCursorObjs.push(Ce)}this.cursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.starterIconsCursorObj=s.add.image(289,64,"select_gen_cursor").setName("starter-icons-cursor").setVisible(!1).setOrigin(0),L.add(this.cursorObj);for(const Z of it){if(!ze.hasOwnProperty(Z.speciesId)||!Z.isObtainable())continue;ee.push(Z.speciesId),this.speciesLoaded.set(Z.speciesId,!1),this.allSpecies.push(Z);const Ce=new gl(Z).setVisible(!1);this.iconAnimHandler.addOrUpdate(Ce.icon,Nt.NONE),this.starterContainers.push(Ce),L.add(Ce)}this.starterIcons=[];for(let Z=0;Z<6;Z++){const Ce=s.add.sprite(Cs+7,Ch(Z),"pokemon_icons_0").setScale(.5).setOrigin(0).setFrame("unknown");this.iconAnimHandler.addOrUpdate(Ce,Nt.PASSIVE),this.starterIcons.push(Ce)}this.type1Icon=s.add.sprite(8,98,Ns("types")).setScale(.5).setOrigin(0),this.type2Icon=s.add.sprite(26,98,Ns("types")).setScale(.5).setOrigin(0),this.pokemonLuckLabelText=P(8,89,m.t("common:luckIndicator"),A.WINDOW_ALT,{fontSize:"56px"}).setOrigin(0),this.pokemonLuckText=P(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",A.LUCK_VALUE,{fontSize:"56px"}).setOrigin(0),this.pokemonCandyContainer=s.add.container(4.5,18).setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.pokemonCandyIcon=s.add.sprite(0,0,"candy").setScale(.5).setOrigin(0),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay").setScale(.5).setOrigin(0),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy").setScale(.5).setOrigin(0).setTint(0).setAlpha(.5),this.pokemonCandyCountText=P(9.5,0,"x0",A.WINDOW_ALT,{fontSize:"56px"}).setOrigin(0),this.pokemonCandyContainer.add([this.pokemonCandyIcon,this.pokemonCandyOverlayIcon,this.pokemonCandyDarknessOverlay,this.pokemonCandyCountText]),this.pokemonFormText=P(6,42,"Form",A.WINDOW_ALT,{fontSize:"42px"}).setOrigin(0),this.pokemonCaughtHatchedContainer=s.add.container(2,25).setScale(.5);const Ee=s.add.sprite(1,0,"items","pb").setOrigin(0).setScale(.75);this.pokemonCaughtCountText=P(24,4,"0",A.SUMMARY_ALT).setOrigin(0),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons").setOrigin(.15,.2).setScale(.8),this.pokemonShinyIcon=s.add.sprite(14,76,"shiny_icons").setOrigin(.15,.2).setScale(1),this.pokemonHatchedCountText=P(24,19,"0",A.SUMMARY_ALT).setOrigin(0),this.pokemonMovesContainer=s.add.container(102,16).setScale(.375),this.pokemonCaughtHatchedContainer.add([Ee,this.pokemonCaughtCountText,this.pokemonHatchedIcon,this.pokemonShinyIcon,this.pokemonHatchedCountText]);for(let Z=0;Z<4;Z++){const Ce=s.add.container(0,14*Z),Ue=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);Ue.setOrigin(1,0);const xe=P(-Ue.width/2,0,"-",A.MOVE_LABEL);xe.setOrigin(.5,0),this.pokemonMoveBgs.push(Ue),this.pokemonMoveLabels.push(xe),Ce.add([Ue,xe]),this.pokemonMoveContainers.push(Ce),this.pokemonMovesContainer.add(Ce)}this.pokemonAdditionalMoveCountLabel=P(-this.pokemonMoveBgs[0].width/2,56,"(+0)",A.MOVE_LABEL).setOrigin(.5,0),this.pokemonMovesContainer.add(this.pokemonAdditionalMoveCountLabel),this.pokemonEggMovesContainer=s.add.container(102,85).setScale(.375),this.eggMovesLabel=P(-46,0,m.t("starterSelectUiHandler:eggMoves"),A.WINDOW_ALT).setOrigin(.5,0),this.pokemonEggMovesContainer.add(this.eggMovesLabel);for(let Z=0;Z<4;Z++){const Ce=s.add.container(0,16+14*Z),Ue=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);Ue.setOrigin(1,0);const xe=P(-Ue.width/2,0,"???",A.MOVE_LABEL);xe.setOrigin(.5,0),this.pokemonEggMoveBgs.push(Ue),this.pokemonEggMoveLabels.push(xe),Ce.add([Ue,xe]),this.pokemonEggMoveContainers.push(Ce),this.pokemonEggMovesContainer.add(Ce)}this.teraIcon=s.add.sprite(85,63,"button_tera").setName("terastallize-icon").setFrame("fire");const W=n.instructionTextSize;this.instructionsContainer=s.add.container(4,156).setVisible(!0);const Y=this.instructionRowX,me=this.instructionRowY,fe=Y+this.instructionRowTextOffset;this.shinyIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","R.png").setName("sprite-shiny-icon-element").setScale(.675).setOrigin(0),this.shinyLabel=P(fe,me,m.t("starterSelectUiHandler:cycleShiny"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","F.png").setName("sprite-form-icon-element").setScale(.675).setOrigin(0),this.formLabel=P(fe,me,m.t("starterSelectUiHandler:cycleForm"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","G.png").setName("sprite-gender-icon-element").setScale(.675).setOrigin(0),this.genderLabel=P(fe,me,m.t("starterSelectUiHandler:cycleGender"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-gender-label"),this.abilityIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","E.png").setName("sprite-ability-icon-element").setScale(.675).setOrigin(0),this.abilityLabel=P(fe,me,m.t("starterSelectUiHandler:cycleAbility"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-ability-label"),this.natureIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","N.png").setName("sprite-nature-icon-element").setScale(.675).setOrigin(0),this.natureLabel=P(fe,me,m.t("starterSelectUiHandler:cycleNature"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-nature-label"),this.teraIconElement=new Phaser.GameObjects.Sprite(s,Y,me,"keyboard","V.png").setName("sprite-tera-icon-element").setScale(.675).setOrigin(0),this.teraLabel=P(fe,me,m.t("starterSelectUiHandler:cycleTera"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-tera-label"),this.goFilterIconElement=new Phaser.GameObjects.Sprite(s,this.filterInstructionRowX,this.filterInstructionRowY,"keyboard","C.png").setName("sprite-goFilter-icon-element").setScale(.675).setOrigin(0),this.goFilterLabel=P(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY,m.t("starterSelectUiHandler:goFilter"),A.INSTRUCTIONS_TEXT,{fontSize:W}).setName("text-goFilter-label"),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5).setVisible(!0),this.starterSelectMessageBoxContainer=s.add.container(0,a).setVisible(!1),this.starterSelectMessageBox=ye(1,-1,318,28).setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=P(8,8,"",A.WINDOW,{maxLines:2}).setOrigin(0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new cn(6,16).setVisible(!1),s.add.existing(this.statsContainer),this.moveInfoOverlay=new ia({top:!0,x:1,y:s.scaledCanvas.height-ia.getHeight()-29}),this.starterSelectContainer.add([o,l,this.shinyOverlay,u,ye(Cs,Qn-Np,Wn,Np,!0),ye(Cs,Qn,Wn,En),ye(Cs,Qn+En,Wn,Wn,!0),h,this.pokemonSprite,this.pokemonNumberText,this.pokemonNameText,this.pokemonGrowthRateLabelText,this.pokemonGrowthRateText,this.pokemonGenderText,this.pokemonUncaughtText,this.pokemonAbilityLabelText,this.pokemonAbilityText,this.pokemonPassiveLabelText,this.pokemonPassiveText,this.pokemonPassiveDisabledIcon,this.pokemonPassiveLockedIcon,this.pokemonNatureLabelText,this.pokemonNatureText,this.valueLimitLabel,re,this.startCursorObj,H,this.randomCursorObj,this.starterIconsCursorObj,L,...this.starterIcons,this.type1Icon,this.type2Icon,this.pokemonLuckLabelText,this.pokemonLuckText,this.pokemonCandyContainer,this.pokemonFormText,this.pokemonCaughtHatchedContainer,this.pokemonMovesContainer,this.pokemonEggMovesContainer,this.teraIcon,this.instructionsContainer,this.filterInstructionsContainer,this.starterSelectMessageBoxContainer,this.statsContainer,this.moveInfoOverlay,this.filterBarContainer]),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),s.eventTarget.addEventListener(yi.CANDY_UPGRADE_NOTIFICATION_CHANGED,Z=>this.onCandyUpgradeDisplayChanged(Z)),this.updateInstructions()}show(e){if(this.moveInfoOverlay.clear(),this.pokerusSpecies=Af(),this.allowTera=s.gameData.achvUnlocks.hasOwnProperty(Pe.TERASTALLIZE.id),e.length>=1&&e[0]instanceof Function){super.show(e),this.starterSelectCallback=e[0],this.starterSelectContainer.setVisible(!0),this.starterPreferences=Ar(),this.originalStarterPreferences=Ar(),this.allSpecies.forEach((i,n)=>{const a=this.starterContainers[n].icon,{dexEntry:r}=this.getSpeciesData(i.speciesId);this.starterPreferences[i.speciesId]=this.initStarterPrefs(i,this.starterPreferences),this.originalStarterPreferences[i.speciesId]=this.initStarterPrefs(i,this.originalStarterPreferences,!0),r.caughtAttr?a.clearTint():r.seenAttr&&a.setTint(8421504),this.setUpgradeAnimation(a,i)});const t=!s.gameMode.hasChallenge(xt.FRESH_START);for(const i of this.pokemonEggMoveContainers)i.setVisible(t);return this.eggMovesLabel.setVisible(t),this.pokemonPassiveDisabledIcon.setVisible(t),this.pokemonPassiveLabelText.setVisible(t),this.pokemonPassiveLockedIcon.setVisible(t),this.pokemonPassiveText.setVisible(t),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setCursor(0),this.tryUpdateValue(0),Oi(ws.Starter_Select),!0}return!1}initStarterPrefs(e,t,i=!1){const n=t[e.speciesId],{dexEntry:a,starterDataEntry:r}=this.getSpeciesData(e.speciesId,!i);if(!n||!a.caughtAttr)return{};const o=a.caughtAttr,l=o&F.SHINY,h=o&F.NON_SHINY;if(n.shiny&&!l?(n.shiny=void 0,n.variant=void 0):n.shiny===!1&&!h&&(n.shiny=void 0),n.variant!==void 0){const p=[l&&o&F.DEFAULT_VARIANT,l&&o&F.VARIANT_2,l&&o&F.VARIANT_3];(Number.isNaN(n.variant)||n.variant<0||!p[n.variant])&&(n.variant=void 0)}if(n.female!==void 0&&((n.female?o&F.FEMALE:o&F.MALE)||(n.female=void 0)),n.ability!==void 0){const p=e.ability2===e.ability1,f=r.abilityAttr,d=f&rt.ABILITY_1,y=f&rt.ABILITY_2,g=f&rt.ABILITY_HIDDEN;[d,p?y&&!d:y,g][n.ability]||(n.ability=void 0)}const u=n.form;return u!==void 0&&(!e.forms[u]?.isStarterSelectable||!(o&s.gameData.getFormAttr(u)))&&(n.form=void 0),n.nature!==void 0&&s.gameData.getNaturesForAttr(a.natureAttr).indexOf(n.nature)<0&&(n.nature=void 0),n.tera!==void 0&&(n.tera===e.type1||n.tera===e?.type2||(n.tera=e.type1),s.gameMode.hasChallenge(xt.FRESH_START)&&!i&&(n.tera=e.type1)),n}resetFilters(){this.filterBar.setValsToDefault(),this.resetCaughtDropdown()}resetCaughtDropdown(){const e=this.filterBar.getFilter(we.CAUGHT);e.resetToDefault();for(let t=0;t<e.options.length;t++)e.options[t].val!=="ALL"&&e.options[t].val!=="UNCAUGHT"&&e.toggleOptionState(t)}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=e?.indexOf(`
`)===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.scaledCanvas.height),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!e?.length)}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}isPassiveAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=an(ze[e])&&!(t.passiveAttr&bt.UNLOCKED)}isValueReductionAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=rn(ze[e])[t.valueReduction]&&t.valueReduction<Mp}isSameSpeciesEggAvailable(e){return s.gameData.starterData[e].candyCount>=on(ze[e])}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,paused:i,loop:-1,delay:xf(0,50)*5,loopDelay:ge(1e3),tweens:[{targets:e,y:"-=5",duration:ge(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:"-=3",duration:ge(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!t?.speciesId;if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}onCandyUpgradeDisplayChanged(e){if(e){if(s.candyUpgradeDisplay===0){this.filteredStarterContainers.forEach(i=>{this.setUpgradeIcon(i)});return}this.filteredStarterContainers.forEach((i,n)=>{const a=this.filteredStarterContainers[n].icon;this.setUpgradeAnimation(a,i.species)})}}processInput(e){if(this.blockInput)return!1;const t=9,i=9,n=this.filteredStarterContainers.length,a=Math.ceil(n/t),r=Math.floor(this.cursor/t),o=this.scrollCursor*t,l=Math.min(this.filteredStarterContainers.length-1,o+i*t-1),h=l-o+1,u=Math.ceil(h/t),p=Math.floor((this.cursor-o)/t),f=this.getUi();let d=!1,y=!1;if(e===v.SUBMIT)this.tryStart(!0)?d=!0:y=!0;else if(e===v.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),d=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBar.getColumn(this.filterBarCursor)).hasDefaultValues()?(this.filterBar.getColumn(this.filterBarCursor)===we.CAUGHT?this.resetCaughtDropdown():this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),d=!0):this.statsMode?(this.toggleStatsMode(!1),d=!0):this.starterSpecies.length?(this.popStarter(this.starterSpecies.length-1),d=!0,this.updateInstructions()):(this.tryExit(),d=!0);else if(e===v.STATS)this.filterMode||(this.startCursorObj.setVisible(!1),this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=0,this.setFilterMode(!0),this.filterBar.toggleDropDown(this.filterBarCursor));else if(this.startCursorObj.visible)switch(e){case v.ACTION:this.tryStart(!0)?d=!0:y=!0;break;case v.UP:this.startCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=this.starterSpecies.length-1,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.startCursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)),d=!0;break;case v.DOWN:this.startCursorObj.setVisible(!1),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0),d=!0;break;case v.LEFT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(u-1)*9+8),d=!0);break;case v.RIGHT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(u-1)*9),d=!0);break}else if(this.filterMode)switch(e){case v.LEFT:this.filterBarCursor>0?d=this.setCursor(this.filterBarCursor-1):d=this.setCursor(this.filterBar.numFilters-1);break;case v.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?d=this.setCursor(this.filterBarCursor+1):d=this.setCursor(0);break;case v.UP:if(this.filterBar.openDropDown)d=this.filterBar.decDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.starterSpecies.length>0?this.startCursorObj.setVisible(!0):this.randomCursorObj.setVisible(!0),d=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,a-9),this.updateScroll();const g=(this.filterBarCursor+.5)/this.filterBar.numFilters,T=Math.min(8,Math.floor(g*11));n%9>T?this.setCursor(n-n%9+T):this.setCursor(Math.max(n-n%9+T-9,0)),d=!0}break;case v.DOWN:if(this.filterBar.openDropDown)d=this.filterBar.incDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0),d=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const g=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),T=Math.min(8,Math.floor(g*11));this.setCursor(Math.min(T,n)),d=!0}break;case v.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),d=!0;break}else if(this.randomCursorObj.visible)switch(e){case v.ACTION:{if(this.starterSpecies.length>=6){y=!0;break}const g=this.starterSpecies.map(de=>de.generation).reduce((de,k,j)=>de+s.gameData.getSpeciesStarterValue(this.starterSpecies[j].speciesId),0),T=this.filteredStarterContainers.filter(de=>{const k=de.species,[j]=this.isInParty(k),I=s.gameData.getSpeciesStarterValue(k.speciesId),$=$s(k,s.gameData.getSpeciesDexAttrProps(k,this.getCurrentDexProps(k.speciesId)),this.isPartyValid()),re=this.getSpeciesData(k.speciesId).dexEntry.caughtAttr;return!j&&$&&g+I<=this.getValueLimit()&&re});if(T.length===0){y=!0;break}const b=T[Math.floor(Math.random()*T.length)].species;this.setSpecies(b);const _=this.getCurrentDexProps(b.speciesId),O=s.gameData.getSpeciesDexAttrProps(b,_),w=this.abilityCursor,U=this.natureCursor,B=this.teraCursor,K=this.starterMoveset?.slice(0),V=s.gameData.getSpeciesStarterValue(b.speciesId);$t(b.speciesId,O.formIndex).loadAssets(O.female,O.formIndex,O.shiny,O.variant,!0).then(()=>{this.tryUpdateValue(V,!0)&&(this.addToParty(b,_,w,U,K,B,!0),f.playSelect())});break}case v.UP:this.randomCursorObj.setVisible(!1),this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0),d=!0;break;case v.DOWN:this.randomCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=0,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0)),d=!0;break;case v.LEFT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+8),d=!0);break;case v.RIGHT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o),d=!0);break}else{let g;const T=this.getSpeciesData(this.lastSpecies.speciesId).starterDataEntry,E=s.gameData.starterData[this.lastSpecies.speciesId];let b=this.starterPreferences[this.lastSpecies.speciesId];const _=this.originalStarterPreferences[this.lastSpecies.speciesId];if(this.starterIconsCursorObj.visible?g=this.filteredStarterContainers[this.filteredStarterContainers.findIndex(O=>O.species===this.lastSpecies)]:g=this.filteredStarterContainers[this.cursor],e===v.ACTION){if(!this.speciesStarterDexEntry?.caughtAttr)y=!0;else if(this.starterSpecies.length<=6){const O=this.getUi();let w=[];const[U,B]=this.isInParty(this.lastSpecies),K=this.isPartyValid(),V=$s(this.lastSpecies,s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),K),te=this.starterSpecies.map(re=>re.generation).reduce((re,H,ee)=>re+=s.gameData.getSpeciesStarterValue(this.starterSpecies[ee].speciesId),0),de=s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId);if(!U&&V&&te+de<=this.getValueLimit()&&this.starterSpecies.length<Jn?w=[{label:m.t("starterSelectUiHandler:addToParty"),handler:c(()=>{O.setMode(x.STARTER_SELECT);const re=this.tryUpdateValue(s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId),!0);return!U&&V&&re?(this.starterCursorObjs[this.starterSpecies.length].setVisible(!0).setPosition(this.cursorObj.x,this.cursorObj.y),this.addToParty(this.lastSpecies,this.dexAttrCursor,this.abilityCursor,this.natureCursor,this.starterMoveset?.slice(0),this.teraCursor),O.playSelect()):O.playError(),!0},"handler"),overrideSound:!0}]:U&&(w=[{label:m.t("starterSelectUiHandler:removeFromParty"),handler:c(()=>(this.popStarter(B),O.setMode(x.STARTER_SELECT),!0),"handler")}]),w.push({label:m.t("starterSelectUiHandler:toggleIVs"),handler:c(()=>(this.toggleStatsMode(),O.setMode(x.STARTER_SELECT),!0),"handler")}),this.speciesStarterMoves.length>1){const re=c(H=>{this.blockInput=!0,O.setMode(x.STARTER_SELECT).then(()=>{O.showText(m.t("starterSelectUiHandler:selectMoveSwapOut"),null,()=>{this.moveInfoOverlay.show(Fe[H[0]]),O.setModeWithoutClear(x.OPTION_SELECT,{options:H.map((ee,L)=>({label:Fe[ee].name,handler:c(()=>(this.blockInput=!0,O.setMode(x.STARTER_SELECT).then(()=>{O.showText(`${m.t("starterSelectUiHandler:selectMoveSwapWith")} ${Fe[ee].name}.`,null,()=>{const W=this.speciesStarterMoves.filter(Y=>Y!==ee);this.moveInfoOverlay.show(Fe[W[0]]),O.setModeWithoutClear(x.OPTION_SELECT,{options:W.map(Y=>({label:Fe[Y].name,handler:c(()=>(this.switchMoveHandler(L,Y,ee),re(this.starterMoveset),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.show(Fe[Y])},"onHover")})).concat({label:m.t("menu:cancel"),handler:c(()=>(re(this.starterMoveset),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.show(Fe[ee])},"onHover")})).concat({label:m.t("menu:cancel"),handler:c(()=>(this.moveInfoOverlay.clear(),this.clearText(),this.hasSwappedMoves&&s.gameData.saveSystem().then(ee=>{if(!ee)return s.reset(!0)}),O.setMode(x.STARTER_SELECT),!0),"handler"),onHover:c(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})})},"showSwapOptions");w.push({label:m.t("starterSelectUiHandler:manageMoves"),handler:c(()=>(this.hasSwappedMoves=!1,re(this.starterMoveset),!0),"handler")})}if(this.canCycleNature){const re=c(()=>{this.blockInput=!0,O.setMode(x.STARTER_SELECT).then(()=>{O.showText(m.t("starterSelectUiHandler:selectNature"),null,()=>{const H=s.gameData.getNaturesForAttr(this.speciesStarterDexEntry?.natureAttr);O.setModeWithoutClear(x.OPTION_SELECT,{options:H.map((ee,L)=>({label:xi(ee,!0,!0,!0,s.uiTheme),handler:c(()=>(b||(b=this.starterPreferences[this.lastSpecies.speciesId]={}),b.nature=ee,_.nature=b.nature,this.clearText(),O.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies,{natureIndex:ee}),this.blockInput=!1,!0),"handler")})).concat({label:m.t("menu:cancel"),handler:c(()=>(this.clearText(),O.setMode(x.STARTER_SELECT),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})})},"showNatureOptions");w.push({label:m.t("starterSelectUiHandler:manageNature"),handler:c(()=>(re(),!0),"handler")})}const k=T.passiveAttr;if(k&bt.UNLOCKED){const re=m.t(k&bt.ENABLED?"starterSelectUiHandler:disablePassive":"starterSelectUiHandler:enablePassive");w.push({label:re,handler:c(()=>(T.passiveAttr^=bt.ENABLED,E.passiveAttr^=bt.ENABLED,O.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")})}b?.favorite??!1?w.push({label:m.t("starterSelectUiHandler:removeFromFavorites"),handler:c(()=>(b.favorite=!1,_.favorite=!1,g&&g.favoriteIcon.setVisible(b.favorite),O.setMode(x.STARTER_SELECT),!0),"handler")}):w.push({label:m.t("starterSelectUiHandler:addToFavorites"),handler:c(()=>(b.favorite=!0,_.favorite=!0,g&&g.favoriteIcon.setVisible(b.favorite),O.setMode(x.STARTER_SELECT),!0),"handler")}),w.push({label:m.t("menu:rename"),handler:c(()=>{O.playSelect();let re=b.nickname?String(b.nickname):"";return re=decodeURIComponent(escape(atob(re))),O.setModeWithoutClear(x.RENAME_POKEMON,{buttonActions:[H=>{O.playSelect(),b.nickname=H,_.nickname=H;const ee=decodeURIComponent(escape(atob(b.nickname)));ee.length>0?this.pokemonNameText.setText(ee):this.pokemonNameText.setText(this.lastSpecies.name),O.setMode(x.STARTER_SELECT)},()=>{O.setMode(x.STARTER_SELECT)}]},re),!0},"handler")});const I=T.candyCount,$=c(()=>{const re=[];if(!(k&bt.UNLOCKED)&&!s.gameMode.hasChallenge(xt.FRESH_START)){const L=an(ze[this.lastSpecies.speciesId]);re.push({label:`${L} ${m.t("starterSelectUiHandler:unlockPassive")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||I>=L?(E.passiveAttr|=bt.UNLOCKED|bt.ENABLED,T.passiveAttr=E.passiveAttr,le.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=L,T.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${T.candyCount}`),s.gameData.saveSystem().then(Ee=>{if(!Ee)return s.reset(!0)}),O.setMode(x.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),s.playSound("se/buy"),g&&(this.updateCandyUpgradeDisplay(g),g.starterPassiveBgs.setVisible(!!T.passiveAttr)),!0):!1,"handler"),item:"candy",itemArgs:yt[this.lastSpecies.speciesId]})}const H=T.valueReduction;if(H<Mp&&!s.gameMode.hasChallenge(xt.FRESH_START)){const L=rn(ze[this.lastSpecies.speciesId])[H];re.push({label:`${L} ${m.t("starterSelectUiHandler:reduceCost")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||I>=L?(E.valueReduction++,T.valueReduction=E.valueReduction,le.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=L,T.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${T.candyCount}`),s.gameData.saveSystem().then(Ee=>{if(!Ee)return s.reset(!0)}),this.tryUpdateValue(0),O.setMode(x.STARTER_SELECT),s.playSound("se/buy"),g&&(this.updateStarterValueLabel(g),this.updateCandyUpgradeDisplay(g)),!0):!1,"handler"),item:"candy",itemArgs:yt[this.lastSpecies.speciesId]})}const ee=on(ze[this.lastSpecies.speciesId]);re.push({label:`${ee} ${m.t("starterSelectUiHandler:sameSpeciesEgg")}`,handler:c(()=>le.FREE_CANDY_UPGRADE_OVERRIDE||I>=ee?s.gameData.eggs.length>=99&&!le.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(m.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(le.FREE_CANDY_UPGRADE_OVERRIDE||(E.candyCount-=ee,T.candyCount=E.candyCount),this.pokemonCandyCountText.setText(`${T.candyCount}`),new Ii({species:this.lastSpecies.speciesId,sourceType:bf.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(Ee=>{if(!Ee)return s.reset(!0)}),O.setMode(x.STARTER_SELECT),s.playSound("se/buy"),g&&this.updateCandyUpgradeDisplay(g),!0):!1,"handler"),item:"candy",itemArgs:yt[this.lastSpecies.speciesId]}),re.push({label:m.t("menu:cancel"),handler:c(()=>(O.setMode(x.STARTER_SELECT),!0),"handler")}),O.setModeWithoutClear(x.OPTION_SELECT,{options:re,yOffset:47})},"showUseCandies");w.push({label:m.t("menuUiHandler:pokedex"),handler:c(()=>(O.setMode(x.STARTER_SELECT).then(()=>{const re={shiny:b.shiny,variant:b.variant,form:b.form,female:b.female};O.setOverlayMode(x.POKEDEX_PAGE,this.lastSpecies,re,null,null,()=>{if(this.lastSpecies){g=this.filteredStarterContainers[this.cursor];const H=s.gameData.starterData[this.lastSpecies.speciesId];this.updateCandyUpgradeDisplay(g),this.updateStarterValueLabel(g),g.starterPassiveBgs.setVisible(!!H.passiveAttr&&!s.gameMode.hasChallenge(xt.FRESH_START)),this.setSpecies(this.lastSpecies)}})}),!0),"handler")}),wt.hasOwnProperty(this.lastSpecies.speciesId)||w.push({label:m.t("starterSelectUiHandler:useCandies"),handler:c(()=>(O.setMode(x.STARTER_SELECT).then(()=>$()),!0),"handler")}),w.push({label:m.t("menu:cancel"),handler:c(()=>(O.setMode(x.STARTER_SELECT),!0),"handler")}),O.setModeWithoutClear(x.OPTION_SELECT,{options:w,yOffset:47}),d=!0}}else{const O=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId));switch(e){case v.CYCLE_SHINY:if(this.canCycleShiny)if(b.shiny===!1){const w=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),U=b.variant?b.variant:w.variant;b.shiny=!0,_.shiny=!0,b.variant=U,_.variant=U,this.setSpeciesDetails(this.lastSpecies,{shiny:!0,variant:U}),s.playSound("se/sparkle");const B=mt(U);this.pokemonShinyIcon.setFrame(Qt(U)).setTint(B).setVisible(!0)}else{let w=O.variant;do if(w=(w+1)%3,w===0){if(this.speciesStarterDexEntry.caughtAttr&F.DEFAULT_VARIANT)break}else if(w===1){if(this.speciesStarterDexEntry.caughtAttr&F.VARIANT_2)break}else if(this.speciesStarterDexEntry.caughtAttr&F.VARIANT_3)break;while(w!==O.variant);if(b.variant=w,_.variant=w,this.speciesStarterDexEntry.caughtAttr&F.NON_SHINY&&w<=O.variant)b.shiny=!1,_.shiny=!1,this.setSpeciesDetails(this.lastSpecies,{shiny:!1,variant:0}),this.pokemonShinyIcon.setVisible(!1),d=!0;else{this.setSpeciesDetails(this.lastSpecies,{variant:w});const U=mt(w);this.pokemonShinyIcon.setFrame(Qt(w)).setTint(U),d=!0}}break;case v.CYCLE_FORM:if(this.canCycleForm){const w=this.lastSpecies.forms.length;let U=O.formIndex;do if(U=(U+1)%w,this.lastSpecies.forms[U].isStarterSelectable&&this.speciesStarterDexEntry.caughtAttr&s.gameData.getFormAttr(U))break;while(U!==O.formIndex);b.form=U,_.form=U,b.tera=this.lastSpecies.forms[U].type1,_.tera=b.tera,this.setSpeciesDetails(this.lastSpecies,{formIndex:U,teraType:b.tera}),d=!0}break;case v.CYCLE_GENDER:this.canCycleGender&&(b.female=!O.female,_.female=b.female,this.setSpeciesDetails(this.lastSpecies,{female:!O.female}),d=!0);break;case v.CYCLE_ABILITY:if(this.canCycleAbility){const w=this.lastSpecies.getAbilityCount(),U=T.abilityAttr,B=U&rt.ABILITY_1;let K=this.abilityCursor;do if(K=(K+1)%w,K===0){if(B)break}else if(K===1){this.lastSpecies.ability1===this.lastSpecies.ability2&&B&&(K=(K+1)%w);break}else if(U&rt.ABILITY_HIDDEN)break;while(K!==this.abilityCursor);b.ability=K,_.ability=K;const{visible:V}=s.ui.getTooltip();if(V&&this.activeTooltip==="ABILITY"){const te=Et[this.lastSpecies.getAbility(K)];s.ui.editTooltip(`${te.name}`,`${te.description}`)}this.setSpeciesDetails(this.lastSpecies,{abilityIndex:K}),d=!0}break;case v.CYCLE_NATURE:if(this.canCycleNature){const w=s.gameData.getNaturesForAttr(this.speciesStarterDexEntry?.natureAttr),U=w.indexOf(this.natureCursor),B=w[U<w.length-1?U+1:0];b.nature=B,_.nature=b.nature,this.setSpeciesDetails(this.lastSpecies,{natureIndex:B}),d=!0}break;case v.CYCLE_TERA:if(this.canCycleTera){const w=$t(this.lastSpecies.speciesId,b.form??0);w.type1===this.teraCursor&&!ve(w.type2)?(b.tera=w.type2,_.tera=b.tera,this.setSpeciesDetails(this.lastSpecies,{teraType:w.type2})):(b.tera=w.type1,_.tera=b.tera,this.setSpeciesDetails(this.lastSpecies,{teraType:w.type1})),d=!0}break;case v.UP:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===0?(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.randomCursorObj.setVisible(!0)):(this.starterIconsCursorIndex--,this.moveStarterIconsCursor(this.starterIconsCursorIndex)),d=!0):r>0?(this.scrollCursor>0&&r-this.scrollCursor===0&&(this.scrollCursor--,this.updateScroll()),d=this.setCursor(this.cursor-9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),d=!0);break;case v.DOWN:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex<=this.starterSpecies.length-2?(this.starterIconsCursorIndex++,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0):r<a-1?(r-this.scrollCursor===8&&this.scrollCursor++,d=this.setCursor(this.cursor+9),this.updateScroll()):a>1?(this.scrollCursor=0,this.updateScroll(),d=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),d=!0);break;case v.LEFT:if(!this.starterIconsCursorObj.visible)this.cursor%9!==0?d=this.setCursor(this.cursor-1):(p===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?d=this.setCursor(this.cursor+Math.min(8,n-this.cursor)):p<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=kp(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0);else if(n>0){const w=Pp(this.starterIconsCursorIndex,u);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+w*9+8,l)),d=!0}else d=!1;break;case v.RIGHT:if(!this.starterIconsCursorObj.visible)this.cursor%9<(r<a-1?8:(n-1)%9)?d=this.setCursor(this.cursor+1):(p===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?d=this.setCursor(this.cursor-Math.min(8,this.cursor%9)):p<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=kp(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),d=!0);else if(n>0){const w=Pp(this.starterIconsCursorIndex,u);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+w*9,l-l%9)),d=!0}else d=!1;break}}}return d?f.playSelect():y&&f.playError(),d||y}isInParty(e){let t=0,i=!1;for(let n=0;n<this.starterSpecies.length;n++)if(this.starterSpecies[n]===e){i=!0,t=n;break}return[i,t]}addToParty(e,t,i,n,a,r,o=!1){const l=s.gameData.getSpeciesDexAttrProps(e,t);this.starterIcons[this.starterSpecies.length].setTexture(e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.starterIcons[this.starterSpecies.length].setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(this.starterIcons[this.starterSpecies.length],e,l.female,l.formIndex,l.shiny,l.variant),this.starterSpecies.push(e),this.starterAttr.push(t),this.starterAbilityIndexes.push(i),this.starterNatures.push(n),this.starterTeras.push(r),this.starterMovesets.push(a),(this.speciesLoaded.get(e.speciesId)||o)&&$t(e.speciesId,l.formIndex).cry(),this.updateInstructions()}updatePartyIcon(e,t){const i=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId));this.starterIcons[t].setTexture(e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.starterIcons[t].setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(this.starterIcons[t],e,i.female,i.formIndex,i.shiny,i.variant)}switchMoveHandler(e,t,i){const n=this.starterMoveset;if(ve(n)){console.warn("Trying to update a non-existing moveset");return}const a=this.lastSpecies.speciesId,r=n.indexOf(t);n[e]=t,r!==-1&&(n[r]=i);const o=n.slice(),l=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.dexAttrCursor).formIndex,h=s.gameData.starterData[a];Zs.hasOwnProperty(a)?((!h.moveset||Array.isArray(h.moveset))&&(h.moveset={}),h.moveset[l]=o):h.moveset=o,this.hasSwappedMoves=!0,this.setSpeciesDetails(this.lastSpecies,{forSeen:!1}),this.updateSelectedStarterMoveset(a)}updateSelectedStarterMoveset(e){if(this.starterMoveset!==null)for(const[t,i]of this.starterSpecies.entries())i.speciesId===e&&(this.starterMovesets[t]=this.starterMoveset)}updateButtonIcon(e,t,i,n){let a;if(t==="touch")switch(t="keyboard",e){case ae.Button_Cycle_Shiny:a="R.png";break;case ae.Button_Cycle_Form:a="F.png";break;case ae.Button_Cycle_Gender:a="G.png";break;case ae.Button_Cycle_Ability:a="E.png";break;case ae.Button_Cycle_Nature:a="N.png";break;case ae.Button_Cycle_Tera:a="V.png";break;case ae.Button_Stats:a="C.png";break}else a=s.inputController?.getIconForLatestInputRecorded(e);i.setTexture(t,a).setPosition(this.instructionRowX,this.instructionRowY).setVisible(!0),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY).setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=0,this.instructionRowX+=50)}updateFilterButtonIcon(e,t,i,n){let a;t==="touch"?(t="keyboard",a="C.png"):a=s.inputController?.getIconForLatestInputRecorded(e),i.setTexture(t,a).setPosition(this.filterInstructionRowX,this.filterInstructionRowY).setVisible(!0),n.setPosition(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY).setVisible(!0),this.filterInstructionsContainer.add([i,n]),this.filterInstructionRowY+=8,this.filterInstructionRowY>=24&&(this.filterInstructionRowY=0,this.filterInstructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[Me.GAMEPAD]).padType:e=s.inputMethod,e&&(this.speciesStarterDexEntry?.caughtAttr&&(this.canCycleShiny&&this.updateButtonIcon(ae.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleForm&&this.updateButtonIcon(ae.Button_Cycle_Form,e,this.formIconElement,this.formLabel),this.canCycleGender&&this.updateButtonIcon(ae.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel),this.canCycleAbility&&this.updateButtonIcon(ae.Button_Cycle_Ability,e,this.abilityIconElement,this.abilityLabel),this.canCycleNature&&this.updateButtonIcon(ae.Button_Cycle_Nature,e,this.natureIconElement,this.natureLabel),this.canCycleTera&&this.updateButtonIcon(ae.Button_Cycle_Tera,e,this.teraIconElement,this.teraLabel)),this.filterMode||this.updateFilterButtonIcon(ae.Button_Stats,e,this.goFilterIconElement,this.goFilterLabel))}getValueLimit(){const e=new Pt(0);switch(s.gameMode.modeId){case ce.ENDLESS:case ce.SPLICED_ENDLESS:e.value=15;break;default:e.value=10}return fs(gs.STARTER_POINTS,e),e.value}updateStarters=c(()=>{this.scrollCursor=0,this.filteredStarterContainers=[],this.validStarterContainers=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.starterCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),s.gameMode.modeId===ce.CHALLENGE?this.starterContainers.forEach(t=>{const i=t.species;let n=!1;if(i.forms?.length>0)for(let a=0;a<i.forms.length;a++){if(!i.forms[a].isStarterSelectable)continue;const r=BigInt(Math.pow(2,a))*F.DEFAULT_FORM,o=$s(t.species,s.gameData.getSpeciesDexAttrProps(i,r),!0);n||=o}else n=$s(t.species,s.gameData.getSpeciesDexAttrProps(i,s.gameData.getSpeciesDefaultDexAttr(t.species,!1,!0)),!0);n?this.validStarterContainers.push(t):t.setVisible(!1)}):this.validStarterContainers=this.starterContainers;for(let t=0;t<this.validStarterContainers.length;t++){const i=this.validStarterContainers[t],n=i.icon,a=this.getCurrentDexProps(i.species.speciesId),r=s.gameData.getSpeciesDexAttrProps(i.species,a);n.setTexture(i.species.getIconAtlasKey(r.formIndex,r.shiny,r.variant),i.species.getIconId(r.female,r.formIndex,r.shiny,r.variant)),i.checkIconId(r.female,r.formIndex,r.shiny,r.variant)}this.validStarterContainers.forEach(t=>{t.setVisible(!1),t.cost=s.gameData.getSpeciesStarterValue(t.species.speciesId);const{dexEntry:i,starterDataEntry:n}=this.getSpeciesData(t.species.speciesId),a=i?.caughtAttr??BigInt(0),r=Lt.hasOwnProperty(t.species.speciesId),o=this.filterBar.getVals(we.GEN).includes(t.species.generation),l=this.filterBar.getVals(we.TYPES).some(L=>t.species.isOfType(L-1)),h=!!(a&F.NON_SHINY),u=!!(a&F.SHINY),p=u&&!!(a&F.DEFAULT_VARIANT),f=u&&!!(a&F.VARIANT_2),d=u&&!!(a&F.VARIANT_3),y=!h&&!p&&!f&&!d,g=this.filterBar.getVals(we.CAUGHT).some(L=>{if(L==="SHINY3")return d;if(L==="SHINY2")return f&&!d;if(L==="SHINY")return p&&!f&&!d;if(L==="NORMAL")return h&&!p&&!f&&!d;if(L==="UNCAUGHT")return y}),T=n.passiveAttr>0,E=this.isPassiveAvailable(t.species.speciesId)&&!T,b=this.filterBar.getVals(we.UNLOCKS).some(L=>{if(L.val==="PASSIVE"&&L.state===J.ON)return T;if(L.val==="PASSIVE"&&L.state===J.EXCLUDE)return r&&!T;if(L.val==="PASSIVE"&&L.state===J.UNLOCKABLE)return E;if(L.val==="PASSIVE"&&L.state===J.OFF)return!0}),_=n.valueReduction===1,O=n.valueReduction===2,w=this.isValueReductionAvailable(t.species.speciesId),U=this.filterBar.getVals(we.UNLOCKS).some(L=>{if(L.val==="COST_REDUCTION"&&L.state===J.ON)return _||O;if(L.val==="COST_REDUCTION"&&L.state===J.ONE)return _;if(L.val==="COST_REDUCTION"&&L.state===J.TWO)return O;if(L.val==="COST_REDUCTION"&&L.state===J.EXCLUDE)return r&&!(_||O);if(L.val==="COST_REDUCTION"&&L.state===J.UNLOCKABLE)return w;if(L.val==="COST_REDUCTION"&&L.state===J.OFF)return!0}),B=this.starterPreferences[t.species.speciesId]?.favorite??!1,K=this.filterBar.getVals(we.MISC).some(L=>{if(L.val==="FAVORITE"&&L.state===J.ON)return B;if(L.val==="FAVORITE"&&L.state===J.EXCLUDE)return!B;if(L.val==="FAVORITE"&&L.state===J.OFF)return!0}),V=n.classicWinCount>0,te=n.classicWinCount===0,de=n.classicWinCount===void 0,k=this.filterBar.getVals(we.MISC).some(L=>{if(L.val==="WIN"&&L.state===J.ON)return V;if(L.val==="WIN"&&L.state===J.EXCLUDE)return te||de;if(L.val==="WIN"&&L.state===J.OFF)return!0}),j=t.species.abilityHidden!==t.species.ability1&&t.species.abilityHidden!==Ha.NONE,I=n.abilityAttr&rt.ABILITY_HIDDEN,$=this.filterBar.getVals(we.MISC).some(L=>{if(L.val==="HIDDEN_ABILITY"&&L.state===J.ON)return I;if(L.val==="HIDDEN_ABILITY"&&L.state===J.EXCLUDE)return j&&!I;if(L.val==="HIDDEN_ABILITY"&&L.state===J.OFF)return!0}),re=this.isSameSpeciesEggAvailable(t.species.speciesId),H=this.filterBar.getVals(we.MISC).some(L=>{if(L.val==="EGG"&&L.state===J.ON)return re;if(L.val==="EGG"&&L.state===J.EXCLUDE)return r&&!re;if(L.val==="EGG"&&L.state===J.OFF)return!0}),ee=this.filterBar.getVals(we.MISC).some(L=>{if(L.val==="POKERUS"&&L.state===J.ON)return this.pokerusSpecies.includes(t.species);if(L.val==="POKERUS"&&L.state===J.EXCLUDE)return!this.pokerusSpecies.includes(t.species);if(L.val==="POKERUS"&&L.state===J.OFF)return!0});o&&l&&g&&b&&U&&K&&k&&$&&H&&ee&&this.filteredStarterContainers.push(t)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredStarterContainers.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(we.SORT)[0];this.filteredStarterContainers.sort((t,i)=>{switch(e.val){case Qe.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case Qe.COST:return(t.cost-i.cost)*-e.dir;case Qe.CANDY:{const n=s.gameData.starterData[t.species.speciesId].candyCount,a=s.gameData.starterData[i.species.speciesId].candyCount;return(n-a)*-e.dir}case Qe.IV:{const n=s.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[t.species.speciesId].ivs.length,a=s.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case Qe.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case Qe.CAUGHT:return(s.gameData.dexData[t.species.speciesId].caughtCount-s.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case Qe.HATCHED:return(s.gameData.dexData[t.species.speciesId].hatchedCount-s.gameData.dexData[i.species.speciesId].hatchedCount)*-e.dir}return 0}),this.updateScroll()},"updateStarters");destroy(){this.starterContainers=[]}updateScroll=c(()=>{const i=this.scrollCursor*9,n=Math.min(this.filteredStarterContainers.length-1,i+81-1);this.starterSelectScrollBar.setScrollCursor(this.scrollCursor);let a=0;this.filteredStarterContainers.forEach((r,o)=>{const{dexEntry:l,starterDataEntry:h}=this.getSpeciesData(r.species.speciesId),u=ml(o,this.scrollCursor);if(r.setPosition(u.x,u.y),o<i||o>n){r.setVisible(!1),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(u.x-1,u.y+1).setVisible(!1),a++),this.starterSpecies.includes(r.species)&&this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(u.x-1,u.y+1).setVisible(!1);return}r.setVisible(!0),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(u.x-1,u.y+1).setVisible(!0),a++),this.starterSpecies.includes(r.species)&&this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(u.x-1,u.y+1).setVisible(!0);const p=r.species.speciesId;this.updateStarterValueLabel(r),r.label.setVisible(!0);const f=p&&l.caughtAttr&F.SHINY?[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(d=>!!(l.caughtAttr&d)):[];for(let d=0;d<3;d++){const y=f.length>d;r.shinyIcons[d].setVisible(y),y&&r.shinyIcons[d].setTint(mt(f[d]===F.DEFAULT_VARIANT?0:f[d]===F.VARIANT_2?1:2))}r.starterPassiveBgs.setVisible(!!h.passiveAttr),r.hiddenAbilityIcon.setVisible(!!l.caughtAttr&&!!(h.abilityAttr&4)),r.classicWinIcon.setVisible(h.classicWinCount>0).setTexture(l.ribbons.has(Gs.NUZLOCKE)?"champion_ribbon_emerald":"champion_ribbon"),r.favoriteIcon.setVisible(this.starterPreferences[p]?.favorite??!1),s.candyUpgradeDisplay===0?(yt[p]||(yt[p]=["ffffff","ffffff"]),r.candyUpgradeIcon.setTint(ss(Gt(yt[p][0]))),r.candyUpgradeOverlayIcon.setTint(ss(Gt(yt[p][1]))),this.setUpgradeIcon(r)):s.candyUpgradeDisplay===1&&(r.candyUpgradeIcon.setVisible(!1),r.candyUpgradeOverlayIcon.setVisible(!1))})},"updateScroll");setCursor(e){let t=!1;if(this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else{e=Math.max(Math.min(this.filteredStarterContainers.length-1,e),0),t=super.setCursor(e);const i=ml(e,this.scrollCursor);this.cursorObj.setPosition(i.x-1,i.y+1);const n=this.filteredStarterContainers[e]?.species;if(n){const a=this.getCurrentDexProps(n.speciesId),r=s.gameData.getSpeciesDexAttrProps(n,a),o=this.starterPreferences[n.speciesId]?.variant?this.starterPreferences[n.speciesId].variant:r.variant,l=mt(o);this.pokemonShinyIcon.setFrame(Qt(o)).setTint(l),this.setSpecies(n),this.updateInstructions()}}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&(this.setSpecies(null),this.updateInstructions()),!0):!1}moveStarterIconsCursor(e){this.starterIconsCursorObj.setPositionRelative(this.starterIcons[e],this.starterIconsCursorXOffset,this.starterIconsCursorYOffset),this.starterSpecies.length>0?(this.starterIconsCursorObj.setVisible(!0),this.setSpecies(this.starterSpecies[e])):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null))}getFriendship(e){let t=s.gameData.starterData[e].friendship;(!t||t===void 0)&&(t=0);const i=mh(ze[e]);return{currentFriendship:t,friendshipCap:i}}setSpecies(e){if(this.speciesStarterDexEntry=null,this.dexAttrCursor=0n,this.abilityCursor=0,this.natureCursor=0,this.teraCursor=Se.UNKNOWN,e){const{dexEntry:i}=this.getSpeciesData(e.speciesId);this.speciesStarterDexEntry=i,this.dexAttrCursor=this.getCurrentDexProps(e.speciesId),this.abilityCursor=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),this.natureCursor=s.gameData.getSpeciesDefaultNature(e,i),this.teraCursor=e.type1}!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.pokemonAbilityText.off("pointerover"),this.pokemonPassiveText.off("pointerover");const t=e?{...this.starterPreferences[e.speciesId]}:null;if(t?.nature&&(this.natureCursor=t.nature),t?.ability&&!Number.isNaN(t.ability)&&(this.abilityCursor=t.ability),t?.tera&&(this.teraCursor=t.tera),this.statsMode&&(this.speciesStarterDexEntry?.caughtAttr?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),this.lastSpecies){const i=this.getCurrentDexProps(this.lastSpecies.speciesId),n=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,i),a=this.allSpecies.indexOf(this.lastSpecies),r=this.starterContainers[a].icon;this.checkIconId(r,this.lastSpecies,n.female,n.formIndex,n.shiny,n.variant),this.iconAnimHandler.addOrUpdate(r,Nt.NONE);const o=this.starterContainers[a].icon;s.tweens.getTweensOf(o).forEach(l=>l.play())}if(this.lastSpecies=e,e&&(this.speciesStarterDexEntry?.seenAttr||this.speciesStarterDexEntry?.caughtAttr)){if(this.pokemonNumberText.setText(ri(e.speciesId,4)),t?.nickname){const i=decodeURIComponent(escape(atob(t.nickname)));this.pokemonNameText.setText(i)}else this.pokemonNameText.setText(e.name);if(this.speciesStarterDexEntry?.caughtAttr){const i=yt[e.speciesId],n=s.gameData.getDexAttrLuck(this.speciesStarterDexEntry.caughtAttr);this.pokemonLuckText.setVisible(!!n).setText(n.toString()).setTint(mt(Math.min(n-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible);let a=wi(If[e.growthRate]);const r=Tt(a);m.exists("growth:"+r)&&(a=m.t("growth:"+r)),this.pokemonGrowthRateText.setText(a).setColor(aa(e.growthRate)).setShadowColor(aa(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0),this.pokemonUncaughtText.setVisible(!1),this.pokemonAbilityLabelText.setVisible(!0),this.pokemonPassiveLabelText.setVisible(!0),this.pokemonNatureLabelText.setVisible(!0),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry.caughtCount}`),e.speciesId===pe.MANAPHY||e.speciesId===pe.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Js(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry.hatchedCount}`);const o=this.getCurrentDexProps(e.speciesId),l=s.gameData.getSpeciesDexAttrProps(e,o),h=l.variant,u=mt(h);if(this.pokemonShinyIcon.setFrame(Qt(h)).setTint(u).setVisible(l.shiny),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonFormText.setVisible(!0),wt.hasOwnProperty(e.speciesId))this.pokemonCaughtHatchedContainer.setY(16),this.pokemonShinyIcon.setY(135).setFrame(Qt(h)),[this.pokemonCandyContainer,this.pokemonHatchedIcon,this.pokemonHatchedCountText].map(T=>T.setVisible(!1)),this.pokemonFormText.setY(25);else{this.pokemonCaughtHatchedContainer.setY(25),this.pokemonShinyIcon.setY(117),this.pokemonCandyIcon.setTint(ss(Gt(i[0]))),this.pokemonCandyOverlayIcon.setTint(ss(Gt(i[1]))),this.pokemonCandyCountText.setText(`${s.gameData.starterData[e.speciesId].candyCount}`),this.pokemonFormText.setY(42),this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0);const{currentFriendship:T,friendshipCap:E}=this.getFriendship(this.lastSpecies.speciesId),b=16-16*(T/E);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,b),this.pokemonCandyContainer.setVisible(!0).on("pointerover",()=>{s.ui.showTooltip("",`${T}/${E}`,!0),this.activeTooltip="CANDY"}).on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}const p=this.allSpecies.indexOf(e),f=this.starterContainers[p].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(f).forEach(T=>T.pause()),f.x=-2,f.y=2),this.iconAnimHandler.addOrUpdate(f,Nt.PASSIVE);const d=this.starterSpecies.indexOf(e);let y;if(d>-1)y=s.gameData.getSpeciesDexAttrProps(e,this.starterAttr[d]),this.setSpeciesDetails(e,{shiny:y.shiny,formIndex:y.formIndex,female:y.female,variant:y.variant,abilityIndex:this.starterAbilityIndexes[d],natureIndex:this.starterNatures[d],teraType:this.starterTeras[d]});else{const T=t?.ability??s.gameData.getStarterSpeciesDefaultAbilityIndex(e),{dexEntry:E}=this.getSpeciesData(e.speciesId),b=t?.nature||s.gameData.getSpeciesDefaultNature(e,E);y=s.gameData.getSpeciesDexAttrProps(e,o),t?.variant&&!Number.isNaN(t.variant)&&y.shiny&&(y.variant=t.variant),y.formIndex=t?.form??y.formIndex,y.female=t?.female??y.female,this.setSpeciesDetails(e,{shiny:y.shiny,formIndex:y.formIndex,female:y.female,variant:y.variant,abilityIndex:T,natureIndex:b,teraType:t?.tera})}ve(y.formIndex)||this.updateSelectedStarterMoveset(e.speciesId);const g=$t(e.speciesId,y.formIndex);this.setTypeIcons(g.type1,g.type2),this.pokemonSprite.clearTint(),this.pokerusSpecies.includes(e)&&Oi(ws.Pokerus)}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!0),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1);const i=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),n=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),a=s.gameData.getSpeciesDefaultNature(e),r=s.gameData.getSpeciesDexAttrProps(e,i);this.setSpeciesDetails(e,{shiny:r.shiny,formIndex:r.formIndex,female:r.female,variant:r.variant,abilityIndex:n,natureIndex:a,forSeen:!0}),this.pokemonSprite.setTint(8421504)}}else this.pokemonNumberText.setText(ri(0,4)),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!!e),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0,abilityIndex:0,natureIndex:0}),this.pokemonSprite.clearTint()}getSpeciesData(e,t=!0){const i=s.gameData.dexData[e],n=s.gameData.starterData[e],a={...i};a.ivs=[...i.ivs];const r={...n};return t&&fs(gs.STARTER_SELECT_MODIFY,e,a,r),{dexEntry:{...a},starterDataEntry:{...r}}}setSpeciesDetails(e,t={}){let{shiny:i,formIndex:n,female:a,variant:r,abilityIndex:o,natureIndex:l,teraType:h}=t;const u=t.forSeen??!1,p=e?s.gameData.getSpeciesDexAttrProps(e,this.dexAttrCursor):null,f=this.abilityCursor>-1?this.abilityCursor:s.gameData.getStarterSpeciesDefaultAbilityIndex(e);let d=-1;if(e){const{dexEntry:_}=this.getSpeciesData(e.speciesId);d=this.natureCursor>-1?this.natureCursor:s.gameData.getSpeciesDefaultNature(e,_)}const y=this.teraCursor>-1?this.teraCursor:e?e.type1:Se.UNKNOWN;this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=Se.UNKNOWN;const g=e?.genderDiffs&&!ve(a)||!ve(n)||!ve(i)||!ve(r),T=s.gameMode.hasChallenge(xt.FRESH_START);if(this.activeTooltip==="CANDY")if(this.lastSpecies&&this.pokemonCandyContainer.visible){const{currentFriendship:_,friendshipCap:O}=this.getFriendship(this.lastSpecies.speciesId);s.ui.editTooltip("",`${_}/${O}`)}else s.ui.hideTooltip();if(e?.forms?.find(_=>_.formKey==="female")&&(a!==void 0?n=a?1:0:n!==void 0&&(a=n===1)),e){this.dexAttrCursor|=(i!==void 0?!i:!(i=p?.shiny))?F.NON_SHINY:F.SHINY,this.dexAttrCursor|=(a!==void 0?!a:!(a=p?.female))?F.MALE:F.FEMALE,this.dexAttrCursor|=(r!==void 0?!r:!(r=p?.variant))?F.DEFAULT_VARIANT:r===1?F.VARIANT_2:F.VARIANT_3,this.dexAttrCursor|=s.gameData.getFormAttr(n!==void 0?n:n=p.formIndex),this.abilityCursor=o!==void 0?o:o=f,this.natureCursor=l!==void 0?l:l=d,this.teraCursor=ve(h)?h=y:h;const[_,O]=this.isInParty(e);_&&this.updatePartyIcon(e,O)}if(this.pokemonSprite.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonPassiveText.setVisible(!1),this.pokemonPassiveDisabledIcon.setVisible(!1),this.pokemonPassiveLockedIcon.setVisible(!1),this.teraIcon.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),this.starterMoveset=null,this.speciesStarterMoves=[],e){const{dexEntry:_,starterDataEntry:O}=this.getSpeciesData(e.speciesId),w=_.caughtAttr||BigInt(0),U=O.abilityAttr;if(!w){const B=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)),K=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),V=s.gameData.getSpeciesDefaultNature(e,_);(i===void 0||i!==B.shiny)&&(i=B.shiny),(n===void 0||n!==B.formIndex)&&(n=B.formIndex),(a===void 0||a!==B.female)&&(a=B.female),(r===void 0||r!==B.variant)&&(r=B.variant),(o===void 0||o!==K)&&(o=K),(l===void 0||l!==V)&&(l=V)}if(this.shinyOverlay.setVisible(i??!1),this.pokemonNumberText.setColor(this.getTextColor(i?A.SUMMARY_DEX_NUM_GOLD:A.SUMMARY_DEX_NUM,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(i?A.SUMMARY_DEX_NUM_GOLD:A.SUMMARY_DEX_NUM,!0)),u?this.speciesStarterDexEntry?.seenAttr:this.speciesStarterDexEntry?.caughtAttr){const B=this.starterSpecies.indexOf(e);B>-1&&(this.starterAttr[B]=this.dexAttrCursor,this.starterAbilityIndexes[B]=this.abilityCursor,this.starterNatures[B]=this.natureCursor,this.starterTeras[B]=this.teraCursor);const K=new ot(!1);this.assetLoadCancelled=K,a??=!1,g?e.loadAssets(a,n,i,r,!0).then(()=>{K.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,n,i,r)).setPipelineData("shiny",i).setPipelineData("variant",r).setPipelineData("spriteKey",e.getSpriteKey(a,n,i,r)).setVisible(!this.statsMode))}):this.pokemonSprite.setVisible(!this.statsMode);const V=this.filteredStarterContainers.find(ee=>ee.species.speciesId===e.speciesId);V&&(V.icon.setTexture(e.getIconAtlasKey(n,i,r),e.getIconId(a,n,i,r)),V.checkIconId(a,n,i,r));const te=!!(w&F.NON_SHINY),de=!!(w&F.SHINY),k=[F.DEFAULT_VARIANT,F.VARIANT_2,F.VARIANT_3].filter(ee=>w&ee);this.canCycleShiny=te&&de||de&&k.length>1;const j=!!(w&F.MALE),I=!!(w&F.FEMALE);this.canCycleGender=j&&I;const $=U&rt.ABILITY_1;let re=U&rt.ABILITY_2;const H=U&rt.ABILITY_HIDDEN;$&&re&&e.ability1===e.ability2&&(re=0),this.canCycleAbility=[$,re,H].filter(ee=>ee).length>1,this.canCycleForm=e.forms.filter(ee=>ee.isStarterSelectable||!ai[e.speciesId]?.find(L=>L.formKey)).map((ee,L)=>_.caughtAttr&s.gameData.getFormAttr(L)).filter(ee=>ee).length>1,this.canCycleNature=s.gameData.getNaturesForAttr(_.natureAttr).length>1,this.canCycleTera=!this.statsMode&&this.allowTera&&!ve($t(e.speciesId,n??0).type2)&&!s.gameMode.hasChallenge(xt.FRESH_START)}if(_.caughtAttr&&e.malePercent!==null){const B=a?kt.FEMALE:kt.MALE;this.pokemonGenderText.setText(hh(B)).setColor(Ai(B)).setShadowColor(Ai(B,!0))}else this.pokemonGenderText.setText("");if(_.caughtAttr){let B;this.lastSpecies.forms?.length>1?B=Et[this.lastSpecies.forms[n??0].getAbility(o)]:B=Et[this.lastSpecies.getAbility(o)];const K=o===(this.lastSpecies.ability2?2:1);this.pokemonAbilityText.setText(B.name).setColor(this.getTextColor(K?A.SUMMARY_GOLD:A.SUMMARY_ALT)).setShadowColor(this.getTextColor(K?A.SUMMARY_GOLD:A.SUMMARY_ALT,!0));const V=O.passiveAttr,te=Et[this.lastSpecies.getPassiveAbility(n)];if(this.pokemonAbilityText.visible&&(this.activeTooltip==="ABILITY"&&s.ui.editTooltip(`${B.name}`,`${B.description}`),this.pokemonAbilityText.on("pointerover",()=>{s.ui.showTooltip(`${B.name}`,`${B.description}`,!0),this.activeTooltip="ABILITY"}),this.pokemonAbilityText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})),te){const H=!!(V&bt.UNLOCKED),ee=!!(V&bt.ENABLED),L=H&&ee?A.SUMMARY_ALT:A.SUMMARY_GRAY,Ee=H&&ee?1:.5;this.pokemonPassiveLabelText.setVisible(!T).setColor(this.getTextColor(A.SUMMARY_ALT)).setShadowColor(this.getTextColor(A.SUMMARY_ALT,!0)),this.pokemonPassiveText.setVisible(!T).setText(te.name).setColor(this.getTextColor(L)).setAlpha(Ee).setShadowColor(this.getTextColor(L,!0)),this.activeTooltip==="PASSIVE"&&s.ui.editTooltip(`${te.name}`,`${te.description}`),this.pokemonPassiveText.visible&&(this.pokemonPassiveText.on("pointerover",()=>{s.ui.showTooltip(`${te.name}`,`${te.description}`,!0),this.activeTooltip="PASSIVE"}),this.pokemonPassiveText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0}));const W={x:this.pokemonPassiveText.x+this.pokemonPassiveText.displayWidth+1,y:this.pokemonPassiveText.y+this.pokemonPassiveText.displayHeight/2};this.pokemonPassiveDisabledIcon.setVisible(H&&!ee&&!T).setPosition(W.x,W.y),this.pokemonPassiveLockedIcon.setVisible(!H&&!T).setPosition(W.x,W.y)}else this.activeTooltip==="PASSIVE"&&s.ui.hideTooltip();this.pokemonNatureText.setText(xi(l,!0,!0,!1,s.uiTheme));let de;if(Zs.hasOwnProperty(e.speciesId)&&n&&Zs[e.speciesId].hasOwnProperty(n)?de=Zs[e.speciesId][n]:de=vr[e.speciesId],this.speciesStarterMoves.push(...de.filter(H=>H[0]>0&&H[0]<=5).map(H=>H[1])),Lt.hasOwnProperty(e.speciesId))for(let H=0;H<4;H++)O.eggMoves&1<<H&&this.speciesStarterMoves.push(Lt[e.speciesId][H]);const k=O.moveset,j=k?Array.isArray(k)?k:k[n]:null,I=this.speciesStarterMoves.concat(Lt.hasOwnProperty(e.speciesId)?Lt[e.speciesId].filter((H,ee)=>O.eggMoves&1<<ee):[]);this.starterMoveset=(j||this.speciesStarterMoves.slice(0,4)).filter(H=>I.find(ee=>ee===H)),this.starterMoveset.length<4&&this.starterMoveset.length<I.length&&this.starterMoveset.push(...I.filter(H=>this.starterMoveset?.indexOf(H)===-1).slice(0,4-this.starterMoveset.length)),this.starterMoveset=this.starterMoveset.filter((H,ee)=>this.starterMoveset?.indexOf(H)===ee);const $=$t(e.speciesId,n),re=e.getFormNameToDisplay(n);this.pokemonFormText.setText(re),this.setTypeIcons($.type1,$.type2),this.teraIcon.setFrame(Se[this.teraCursor].toLowerCase()),this.teraIcon.setVisible(!this.statsMode&&this.allowTera)}else this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(A.SUMMARY)).setShadowColor(this.getTextColor(A.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null);this.starterMoveset||(this.starterMoveset=this.speciesStarterMoves.slice(0,4));for(let _=0;_<4;_++){const O=_<this.starterMoveset.length?Fe[this.starterMoveset[_]]:null;this.pokemonMoveBgs[_].setFrame(Se[O?O.type:Se.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[_].setText(O?O.name:"-"),this.pokemonMoveContainers[_].setVisible(!!O)}const E=e&&Lt.hasOwnProperty(e.speciesId);let b=0;if(e){const{starterDataEntry:_}=this.getSpeciesData(this.lastSpecies.speciesId);b=_.eggMoves}for(let _=0;_<4;_++){const O=E?Fe[Lt[e.speciesId][_]]:null,w=O&&b&1<<_;this.pokemonEggMoveBgs[_].setFrame(Se[O?O.type:Se.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[_].setText(O&&w?O.name:"???")}this.pokemonEggMovesContainer.setVisible(!!this.speciesStarterDexEntry?.caughtAttr&&E),this.pokemonAdditionalMoveCountLabel.setText(`(+${Math.max(this.speciesStarterMoves.length-4,0)})`).setVisible(this.speciesStarterMoves.length>4),this.tryUpdateValue(),this.updateInstructions(),hp(this.originalStarterPreferences)}setTypeIcons(e,t){e!==null?this.type1Icon.setVisible(!0).setFrame(Se[e].toLowerCase()):this.type1Icon.setVisible(!1),t!==null?this.type2Icon.setVisible(!0).setFrame(Se[t].toLowerCase()):this.type2Icon.setVisible(!1)}popStarter(e){this.starterSpecies.splice(e,1),this.starterAttr.splice(e,1),this.starterAbilityIndexes.splice(e,1),this.starterNatures.splice(e,1),this.starterTeras.splice(e,1),this.starterMovesets.splice(e,1);for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=this.getCurrentDexProps(i.speciesId),a=s.gameData.getSpeciesDexAttrProps(i,n);this.starterIcons[t].setTexture(i.getIconAtlasKey(a.formIndex,a.shiny,a.variant)).setFrame(i.getIconId(a.female,a.formIndex,a.shiny,a.variant)),this.checkIconId(this.starterIcons[t],i,a.female,a.formIndex,a.shiny,a.variant),t>=e&&this.starterCursorObjs[t].setPosition(this.starterCursorObjs[t+1].x,this.starterCursorObjs[t+1].y).setVisible(this.starterCursorObjs[t+1].visible)}this.starterCursorObjs[this.starterSpecies.length].setVisible(!1),this.starterIcons[this.starterSpecies.length].setTexture("pokemon_icons_0").setFrame("unknown"),this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===this.starterSpecies.length&&(this.starterSpecies.length>0?this.starterIconsCursorIndex--:(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):this.startCursorObj.visible&&this.starterSpecies.length===0&&(this.startCursorObj.setVisible(!1),this.filteredStarterContainers.length>0?(this.cursorObj.setVisible(!0),this.setCursor(this.scrollCursor*9)):(this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.tryUpdateValue()}updateStarterValueLabel(e){const t=e.species.speciesId,i=ze[t],n=s.gameData.getSpeciesStarterValue(t);e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=A.WINDOW;break;case 1:case .5:r=A.SUMMARY_BLUE;break;default:r=A.SUMMARY_GOLD;break}e.label.setColor(this.getTextColor(r)).setShadowColor(this.getTextColor(r,!0))}tryUpdateValue(e,t){const n=this.starterSpecies.map(u=>u.generation).reduce((u,p,f)=>u+=s.gameData.getSpeciesStarterValue(this.starterSpecies[f].speciesId),0)+(e||0),a=this.getValueLimit(),r=n>a;let o=n.toString();if(o.startsWith("0.")&&(o=o.slice(1)),this.valueLimitLabel.setText(`${o}/${a}`).setColor(this.getTextColor(r?A.SUMMARY_PINK:A.TOOLTIP_CONTENT)).setShadowColor(this.getTextColor(r?A.SUMMARY_PINK:A.TOOLTIP_CONTENT,!0)),r)return s.time.delayedCall(ge(500),()=>this.tryUpdateValue()),!1;let l=this.isPartyValid();if(t){const u=this.filteredStarterContainers[this.cursor].species,p=$s(u,s.gameData.getSpeciesDexAttrProps(u,this.getCurrentDexProps(u.speciesId)),!1);l||=p}const h=a-n;for(let u=0;u<this.allSpecies.length;u++){const p=s.gameData.getSpeciesStarterValue(this.allSpecies[u].speciesId),f=this.starterContainers[u].icon,d=$s(this.allSpecies[u],s.gameData.getSpeciesDexAttrProps(this.allSpecies[u],this.getCurrentDexProps(this.allSpecies[u].speciesId)),l),y=h>=p&&d,g=this.isInParty(this.allSpecies[u])[0];y||g&&h>=p?f.setAlpha(1):f.setAlpha(.375)}return!0}tryExit(){this.blockInput=!0;const e=this.getUi(),t=c(()=>{e.setMode(x.STARTER_SELECT),this.clearText(),this.blockInput=!1},"cancel");e.showText(m.t("starterSelectUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(x.CONFIRM,()=>{e.setMode(x.STARTER_SELECT),s.gameMode.isChallenge?(s.phaseManager.clearPhaseQueue(),s.phaseManager.pushNew("SelectChallengePhase"),s.phaseManager.pushNew("EncounterPhase")):s.phaseManager.toTitleScreen(),this.clearText(),s.phaseManager.getCurrentPhase()?.end()},t,null,null,19)})}tryStart(e=!1){if(!this.starterSpecies.length)return!1;const t=this.getUi(),i=c(()=>{t.setMode(x.STARTER_SELECT),e||this.popStarter(this.starterSpecies.length-1),this.clearText()},"cancel");return this.isPartyValid()?t.showText(m.t("starterSelectUiHandler:confirmStartTeam"),null,()=>{t.setModeWithoutClear(x.CONFIRM,()=>{c(()=>{s.money=s.gameMode.getStartingMoney(),t.setMode(x.STARTER_SELECT);const r=this,o=this.starterSelectCallback;this.starterSelectCallback=null,o?.(new Array(this.starterSpecies.length).fill(0).map((l,h)=>{const u=r.starterSpecies[h],{starterDataEntry:p}=this.getSpeciesData(u.speciesId);return{species:u,dexAttr:r.starterAttr[h],abilityIndex:r.starterAbilityIndexes[h],passive:!(p.passiveAttr^(bt.ENABLED|bt.UNLOCKED)),nature:r.starterNatures[h],teraType:r.starterTeras[h],moveset:r.starterMovesets[h],pokerus:r.pokerusSpecies.includes(u),nickname:r.starterPreferences[u.speciesId]?.nickname}}))},"startRun")()},i,null,null,19)}):(this.tutorialActive=!0,this.showText(m.t("starterSelectUiHandler:invalidParty"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),void 0,!0)),!0}isPartyValid(){let e=!1;for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=$s(i,s.gameData.getSpeciesDexAttrProps(i,this.getCurrentDexProps(i.speciesId)),!1);e||=n}return e}getCurrentDexProps(e){let t=0n;const{dexEntry:i}=this.getSpeciesData(e),n=i.caughtAttr;return this.starterPreferences[e]?.female||(n&F.FEMALE)>0n&&(n&F.MALE)===0n?t+=F.FEMALE:t+=F.MALE,this.starterPreferences[e]?.shiny||(n&F.SHINY)>0n&&this.starterPreferences[e]?.shiny!==!1?(t+=F.SHINY,this.starterPreferences[e]?.variant!==void 0?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.variant))*F.DEFAULT_VARIANT:(n&F.VARIANT_3)>0?t+=F.VARIANT_3:(n&F.VARIANT_2)>0?t+=F.VARIANT_2:t+=F.DEFAULT_VARIANT):(t+=F.NON_SHINY,t+=F.DEFAULT_VARIANT),this.starterPreferences[e]?.form?t+=BigInt(Math.pow(2,this.starterPreferences[e]?.form))*F.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}toggleStatsMode(e){if(e===void 0&&(e=!this.statsMode),e)this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1),this.teraIcon.setVisible(!1),this.canCycleTera=!1,this.updateInstructions();else{this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!!this.speciesStarterDexEntry?.caughtAttr),this.statsContainer.updateIvs(null),this.teraIcon.setVisible(this.allowTera);const i=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)).formIndex;this.canCycleTera=!this.statsMode&&this.allowTera&&!ve($t(this.lastSpecies.speciesId,i??0).type2)&&!s.gameMode.hasChallenge(xt.FRESH_START),this.updateInstructions()}}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.abilityIconElement.setVisible(!1),this.abilityLabel.setVisible(!1),this.natureIconElement.setVisible(!1),this.natureLabel.setVisible(!1),this.teraIconElement.setVisible(!1),this.teraLabel.setVisible(!1),this.goFilterIconElement.setVisible(!1),this.goFilterLabel.setVisible(!1)}clear(){for(super.clear(),hp(this.originalStarterPreferences),this.clearStarterPreferences(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1;this.starterSpecies.length;)this.popStarter(this.starterSpecies.length-1);this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)).setFrame(t.getIconId(i,n,!1,r)))}clearStarterPreferences(){this.starterPreferences={},this.originalStarterPreferences={}}};c(ju,"StarterSelectUiHandler");let bn=ju;const $u=class $u{events;inputsController;constructor(e){this.inputsController=e,this.init()}init(){this.events=this.inputsController.events,this.listenInputs()}detectInputMethod(e){e.controller_type==="keyboard"?e.hasOwnProperty("isTouch")&&e.isTouch?s.inputMethod="touch":s.inputMethod="keyboard":e.controller_type==="gamepad"&&(s.inputMethod="gamepad")}listenInputs(){this.events.on("input_down",e=>{this.detectInputMethod(e);const t=this.getActionsKeyDown();t.hasOwnProperty(e.button)&&t[e.button]()},this),this.events.on("input_up",e=>{const t=this.getActionsKeyUp();t.hasOwnProperty(e.button)&&t[e.button]()},this)}doVibration(e,t){e&&s.enableVibration&&typeof navigator.vibrate<"u"&&navigator.vibrate(t)}getActionsKeyDown(){return{[v.UP]:()=>this.buttonDirection(v.UP),[v.DOWN]:()=>this.buttonDirection(v.DOWN),[v.LEFT]:()=>this.buttonDirection(v.LEFT),[v.RIGHT]:()=>this.buttonDirection(v.RIGHT),[v.SUBMIT]:()=>this.buttonTouch(),[v.ACTION]:()=>this.buttonAb(v.ACTION),[v.CANCEL]:()=>this.buttonAb(v.CANCEL),[v.MENU]:()=>this.buttonMenu(),[v.STATS]:()=>this.buttonGoToFilter(v.STATS),[v.CYCLE_SHINY]:()=>this.buttonCycleOption(v.CYCLE_SHINY),[v.CYCLE_FORM]:()=>this.buttonCycleOption(v.CYCLE_FORM),[v.CYCLE_GENDER]:()=>this.buttonCycleOption(v.CYCLE_GENDER),[v.CYCLE_ABILITY]:()=>this.buttonCycleOption(v.CYCLE_ABILITY),[v.CYCLE_NATURE]:()=>this.buttonCycleOption(v.CYCLE_NATURE),[v.CYCLE_TERA]:()=>this.buttonCycleOption(v.CYCLE_TERA),[v.SPEED_UP]:()=>this.buttonSpeedChange(),[v.SLOW_DOWN]:()=>this.buttonSpeedChange(!1)}}getActionsKeyUp(){return{[v.UP]:()=>{},[v.DOWN]:()=>{},[v.LEFT]:()=>{},[v.RIGHT]:()=>{},[v.SUBMIT]:()=>{},[v.ACTION]:()=>{},[v.CANCEL]:()=>{},[v.MENU]:()=>{},[v.STATS]:()=>this.buttonStats(!1),[v.CYCLE_SHINY]:()=>{},[v.CYCLE_FORM]:()=>{},[v.CYCLE_GENDER]:()=>{},[v.CYCLE_ABILITY]:()=>{},[v.CYCLE_NATURE]:()=>{},[v.CYCLE_TERA]:()=>this.buttonInfo(!1),[v.SPEED_UP]:()=>{},[v.SLOW_DOWN]:()=>{}}}buttonDirection(e){const t=s.ui.processInput(e);this.doVibration(t,5)}buttonAb(e){s.ui.processInput(e)}buttonTouch(){s.ui.processInput(v.SUBMIT)||s.ui.processInput(v.ACTION)}buttonStats(e=!0){for(const t of s.getInfoToggles(!0))t.toggleInfo(e);for(const t of s.getField().filter(i=>i?.isActive(!0)))t.toggleStats(e)}buttonGoToFilter(e){const t=[bn,Sn,Tn],i=s.ui?.getHandler();t.some(n=>i instanceof n)?s.ui.processInput(e):this.buttonStats(!0)}buttonInfo(e=!0){if(s.showMovesetFlyout)for(const t of s.getEnemyField().filter(i=>i?.isActive(!0)))t.toggleFlyout(e);s.showArenaFlyout&&s.ui.processInfoButton(e)}buttonMenu(){if(!s.disableMenu)switch(s.ui?.getMode()){case x.MESSAGE:{const e=s.ui.getHandler();if(!e.pendingPrompt||e.isTextAnimationInProgress())return}case x.TITLE:case x.COMMAND:case x.MODIFIER_SELECT:case x.MYSTERY_ENCOUNTER:s.ui.setOverlayMode(x.MENU);break;case x.STARTER_SELECT:case x.POKEDEX_PAGE:this.buttonTouch();break;case x.MENU:s.ui.revertMode(),s.playSound("ui/select");break;default:return}}buttonCycleOption(e){const t=[bn,Sn,Tn,Na,ya,xa,Aa,wa,Ma],i=s.ui?.getHandler();t.some(n=>i instanceof n)?s.ui.processInput(e):e===v.CYCLE_TERA&&this.buttonInfo(!0)}buttonSpeedChange(e=!0){const t=Vm(ks.Game_Speed),i=Of[t].options;let n=i.findIndex(r=>r.value===s.gameSpeed.toString());n===-1&&(n=5);let a;if(e&&s.gameSpeed<5)a=1;else if(!e&&s.gameSpeed>1)a=-1;else return;s.gameData.saveSetting(ks.Game_Speed,rs.Math.Clamp(n+a,0,i.length-1)),s.ui?.getMode()===x.SETTINGS&&s.ui.getHandler().show([])}};c($u,"UiInputs");let yl=$u;const Xu=class Xu{damageNumbers;constructor(){this.damageNumbers=new Map}add(e,t,i=$e.EFFECTIVE,n=!1){if(!s?.damageNumbersMode)return;const a=e.getBattlerIndex(),r=e.getSpriteScale()/6,o=P(e.x,-s.scaledCanvas.height+e.y-e.getSprite().height/2,Hm(t,!0),A.SUMMARY);o.setName("text-damage-number"),o.setOrigin(.5,1),o.setScale(r);let[l,h]=[null,null];switch(i){case $e.SUPER_EFFECTIVE:[l,h]=["#f8d030","#b8a038"];break;case $e.NOT_VERY_EFFECTIVE:[l,h]=["#f08030","#c03028"];break;case $e.INDIRECT_KO:case $e.ONE_HIT_KO:[l,h]=["#a040a0","#483850"];break;case $e.HEAL:[l,h]=["#78c850","#588040"];break;default:[l,h]=["#ffffff","#636363"];break}l&&o.setColor(l),h&&(n?(o.setShadowOffset(0,0),o.setStroke(h,12)):o.setShadowColor(h)),s.fieldUI.add(o),this.damageNumbers.has(a)||this.damageNumbers.set(a,[]);const u=this.damageNumbers.get(a).length*-10;if(u&&(o.y+=u),this.damageNumbers.get(a).push(o),s.damageNumbersMode===1){s.tweens.add({targets:o,duration:ge(750),alpha:1,y:"-=32"}),s.tweens.add({delay:375,targets:o,duration:ge(625),alpha:0,ease:"Sine.easeIn",onComplete:c(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")});return}o.setAlpha(0),s.tweens.chain({targets:o,tweens:[{duration:ge(250),alpha:1,scaleX:.75*r,scaleY:1.25*r,y:"-=16",ease:"Cubic.easeOut"},{duration:ge(175),alpha:1,scaleX:.875*r,scaleY:1.125*r,y:"+=16",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.25*r,scaleY:.75*r,ease:"Cubic.easeOut"},{duration:ge(175),scaleX:.875*r,scaleY:1.125*r,y:"-=8",ease:"Cubic.easeOut"},{duration:ge(50),scaleX:.925*r,scaleY:1.075*r,y:"+=8",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.125*r,scaleY:.875*r,ease:"Cubic.easeOut"},{duration:ge(175),scaleX:.925*r,scaleY:1.075*r,y:"-=4",ease:"Cubic.easeOut"},{duration:ge(50),scaleX:.975*r,scaleY:1.025*r,y:"+=4",ease:"Cubic.easeIn"},{duration:ge(100),scaleX:1.075*r,scaleY:.925*r,ease:"Cubic.easeOut"},{duration:ge(25),scaleX:r,scaleY:r,ease:"Cubic.easeOut"},{delay:ge(500),alpha:0,onComplete:c(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")}]})}};c(Xu,"DamageNumberHandler");let Tl=Xu;const qu=class qu{sprites;counterTween;setup(){this.sprites=new Set,this.counterTween=s.tweens.addCounter({duration:ge(200),from:0,to:1,yoyo:!0,repeat:-1,onRepeat:c(()=>this.onLapse(),"onRepeat")})}onLapse(){Array.from(this.sprites.values()).filter(e=>!e.scene).map(e=>this.sprites.delete(e));for(const e of this.sprites.values()){if(!e.pipelineData.teraColor||!e.pipelineData.teraColor.find(f=>f)||!e.visible||e.parentContainer instanceof Ys&&!e.parentContainer.parentContainer||!(e.parentContainer instanceof Ys)||!e.parentContainer.isTerastallized)continue;const t=e.parentContainer instanceof Ys?e.parentContainer:null,i=(t||e).parentContainer,n=e.texture,[a,r]=[n.source[0].width,n.source[0].height],[o,l]=[ms(a),ms(r)],h=e.width/a,u=e.height/r;if(n.manager.getPixel(o,l,n.key,"__BASE")?.alpha){const[f,d]=[-e.originX*e.width,-e.originY*e.height],y=s.addFieldSprite((t?.x||0)+e.x+o*h+f,(t?.y||0)+e.y+l*u+d,"tera_sparkle");y.pipelineData.ignoreTimeTint=e.pipelineData.ignoreTimeTint,y.setName("sprite-tera-sparkle"),y.play("tera_sparkle"),i.add(y),e.scene.time.delayedCall(ge(Math.floor(1e3/12*13)),()=>y.destroy())}}}add(e){e=sa(e);for(const t of e)this.sprites.has(t)||this.sprites.add(t)}remove(e){e=sa(e);for(const t of e)this.sprites.delete(t)}removeAll(){for(const e of this.sprites.values())this.sprites.delete(e)}destroy(){this.removeAll(),this.counterTween&&(this.counterTween.destroy(),this.counterTween=void 0)}};c(qu,"PokemonSpriteSparkleHandler");let Sl=qu;var qe=(C=>(C[C.SYSTEM=0]="SYSTEM",C[C.SESSION=1]="SESSION",C[C.SETTINGS=2]="SETTINGS",C[C.TUTORIALS=3]="TUTORIALS",C[C.SEEN_DIALOGUES=4]="SEEN_DIALOGUES",C[C.RUN_HISTORY=5]="RUN_HISTORY",C))(qe||{});const Qu=class Qu{id;tier;sourceType;hatchWaves;timestamp;variantTier;isShiny;species;eggMoveIndex;overrideHiddenAbility;constructor(e){const t=e instanceof Ii?e:null;this.id=t?t.id:e.id,this.tier=t?t.tier:e.tier??Math.floor(this.id/Cr),e.species===0?this.sourceType=e.gachaType??e.sourceType:this.sourceType=t?t.sourceType:e.sourceType,this.hatchWaves=t?t.hatchWaves:e.hatchWaves,this.timestamp=t?t.timestamp:e.timestamp,this.variantTier=t?t.variantTier:e.variantTier,this.isShiny=t?t.isShiny:e.isShiny,this.species=t?t.species:e.species,this.eggMoveIndex=t?t.eggMoveIndex:e.eggMoveIndex,this.overrideHiddenAbility=t?t.overrideHiddenAbility:e.overrideHiddenAbility}toEgg(){return this.species?new Ii({id:this.id,tier:this.tier,sourceType:this.sourceType,hatchWaves:this.hatchWaves,timestamp:this.timestamp,variantTier:this.variantTier,isShiny:this.isShiny,species:this.species,eggMoveIndex:this.eggMoveIndex,overrideHiddenAbility:this.overrideHiddenAbility}):new Ii({id:this.id,hatchWaves:this.hatchWaves,sourceType:this.sourceType,timestamp:this.timestamp,tier:Math.floor(this.id/Cr)})}};c(Qu,"EggData");let ka=Qu;const Zu=class Zu{playTime;battles;classicSessionsPlayed;sessionsWon;ribbonsOwned;dailyRunSessionsPlayed;dailyRunSessionsWon;endlessSessionsPlayed;highestEndlessWave;highestLevel;highestMoney;highestDamage;highestHeal;pokemonSeen;pokemonDefeated;pokemonCaught;pokemonHatched;subLegendaryPokemonSeen;subLegendaryPokemonCaught;subLegendaryPokemonHatched;legendaryPokemonSeen;legendaryPokemonCaught;legendaryPokemonHatched;mythicalPokemonSeen;mythicalPokemonCaught;mythicalPokemonHatched;shinyPokemonSeen;shinyPokemonCaught;shinyPokemonHatched;pokemonFused;trainersDefeated;eggsPulled;rareEggsPulled;epicEggsPulled;legendaryEggsPulled;manaphyEggsPulled;constructor(e){this.playTime=e?.playTime||0,this.battles=e?.battles||0,this.classicSessionsPlayed=e?.classicSessionsPlayed||0,this.sessionsWon=e?.sessionsWon||0,this.ribbonsOwned=e?.ribbonsOwned||0,this.dailyRunSessionsPlayed=e?.dailyRunSessionsPlayed||0,this.dailyRunSessionsWon=e?.dailyRunSessionsWon||0,this.endlessSessionsPlayed=e?.endlessSessionsPlayed||0,this.highestEndlessWave=e?.highestEndlessWave||0,this.highestLevel=e?.highestLevel||0,this.highestMoney=e?.highestMoney||0,this.highestDamage=e?.highestDamage||0,this.highestHeal=e?.highestHeal||0,this.pokemonSeen=e?.pokemonSeen||0,this.pokemonDefeated=e?.pokemonDefeated||0,this.pokemonCaught=e?.pokemonCaught||0,this.pokemonHatched=e?.pokemonHatched||0,this.subLegendaryPokemonSeen=e?.subLegendaryPokemonSeen??0,this.subLegendaryPokemonCaught=e?.subLegendaryPokemonCaught??0,this.subLegendaryPokemonHatched=e?.subLegendaryPokemonHatched??0,this.legendaryPokemonSeen=e?.legendaryPokemonSeen||0,this.legendaryPokemonCaught=e?.legendaryPokemonCaught||0,this.legendaryPokemonHatched=e?.legendaryPokemonHatched||0,this.mythicalPokemonSeen=e?.mythicalPokemonSeen||0,this.mythicalPokemonCaught=e?.mythicalPokemonCaught||0,this.mythicalPokemonHatched=e?.mythicalPokemonHatched||0,this.shinyPokemonSeen=e?.shinyPokemonSeen||0,this.shinyPokemonCaught=e?.shinyPokemonCaught||0,this.shinyPokemonHatched=e?.shinyPokemonHatched||0,this.pokemonFused=e?.pokemonFused||0,this.trainersDefeated=e?.trainersDefeated||0,this.eggsPulled=e?.eggsPulled||0,this.rareEggsPulled=e?.rareEggsPulled||0,this.epicEggsPulled=e?.epicEggsPulled||0,this.legendaryEggsPulled=e?.legendaryEggsPulled||0,this.manaphyEggsPulled=e?.manaphyEggsPulled||0}};c(Zu,"GameStats");let Pa=Zu;const LT=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Bp=c(C=>{if(typeof C!="string")throw new TypeError("Invalid argument expected string");const e=C.match(LT);if(!e)throw new Error(`Invalid argument not valid semver ('${C}' received)`);return e.shift(),e},"validateAndParse"),Lp=c(C=>C==="*"||C==="x"||C==="X","isWildcard"),Dp=c(C=>{const e=parseInt(C,10);return isNaN(e)?C:e},"tryParse"),DT=c((C,e)=>typeof C!=typeof e?[String(C),String(e)]:[C,e],"forceType"),RT=c((C,e)=>{if(Lp(C)||Lp(e))return 0;const[t,i]=DT(Dp(C),Dp(e));return t>i?1:t<i?-1:0},"compareStrings"),Rp=c((C,e)=>{for(let t=0;t<Math.max(C.length,e.length);t++){const i=RT(C[t]||"0",e[t]||"0");if(i!==0)return i}return 0},"compareSegments"),vn=c((C,e)=>{const t=Bp(C),i=Bp(e),n=t.pop(),a=i.pop(),r=Rp(t,i);return r!==0?r:n&&a?Rp(n.split("."),a.split(".")):n||a?n?-1:1:0},"compareVersions"),FT={version:"1.0.4",migrate:c(C=>{C.starterData&&C.dexData&&Object.keys(C.starterData).forEach(e=>{C.dexData[e]?.caughtAttr&&C.starterData[e]&&!C.starterData[e].abilityAttr&&(C.starterData[e].abilityAttr=1)})},"migrate")},UT={version:"1.0.4",migrate:c(C=>{C.gameStats&&C.gameStats.legendaryPokemonCaught!==void 0&&C.gameStats.subLegendaryPokemonCaught===void 0&&(C.gameStats.subLegendaryPokemonSeen=0,C.gameStats.subLegendaryPokemonCaught=0,C.gameStats.subLegendaryPokemonHatched=0,it.filter(e=>e.subLegendary).forEach(e=>{const t=C.dexData[e.speciesId];C.gameStats.subLegendaryPokemonSeen+=t.seenCount,C.gameStats.legendaryPokemonSeen=Math.max(C.gameStats.legendaryPokemonSeen-t.seenCount,0),C.gameStats.subLegendaryPokemonCaught+=t.caughtCount,C.gameStats.legendaryPokemonCaught=Math.max(C.gameStats.legendaryPokemonCaught-t.caughtCount,0),C.gameStats.subLegendaryPokemonHatched+=t.hatchedCount,C.gameStats.legendaryPokemonHatched=Math.max(C.gameStats.legendaryPokemonHatched-t.hatchedCount,0)}),C.gameStats.subLegendaryPokemonSeen=Math.max(C.gameStats.subLegendaryPokemonSeen,C.gameStats.subLegendaryPokemonCaught),C.gameStats.legendaryPokemonSeen=Math.max(C.gameStats.legendaryPokemonSeen,C.gameStats.legendaryPokemonCaught),C.gameStats.mythicalPokemonSeen=Math.max(C.gameStats.mythicalPokemonSeen,C.gameStats.mythicalPokemonCaught))},"migrate")},VT={version:"1.0.4",migrate:c(C=>{if(!ve(C.starterData))for(const e of Ki)C.starterData[e]?.abilityAttr&&(C.starterData[e].abilityAttr|=rt.ABILITY_1),C.dexData[e]?.caughtAttr&&(C.dexData[e].caughtAttr|=F.FEMALE)},"migrate")},HT=[FT,UT,VT],YT={version:"1.0.4",migrate:c(C=>{C.hasOwnProperty("REROLL_TARGET")&&!C.hasOwnProperty(ks.Shop_Cursor_Target)&&(C[ks.Shop_Cursor_Target]=C.REROLL_TARGET,delete C.REROLL_TARGET,localStorage.setItem("settings",JSON.stringify(C)))},"migrate")},GT=[YT],WT={version:"1.0.4",migrate:c(C=>{for(const e of C.modifiers)if(e.className==="PokemonBaseStatModifier")e.className="BaseStatModifier";else if(e.className==="PokemonResetNegativeStatStageModifier")e.className="ResetNegativeStatStageModifier";else if(e.className==="TempBattleStatBoosterModifier")if(e.typeId!=="DIRE_HIT"){e.className="TempStatStageBoosterModifier",e.typeId="TEMP_STAT_STAGE_BOOSTER";const i=e.typePregenArgs[0]+1;e.typePregenArgs[0]=i,e.args=[i,5,Math.min(e.args[1],5)]}else e.className="TempCritBoosterModifier",e.typePregenArgs=[],e.args=[5,Math.min(e.args[1],5)];else if(e.className==="DoubleBattleChanceBoosterModifier"&&e.args.length===1){let t;switch(e.typeId){case"MAX_LURE":t=30;break;case"SUPER_LURE":t=15;break;default:t=10;break}e.args=[t,Math.min(e.args[0],t)]}for(const e of C.enemyModifiers)e.className==="PokemonBaseStatModifier"?e.className="BaseStatModifier":e.className==="PokemonResetNegativeStatStageModifier"&&(e.className="ResetNegativeStatStageModifier")},"migrate")},KT={version:"1.0.4",migrate:c(C=>{for(const e of C.party)e.mysteryEncounterPokemonData&&(e.customPokemonData=new ir(e.mysteryEncounterPokemonData),e.mysteryEncounterPokemonData=null),e.fusionMysteryEncounterPokemonData&&(e.fusionCustomPokemonData=new ir(e.fusionMysteryEncounterPokemonData),e.fusionMysteryEncounterPokemonData=null),e.customPokemonData=e.customPokemonData??new ir,!ve(e.natureOverride)&&e.natureOverride>=0&&(e.customPokemonData.nature=e.natureOverride,e.natureOverride=-1)},"migrate")},zT=[WT,KT],jT={version:"1.7.0",migrate:c(C=>{C.starterData&&C.dexData&&Object.keys(C.starterData).forEach(e=>{const t=C.dexData[e]?.caughtAttr,i=Number(e);if(!i)return;const n=ns(i);t&&n.forms?.length>1&&n.forms.filter((r,o)=>r.isStarterSelectable&&t&s.gameData.getFormAttr(o)).length===0&&(C.dexData[e].caughtAttr+=F.DEFAULT_FORM)})},"migrate")},$T=[jT],XT={version:"1.7.0",migrate:c(C=>{for(let e=0;e<C.modifiers.length;)C.modifiers[e].className==="TerastallizeModifier"?(C.party.forEach(t=>{t.id===C.modifiers[e].args[0]&&(t.teraType=C.modifiers[e].args[1])}),C.modifiers.splice(e,1)):e++;for(let e=0;e<C.enemyModifiers.length;)C.enemyModifiers[e].className==="TerastallizeModifier"?(C.enemyParty.forEach(t=>{t.id===C.enemyModifiers[e].args[0]&&(t.teraType=C.enemyModifiers[e].args[1])}),C.enemyModifiers.splice(e,1)):e++;C.party.forEach(e=>{ve(e.teraType)&&(e.teraType=$t(e.species,e.formIndex).type1)}),C.enemyParty.forEach(e=>{ve(e.teraType)&&(e.teraType=$t(e.species,e.formIndex).type1)})},"migrate")},qT=[XT],QT={version:"1.8.3",migrate:c(C=>{if(C.starterData&&C.dexData){const t=C.dexData[172]?.caughtAttr,i=ns(172);i.speciesId===pe.PICHU&&t&&(C.dexData[172].caughtAttr&=i.getFullUnlocksData(),C.dexData[172].caughtAttr|=F.DEFAULT_FORM)}},"migrate")},ZT=[QT],JT={version:"1.9.0",migrate:c(C=>{const e=c(t=>(t.moveset=(t.moveset??[new ps(Ot.TACKLE),new ps(Ot.GROWL)]).filter(i=>!!i).map(i=>ps.loadMove(i)),t.summonData.moveset&&=t.summonData.moveset.filter(i=>!!i).map(i=>ps.loadMove(i)),t.customPokemonData&&"hitsRecCount"in t.customPokemonData&&typeof t.customPokemonData.hitsRecCount=="number"&&(t.battleData.hitCount=t.customPokemonData.hitsRecCount,t.customPokemonData.hitsRecCount=null),t),"mapParty");C.party=C.party.map(e),C.enemyParty=C.enemyParty.map(e)},"migrate")},eS=[JT],tS={version:"1.10.0",migrate:c(C=>{const e=c(t=>({move:t.move,targets:t.targets,result:t.result,turn:t.turn,useMode:t.virtual?ti.FOLLOW_UP:t.ignorePP?ti.IGNORE_PP:ti.NORMAL}),"mapTurnMove");C.party.forEach(t=>{t.summonData.moveHistory=t.summonData.moveHistory.map(e),t.summonData.moveQueue=t.summonData.moveQueue.map(e)}),C.enemyParty.forEach(t=>{t.summonData.moveHistory=t.summonData.moveHistory.map(e),t.summonData.moveQueue=t.summonData.moveQueue.map(e)})},"migrate")},sS=[tS],Eh=iT,_n=[];_n.push(...HT);_n.push(...$T);_n.push(...ZT);const Li=[];Li.push(...zT);Li.push(...qT);Li.push(...eS);Li.push(...sS);const bh=[];bh.push(...GT);const Ih=c(C=>{C.sort((e,t)=>vn(e.version,t.version))},"sortMigrators");Ih(_n);Ih(Li);Ih(bh);const vh=c((C,e,t)=>{for(const i of C)vn(t,i.version)===-1&&i.migrate(e)},"applyMigrators");function iS(C){const e=C.gameVersion;vn(e,Eh)===-1&&vh(_n,C,e)}c(iS,"applySystemVersionMigration");function nS(C){const e=C.gameVersion;vn(e,Eh)===-1&&(C.money=Math.floor(C.money),vh(Li,C,e))}c(nS,"applySessionVersionMigration");function aS(C){const e=C.hasOwnProperty("gameVersion")?C.gameVersion:"1.0.0";vn(e,Eh)===-1&&vh(bh,C,e)}c(aS,"applySettingsVersionMigration");const rS=25,Ju=class Ju extends Bt{maxRows=3;runSelectContainer;runsContainer;runs;runSelectCallback;scrollCursor=0;cursorObj;runContainerInitialY;constructor(){super(x.RUN_HISTORY)}setup(){const e=this.getUi();this.runSelectContainer=s.add.container(0,0),this.runSelectContainer.setVisible(!1),e.add(this.runSelectContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,-s.scaledCanvas.height,26720);t.setOrigin(0,0),this.runSelectContainer.add(t),this.runContainerInitialY=-s.scaledCanvas.height+8,this.runsContainer=s.add.container(8,this.runContainerInitialY),this.runSelectContainer.add(this.runsContainer),this.runs=[],s.loadImage("hall_of_fame_red","ui"),s.loadImage("hall_of_fame_blue","ui"),s.loadAtlas("rival_f","trainer"),s.loadAtlas("rival_m","trainer")}show(e){return super.show(e),this.getUi().bringToTop(this.runSelectContainer),this.runSelectContainer.setVisible(!0),this.populateRuns().then(()=>{this.setScrollCursor(0),this.setCursor(0),this.runs.length===0&&this.clearCursor()}),!0}processInput(e){const t=this.getUi();let i=!1;const n=!1;if([v.ACTION,v.CANCEL].includes(e)){if(e===v.ACTION){const a=this.cursor+this.scrollCursor;if(this.runs[a])s.ui.setOverlayMode(x.RUN_INFO,this.runs[a].entryData,Sh.RUN_HISTORY,!0);else return!1;return i=!0,i}this.runSelectCallback=null,i=!0,s.ui.revertMode()}else if(this.runs.length>0)switch(e){case v.UP:this.cursor?i=this.setCursor(this.cursor-1):this.scrollCursor?i=this.setScrollCursor(this.scrollCursor-1):this.runs.length>1&&(i=this.setCursor(Math.min(this.runs.length-1,this.maxRows-1)),i=this.setScrollCursor(Math.max(0,this.runs.length-this.maxRows))||i);break;case v.DOWN:this.cursor<Math.min(this.maxRows-1,this.runs.length-this.scrollCursor-1)?i=this.setCursor(this.cursor+1):this.scrollCursor<this.runs.length-this.maxRows?i=this.setScrollCursor(this.scrollCursor+1):this.runs.length>1&&(i=this.setCursor(0),i=this.setScrollCursor(0)||i);break}return i&&t.playSelect(),i||n}async populateRuns(){const e=await s.gameData.getRunHistoryData(),t=Object.keys(e);if(t.length===0){this.showEmpty();return}const i=t.map(Number);t.length>1&&i.sort((a,r)=>r-a);const n=t.length;for(let a=0;a<n;a++){const r=new El(e[i[a]],a);s.add.existing(r),this.runsContainer.add(r),this.runs.push(r)}this.cursorObj&&t.length>0&&this.runsContainer.bringToTop(this.cursorObj)}async showEmpty(){const e=ye(0,0,304,165);this.runsContainer.add(e);const t=e.getCenter(),i=P(0,0,m.t("saveSlotSelectUiHandler:empty"),A.WINDOW,{fontSize:"128px"});i.setPosition(t.x-18,t.y-15),this.runsContainer.add(i)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight_thick",void 0,296,46,6,6,6,6),this.cursorObj.setOrigin(0,0),this.runsContainer.add(this.cursorObj)),this.cursorObj.setPosition(4,4+(e+this.scrollCursor)*56),t}setScrollCursor(e){const t=e!==this.scrollCursor;return t&&(this.scrollCursor=e,this.setCursor(this.cursor),s.tweens.add({targets:this.runsContainer,y:this.runContainerInitialY-56*e,duration:ge(325),ease:"Sine.easeInOut"})),t}clear(){super.clear(),this.runSelectContainer.setVisible(!1),this.setScrollCursor(0),this.clearCursor(),this.runSelectCallback=null,this.clearRuns()}clearCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearRuns(){this.runs.splice(0,this.runs.length),this.runsContainer.removeAll(!0)}};c(Ju,"RunHistoryUiHandler");let Cl=Ju;const ed=class ed extends Phaser.GameObjects.Container{slotId;entryData;constructor(e,t){super(s,0,t*56),this.slotId=t,this.entryData=e,this.setup(this.entryData)}setup(e){const t=e.isVictory,i=s.gameData.parseSessionData(JSON.stringify(e.entry)),n=ye(0,0,304,52);if(this.add(n),t){const h=P(8,5,`${m.t("runHistory:victory")}`,A.WINDOW);this.add(h)}else{const h=s.gameData.gender??Be.UNSET,u=Be[h].toLowerCase();if(i.battleType===ue.WILD||i.battleType===ue.MYSTERY_ENCOUNTER&&!i.trainer){const p=s.add.container(8,5),f=P(0,0,`${m.t("runHistory:defeatedWild",{context:u})}`,A.WINDOW);p.add(f),i.enemyParty.forEach((d,y)=>{const g=s.add.container(65+y*25,-8);g.setScale(.75),d.boss=!1,d.player=!0;const T=d.toPokemon(),E=s.addPokemonIcon(T,0,0,0,0),b=P(32,20,`${m.t("saveSlotSelectUiHandler:lv")}${bi(T.level,1e3)}`,A.PARTY,{fontSize:"54px",color:"#f8f8f8"});b.setShadow(0,0,void 0),b.setStroke("#424242",14),b.setOrigin(1,0),g.add(E),g.add(b),p.add(g),T.destroy()}),this.add(p)}else if(i.battleType===ue.TRAINER||i.battleType===ue.MYSTERY_ENCOUNTER&&i.trainer){const p=i.trainer.toTrainer();if(i.trainer.trainerType>=375){const d=p.variant===tt.FEMALE?"trainerNames:rivalFemale":"trainerNames:rival",y=P(8,5,`${m.t("runHistory:defeatedRival",{context:u})} ${m.t(d)}`,A.WINDOW);this.add(y)}else{const d=P(8,5,`${m.t("runHistory:defeatedTrainer",{context:u})}${p.getName(0,!0)}`,A.WINDOW);this.add(d)}}}const a=P(8,19,"",A.WINDOW);let r="";switch(i.gameMode){case ce.DAILY:r=m.t("gameMode:dailyRun");break;case ce.SPLICED_ENDLESS:case ce.ENDLESS:r=m.t("gameMode:endless");break;case ce.CLASSIC:r=m.t("gameMode:classic");break;case ce.CHALLENGE:r=m.t("gameMode:challenge");break}if(a.appendText(r,!1),i.gameMode===ce.SPLICED_ENDLESS){const h=s.add.image(0,0,"icon_spliced");h.setScale(.75);const u=a.getTopRight();h.setPosition(u.x+5,27),this.add(h),a.appendText("    - ",!1)}else a.appendText(" - ",!1);a.appendText(m.t("saveSlotSelectUiHandler:wave")+" "+i.waveIndex,!1),this.add(a);const o=P(8,33,new Date(i.timestamp).toLocaleString(),A.WINDOW);this.add(o);const l=s.add.container(140,17);i.party.forEach((h,u)=>{const p=s.add.container(26*u,0);p.setScale(.75);const f=h.toPokemon(),d=s.addPokemonIcon(f,0,0,0,0),y=P(32,20,`${m.t("saveSlotSelectUiHandler:lv")}${bi(f.level,1e3)}`,A.PARTY,{fontSize:"54px",color:"#f8f8f8"});y.setShadow(0,0,void 0),y.setStroke("#424242",14),y.setOrigin(1,0),p.add(d),p.add(y),l.add(p),f.destroy()}),this.add(l)}};c(ed,"RunEntryContainer");let El=ed;function di(C,e=0){switch(C){case qe.SYSTEM:return"data";case qe.SESSION:{let t="sessionData";return e&&(t+=e),t}case qe.SETTINGS:return"settings";case qe.TUTORIALS:return"tutorials";case qe.SEEN_DIALOGUES:return"seenDialogues";case qe.RUN_HISTORY:return"runHistoryData"}}c(di,"getDataTypeKey");const Kn={seenAttr:"$sa",caughtAttr:"$ca",natureAttr:"$na",seenCount:"$s",caughtCount:"$c",hatchedCount:"$hc",ivs:"$i",moveset:"$m",eggMoves:"$em",candyCount:"$x",friendship:"$f",abilityAttr:"$a",passiveAttr:"$pa",valueReduction:"$vr",classicWinCount:"$wc"},td=class td{trainerId;secretId;gender;dexData;defaultDexData;starterData;gameStats;runHistory;unlocks;achvUnlocks;voucherUnlocks;voucherCounts;eggs;eggPity;unlockPity;eggProgress;constructor(){this.loadSettings(),this.loadGamepadSettings(),this.loadMappingConfigs(),this.trainerId=ms(65536),this.secretId=ms(65536),this.starterData={},this.gameStats=new Pa,this.runHistory={},this.unlocks={[It.ENDLESS_MODE]:!1,[It.MINI_BLACK_HOLE]:!1,[It.SPLICED_ENDLESS_MODE]:!1,[It.EVIOLITE]:!1},this.achvUnlocks={},this.voucherUnlocks={},this.voucherCounts={[At.REGULAR]:0,[At.PLUS]:0,[At.PREMIUM]:0,[At.GOLDEN]:0},this.eggs=[],this.eggPity=[0,0,0,0],this.unlockPity=[0,0,0,0],this.initDexData(),this.initStarterData()}getSystemSaveData(){return{trainerId:this.trainerId,secretId:this.secretId,gender:this.gender,dexData:this.dexData,starterData:this.starterData,starterAttributes:this.starterAttributes,gameStats:this.gameStats,unlocks:this.unlocks,achvUnlocks:this.achvUnlocks,voucherUnlocks:this.voucherUnlocks,voucherCounts:this.voucherCounts,eggs:this.eggs.map(e=>new ka(e)),gameVersion:s.game.config.gameVersion,timestamp:Date.now(),eggPity:this.eggPity.slice(0),unlockPity:this.unlockPity.slice(0),eggProgress:this.eggProgress}}isUnlocked(e){return le.ITEM_UNLOCK_OVERRIDE.includes(e)?!0:this.unlocks[e]}saveSystem(){return new Promise(e=>{s.ui.savingIcon.show();const t=this.getSystemSaveData(),i=2147483648,n=JSON.stringify(t,(a,r)=>typeof r=="bigint"?r<=i?Number(r):r.toString():r);localStorage.setItem(`data_${ke?.username}`,Ls(n)),nt.savedata.system.update({clientSessionId:zt},n).then(a=>{if(s.ui.savingIcon.hide(),a)return a.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(a),e(!1);e(!0)})})}loadSystem(){return new Promise(e=>{nt.savedata.system.get({clientSessionId:zt}).then(t=>{if(typeof t=="number"||!t||t.length===0||t[0]!=="{")return t===404?(s.phaseManager.queueMessage("Save data could not be found. If this is a new account, you can safely ignore this message.",null,!0),e(!0)):(typeof t=="string"&&t?.includes("Too many connections")&&s.phaseManager.queueMessage("Too many people are trying to connect and the server is overloaded. Please try again later.",null,!0),e(!1));const i=localStorage.getItem(`data_${ke?.username}`);this.initSystem(t,i?Vi.AES.decrypt(i,nr).toString(Vi.enc.Utf8):void 0).then(e)})})}initSystem(e,t){const{promise:i,resolve:n}=Promise.withResolvers();try{let a=this.parseSystemData(e);if(t){const l=this.parseSystemData(t);l.timestamp>a.timestamp?(console.debug("Use cached system"),a=l,e=t):this.clearLocalData()}console.debug(a),localStorage.setItem(`data_${ke?.username}`,Ls(e,ra));const r=`runHistoryData_${ke?.username}`;if(localStorage.getItem(r)||localStorage.setItem(r,""),iS(a),this.trainerId=a.trainerId,this.secretId=a.secretId,this.gender=a.gender,this.saveSetting(ks.Player_Gender,a.gender===Be.FEMALE?1:0),a.starterData)this.starterData=a.starterData;else{if(this.initStarterData(),a.starterMoveData){const h=a.starterMoveData;for(const u of Object.keys(h))this.starterData[u].moveset=h[u]}if(a.starterEggMoveData){const h=a.starterEggMoveData;for(const u of Object.keys(h))this.starterData[u].eggMoves=h[u]}this.migrateStarterAbilities(a,this.starterData);const l=Object.keys(this.starterData).map(h=>Number.parseInt(h));if(a.starterAttributes)for(const h of Object.keys(a.starterAttributes)){const u=a.starterAttributes[h];this.starterData[h]&&(this.starterData[h]={...this.starterData[h],attributes:{...this.starterData[h].attributes,...u}})}for(const h of l)this.starterData[h].candyCount+=a.dexData[h].caughtCount,this.starterData[h].candyCount+=a.dexData[h].hatchedCount*2,a.dexData[h].caughtAttr&F.SHINY&&(this.starterData[h].candyCount+=4)}if(a.gameStats&&(this.gameStats=a.gameStats),a.unlocks)for(const l of Object.keys(a.unlocks))this.unlocks.hasOwnProperty(l)&&(this.unlocks[l]=a.unlocks[l]);if(a.achvUnlocks)for(const l of Object.keys(a.achvUnlocks))Pe.hasOwnProperty(l)&&(this.achvUnlocks[l]=a.achvUnlocks[l]);if(a.voucherUnlocks)for(const l of Object.keys(a.voucherUnlocks))Ft.hasOwnProperty(l)&&(this.voucherUnlocks[l]=a.voucherUnlocks[l]);a.voucherCounts&&Ym(At).forEach(l=>{const h=At[l];this.voucherCounts[h]=a.voucherCounts[h]||0}),this.eggs=a.eggs?a.eggs.map(l=>l.toEgg()):[],this.eggPity=a.eggPity?a.eggPity.slice(0):[0,0,0,0],this.unlockPity=a.unlockPity?a.unlockPity.slice(0):[0,0,0,0],this.eggProgress=a.eggProgress??{},this.dexData=Object.assign(this.dexData,a.dexData),this.consolidateDexData(this.dexData),this.defaultDexData=null,n(!0)}catch(a){console.error(a),n(!1)}return i}async getRunHistoryData(){if(!Ci){const i=`runHistoryData_${ke?.username}`,n=localStorage.getItem(i);if(n){const a=n;return a?JSON.parse(hi(a)):{}}return localStorage.setItem(`runHistoryData_${ke?.username}`,""),{}}const e=`runHistoryData_${ke?.username}`,t=localStorage.getItem(e);if(t){const i=t;return i?JSON.parse(hi(i)):{}}return localStorage.setItem(`runHistoryData_${ke?.username}`,""),{}}async saveRunHistory(e,t){const i=await this.getRunHistoryData();let n=Object.keys(i).map(Number);for(;n.length>=rS;){const r=Math.min.apply(Math,n).toString();delete i[r],n=Object.keys(i).map(Number)}const a=e.timestamp.toString();return i[a]={entry:e,isVictory:t,isFavorite:!1},localStorage.setItem(`runHistoryData_${ke?.username}`,Ls(JSON.stringify(i))),!0}parseSystemData(e){return JSON.parse(e,(t,i)=>{if(t==="gameStats")return new Pa(i);if(t==="eggs"){const n=[];i===null&&(i=[]);for(const a of i)n.push(new ka(a));return n}return t==="ribbons"?Gs.fromJSON(i):t==="eggProgress"?i??{}:t.endsWith("Attr")&&!["natureAttr","abilityAttr","passiveAttr"].includes(t)?BigInt(i??0):i})}convertSystemDataStr(e,t=!1){t||(e=e.replace(/\$pAttr/g,"$pa")),e=e.replace(/"trainerId":\d+/g,`"trainerId":${this.trainerId}`),e=e.replace(/"secretId":\d+/g,`"secretId":${this.secretId}`);const i=t?Object.keys(Kn):Object.values(Kn),n=t?Object.values(Kn):Object.keys(Kn);for(const a in i)e=e.replace(new RegExp(`${i[a].replace("$","\\$")}`,"g"),n[a]);return e}async verify(){const e=await nt.savedata.system.verify({clientSessionId:zt});return e?(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase",JSON.stringify(e)),this.clearLocalData(),!1):!0}clearLocalData(){localStorage.removeItem(`data_${ke?.username}`);for(let e=0;e<5;e++)localStorage.removeItem(`sessionData${e||""}_${ke?.username}`)}saveSetting(e,t){let i={};return localStorage.hasOwnProperty("settings")&&(i=JSON.parse(localStorage.getItem("settings"))),cp(e,t),i[e]=t,i.gameVersion=s.game.config.gameVersion,localStorage.setItem("settings",JSON.stringify(i)),!0}saveMappingConfigs(e,t){const i=e.toLowerCase();let n={};return localStorage.hasOwnProperty("mappingConfigs")&&(n=JSON.parse(localStorage.getItem("mappingConfigs"))),n[i]||(n[i]={}),n[i].custom=t.custom,localStorage.setItem("mappingConfigs",JSON.stringify(n)),!0}loadMappingConfigs(){if(!localStorage.hasOwnProperty("mappingConfigs"))return!1;const e=JSON.parse(localStorage.getItem("mappingConfigs"));for(const t of Object.keys(e))s.inputController.injectConfig(t,e[t]);return!0}resetMappingToFactory(){return localStorage.hasOwnProperty("mappingConfigs")?(localStorage.removeItem("mappingConfigs"),s.inputController.resetConfigs(),!0):!1}saveControlSetting(e,t,i,n,a){let r={};return localStorage.hasOwnProperty(t)&&(r=JSON.parse(localStorage.getItem(t))),e===Me.GAMEPAD?qn(i,a):e===Me.KEYBOARD&&kf(i,a),Object.keys(n).forEach(o=>{o===i&&(r[o]=a)}),localStorage.setItem(t,JSON.stringify(r)),!0}loadSettings(){if(Gm(),!localStorage.hasOwnProperty("settings"))return!1;const e=JSON.parse(localStorage.getItem("settings"));aS(e);for(const t of Object.keys(e))cp(t,e[t]);return!0}loadGamepadSettings(){if(Object.values(G).forEach(t=>{qn(t,Lf[t])}),!localStorage.hasOwnProperty("settingsGamepad"))return;const e=JSON.parse(localStorage.getItem("settingsGamepad"));for(const t of Object.keys(e))qn(t,e[t])}saveTutorialFlag(e,t){const i=di(qe.TUTORIALS),n=localStorage.hasOwnProperty(i)?JSON.parse(localStorage.getItem(i)):{};for(const a of Object.values(ws))a===e?n[a]=t:n[a]??=!1;localStorage.setItem(i,JSON.stringify(n))}getTutorialFlags(){const e=di(qe.TUTORIALS),t=Object.values(ws).reduce((n,a)=>(n[ws[a]]=!1,n),{});if(!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}saveSeenDialogue(e){const t=di(qe.SEEN_DIALOGUES),i=this.getSeenDialogues();return i[e]=!0,localStorage.setItem(t,JSON.stringify(i)),!0}getSeenDialogues(){const e=di(qe.SEEN_DIALOGUES),t={};if(!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}getSessionSaveData(){return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(e=>new qi(e)),enemyParty:s.getEnemyParty().map(e=>new qi(e)),modifiers:s.findModifiers(()=>!0).map(e=>new si(e,!0)),enemyModifiers:s.findModifiers(()=>!0,!1).map(e=>new si(e,!1)),arena:new pn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.battleType===ue.TRAINER?new gn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:Date.now(),challenges:s.gameMode.challenges.map(e=>new fn(e)),mysteryEncounterType:s.currentBattle.mysteryEncounter?.encounterType??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}getSession(e){return new Promise(async(t,i)=>{if(e<0)return t(null);const n=c(async a=>{try{const r=this.parseSessionData(a);t(r)}catch(r){i(r);return}},"handleSessionData");if(!localStorage.getItem(`sessionData${e||""}_${ke?.username}`))nt.savedata.session.get({slot:e,clientSessionId:zt}).then(async a=>{if(!a||a?.length===0||a?.[0]!=="{")return console.error(a),t(null);localStorage.setItem(`sessionData${e||""}_${ke?.username}`,Ls(a)),await n(a)});else{const a=localStorage.getItem(`sessionData${e||""}_${ke?.username}`);if(a)await n(hi(a));else return t(null)}})}async renameSession(e,t){if(e<0)return!1;if(t==="")return!0;const i=await this.getSession(e);if(!i)return!1;i.name=t,i.timestamp+=1;const n=JSON.stringify(i),a=Ls(n),r=this.secretId,o=this.trainerId;if(await nt.savedata.session.update({slot:e,trainerId:o,secretId:r,clientSessionId:zt},n))return!1;localStorage.setItem(`sessionData${e||""}_${ke?.username}`,a);const h=await ts();return!(h!==null&&!h)}loadSession(e,t){return new Promise(async(i,n)=>{try{const a=c(async r=>{console.debug(r),s.gameMode=oa(r.gameMode||ce.CLASSIC),r.challenges&&(s.gameMode.challenges=r.challenges.map(d=>d.toChallenge())),s.setSeed(r.seed||s.game.config.seed[0]),s.resetSeed(),s.seed,s.sessionPlayTime=r.playTime||0,s.lastSavePlayTime=0;const o=[],l=s.getPlayerParty();l.splice(0,l.length);for(const d of r.party){const y=d.toPokemon();y.setVisible(!1),o.push(y.loadAssets(!1)),l.push(y)}Object.keys(s.pokeballCounts).forEach(d=>{s.pokeballCounts[d]=r.pokeballCounts[d]||0}),le.POKEBALL_OVERRIDE.active&&(s.pokeballCounts=le.POKEBALL_OVERRIDE.pokeballs),s.money=Math.floor(r.money||0),s.updateMoneyText(),s.money>this.gameStats.highestMoney&&(this.gameStats.highestMoney=s.money),s.score=r.score,s.updateScoreText(),s.mysteryEncounterSaveData=new Pi(r.mysteryEncounterSaveData),s.newArena(r.arena.biome,r.playerFaints);const h=r.battleType||0,u=r.trainer?Ei[r.trainer.trainerType]:null,p=r.mysteryEncounterType!==-1?r.mysteryEncounterType:void 0,f=s.newBattle(r.waveIndex,h,r.trainer,h===ue.TRAINER?u?.doubleOnly||r.trainer?.variant===tt.DOUBLE:r.enemyParty.length>1,p);if(f.enemyLevels=r.enemyParty.map(d=>d.level),s.arena.init(),r.enemyParty.forEach((d,y)=>{const g=d.toPokemon(h,y,r.trainer?.variant===tt.DOUBLE);f.enemyParty[y]=g,h===ue.WILD&&f.seenEnemyPartyMemberIds.add(g.id),o.push(g.loadAssets())}),s.arena.weather=r.arena.weather,s.arena.eventTarget.dispatchEvent(new zi(es.NONE,s.arena.weather?.weatherType,s.arena.weather?.turnsLeft)),s.arena.terrain=r.arena.terrain,s.arena.eventTarget.dispatchEvent(new wf(us.NONE,s.arena.terrain?.terrainType,s.arena.terrain?.turnsLeft)),s.arena.playerTerasUsed=r.arena.playerTerasUsed,s.arena.tags=r.arena.tags,s.arena.tags)for(const d of s.arena.tags)if(d instanceof rh){const{tagType:y,side:g,turnCount:T,layers:E,maxLayers:b}=d;s.arena.eventTarget.dispatchEvent(new xr(y,g,T,E,b))}else s.arena.eventTarget.dispatchEvent(new xr(d.tagType,d.side,d.turnCount));s.arena.positionalTagManager.tags=r.arena.positionalTags.map(d=>Wm(d)),s.modifiers.length&&(console.warn("Existing modifiers not cleared on session load, deleting..."),s.modifiers=[]);for(const d of r.modifiers){const y=d.toModifier(ta[d.className]);y&&s.addModifier(y,!0)}s.updateModifiers(!0);for(const d of r.enemyModifiers){const y=d.toModifier(ta[d.className]);y&&s.addEnemyModifier(y,!0)}s.updateModifiers(!1),Promise.all(o).then(()=>i(!0))},"initSessionFromData");t?a(t):this.getSession(e).then(r=>r&&a(r)).catch(r=>{n(r)})}catch(a){n(a);return}})}deleteSession(e){return new Promise(t=>{ts().then(i=>{if(i!==null&&!i)return t(!1);nt.savedata.session.delete({slot:e,clientSessionId:zt}).then(n=>{n?(n.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(n),t(!1)):(ke&&(ke.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${ke?.username}`),t(!0))})})})}offlineNewClear(){return new Promise(e=>{const t=this.getSessionSaveData(),i=t.seed;let n=[];return t.gameMode===ce.DAILY?localStorage.hasOwnProperty("daily")?(n=JSON.parse(atob(localStorage.getItem("daily"))),n.includes(i)?e(!1):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0))):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0)):e(!0)})}async tryClearSession(e){let t=[!1,!1];{const i=this.getSessionSaveData(),{trainerId:n}=this,a=await nt.savedata.session.clear({slot:e,trainerId:n,clientSessionId:zt},i);a?.error?(a?.error?.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(a),t=[!1,!1]):(t=[!0,a?.success??!1],ke&&(ke.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${ke?.username}`))}return await ts(),t}parseSessionData(e){const t=JSON.parse(e,(i,n)=>{switch(i){case"party":case"enemyParty":{const a=[];for(const r of n??[])a.push(new qi(r));return a}case"trainer":return n?new gn(n):null;case"modifiers":case"enemyModifiers":{const a=[];for(const r of n??[])r?.className==="ExpBalanceModifier"&&(r.stackCount=Math.min(r.stackCount,4)),!(r instanceof hf&&(r.effect===Yt.FREEZE||r.effect===Yt.SLEEP))&&a.push(new si(r,i==="modifiers"));return a}case"arena":return new pn(n);case"challenges":{const a=[];for(const r of n??[])a.push(new fn(r));return a}case"mysteryEncounterType":return n;case"starterPassiveAbilities":return n;case"mysteryEncounterSaveData":return new Pi(n);default:return n}});return nS(t),t.starterPassiveAbilities&&(s.runData||(s.runData={}),s.runData.starterPassiveAbilities=t.starterPassiveAbilities),t}saveAll(e=!1,t=!1,i=!1,n=!1){return new Promise(a=>{dh(!e,ts).then(r=>{if(r!==null&&!r)return a(!1);t&&s.ui.savingIcon.show();const o=i?this.parseSessionData(hi(localStorage.getItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${ke?.username}`))):this.getSessionSaveData(),l=2147483648,h=n?this.parseSystemData(hi(localStorage.getItem(`data_${ke?.username}`))):this.getSystemSaveData(),u={system:h,session:o,sessionSlotId:s.sessionSlotId,clientSessionId:zt};localStorage.setItem(`data_${ke?.username}`,Ls(JSON.stringify(h,(p,f)=>typeof f=="bigint"?f<=l?Number(f):f.toString():f))),localStorage.setItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${ke?.username}`,Ls(JSON.stringify(o))),console.debug("Session data saved!"),t?nt.savedata.updateAll(u).then(p=>{if(t&&(s.lastSavePlayTime=0,s.ui.savingIcon.hide()),p)return p.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(p),a(!1);a(!0)}):this.verify().then(p=>{s.ui.savingIcon.hide(),a(p)})})})}tryExportData(e,t=0){return new Promise(i=>{const n=`${di(e,t)}_${ke?.username}`,a=c(r=>{switch(e){case qe.SYSTEM:r=this.convertSystemDataStr(r,!0);break}const o=Vi.AES.encrypt(r,nr),l=new Blob([o.toString()],{type:"text/json"}),h=document.createElement("a");h.href=window.URL.createObjectURL(l),h.download=`${n}.prsv`,h.click(),h.remove()},"handleData");if(e<qe.SETTINGS){let r=Promise.resolve(null);e===qe.SYSTEM?r=nt.savedata.system.get({clientSessionId:zt}):e===qe.SESSION&&(r=nt.savedata.session.get({slot:t,clientSessionId:zt})),r.then(o=>{if(typeof o=="number"||!o?.length||o[0]!=="{"){console.error(o),i(!1);return}a(o),i(!0)})}else{const r=localStorage.getItem(n);r&&a(hi(r)),i(!!r)}})}importData(e,t=0){const i=`${di(e,t)}_${ke?.username}`;let n=document.getElementById("saveFile");n&&n.remove(),n=document.createElement("input"),n.id="saveFile",n.type="file",n.accept=".prsv",n.style.display="none",n.addEventListener("change",a=>{const r=new FileReader;r.onload=(o=>l=>{let h=qe[e].toLowerCase(),u=Vi.AES.decrypt(l.target?.result?.toString(),nr).toString(Vi.enc.Utf8),p=!1;try{switch(e){case qe.SYSTEM:{u=this.convertSystemDataStr(u);const d=this.parseSystemData(u);p=!!d.dexData&&!!d.timestamp;break}case qe.SESSION:{const d=this.parseSessionData(u);p=!!d.party&&!!d.enemyParty&&!!d.timestamp;break}case qe.RUN_HISTORY:{const d=JSON.parse(u),y=Object.keys(d);h=m.t("menuUiHandler:RUN_HISTORY").toLowerCase(),y.forEach(g=>{const T=Object.keys(d[g]);p=["isFavorite","isVictory","entry"].every(E=>T.includes(E))&&T.length===3});break}case qe.SETTINGS:case qe.TUTORIALS:p=!0;break}}catch(d){console.error(d)}const f=c(d=>s.ui.showText(d,null,()=>s.ui.showText("",0),ge(1500)),"displayError");if(!p)return s.ui.showText(`Your ${h} data could not be loaded. It may be corrupted.`,null,()=>s.ui.showText("",0),ge(1500));s.ui.showText(`Your ${h} data will be overridden and the page will reload. Proceed?`,null,()=>{s.ui.setOverlayMode(x.CONFIRM,()=>{localStorage.setItem(i,Ls(u)),e<qe.SETTINGS?ts().then(d=>{if(!d[0])return f(`Could not contact the server. Your ${h} data could not be imported.`);const{trainerId:y,secretId:g}=this;let T;e===qe.SESSION?T=nt.savedata.session.update({slot:t,trainerId:y,secretId:g,clientSessionId:zt},u):T=nt.savedata.system.update({trainerId:y,secretId:g,clientSessionId:zt},u),T.then(E=>{if(E)return console.error(E),f(`An error occurred while updating ${h} data. Please contact the administrator.`);window.location.reload()})}):window.location.reload()},()=>{s.ui.revertMode(),s.ui.showText("",0)},!1,-98)})})(a.target.files[0]),r.readAsText(a.target.files[0])}),n.click()}initDexData(){const e={};for(const n of it)e[n.speciesId]={seenAttr:0n,caughtAttr:0n,natureAttr:0,seenCount:0,caughtCount:0,hatchedCount:0,ivs:[0,0,0,0,0,0],ribbons:new Gs(0)};const t=F.NON_SHINY|F.MALE|F.FEMALE|F.DEFAULT_VARIANT|F.DEFAULT_FORM,i=[];s.executeWithSeedOffset(()=>{const n=[_t.HARDY,_t.DOCILE,_t.SERIOUS,_t.BASHFUL,_t.QUIRKY];for(let a=0;a<Ki.length;a++)i.push(In(n))},0,"default");for(let n=0;n<Ki.length;n++){const a=e[Ki[n]];a.seenAttr=t,a.caughtAttr=t,a.natureAttr=1<<i[n]+1;for(const r in a.ivs)a.ivs[r]=15}this.defaultDexData={...e},this.dexData=e}initStarterData(){const e={},t=Object.keys(ze).map(i=>Number.parseInt(i));for(const i of t)e[i]={moveset:null,eggMoves:0,candyCount:0,friendship:0,abilityAttr:Ki.includes(i)?rt.ABILITY_1:0,passiveAttr:0,valueReduction:0,classicWinCount:0,attributes:{nature:0,ability:0,variant:0,form:0,female:!1,shiny:!1,favorite:!1,nickname:"",tera:void 0}};this.starterData=e}setPokemonSeen(e,t=!0,i=!1){if(s.currentBattle?.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter?.preventGameStatsUpdates)return;const n=this.dexData[e.species.speciesId];n.seenAttr|=e.getDexAttr(),t&&(n.seenCount++,this.gameStats.pokemonSeen++,!i&&e.species.subLegendary?this.gameStats.subLegendaryPokemonSeen++:!i&&e.species.legendary?this.gameStats.legendaryPokemonSeen++:!i&&e.species.mythical&&this.gameStats.mythicalPokemonSeen++,!i&&e.isShiny()&&this.gameStats.shinyPokemonSeen++)}setPokemonCaught(e,t=!0,i=!1,n=!0){const a=e.species.getRootSpeciesId();return!t&&!s.gameData.dexData[a].caughtAttr?Promise.resolve(!1):this.setPokemonSpeciesCaught(e,e.species,t,i,n)}setPokemonSpeciesCaught(e,t,i=!0,n=!1,a=!0){return new Promise(r=>{const o=this.dexData[t.speciesId],l=o.caughtAttr,h=e.formIndex,u=e.getDexAttr()&t.getFullUnlocksData();o.caughtAttr|=u;const p=e.getFormKey();if(h>0&&(e.species.speciesId===pe.PIKACHU&&t.speciesId===pe.PICHU&&(o.caughtAttr|=s.gameData.getFormAttr(0)),e.species.speciesId===pe.URSHIFU?h===2?o.caughtAttr|=s.gameData.getFormAttr(0):h===3&&(o.caughtAttr|=s.gameData.getFormAttr(1)):e.species.speciesId===pe.ZYGARDE?h===4?o.caughtAttr|=s.gameData.getFormAttr(2):h===5&&(o.caughtAttr|=s.gameData.getFormAttr(3)):(ai.hasOwnProperty(t.speciesId)?ai[t.speciesId]:[]).filter(b=>b.formKey===p).length>0&&(o.caughtAttr|=s.gameData.getFormAttr(0))),ze.hasOwnProperty(t.speciesId)){const T=this.starterData[t.speciesId];T.abilityAttr|=e.abilityIndex!==1||e.species.ability2?1<<e.abilityIndex:rt.ABILITY_HIDDEN,T.attributes={...T.attributes,nature:e.nature,ability:e.abilityIndex,variant:e.variant??0,form:e.formIndex,female:e.female,shiny:e.isShiny()}}o.natureAttr|=1<<e.nature+1;const f=wt.hasOwnProperty(t.speciesId),d=!l,y=(l&u)!==u;i&&(n?(o.hatchedCount++,this.gameStats.pokemonHatched++,e.species.subLegendary?this.gameStats.subLegendaryPokemonHatched++:e.species.legendary?this.gameStats.legendaryPokemonHatched++:e.species.mythical&&this.gameStats.mythicalPokemonHatched++,e.isShiny()&&this.gameStats.shinyPokemonHatched++):(o.caughtCount++,this.gameStats.pokemonCaught++,e.species.subLegendary?this.gameStats.subLegendaryPokemonCaught++:e.species.legendary?this.gameStats.legendaryPokemonCaught++:e.species.mythical&&this.gameStats.mythicalPokemonCaught++,e.isShiny()&&this.gameStats.shinyPokemonCaught++),!f&&(!s.gameMode.isDaily||y||n)&&this.addStarterCandy(t,1*(e.isShiny()?5*(1<<(e.variant??0)):1)*(n||e.isBoss()?2:1)));const g=c(T=>{if(f){const E=wt[t.speciesId];this.setPokemonSpeciesCaught(e,ns(E),i,n,a).then(b=>r(b))}else r(T)},"checkPrevolution");if(d&&ze.hasOwnProperty(t.speciesId)){if(!a){r(!0);return}s.playSound("level_up_fanfare"),s.ui.showText(m.t("battle:addedAsAStarter",{pokemonName:t.name}),null,()=>g(!0),null,!0)}else g(!1)})}incrementRibbonCount(e,t=!1){const i=e.getRootSpeciesId(t);this.starterData[i].classicWinCount||(this.starterData[i].classicWinCount=0),this.starterData[i].classicWinCount||s.gameData.gameStats.ribbonsOwned++;const n=s.gameData.gameStats.ribbonsOwned;return n>=100&&s.validateAchv(Pe._100_RIBBONS),n>=75&&s.validateAchv(Pe._75_RIBBONS),n>=50&&s.validateAchv(Pe._50_RIBBONS),n>=25&&s.validateAchv(Pe._25_RIBBONS),n>=10&&s.validateAchv(Pe._10_RIBBONS),++this.starterData[i].classicWinCount}addStarterCandy(e,t){const i=e.getRootSpeciesId();s.gameData.dexData[i].caughtAttr&&(s.candyBar.showStarterSpeciesCandy(e.speciesId,t),this.starterData[e.speciesId].candyCount+=t)}setEggMoveUnlocked(e,t,i=!0,n=!1){return new Promise(a=>{const r=e.speciesId;if(!Lt.hasOwnProperty(r)||!Lt[r][t]){a(!1);return}this.starterData[r].eggMoves||(this.starterData[r].eggMoves=0);const o=1<<t;if(this.starterData[r].eggMoves&o){a(!1);return}if(this.starterData[r].eggMoves|=o,!i){a(!0);return}s.playSound("level_up_fanfare");const l=Fe[Lt[r][t]].name;let h=n?e.getName()+" ":"";h+=t===3?m.t("egg:rareEggMoveUnlock",{moveName:l}):m.t("egg:eggMoveUnlock",{moveName:l}),s.ui.showText(h,null,()=>a(!0),null,!0)})}isRootSpeciesUnlocked(e){return!!this.dexData[e.getRootSpeciesId()]?.caughtAttr}unlockSpeciesNature(e,t){if(!this.isRootSpeciesUnlocked(e))return;const i=c(n=>{this.dexData[n].natureAttr|=1<<t+1,wt.hasOwnProperty(n)&&i(wt[n])},"_unlockSpeciesNature");i(e.speciesId)}updateSpeciesDexIvs(e,t){let i;do{i=s.gameData.dexData[e];const n=i.ivs;for(let a=0;a<n.length;a++)n[a]<t[a]&&(n[a]=t[a]);n.filter(a=>a===31).length===6&&s.validateAchv(Pe.PERFECT_IVS)}while(wt.hasOwnProperty(e)&&(e=wt[e]))}getSpeciesCount(e){const t=Object.keys(this.dexData);let i=0;for(const n of t)e(this.dexData[n])&&i++;return i}getStarterCount(e){const t=Object.keys(ze);let i=0;for(const n of t){const a=this.dexData[n];e(a)&&i++}return i}getSpeciesDefaultDexAttr(e,t=!1,i=!1){let n=0n;const r=this.dexData[e.speciesId].caughtAttr;return i?r&F.SHINY?(n|=F.SHINY,r&F.VARIANT_3?n|=F.VARIANT_3:r&F.VARIANT_2?n|=F.VARIANT_2:n|=F.DEFAULT_VARIANT):(n|=F.NON_SHINY,n|=F.DEFAULT_VARIANT):(n|=r&F.NON_SHINY||!(r&F.SHINY)?F.NON_SHINY:F.SHINY,r&F.DEFAULT_VARIANT?n|=F.DEFAULT_VARIANT:r&F.VARIANT_2?n|=F.VARIANT_2:r&F.VARIANT_3?n|=F.VARIANT_3:n|=F.DEFAULT_VARIANT),n|=r&F.MALE||!(r&F.FEMALE)?F.MALE:F.FEMALE,n|=this.getFormAttr(this.getFormIndex(r)),n}getSpeciesDexAttrProps(e,t){const i=!(t&F.NON_SHINY),n=!(t&F.MALE);let a=0;t&F.DEFAULT_VARIANT?a=0:t&F.VARIANT_2?a=1:t&F.VARIANT_3&&(a=2);const r=this.getFormIndex(t);return{shiny:i,female:n,variant:a,formIndex:r}}getStarterSpeciesDefaultAbilityIndex(e,t){return t??=this.starterData[e.speciesId].abilityAttr,t&rt.ABILITY_1?0:!e.ability2||t&rt.ABILITY_2?1:2}getSpeciesDefaultNature(e,t){t??=this.dexData[e.speciesId];for(let i=0;i<25;i++)if(t.natureAttr&1<<i+1)return i;return 0}getSpeciesDefaultNatureAttr(e){return 1<<this.getSpeciesDefaultNature(e)}getDexAttrLuck(e){return e&F.SHINY?e&F.VARIANT_3?3:e&F.VARIANT_2?2:1:0}getNaturesForAttr(e=0){const t=[];for(let i=0;i<25;i++)e&1<<i+1&&t.push(i);return t}getSpeciesStarterValue(e){let i=ze[e];const n=c(r=>(r>1?r--:r/=2,r),"decrementValue");for(let r=0;r<this.starterData[e].valueReduction;r++)i=n(i);const a=new Pt(i);return fs(gs.STARTER_COST,e,a),a.value}getFormIndex(e){if(!e||e<F.DEFAULT_FORM)return 0;let t=0;for(;!(e&this.getFormAttr(t));)t++;return t}getFormAttr(e){return BigInt(1)<<BigInt(7+e)}consolidateDexData(e){for(const t of Object.keys(e)){const i=e[t];i.hasOwnProperty("hatchedCount")||(i.hatchedCount=0),(!i.hasOwnProperty("natureAttr")||i.caughtAttr&&!i.natureAttr)&&(i.natureAttr=this.defaultDexData?.[t].natureAttr||1<<ms(25,1)),i.hasOwnProperty("ribbons")||(i.ribbons=new Gs(0))}}migrateStarterAbilities(e,t){const i=Object.keys(this.starterData).map(r=>Number.parseInt(r)),n=t||e.starterData,a=e.dexData;for(const r of i){const o=a[r].caughtAttr;n[r].abilityAttr=(o&F.DEFAULT_VARIANT?rt.ABILITY_1:0)|(o&F.VARIANT_2?rt.ABILITY_2:0)|(o&F.VARIANT_3?rt.ABILITY_HIDDEN:0),o&&(o&F.DEFAULT_VARIANT||(a[r].caughtAttr^=F.DEFAULT_VARIANT),o&F.VARIANT_2&&(a[r].caughtAttr^=F.VARIANT_2),o&F.VARIANT_3&&(a[r].caughtAttr^=F.VARIANT_3))}}};c(td,"GameData");let Ba=td;const oS=["delay","completeDelay","loopDelay","duration","repeatDelay","hold","startDelay"];function lS(){const C=this,e=c(p=>p instanceof up?p.value:C.gameSpeed===1?p:Math.ceil(p/=C.gameSpeed),"transformValue"),t=c((p,f=!1)=>{if(!(p instanceof Phaser.Tweens.Tween||p instanceof Phaser.Tweens.TweenChain)){if(f&&Array.isArray(p)){for(const d of p)t(d);return}for(const d of oS){const y=p[d];(typeof y=="number"||y instanceof up)&&(p[d]=e(y))}if(p.tweens&&Array.isArray(p.tweens))for(const d of p.tweens)t(d)}},"mutateProperties"),i=this.time.addEvent;this.time.addEvent=function(p){return!(p instanceof Phaser.Time.TimerEvent)&&p.delay&&(p.delay=e(p.delay)),i.apply(this,[p])};const n=this.tweens.add;this.tweens.add=function(p){return t(p),n.apply(this,[p])};const a=this.tweens.chain;this.tweens.chain=function(p){return t(p),a.apply(this,[p])};const r=this.tweens.addCounter;this.tweens.addCounter=function(p){return t(p),r.apply(this,[p])};const o=this.tweens.create;this.tweens.create=function(p){return t(p,!0),o.apply(this,[p])};const l=this.tweens.addMultiple;this.tweens.addMultiple=function(p){return t(p,!0),l.apply(this,[p])};const h=Os.fadeOut;Os.fadeOut=((p,f,d,y)=>h(s,f,e(d),y));const u=Os.fadeIn;Os.fadeIn=((p,f,d,y,g)=>u(s,f,e(d),y,g))}c(lS,"initGameSpeed");const Yi=118,hS=0,Fp=-116,sd=class sd extends Phaser.GameObjects.Container{abilityBars;abilityBarText;player;screenRight;shown;constructor(){super(s,Yi,Fp),this.abilityBars=[],this.player=!0,this.shown=!1}setup(){for(const e of["ability_bar_right","ability_bar_left"]){const t=s.add.image(0,0,e);t.setOrigin(0,0),t.setVisible(!1),this.add(t),this.abilityBars.push(t)}this.abilityBarText=P(15,3,"",A.MESSAGE,{fontSize:"72px"}),this.abilityBarText.setOrigin(0,0),this.abilityBarText.setWordWrapWidth(600,!0),this.add(this.abilityBarText),this.bringToTop(this.abilityBarText),this.setVisible(!1),this.setX(-Yi)}setVisible(e){return this.abilityBars[+this.player].setVisible(e),this.shown=e,this}async startTween(e,t){return this.setVisible(!0),t&&this.abilityBarText.setText(t),new Promise(i=>{s.tweens.add({...e,onComplete:c(()=>{e.onComplete&&e.onComplete(),i()},"onComplete")})})}async showAbility(e,t,i=!1,n=!0){const a=`${m.t("fightUiHandler:abilityFlyInText",{pokemonName:e,passive:i?m.t("fightUiHandler:passive"):"",abilityName:t})}`;this.screenRight=s.scaledCanvas.width,n!==this.player&&(this.setX(n?-Yi:this.screenRight),this.player=n),s.fieldUI.bringToTop(this);let r=Fp;return this.player?r+=s.currentBattle.double?14:0:r-=s.currentBattle.double?28:14,this.setY(r),this.startTween({targets:this,x:this.player?hS:this.screenRight-Yi,duration:500,ease:"Sine.easeOut",hold:1e3},a)}async hide(){return this.startTween({targets:this,x:this.player?-Yi:this.screenRight,duration:200,ease:"Sine.easeIn",onComplete:c(()=>{this.setVisible(!1)},"onComplete")})}isVisible(){return this.shown}};c(sd,"AbilityBar");let bl=sd;const id=class id extends Phaser.GameObjects.Container{timeOfDayIconFgs=new Array(2);timeOfDayIconMgs=new Array(2);timeOfDayIconBgs=new Array(2);timeOfDayIcons;timeOfDayIconPairs=new Map([["bg",this.timeOfDayIconBgs],["mg",this.timeOfDayIconMgs],["fg",this.timeOfDayIconFgs]]);currentTime=Jt.ALL;previousTime=Jt.ALL;onEncounterPhaseEvent=c(e=>this.onEncounterPhase(e),"onEncounterPhaseEvent");_parentVisible;get parentVisible(){return this._parentVisible}set parentVisible(e){e&&!this._parentVisible&&this.timeOfDayIcons?.forEach(t=>s.tweens.getTweensOf(t).forEach(i=>i.resume())),this._parentVisible=e}constructor(e=0,t=0){super(s,e,t),this.setVisible(s.showTimeOfDayWidget),s.showTimeOfDayWidget&&(this.timeOfDayIconPairs.forEach((i,n)=>{for(let a=0;a<i.length;a++)i[a]=s.add.sprite(0,0,"dawn_icon_"+n).setOrigin()}),this.timeOfDayIcons=[this.timeOfDayIconBgs,this.timeOfDayIconMgs,this.timeOfDayIconFgs].flat(),this.add(this.timeOfDayIcons),s.eventTarget.addEventListener(yi.ENCOUNTER_PHASE,this.onEncounterPhaseEvent))}getBackTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ge(1500),ease:"Back.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ge(500),ease:"Linear",paused:!this.parentVisible};return[e,t]}getBounceTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:ge(2e3),ease:"Bounce.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:ge(800),ease:"Linear",paused:!this.parentVisible};return[e,t]}resetIcons(){this.moveBelow(this.timeOfDayIconBgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconMgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconFgs[0],this.timeOfDayIconFgs[1]),this.timeOfDayIconPairs.forEach((e,t)=>{e[0].setTexture(Jt[this.currentTime].toLowerCase()+"_icon_"+t),e[1].setTexture(Jt[this.previousTime].toLowerCase()+"_icon_"+t)}),this.timeOfDayIconMgs[0].setRotation(-90*(3.14/180)),this.timeOfDayIcons.forEach(e=>e.setAlpha(1))}tweenTimeOfDayIcon(){s.tweens.killTweensOf(this.timeOfDayIcons),this.resetIcons(),(s.timeOfDayAnimation===Mf.BACK?this.getBackTween():this.getBounceTween()).forEach(e=>s.tweens.add(e)),this.timeOfDayIconPairs.forEach(e=>{const t=e.shift();t&&e.push(t)})}onEncounterPhase(e){const t=s.arena.getTimeOfDay();this.currentTime!==t&&(this.currentTime=t,this.previousTime=this.currentTime-1,this.previousTime<Jt.DAWN&&(this.previousTime=Jt.NIGHT),this.tweenTimeOfDayIcon())}};c(id,"TimeOfDayWidget");let Il=id;function gr(C){if(!C||C===Ya.NONE)return C;const t=`arenaFlyout:${Tt(C)}`,i=m.t(t);return!i||i===t?wi(C):i}c(gr,"getFieldEffectText");const nd=class nd extends Phaser.GameObjects.Container{flyoutWidth=170;flyoutHeight=51;translationX;anchorX;anchorY;flyoutParent;flyoutContainer;flyoutWindow;flyoutWindowHeader;flyoutTextHeader;timeOfDayWidget;flyoutTextHeaderPlayer;flyoutTextHeaderEnemy;flyoutTextHeaderField;flyoutTextPlayer;flyoutTextEnemy;flyoutTextField;fieldEffectInfo=[];onNewArenaEvent=c(e=>this.onNewArena(e),"onNewArenaEvent");onTurnEndEvent=c(e=>this.onTurnEnd(e),"onTurnEndEvent");onFieldEffectChangedEvent=c(e=>this.onFieldEffectChanged(e),"onFieldEffectChangedEvent");constructor(){super(s,0,0),this.setName("arena-flyout"),this.translationX=this.flyoutWidth,this.anchorX=0,this.anchorY=-98,this.flyoutParent=s.add.container(this.anchorX-this.translationX,this.anchorY),this.flyoutParent.setAlpha(0),this.add(this.flyoutParent),this.flyoutContainer=s.add.container(0,0),this.flyoutParent.add(this.flyoutContainer),this.flyoutWindow=ye(0,0,this.flyoutWidth,this.flyoutHeight,!1,!1,0,0,is.THIN),this.flyoutContainer.add(this.flyoutWindow),this.flyoutWindowHeader=ye(this.flyoutWidth/2,0,this.flyoutWidth/2,14,!1,!1,0,0,is.XTHIN),this.flyoutWindowHeader.setOrigin(),this.flyoutContainer.add(this.flyoutWindowHeader),this.flyoutTextHeader=P(this.flyoutWidth/2,0,m.t("arenaFlyout:activeBattleEffects"),A.BATTLE_INFO),this.flyoutTextHeader.setFontSize(54),this.flyoutTextHeader.setAlign("center"),this.flyoutTextHeader.setOrigin(),this.flyoutContainer.add(this.flyoutTextHeader),this.timeOfDayWidget=new Il(this.flyoutWidth/2+this.flyoutWindowHeader.displayWidth/2),this.flyoutContainer.add(this.timeOfDayWidget),this.flyoutTextHeaderPlayer=P(6,5,m.t("arenaFlyout:player"),A.SUMMARY_BLUE),this.flyoutTextHeaderPlayer.setFontSize(54),this.flyoutTextHeaderPlayer.setAlign("left"),this.flyoutTextHeaderPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextHeaderPlayer),this.flyoutTextHeaderField=P(this.flyoutWidth/2,5,m.t("arenaFlyout:field"),A.SUMMARY_GREEN),this.flyoutTextHeaderField.setFontSize(54),this.flyoutTextHeaderField.setAlign("center"),this.flyoutTextHeaderField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextHeaderField),this.flyoutTextHeaderEnemy=P(this.flyoutWidth-6,5,m.t("arenaFlyout:enemy"),A.SUMMARY_RED),this.flyoutTextHeaderEnemy.setFontSize(54),this.flyoutTextHeaderEnemy.setAlign("right"),this.flyoutTextHeaderEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextHeaderEnemy),this.flyoutTextPlayer=P(6,13,"",A.BATTLE_INFO),this.flyoutTextPlayer.setLineSpacing(-1),this.flyoutTextPlayer.setFontSize(48),this.flyoutTextPlayer.setAlign("left"),this.flyoutTextPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextPlayer),this.flyoutTextField=P(this.flyoutWidth/2,13,"",A.BATTLE_INFO),this.flyoutTextField.setLineSpacing(-1),this.flyoutTextField.setFontSize(48),this.flyoutTextField.setAlign("center"),this.flyoutTextField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextField),this.flyoutTextEnemy=P(this.flyoutWidth-6,13,"",A.BATTLE_INFO),this.flyoutTextEnemy.setLineSpacing(-1),this.flyoutTextEnemy.setFontSize(48),this.flyoutTextEnemy.setAlign("right"),this.flyoutTextEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextEnemy),this.name="Fight Flyout",this.flyoutParent.name="Fight Flyout Parent",s.eventTarget.addEventListener(yi.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.addEventListener(yi.TURN_END,this.onTurnEndEvent)}onNewArena(e){this.fieldEffectInfo.length=0,s.arena.eventTarget.addEventListener(Ds.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(Ds.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(Ds.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(Ds.TAG_REMOVED,this.onFieldEffectChangedEvent)}clearText(){this.flyoutTextPlayer.text="",this.flyoutTextField.text="",this.flyoutTextEnemy.text=""}updateFieldText(){this.clearText(),this.fieldEffectInfo.sort((e,t)=>e.duration-t.duration);for(let e=0;e<this.fieldEffectInfo.length;e++){const t=this.fieldEffectInfo[e];let i;switch(t.effectType){case 0:i=this.flyoutTextPlayer;break;case 1:case 2:case 3:i=this.flyoutTextField;break;case 4:i=this.flyoutTextEnemy;break}i.text+=t.name,t.maxDuration!==0&&(i.text+="  "+t.duration+"/"+t.maxDuration),i.text+=`
`}}onFieldEffectChanged(e){const t=e;if(!t)return;let i;switch(t.constructor){case xr:{const n=t,a=s.arena.getTag(n.arenaTagType)instanceof rh;let r;n.arenaTagSide===sn.BOTH?r=3:n.arenaTagSide===sn.PLAYER?r=0:r=4;const o=a?this.fieldEffectInfo.findIndex(h=>n.arenaTagType===h.tagType&&r===h.effectType):-1;let l=gr(Ya[n.arenaTagType]);if(a){if(o!==-1){const h=n.arenaTagMaxLayers>1?` (${n.arenaTagLayers})`:"";this.fieldEffectInfo[o].name=`${l}${h}`;break}n.arenaTagMaxLayers>1&&(l=`${l} (${n.arenaTagLayers})`)}this.fieldEffectInfo.push({name:l,effectType:r,maxDuration:n.duration,duration:n.duration,tagType:n.arenaTagType});break}case Km:{const n=t;i=this.fieldEffectInfo.findIndex(a=>a.tagType===n.arenaTagType),i!==-1&&this.fieldEffectInfo.splice(i,1);break}case zi:case wf:{const n=t,a=gr(n instanceof zi?es[n.oldWeatherType]:us[n.oldTerrainType]),r={name:gr(n instanceof zi?es[n.newWeatherType]:us[n.newTerrainType]),effectType:n instanceof zi?1:2,maxDuration:n.duration,duration:n.duration};i=this.fieldEffectInfo.findIndex(o=>[r.name,a].includes(o.name)),i===-1?r.name!==void 0&&this.fieldEffectInfo.push(r):r.name?this.fieldEffectInfo[i]=r:this.fieldEffectInfo.splice(i,1);break}}this.updateFieldText()}onTurnEnd(e){if(!e)return;const i=[];this.fieldEffectInfo.forEach(n=>i.push(n));for(let n=0;n<i.length;n++){const a=i[n];a.maxDuration!==0&&(--a.duration,a.duration<=0&&this.fieldEffectInfo.splice(this.fieldEffectInfo.indexOf(a),1))}this.updateFieldText()}toggleFlyout(e){s.tweens.add({targets:this.flyoutParent,x:e?this.anchorX:this.anchorX-this.translationX,duration:ge(125),ease:"Sine.easeInOut",alpha:e?1:0,onComplete:c(()=>this.timeOfDayWidget.parentVisible=e,"onComplete")})}destroy(e){s.eventTarget.removeEventListener(yi.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.removeEventListener(yi.TURN_END,this.onTurnEndEvent),s.arena.eventTarget.removeEventListener(Ds.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(Ds.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(Ds.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(Ds.TAG_REMOVED,this.onFieldEffectChangedEvent),super.destroy(e)}};c(nd,"ArenaFlyout");let vl=nd;const ad=class ad extends Phaser.GameObjects.Container{bg;candyIcon;candyOverlayIcon;countText;speciesId;tween;autoHideTimer;shown;constructor(){super(s,s.scaledCanvas.width,-s.scaledCanvas.height+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.candyIcon=s.add.sprite(14,0,"items","candy"),this.candyIcon.setOrigin(.5,0),this.candyIcon.setScale(.5),this.add(this.candyIcon),this.candyOverlayIcon=s.add.sprite(14,0,"items","candy_overlay"),this.candyOverlayIcon.setOrigin(.5,0),this.candyOverlayIcon.setScale(.5),this.add(this.candyOverlayIcon),this.countText=P(22,4,"",A.BATTLE_INFO),this.countText.setOrigin(0,0),this.add(this.countText),this.setVisible(!1),this.shown=!1}showStarterSpeciesCandy(e,t){return new Promise(i=>{if(this.shown)return this.speciesId===e?i():this.hide().then(()=>this.showStarterSpeciesCandy(e,t)).then(()=>i());const n=yt[e];this.candyIcon.setTint(ss(Gt(n[0]))),this.candyOverlayIcon.setTint(ss(Gt(n[1]))),this.countText.setText(`${s.gameData.starterData[e].candyCount+t} (+${t.toString()})`),this.bg.width=this.countText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),s.playSound("se/shing"),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width-(this.bg.width-5),duration:500,ease:"Sine.easeOut",onComplete:c(()=>{this.tween=null,this.resetAutoHideTimer(),i()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.autoHideTimer&&clearInterval(this.autoHideTimer),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:c(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),e()},"onComplete")})})}resetAutoHideTimer(){this.autoHideTimer&&clearInterval(this.autoHideTimer),this.autoHideTimer=setTimeout(()=>{this.hide(),this.autoHideTimer=null},2500)}};c(ad,"CandyBar");let _l=ad;const rd=class rd extends Phaser.GameObjects.Container{sprite;transitionSprite;key;variant;shown;constructor(){super(s,s.scaledCanvas.width+32,-42)}setup(){[this.sprite,this.transitionSprite]=new Array(2).fill(null).map(()=>{const e=s.add.sprite(0,0,"","");return e.setOrigin(.5,1),this.add(e),e}),this.transitionSprite.setVisible(!1),this.setVisible(!1),this.shown=!1}showCharacter(e,t){return new Promise(i=>{if(e.startsWith("c_")||(e=`c_${e}`),this.shown){if(e===this.key&&t===this.variant)return i();if(e!==this.key)return this.hide().then(()=>this.showCharacter(e,t));this.setVariant(t).then(()=>i());return}this.sprite.setTexture(e,t),s.fieldUI.bringToTop(this),s.tweens.add({targets:this,x:s.scaledCanvas.width-102,duration:750,ease:"Cubic.easeOut",onComplete:c(()=>{i()},"onComplete")}),this.setVisible(s.textures.get(e).key!==zm),this.shown=!0,this.key=e,this.variant=t})}setVariant(e){return new Promise(t=>{s.fieldUI.bringToTop(this),this.transitionSprite.setTexture(this.key,e),this.transitionSprite.setAlpha(0),this.transitionSprite.setVisible(!0),s.tweens.add({targets:this.transitionSprite,alpha:1,duration:250,ease:"Sine.easeIn",onComplete:c(()=>{this.sprite.setTexture(this.key,e),this.transitionSprite.setVisible(!1),t()},"onComplete")}),this.variant=e})}hide(){return new Promise(e=>{if(!this.shown)return e();s.tweens.add({targets:this,x:s.scaledCanvas.width+32,duration:750,ease:"Cubic.easeIn",onComplete:c(()=>{this.shown||this.setVisible(!1),e()},"onComplete")}),this.shown=!1})}};c(rd,"CharSprite");let Al=rd;const od=class od extends Phaser.GameObjects.Container{bg;pokemonIcon;expText;tween;shown;constructor(){super(s,s.scaledCanvas.width,-s.scaledCanvas.height+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.expText=P(22,4,"",A.BATTLE_INFO),this.expText.setOrigin(0,0),this.add(this.expText),this.setVisible(!1),this.shown=!1}showPokemonExp(e,t,i,n){return new Promise(a=>{if(this.shown)return a();this.pokemonIcon=s.addPokemonIcon(e,-8,15,0,.5),this.pokemonIcon.setScale(.5),this.add(this.pokemonIcon),i?n>200?this.expText.setText(m.t("battleScene:levelUp")):this.expText.setText(m.t("battleScene:levelUpWithLevel",{level:n})):this.expText.setText(`+${t.toString()}`),this.bg.width=this.expText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width-(this.bg.width-5),duration:500/Math.pow(2,s.expGainsSpeed),ease:"Sine.easeOut",onComplete:c(()=>{this.tween=null,a()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:c(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),this.pokemonIcon?.destroy(),e()},"onComplete")})})}};c(od,"PartyExpBar");let xl=od;const ld=class ld extends Phaser.GameObjects.Container{player;bg;balls;shown;constructor(e){super(s,e?s.scaledCanvas.width:0,e?-72:-144),this.player=e}setup(){this.bg=s.add.nineslice(0,0,`pb_tray_overlay_${this.player?"player":"enemy"}`,void 0,104,4,48,8,0,0),this.bg.setOrigin(this.player?1:0,0),this.add(this.bg),this.balls=new Array(6).fill(null).map((e,t)=>s.add.sprite((this.player?-83:76)+s.scaledCanvas.width*(this.player?-1:1)+10*t*(this.player?1:-1),-8,"pb_tray_ball","empty"));for(const e of this.balls)e.setOrigin(0,0),this.add(e);this.setVisible(!1),this.shown=!1}showPbTray(e){return new Promise(t=>{if(this.shown)return t();s.fieldUI.bringToTop(this),this.x+=104*(this.player?1:-1),this.bg.width=104,this.bg.alpha=1,this.balls.forEach((i,n)=>{i.x+=(s.scaledCanvas.width+104)*(this.player?1:-1);let a="ball";n>=e.length?a="empty":e[n].hp?e[n].status&&(a="status"):a="faint",i.setFrame(a)}),s.playSound("se/pb_tray_enter"),s.tweens.add({targets:this,x:`${this.player?"-":"+"}=104`,duration:500,ease:"Sine.easeIn",onComplete:c(()=>{this.balls.forEach((i,n)=>{s.tweens.add({targets:i,x:`${this.player?"-":"+"}=104`,duration:n*100,ease:"Sine.easeIn",onComplete:c(()=>s.playSound(`se/${n<e.length?"pb_tray_ball":"pb_tray_empty"}`),"onComplete")})})},"onComplete")}),this.setVisible(!0),this.shown=!0,s.time.delayedCall(1100,()=>t())})}hide(){return new Promise(e=>{if(!this.shown)return e();this.balls.forEach((t,i)=>{s.tweens.add({targets:t,x:`${this.player?"-":"+"}=${s.scaledCanvas.width}`,duration:250,delay:i*100,ease:"Sine.easeIn"})}),s.tweens.add({targets:this.bg,width:144,alpha:0,duration:500,ease:"Sine.easeIn"}),s.time.delayedCall(850,()=>{this.setVisible(!1),e()}),this.shown=!1})}};c(ld,"PokeballTray");let La=ld;const hd=class hd extends Phaser.GameObjects.Container{defaultWidth;defaultHeight;bg;icon;titleText;scoreText;descriptionText;queue=[];playerGender;shown;constructor(){super(s,s.scaledCanvas.width,0),this.playerGender=s.gameData.gender}setup(){this.defaultWidth=200,this.defaultHeight=40,this.bg=s.add.nineslice(0,0,"achv_bar",void 0,this.defaultWidth,this.defaultHeight,41,6,16,4),this.bg.setOrigin(0,0),this.add(this.bg),this.icon=s.add.sprite(4,4,"items"),this.icon.setOrigin(0,0),this.add(this.icon),this.titleText=P(40,3,"",A.MESSAGE,{fontSize:"72px"}),this.titleText.setOrigin(0,0),this.add(this.titleText),this.scoreText=P(150,3,"",A.MESSAGE,{fontSize:"72px"}),this.scoreText.setOrigin(1,0),this.add(this.scoreText),this.descriptionText=P(43,16,"",A.WINDOW_ALT,{fontSize:"72px"}),this.descriptionText.setOrigin(0,0),this.add(this.descriptionText),this.descriptionText.setWordWrapWidth(664),this.descriptionText.setLineSpacing(-5),this.setScale(.5),this.shown=!1}showAchv(e){if(this.shown){this.queue.push(e);return}const t=e.getTier();this.bg.setTexture(`achv_bar${t?`_${t+1}`:""}`),this.icon.setFrame(e.getIconImage()),this.titleText.setText(e.getName(this.playerGender)),this.scoreText.setVisible(e instanceof ar),e instanceof ar?this.descriptionText.setText(Nf(e.localizationKey)):e instanceof jm&&this.descriptionText.setText(e.description),e instanceof ar&&this.scoreText.setText(`+${e.score}pt`),this.bg.width=Math.max(this.defaultWidth,this.icon.displayWidth+this.titleText.displayWidth+this.scoreText.displayWidth+16),this.scoreText.x=this.bg.width-2,this.descriptionText.width=this.bg.width-this.icon.displayWidth-16,this.descriptionText.setWordWrapWidth(this.descriptionText.width*6),this.bg.height=Math.max(this.defaultHeight,this.titleText.displayHeight+this.descriptionText.displayHeight+8),this.icon.y=this.bg.height/2-this.icon.height/2,s.playSound("se/achv"),s.tweens.add({targets:this,x:s.scaledCanvas.width-this.bg.width/2,duration:500,ease:"Sine.easeOut"}),s.time.delayedCall(1e4,()=>this.hide(this.playerGender)),this.setVisible(!0),this.shown=!0}hide(e){this.shown&&s.tweens.add({targets:this,x:s.scaledCanvas.width,duration:500,ease:"Sine.easeIn",onComplete:c(()=>{if(this.shown=!1,this.setVisible(!1),this.queue.length){const t=this.queue.shift();t&&this.showAchv(t)}},"onComplete")})}};c(hd,"AchvBar");let Ol=hd;const Es={ACHIEVEMENTS:0,VOUCHERS:1},cS={de:{TextSize:"80px"}},cd=class cd extends Bt{ROWS=4;COLS=18;mainContainer;iconsContainer;headerBg;headerText;headerActionText;headerActionButton;headerBgX;iconsBg;icons;titleBg;titleText;scoreContainer;scoreText;unlockText;achvsName;achvsTotal;vouchersName;vouchersTotal;currentTotal;scrollBar;scrollCursor;cursorObj;currentPage;constructor(e=null){super(e),this.achvsTotal=Object.keys(Pe).length,this.vouchersTotal=Object.keys(Ft).length,this.scrollCursor=0}setup(){const e=this.getUi(),t=s.scaledCanvas.width,i=s.scaledCanvas.height;this.mainContainer=s.add.container(1,-i+1),this.mainContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,t,i),Phaser.Geom.Rectangle.Contains),this.headerBg=ye(0,0,t-2,24),this.headerText=P(0,0,"",A.HEADER_LABEL).setOrigin(0).setPositionRelative(this.headerBg,8,4),this.headerActionButton=new Phaser.GameObjects.Sprite(s,0,0,"keyboard","ACTION.png").setOrigin(0).setPositionRelative(this.headerBg,236,6),this.headerActionText=P(0,0,"",A.WINDOW,{fontSize:"60px"}).setOrigin(0).setPositionRelative(this.headerBg,264,8);const n=s.gameData.gender??Be.MALE,a=Be[n].toLowerCase();this.achvsName=m.t("achv:achievements.name",{context:a}),this.vouchersName=m.t("voucher:vouchers"),this.iconsBg=ye(0,this.headerBg.height,t-2,i-this.headerBg.height-68).setOrigin(0);const r=6;this.scrollBar=new _s(this.iconsBg.width-9,this.iconsBg.y+r,4,this.iconsBg.height-r*2,this.ROWS),this.iconsContainer=s.add.container(5,this.headerBg.height+8),this.icons=[];for(let g=0;g<this.ROWS*this.COLS;g++){const T=g%this.COLS*17,E=Math.floor(g/this.COLS)*19,b=s.add.sprite(T,E,"items","unknown").setOrigin(0).setScale(.5);this.icons.push(b),this.iconsContainer.add(b)}const o=ye(0,this.headerBg.height+this.iconsBg.height,174,24);this.titleBg=o,this.titleText=P(0,0,"",A.WINDOW).setOrigin();const l=cS[m.language]?.TextSize??this.titleText.style.fontSize;this.titleText.setFontSize(l);const h=o.x+o.width/2,u=o.y+o.height/2;this.titleText.setPosition(h,u),this.scoreContainer=s.add.container(o.x+o.width,o.y);const p=ye(0,0,46,24);this.scoreText=P(p.width/2,p.height/2,"",A.WINDOW).setOrigin(),this.scoreContainer.add([p,this.scoreText]);const f=ye(this.scoreContainer.x+p.width,o.y,98,24);this.unlockText=P(0,0,"",A.WINDOW).setPositionRelative(f,f.width/2,f.height/2).setOrigin();const d=ye(0,o.y+o.height,t-2,42),y=P(0,0,"",A.WINDOW,{maxLines:2}).setWordWrapWidth(1870).setOrigin(0).setPositionRelative(d,8,4);this.message=y,this.mainContainer.add([this.headerBg,this.headerActionButton,this.headerText,this.headerActionText,this.iconsBg,this.scrollBar,this.iconsContainer,o,this.titleText,this.scoreContainer,f,this.unlockText,d,y]),e.add(this.mainContainer),this.currentPage=Es.ACHIEVEMENTS,this.mainContainer.setVisible(!1)}show(e){return super.show(e),this.headerBgX=this.headerBg.getTopRight().x,this.updateAchvIcons(),this.mainContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.getUi().moveTo(this.mainContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}showAchv(e){const t=s.gameData.gender??Be.MALE,i=Be[t].toLowerCase();e.name=m.t(`achv:${e.localizationKey}.name`,{context:i}),e.description=Nf(e.localizationKey);const n=s.gameData.achvUnlocks,a=n.hasOwnProperty(e.id),r=!a&&e.secret&&(!e.parentId||!n.hasOwnProperty(e.parentId));this.titleText.setText(a?e.name:"???"),this.showText(r?"":e.description),this.scoreText.setText(`${e.score}pt`),this.unlockText.setText(a?new Date(n[e.id]).toLocaleDateString():m.t("achv:locked.name"))}showVoucher(e){const t=s.gameData.voucherUnlocks,i=t.hasOwnProperty(e.id);this.titleText.setText($m(e.voucherType)),this.showText(e.description),this.unlockText.setText(i?new Date(t[e.id]).toLocaleDateString():m.t("voucher:locked"))}processActionInput(){return this.setScrollCursor(0),this.currentPage===Es.ACHIEVEMENTS?(this.currentPage=Es.VOUCHERS,this.updateVoucherIcons()):this.currentPage===Es.VOUCHERS&&(this.currentPage=Es.ACHIEVEMENTS,this.updateAchvIcons()),this.setCursor(0,!0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.mainContainer.update(),!0}processUpInput(){if(this.cursor>=this.COLS)return this.setCursor(this.cursor-this.COLS);if(this.scrollCursor)return this.setScrollCursor(this.scrollCursor-1);const e=this.setScrollCursor(Math.ceil(this.currentTotal/this.COLS)-this.ROWS);let t=this.cursor+(this.ROWS-1)*this.COLS;return t>this.currentTotal-this.scrollCursor*this.COLS-1&&(t-=this.COLS),e&&this.setCursor(t)}processDownInput(){const e=Math.floor(this.cursor/this.COLS),t=this.scrollCursor*this.COLS,i=t+1<this.currentTotal;return e>=this.ROWS-1?this.scrollCursor<Math.ceil(this.currentTotal/this.COLS)-this.ROWS&&i?this.setScrollCursor(this.scrollCursor+1):this.setScrollCursor(0)&&this.setCursor(this.cursor%this.COLS):i?this.setCursor(Math.min(this.cursor+this.COLS,this.currentTotal-t-1)):!1}processLeftInput(){const e=this.scrollCursor*this.COLS;return this.cursor%this.COLS===0?this.setCursor(Math.min(this.cursor+this.COLS-1,this.currentTotal-e-1)):this.setCursor(this.cursor-1)}processRightInput(){const e=this.scrollCursor*this.COLS;return(this.cursor+1)%this.COLS===0||this.cursor+e===this.currentTotal-1?this.setCursor(this.cursor-this.cursor%this.COLS):this.setCursor(this.cursor+1)}processInput(e){let t=!1;switch(e){case v.ACTION:t=this.processActionInput();break;case v.CANCEL:t=!0,s.ui.revertMode();break;case v.UP:t=this.processUpInput();break;case v.DOWN:t=this.processDownInput();break;case v.LEFT:t=this.processLeftInput();break;case v.RIGHT:t=this.processRightInput();break}return t&&this.getUi().playSelect(),t}setCursor(e,t){const i=super.setCursor(e);let n=i;if(this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight",void 0,16,16,1,1,1,1).setOrigin(0),this.iconsContainer.add(this.cursorObj),n=!0),this.cursorObj.setPositionRelative(this.icons[this.cursor],0,0),!n&&!t)return i;switch(this.currentPage){case Es.ACHIEVEMENTS:t&&(this.titleBg.width=174,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!0)),this.showAchv(Pe[Object.keys(Pe)[e+this.scrollCursor*this.COLS]]);break;case Es.VOUCHERS:t&&(this.titleBg.width=220,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!1)),this.showVoucher(Ft[Object.keys(Ft)[e+this.scrollCursor*this.COLS]]);break}return i}setScrollCursor(e){if(e===this.scrollCursor)return!1;this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor);const t=Math.min(this.cursor,this.currentTotal-this.scrollCursor*this.COLS-1);switch(t!==this.cursor&&this.setCursor(t),this.currentPage){case Es.ACHIEVEMENTS:this.updateAchvIcons(),this.showAchv(Pe[Object.keys(Pe)[this.cursor+this.scrollCursor*this.COLS]]);break;case Es.VOUCHERS:this.updateVoucherIcons(),this.showVoucher(Ft[Object.keys(Ft)[this.cursor+this.scrollCursor*this.COLS]]);break}return!0}updateIcons(e,t,i,n,a,r){this.headerText.text=i,this.headerActionText.text=n;const o=this.headerBgX-this.headerActionText.displayWidth-8;this.headerActionText.setX(o),this.headerActionButton.setX(o-this.headerActionButton.displayWidth-4);const l=this.scrollCursor*this.COLS,h=this.ROWS*this.COLS,u=e.slice(l,h+l);u.forEach((p,f)=>{const d=this.icons[f],y=t.hasOwnProperty(p.id);let g=!y;if(r){const T=p,E=!y&&T.secret&&(!T.parentId||!t.hasOwnProperty(T.parentId));g&&=!E,d.setFrame(E?"unknown":T.iconImage)}else d.setFrame(qs(p.voucherType));d.setVisible(!0),g?d.setTintFill(0):d.clearTint()}),u.length<this.icons.length&&this.icons.slice(u.length).forEach(p=>p.setVisible(!1)),this.currentTotal=a}updateAchvIcons(){this.updateIcons(Object.values(Pe),s.gameData.achvUnlocks,this.achvsName,this.vouchersName,this.achvsTotal,!0)}updateVoucherIcons(){this.updateIcons(Object.values(Ft),s.gameData.voucherUnlocks,this.vouchersName,this.achvsName,this.vouchersTotal,!1)}clear(){super.clear(),this.currentPage=Es.ACHIEVEMENTS,this.mainContainer.setVisible(!1),this.setScrollCursor(0),this.setCursor(0,!0),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};c(cd,"AchvsUiHandler");let wl=cd;const ud=class ud extends zs{modalContainer;modalBg;titleText;buttonContainers;buttonBgs;buttonLabels;constructor(e=null){super(e),this.buttonContainers=[],this.buttonBgs=[],this.buttonLabels=[]}getButtonTopMargin(){return 0}setup(){const e=this.getUi();this.modalContainer=s.add.container(0,0),this.modalContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.modalBg=ye(0,0,0,0),this.modalContainer.add(this.modalBg),this.titleText=P(0,4,"",A.SETTINGS_LABEL),this.titleText.setOrigin(.5,0),this.modalContainer.add(this.titleText),e.add(this.modalContainer);const t=this.getButtonLabels();for(const i of t)this.addButton(i);this.modalContainer.setVisible(!1)}addButton(e){const t=this.getButtonTopMargin(),i=P(0,8,e,A.TOOLTIP_CONTENT);i.setOrigin(.5,.5);const n=ye(0,0,i.getBounds().width+8,16,!1,!1,0,0,is.THIN);n.setOrigin(.5,0),n.setInteractive(new Phaser.Geom.Rectangle(0,0,n.width,n.height),Phaser.Geom.Rectangle.Contains);const a=s.add.container(0,t);this.buttonLabels.push(i),this.buttonBgs.push(n),this.buttonContainers.push(a),a.add(n),a.add(i),this.addInteractionHoverEffect(n),this.modalContainer.add(a)}show(e){if(e.length>=1&&"buttonActions"in e[0]){if(super.show(e),e[0].hasOwnProperty("fadeOut")&&typeof e[0].fadeOut=="function"){const[i,n,a,r]=this.getMargin(),o=s.add.rectangle((this.getWidth()+r+n)/2,(this.getHeight()+i+a)/2,s.scaledCanvas.width,s.scaledCanvas.height,0);o.setOrigin(.5,.5),o.setName("rect-ui-overlay-modal"),o.setAlpha(0),this.modalContainer.add(o),this.modalContainer.moveTo(o,0),s.tweens.add({targets:o,alpha:1,duration:250,ease:"Sine.easeOut",onComplete:e[0].fadeOut})}const t=e[0];this.updateContainer(t),this.modalContainer.setVisible(!0),this.getUi().moveTo(this.modalContainer,this.getUi().length-1);for(let i=0;i<this.buttonBgs.length;i++)i<this.buttonBgs.length&&this.buttonBgs[i].on("pointerdown",n=>{s.tweens.getTweensOf(this.modalContainer).length===0&&t.buttonActions[i]()});return!0}return!1}updateContainer(e){const[t,i,n,a]=this.getMargin(e),r=this.getWidth(e),o=this.getHeight(e);this.modalContainer.setPosition((s.scaledCanvas.width-(r+(i-a)))/2,(-s.scaledCanvas.height-(o+(n-t)))/2),this.modalBg.setSize(r,o);const l=this.getModalTitle(e);if(this.titleText.setText(l),this.titleText.setX(r/2),this.titleText.setVisible(!!l),this.buttonContainers.length>0){const u=this.buttonBgs.reduce((f,d)=>f+d.width,0)+12*(this.buttonBgs.length-1);let p=(this.modalBg.width-u)/2;this.buttonContainers.forEach((f,d)=>{f.setPosition(p+this.buttonBgs[d].width/2,this.modalBg.height-(this.buttonBgs[d].height+8)),p+=this.buttonBgs[d].width+12})}}processInput(e){return!1}clear(){super.clear(),this.modalContainer.setVisible(!1),this.buttonBgs.map(e=>e.off("pointerdown"))}addInteractionHoverEffect(e){e.on("pointerover",()=>{this.setMouseCursorStyle("pointer"),e.setTint(12303291)}),e.on("pointerout",()=>{this.setMouseCursorStyle("default"),e.clearTint()})}};c(ud,"ModalUiHandler");let Bi=ud;const dd=class dd extends Bi{editing;inputContainers;inputs;errorMessage;submitAction;cancelAction;tween;formLabels;constructor(e=null){super(e),this.editing=!1,this.inputContainers=[],this.inputs=[],this.formLabels=[]}getHeight(e){return 20*this.getInputFieldConfigs().length+(this.getModalTitle()?26:0)+(e?.errorMessage?12:0)+this.getButtonTopMargin()+28}getReadableErrorMessage(e){return e?.indexOf("connection refused")>-1?"Could not connect to the server":e}setup(){super.setup();const e=this.getInputFieldConfigs(),t=!!this.getModalTitle();e.length>=1&&this.updateFields(e,t),this.errorMessage=P(10,(t?31:5)+20*(e.length-1)+16+this.getButtonTopMargin(),"",A.TOOLTIP_CONTENT,{fontSize:"42px",wordWrap:{width:850}}),this.errorMessage.setColor(this.getTextColor(A.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(A.SUMMARY_PINK,!0)),this.errorMessage.setVisible(!1),this.modalContainer.add(this.errorMessage)}updateFields(e,t){this.inputContainers=[],this.inputs=[],this.formLabels=[],e.forEach((i,n)=>{const a=P(10,(t?31:5)+20*n,i.label.length>25&&this.getWidth()<200?i.label.slice(0,20)+"...":i.label,A.TOOLTIP_CONTENT);a.name="formLabel"+n,this.formLabels.push(a),this.modalContainer.add(this.formLabels[this.formLabels.length-1]);const r=a.width<320?80:80-(a.width-320)/5.5,o=s.add.container(70+(80-r),(t?28:2)+20*n);o.setVisible(!1);const l=ye(0,0,r,16,!1,!1,0,0,is.XTHIN),h=i?.isPassword,u=i?.isReadOnly,p=Xm(4,-2,r*5.5,116,A.TOOLTIP_CONTENT,{type:h?"password":"text",maxLength:h?64:20,readOnly:u});p.setOrigin(0,0),o.add(l),o.add(p),this.inputContainers.push(o),this.modalContainer.add(o),this.inputs.push(p)})}show(e){if(super.show(e)){this.inputContainers.map(n=>n.setVisible(!0));const t=e[0];this.submitAction=t.buttonActions.length?t.buttonActions[0]:null,this.cancelAction=t.buttonActions[1]??null,this.buttonBgs[0].off("pointerdown"),this.buttonBgs[0].on("pointerdown",()=>{this.submitAction&&s.tweens.getTweensOf(this.modalContainer).length===0&&this.submitAction()});const i=this.buttonBgs[1];return i&&(i.off("pointerdown"),i.on("pointerdown",()=>{this.cancelAction&&s.tweens.getTweensOf(this.modalContainer).length===0&&this.cancelAction()})),this.modalContainer.y+=24,this.modalContainer.setAlpha(0),this.tween=s.tweens.add({targets:this.modalContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),!0}return!1}processInput(e){return e===v.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}sanitizeInputs(){for(const e of this.inputs)e.text=e.text.trim()}updateContainer(e){super.updateContainer(e),this.errorMessage.setText(this.getReadableErrorMessage(e?.errorMessage||"")),this.errorMessage.setVisible(!!this.errorMessage.text)}clear(){super.clear(),this.modalContainer.setVisible(!1),this.inputContainers.map(e=>e.setVisible(!1)),this.submitAction=null,this.tween&&this.tween.remove()}};c(dd,"FormModalUiHandler");let As=dd;const pd=class pd extends As{adminMode;adminResult;config;buttonGap=10;httpUserNotFoundErrorCode=404;ERR_REQUIRED_FIELD=c(e=>e==="username"?`${wi(e)} is required`:`${wi(e)} Id is required`,"ERR_REQUIRED_FIELD");SUCCESS_SERVICE_MODE=c((e,t)=>`Username and ${e} successfully ${t.toLowerCase()}ed`,"SUCCESS_SERVICE_MODE");constructor(e=null){super(e)}getModalTitle(){return"Admin panel"}getWidth(){return this.adminMode===2?180:160}getMargin(){return[0,0,0,0]}getButtonLabels(){switch(this.adminMode){case 0:return["Link Account","Cancel"];case 1:return["Find account","Cancel"];case 2:return["Back to search","Cancel"];default:return["Activate ADMIN","Cancel"]}}getInputFieldConfigs(){const e=[];switch(this.adminMode){case 0:e.push({label:"Username"}),e.push({label:"Discord ID"});break;case 1:e.push({label:"Username"});break;case 2:{const t=this.adminResult??{discordId:"",googleId:""};e.push({label:"Username",isReadOnly:!0}),e.push({label:"Discord ID",isReadOnly:t.discordId!==""}),e.push({label:"Google ID",isReadOnly:t.googleId!==""}),e.push({label:"Last played",isReadOnly:!0}),e.push({label:"Registered",isReadOnly:!0});break}}return e}processInput(e){return e===v.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}show(e){this.config=e[0],this.adminMode=e[1],this.adminResult=e[2]??{username:"",discordId:"",googleId:"",lastLoggedIn:"",registered:""};const t=e[3],i=this.getInputFieldConfigs(),n=!!this.getModalTitle();this.updateFields(i,n),this.updateContainer(this.config);const a=this.getButtonLabels();for(let r=0;r<a.length;r++)this.buttonLabels[r].setText(a[r]);if(this.errorMessage.setPosition(10,(n?31:5)+20*(i.length-1)+16+this.getButtonTopMargin()),t?(this.errorMessage.setColor(this.getTextColor(A.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(A.SUMMARY_PINK,!0))):(this.errorMessage.setColor(this.getTextColor(A.SUMMARY_GREEN)),this.errorMessage.setShadowColor(this.getTextColor(A.SUMMARY_GREEN,!0))),super.show(e)){this.populateFields(this.adminMode,this.adminResult);const r=this.submitAction;return this.submitAction=o=>{this.submitAction=r;const l=this.convertInputsToAdmin(),h=this.areFieldsValid(this.adminMode);if(h.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",l,!0);s.ui.setMode(x.LOADING,{buttonActions:[]}),this.adminMode===0?this.adminLinkUnlink(l,"discord","Link").then(u=>u.error?this.showMessage(u.errorType,l,!0):this.showMessage(this.SUCCESS_SERVICE_MODE("discord","link"),l,!1)):this.adminMode===1?this.adminSearch(l).then(u=>{if(u.error)return this.showMessage(u.errorType,l,!0);this.updateAdminPanelInfo(u.adminSearchResult??l)}):this.adminMode===2&&this.updateAdminPanelInfo(l,1)},!0}return!1}showMessage(e,t,i){s.ui.setMode(x.ADMIN,Object.assign(this.config,{errorMessage:e?.trim()}),this.adminMode,t,i),i?s.ui.playError():s.ui.playSelect()}populateFields(e,t){switch(e){case 0:this.inputs[0].setText(t.username),this.inputs[1].setText(t.discordId);break;case 1:this.inputs[0].setText(t.username);break;case 2:Object.keys(t).forEach((i,n)=>{if(this.inputs[n].setText(t[i]),i==="discordId"||i==="googleId"){const a=this.inputContainers[n].list.find(o=>o.type==="NineSlice"),r=s.add.image(this.inputContainers[n].x+a.width+this.buttonGap,this.inputContainers[n].y+Math.floor(a.height/2),t[i]===""?"link_icon":"unlink_icon");r.setName(`adminBtn_${i}`),r.setOrigin(.5,.5),r.setInteractive(),r.on("pointerdown",()=>{const o=i.toLowerCase().replace("id",""),l=t[i]===""?"Link":"Unlink",h=this.areFieldsValid(this.adminMode,o);if(h.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",t,!0);this.adminLinkUnlink(this.convertInputsToAdmin(),o,l).then(u=>{if(u.error)return s.ui.setMode(x.LOADING,{buttonActions:[]}),this.showMessage(u.errorType,t,!0);s.ui.setMode(x.LOADING,{buttonActions:[]}),this.adminSearch(t).then(p=>p.error?this.showMessage(p.errorType,t,!0):this.showMessage(this.SUCCESS_SERVICE_MODE(o,l),p.adminSearchResult??t,!1))})}),this.addInteractionHoverEffect(r),this.modalContainer.add(r)}});break}}areFieldsValid(e,t){switch(e){case 0:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};if(!this.inputs[1].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("discord")};break;case 1:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};break;case 2:if(!this.inputs[1].text&&t==="discord")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};if(!this.inputs[2].text&&t==="google")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};break}return{error:!1}}convertInputsToAdmin(){return{username:this.inputs[0]?.node?this.inputs[0].text:"",discordId:this.inputs[1]?.node?this.inputs[1]?.text:"",googleId:this.inputs[2]?.node?this.inputs[2]?.text:"",lastLoggedIn:this.inputs[3]?.node?this.inputs[3]?.text:"",registered:this.inputs[4]?.node?this.inputs[4]?.text:""}}async adminSearch(e){try{const[t,i]=await nt.admin.searchAccount({username:e.username});return i||!t?{adminSearchResult:e,error:!0,errorType:i}:{adminSearchResult:t,error:!1}}catch(t){return console.error(t),{error:!0,errorType:t}}}async adminLinkUnlink(e,t,i){try{let n=null;return t==="discord"?i==="Link"?n=await nt.admin.linkAccountToDiscord({discordId:e.discordId,username:e.username}):i==="Unlink"?n=await nt.admin.unlinkAccountFromDiscord({discordId:e.discordId,username:e.username}):console.warn("Unknown mode",i,"for service",t):t==="google"?i==="Link"?n=await nt.admin.linkAccountToGoogleId({googleId:e.googleId,username:e.username}):i==="Unlink"?n=await nt.admin.unlinkAccountFromGoogleId({googleId:e.googleId,username:e.username}):console.warn("Unknown mode",i,"for service",t):console.warn("Unknown service",t),n?{adminSearchResult:e,error:!0,errorType:n}:{adminSearchResult:e,error:!1}}catch(n){return console.error(n),{error:!0,errorType:n}}}updateAdminPanelInfo(e,t){t=t??2,s.ui.setMode(x.ADMIN,{buttonActions:[()=>{s.ui.revertMode(),s.ui.revertMode()},()=>{s.ui.revertMode(),s.ui.revertMode()}]},t,e)}clear(){super.clear();const e=["formLabel","adminBtn"],t=[],i=this.modalContainer.list;for(let n=i.length-1;n>=0;n--)(e.some(a=>i[n].name.includes(a))||i[n].type==="Container"&&i[n].list.find(a=>a.type==="rexInputText"))&&t.push(i[n]);for(;t.length>0;)this.modalContainer.remove(t.pop(),!0)}};c(pd,"AdminUiHandler");let Ml=pd;var Nl=(C=>(C[C.LINK=0]="LINK",C[C.SEARCH=1]="SEARCH",C[C.ADMIN=2]="ADMIN",C))(Nl||{});function uS(C){switch(C){case 0:return"Link";case 1:return"Search";default:return""}}c(uS,"getAdminModeName");const fd=class fd extends $p{modalContainer;constructor(e=x.OPTION_SELECT){super(e)}getWindowWidth(){return 64}show(e){if(e[0].modalContainer){const{modalContainer:t}=e[0],i=super.show(e);return this.modalContainer=t,this.setupOptions(),i}return!1}setupOptions(){super.setupOptions(),this.modalContainer&&(this.optionSelectContainer.setSize(this.optionSelectContainer.height,Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth())),this.optionSelectContainer.setPositionRelative(this.modalContainer,this.optionSelectBg.width,this.optionSelectBg.height+50))}processInput(e){return e!==v.CANCEL&&e!==v.ACTION?super.processInput(e):!1}};c(fd,"AutoCompleteUiHandler");let kl=fd;const gd=class gd extends Bt{levelUpStatsContainer;levelUpStatsIncrContent;levelUpStatsValuesContent;nameBox;nameText;bg;commandWindow;movesWindowContainer;nameBoxContainer;wordWrapWidth=1780;constructor(){super(x.MESSAGE)}setup(){const e=this.getUi();this.textTimer=null,this.textCallbackTimer=null,this.bg=s.add.sprite(0,0,"bg",s.windowType),this.bg.setName("sprite-battle-msg-bg"),this.bg.setOrigin(0,1),e.add(this.bg),this.commandWindow=ye(202,0,118,48),this.commandWindow.setName("window-command"),this.commandWindow.setOrigin(0,1),this.commandWindow.setVisible(!1),e.add(this.commandWindow),this.movesWindowContainer=s.add.container(0,0),this.movesWindowContainer.setName("moves-bg"),this.movesWindowContainer.setVisible(!1);const t=ye(0,0,243,48);t.setName("moves-window"),t.setOrigin(0,1);const i=ye(240,0,80,48,!1,!1,-1,132);i.setName("move-details-window"),i.setOrigin(0,1),this.movesWindowContainer.add([t,i]),e.add(this.movesWindowContainer);const n=s.add.container(12,-39);e.add(n);const a=P(0,0,"",A.MESSAGE,{maxLines:2,wordWrap:{width:this.wordWrapWidth}});n.add(a),this.message=a,this.nameBoxContainer=s.add.container(0,-16),this.nameBoxContainer.setVisible(!1),this.nameBox=s.add.nineslice(0,0,"namebox",s.windowType,72,16,8,8,5,5),this.nameBox.setOrigin(0,0),this.nameText=P(8,0,"Rival",A.MESSAGE,{maxLines:1}),this.nameBoxContainer.add(this.nameBox),this.nameBoxContainer.add(this.nameText),n.add(this.nameBoxContainer),this.initPromptSprite(n);const r=s.add.container(0,0);r.setVisible(!1),e.add(r),this.levelUpStatsContainer=r;const o=P(s.scaledCanvas.width-73,-94,"",A.WINDOW,{maxLines:6});let l="";for(const f of Xi)l+=`${m.t(Xp(f))}
`;o.text=l,o.x-=o.displayWidth;const h=ye(s.scaledCanvas.width,-100,80+o.displayWidth,100);h.setOrigin(1,0),r.add(h),r.add(o);const u=P(s.scaledCanvas.width-50,-94,`+
+
+
+
+
+`,A.WINDOW,{maxLines:6});r.add(u),this.levelUpStatsIncrContent=u;const p=St(s.scaledCanvas.width-7,-94,"",A.WINDOW,{maxLines:6,lineSpacing:5});p.setOrigin(1,0),p.setAlign("right"),r.add(p),this.levelUpStatsValuesContent=p}show(e){return super.show(e),this.commandWindow.setVisible(!1),this.movesWindowContainer.setVisible(!1),this.message.setWordWrapWidth(this.wordWrapWidth),!0}processInput(e){const t=this.getUi();if(this.awaitingActionInput&&(e===v.CANCEL||e===v.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}clear(){super.clear()}showText(e,t,i,n,a,r){this.hideNameText(),super.showText(e,t,i,n,a,r)}showDialogue(e,t,i,n,a,r,o){t&&this.showNameText(t),super.showDialogue(e,t,i,n,a,r,o)}promptLevelUpStats(e,t,i){return new Promise(n=>{if(!s.showLevelUpStats)return n();const a=s.getPlayerParty()[e].stats;let r="";for(const o of Xi)r+=`${i?a[o]:a[o]-t[o]}
`;this.levelUpStatsValuesContent.text=r,this.levelUpStatsIncrContent.setVisible(!i),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{if(!i)return this.promptLevelUpStats(e,[],!0).then(()=>n());this.levelUpStatsContainer.setVisible(!1),n()}})}promptIvs(e,t){return new Promise(i=>{s.executeWithSeedOffset(()=>{let n="";for(const a of Xi)n+=`${this.getIvDescriptor(t[a],a,e)}
`;this.levelUpStatsValuesContent.text=n,this.levelUpStatsIncrContent.setVisible(!1),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{this.levelUpStatsContainer.setVisible(!1),i()}},e)})}getIvDescriptor(e,t,i){const n=s.getPokemonById(i).species.getRootSpeciesId(),a=s.gameData.dexData[n].ivs,r=s.uiTheme,o=c((l,h,u)=>{let p;return h?u===31?p=A.PERFECT_IV:p=A.SUMMARY_GREEN:p=A.WINDOW,`[color=${He(p,!1,r)}][shadow=${He(p,!0,r)}]${l}[/shadow][/color]`},"coloredText");return e>30?o(m.t("battleMessageUiHandler:ivBest"),e>a[t],e):e===30?o(m.t("battleMessageUiHandler:ivFantastic"),e>a[t],e):e>20?o(m.t("battleMessageUiHandler:ivVeryGood"),e>a[t],e):e>10?o(m.t("battleMessageUiHandler:ivPrettyGood"),e>a[t],e):e>0?o(m.t("battleMessageUiHandler:ivDecent"),e>a[t],e):o(m.t("battleMessageUiHandler:ivNoGood"),e>a[t],e)}showNameText(e){this.nameBoxContainer.setVisible(!0),this.nameText.setText(e),this.nameBox.width=this.nameText.displayWidth+16}hideNameText(){this.nameBoxContainer.setVisible(!1)}};c(gd,"BattleMessageUiHandler");let Pl=gd;const md=class md extends zs{challengesContainer;valuesContainer;scrollCursor;optionsBg;descriptionText;challengeLabels;monoTypeValue;cursorObj;startBg;startCursor;startText;hasSelectedChallenge;optionsWidth;widestTextBox;leftArrowGap=90;arrowSpacing=3;constructor(e=null){super(e)}setup(){const e=this.getUi();this.widestTextBox=0,this.challengesContainer=s.add.container(1,-s.scaledCanvas.height+1),this.challengesContainer.setName("challenges"),this.challengesContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains);const t=s.add.rectangle(-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,4342338,.8);t.setName("rect-challenge-overlay"),t.setOrigin(0,0),this.challengesContainer.add(t);const i=ye(0,0,s.scaledCanvas.width,24);i.setName("window-header-bg"),i.setOrigin(0,0);const n=P(0,0,m.t("challenges:title"),A.HEADER_LABEL);n.setName("text-header"),n.setOrigin(0,0),n.setPositionRelative(i,8,4),this.optionsWidth=s.scaledCanvas.width*.6,this.optionsBg=ye(0,i.height,this.optionsWidth,s.scaledCanvas.height-i.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const a=ye(0,i.height,s.scaledCanvas.width-this.optionsWidth,s.scaledCanvas.height-i.height-26);a.setName("window-desc-bg"),a.setOrigin(0,0),a.setPositionRelative(this.optionsBg,this.optionsBg.width,0),this.descriptionText=new nT(s,a.x+6,a.y+4,"",{fontFamily:"emerald",fontSize:84,color:dp.ORANGE,padding:{bottom:6},wrap:{mode:"word",width:(a.width-12)*6}}),this.descriptionText.setName("text-desc"),s.add.existing(this.descriptionText),this.descriptionText.setScale(1/6),this.descriptionText.setShadow(4,5,pp.ORANGE),this.descriptionText.setOrigin(0,0),this.startBg=ye(0,0,a.width,24),this.startBg.setName("window-start-bg"),this.startBg.setOrigin(0,0),this.startBg.setPositionRelative(a,0,a.height),this.startText=P(0,0,m.t("challenges:noneSelected"),A.SETTINGS_LABEL),this.startText.setName("text-start"),this.startText.setOrigin(0,0),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4),this.startCursor=s.add.nineslice(0,0,"summary_moves_cursor",void 0,a.width-8,16,1,1,1,1),this.startCursor.setName("9s-start-cursor"),this.startCursor.setOrigin(0,0),this.startCursor.setPositionRelative(this.startBg,4,3),this.startCursor.setVisible(!1),this.valuesContainer=s.add.container(0,0),this.valuesContainer.setName("values"),this.challengeLabels=[];for(let r=0;r<9;r++){const o=P(8,28+r*16,"",A.SETTINGS_LABEL);o.setName(`text-challenge-label-${r}`),o.setOrigin(0,0),this.valuesContainer.add(o);const l=s.add.image(0,0,"cursor_reverse");l.setName(`challenge-left-arrow-${r}`),l.setOrigin(0,0),l.setVisible(!1),l.setScale(.75),this.valuesContainer.add(l);const h=s.add.image(0,0,"cursor");h.setName(`challenge-right-arrow-${r}`),h.setOrigin(0,0),h.setScale(.75),h.setVisible(!1),this.valuesContainer.add(h);const u=P(0,28+r*16,"",A.SETTINGS_LABEL);u.setName(`challenge-value-text-${r}`),u.setPositionRelative(o,100,0),this.valuesContainer.add(u),this.challengeLabels[r]={label:o,value:u,leftArrow:l,rightArrow:h}}this.monoTypeValue=s.add.sprite(8,98,Ns("types")),this.monoTypeValue.setName("challenge-value-monotype-sprite"),this.monoTypeValue.setScale(.86),this.monoTypeValue.setVisible(!1),this.valuesContainer.add(this.monoTypeValue),this.challengesContainer.add(i),this.challengesContainer.add(n),this.challengesContainer.add(this.optionsBg),this.challengesContainer.add(a),this.challengesContainer.add(this.descriptionText),this.challengesContainer.add(this.startBg),this.challengesContainer.add(this.startText),this.challengesContainer.add(this.startCursor),this.challengesContainer.add(this.valuesContainer),e.add(this.challengesContainer),this.setCursor(0),this.setScrollCursor(0),this.challengesContainer.setVisible(!1)}setDescription(e){this.descriptionText.setText(`[color=${dp.ORANGE}][shadow=${pp.ORANGE}]${e}`)}initLabels(){this.setDescription(s.gameMode.challenges[0].getDescription()),this.widestTextBox=0;for(let e=0;e<9;e++)if(e<s.gameMode.challenges.length){this.challengeLabels[e].label.setVisible(!0),this.challengeLabels[e].value.setVisible(!0),this.challengeLabels[e].leftArrow.setVisible(!0),this.challengeLabels[e].rightArrow.setVisible(!0);const t=P(0,0,"",A.SETTINGS_LABEL);for(let i=0;i<=s.gameMode.challenges[e].maxValue;i++)s.gameMode.challenges[e].id!==xt.SINGLE_TYPE&&(t.setText(s.gameMode.challenges[e].getValue(i)),t.displayWidth>this.widestTextBox&&(this.widestTextBox=t.displayWidth));t.destroy()}}updateText(){this.setDescription(this.getActiveChallenge().getDescription());let e=!1;for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=s.gameMode.challenges[this.scrollCursor+t],n=this.challengeLabels[t];n.label.setText(i.getName()),n.leftArrow.setPositionRelative(n.label,this.leftArrowGap,4.5),n.leftArrow.setVisible(i.value!==0),n.rightArrow.setPositionRelative(n.leftArrow,Math.max(this.monoTypeValue.width,this.widestTextBox)+n.leftArrow.displayWidth+2*this.arrowSpacing,0),n.rightArrow.setVisible(i.value!==i.maxValue),n.rightArrow.x+n.rightArrow.width+this.optionsBg.rightWidth+this.arrowSpacing>this.optionsWidth&&n.rightArrow.setX(this.optionsWidth-this.arrowSpacing-this.optionsBg.rightWidth);const a=Math.round((n.leftArrow.x+n.rightArrow.x+n.leftArrow.displayWidth)/2);i.id===xt.SINGLE_TYPE?(this.monoTypeValue.setX(a),this.monoTypeValue.setY(n.label.y+8),this.monoTypeValue.setFrame(i.getValue()),this.monoTypeValue.setVisible(!0),n.value.setVisible(!1),e=!0):(n.value.setText(i.getValue()),n.value.setX(a),n.value.setOrigin(.5,0),n.value.setVisible(!0))}e||this.monoTypeValue.setVisible(!1),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.hasSelectedChallenge?(this.startText.setText(m.t("common:start")),this.startText.setAlpha(1),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)):(this.startText.setText(m.t("challenges:noneSelected")),this.startText.setAlpha(.5),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)),this.challengesContainer.update()}show(e){return super.show(e),this.startCursor.setVisible(!1),this.updateChallengeArrows(!1),this.challengesContainer.setVisible(!0),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.setCursor(0),this.initLabels(),this.updateText(),this.getUi().moveTo(this.challengesContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}updateChallengeArrows(e){for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=this.challengeLabels[t];e?(i.leftArrow.setTint(8421504),i.rightArrow.setTint(8421504)):(i.leftArrow.clearTint(),i.rightArrow.clearTint())}}processInput(e){const t=this.getUi(),i=9;let n=!1;if(e===v.CANCEL)this.startCursor.visible?(this.startCursor.setVisible(!1),this.cursorObj?.setVisible(!0),this.updateChallengeArrows(this.startCursor.visible)):(s.phaseManager.toTitleScreen(),s.phaseManager.getCurrentPhase()?.end()),n=!0;else if(e===v.SUBMIT||e===v.ACTION)this.hasSelectedChallenge?(this.startCursor.visible?(s.phaseManager.unshiftNew("SelectStarterPhase"),s.phaseManager.getCurrentPhase()?.end()):(this.startCursor.setVisible(!0),this.cursorObj?.setVisible(!1),this.updateChallengeArrows(this.startCursor.visible)),n=!0):n=!1;else if(this.cursorObj?.visible&&!this.startCursor.visible)switch(e){case v.UP:if(this.cursor===0)if(this.scrollCursor===0)if(s.gameMode.challenges.length>i){const a=this.setCursor(i-1),r=this.setScrollCursor(s.gameMode.challenges.length-i);n=a&&r}else n=this.setCursor(s.gameMode.challenges.length-1);else n=this.setScrollCursor(this.scrollCursor-1);else n=this.setCursor(this.cursor-1);n&&this.updateText();break;case v.DOWN:if(this.cursor===i-1)if(this.scrollCursor<s.gameMode.challenges.length-i)n=this.setScrollCursor(this.scrollCursor+1);else{const a=this.setCursor(0),r=this.setScrollCursor(0);n=a&&r}else s.gameMode.challenges.length<i&&this.cursor===s.gameMode.challenges.length-1?n=this.setCursor(0):n=this.setCursor(this.cursor+1);n&&this.updateText();break;case v.LEFT:n=this.getActiveChallenge().decreaseValue(),n&&this.updateText();break;case v.RIGHT:n=this.getActiveChallenge().increaseValue(),n&&this.updateText();break}return n&&t.playSelect(),n}setCursor(e){let t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,this.optionsWidth-8,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.valuesContainer.add(this.cursorObj)),t||=!this.cursorObj.visible,this.cursorObj.setVisible(!0),this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.setCursor(this.cursor),!0)}getActiveChallenge(){return s.gameMode.challenges[this.cursor+this.scrollCursor]}clear(){super.clear(),this.challengesContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};c(md,"GameChallengesUiHandler");let Bl=md;const yd=class yd extends As{ERR_PASSWORD="invalid password";ERR_ACCOUNT_EXIST="account doesn't exist";ERR_PASSWORD_MISMATCH="password doesn't match";constructor(e=null){super(e)}setup(){super.setup()}getModalTitle(e){return m.t("menu:changePassword")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[m.t("settings:buttonSubmit"),m.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case this.ERR_PASSWORD:return m.t("menu:invalidRegisterPassword");case this.ERR_ACCOUNT_EXIST:return m.t("menu:accountNonExistent");case this.ERR_PASSWORD_MISMATCH:return m.t("menu:passwordNotMatchingConfirmPassword")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:m.t("menu:password"),isPassword:!0}),e.push({label:m.t("menu:confirmPassword"),isPassword:!0}),e}show(e){if(super.show(e)){const t=e[0],i=this.submitAction;this.submitAction=()=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const a=c(l=>{s.ui.setMode(x.CHANGE_PASSWORD_FORM,Object.assign(t,{errorMessage:l?.trim()})),s.ui.playError()},"onFail"),[r,o]=this.inputs;if(!r?.text)return a(this.getReadableErrorMessage("invalid password"));if(r.text!==o.text)return a(this.ERR_PASSWORD_MISMATCH);nt.account.changePassword({password:r.text}).then(l=>{if(!l&&i){s.ui.playSelect(),i();for(const h of this.inputs)h.setText("")}else a(l)})}};const n=this.cancelAction;return this.cancelAction=()=>{s.ui.playSelect();for(const a of this.inputs)a.setText("");n?.()},!0}return!1}clear(){super.clear(),this.setMouseCursorStyle("default")}};c(yd,"ChangePasswordFormUiHandler");let Ll=yd;const Va=class Va extends Bt{eggGachaContainer;eggGachaMessageBox;eggGachaOptionsContainer;eggGachaOptionSelectBg;gachaContainers;gachaKnobs;gachaHatches;gachaInfoContainers;eggGachaOverlay;eggGachaSummaryContainer;voucherCountLabels;gachaCursor;cursorObj;transitioning;transitionCancelled;summaryFinished;defaultText;eggDropTweenChain;scale=.1666666667;legendaryExpiration=P(0,0,"",A.WINDOW_ALT);playTimeTimer;constructor(){super(x.EGG_GACHA),this.gachaContainers=[],this.gachaKnobs=[],this.gachaHatches=[],this.gachaInfoContainers=[],this.voucherCountLabels=[],this.defaultText=m.t("egg:selectMachine")}setupGachaType(e,t){const i=e.toLowerCase(),n=s.add.container(180*t,18),a=s.add.sprite(0,0,`gacha_${i}`).setOrigin(0),r=s.add.sprite(115,80,`gacha_underlay_${i}`).setOrigin(0),o=s.add.sprite(0,0,"gacha_eggs").setOrigin(0),l=s.add.sprite(0,0,"gacha_glass").setOrigin(0),h=s.add.container(160,46),u=m.resolvedLanguage??"en";let p=A.WINDOW_ALT,f=4,d=0,y=-20,g=6;["de","es-ES","es-MX","fr","ko","pt-BR","ja","ru"].includes(u)&&(p=A.SMALLER_WINDOW_ALT,f=2,d=2);let T=f,E=d;["de","es-ES","es-MX"].includes(u)&&(y=-25,g=10,T=-6,E=0);const b=P(f,d,m.t("egg:legendaryUPGacha"),p).setOrigin(0);switch(h.add(b),t){case Xs.LEGENDARY:{["de","es-ES"].includes(u)&&b.setAlign("center");let w=0;const U=s.add.sprite(y,g,"pokemon_icons_0");["pt-BR"].includes(u)&&(w=2,U.setX(y-2)),b.setX(T-w).setY(E),U.setScale(.5).setOrigin(0,.5),h.add(U)}break;case Xs.MOVE:["de","es-ES","fr","pt-BR","ru"].includes(u)&&b.setAlign("center").setY(0),b.setText(m.t("egg:moveUPGacha")).setX(0).setOrigin(.5,0);break;case Xs.SHINY:["de","fr","ko","ru"].includes(u)&&b.setAlign("center").setY(0),b.setText(m.t("egg:shinyUPGacha")).setX(0).setOrigin(.5,0);break}const _=s.add.sprite(191,89,"gacha_knob"),O=s.add.sprite(115,73,"gacha_hatch");O.setOrigin(0).setAlpha(.9),l.setAlpha(.5),n.add([o,r,a,l,_,O,h]),O.on("animationupdate",(w,U)=>r.setFrame(U.textureFrame==="4.png"?"open_hatch":"default")),this.gachaContainers.push(n),this.gachaKnobs.push(_),this.gachaHatches.push(O),this.gachaInfoContainers.push(h),this.eggGachaContainer.add(n),t===Xs.LEGENDARY&&(this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft()).setFontSize("64px").setPositionRelative(a,a.width/2-this.legendaryExpiration.displayWidth/2+.3,a.height/2+12.5),n.add(this.legendaryExpiration),this.updateLegendaryGacha())}setup(){this.gachaCursor=0,this.scale=gh(A.WINDOW,s.uiTheme).scale;const e=this.getUi();this.eggGachaContainer=s.add.container(0,-s.scaledCanvas.height).setVisible(!1),e.add(this.eggGachaContainer);const t=s.add.nineslice(0,0,"default_bg",void 0,320,180,0,0,16,0).setOrigin(0);this.eggGachaContainer.add(t);const i=s.anims.generateFrameNames("gacha_hatch",{suffix:".png",start:1,end:4});s.anims.exists("open")||s.anims.create({key:"open",frames:i,frameRate:12}),s.anims.exists("close")||s.anims.create({key:"close",frames:i.reverse(),frameRate:12});for(const[y,g]of Object.entries(Xs))this.setupGachaType(y,g);let n=0;switch(m.resolvedLanguage){case"ru":n=100;break;default:n=96}this.eggGachaOptionSelectBg=ye(0,0,n,16+576*this.scale).setOrigin(1),this.eggGachaOptionsContainer=s.add.container(s.scaledCanvas.width,148).add(this.eggGachaOptionSelectBg),this.eggGachaContainer.add(this.eggGachaOptionsContainer);const a="x1",o=[{multiplier:a,description:`1 ${m.t("egg:pull")}`,icon:qs(At.REGULAR)},{multiplier:"x10",description:`10 ${m.t("egg:pulls")}`,icon:qs(At.REGULAR)},{multiplier:a,description:`5 ${m.t("egg:pulls")}`,icon:qs(At.PLUS)},{multiplier:a,description:`10 ${m.t("egg:pulls")}`,icon:qs(At.PREMIUM)},{multiplier:a,description:`25 ${m.t("egg:pulls")}`,icon:qs(At.GOLDEN)}],l=m.resolvedLanguage??"en",h=o.map(y=>{const g=y.description.split(" ");return g[0].length<2&&(g[0]+=["zh","ko"].includes(l.substring(0,2))?" ":"  "),y.multiplier===a&&(g[0]+=" "),`     ${y.multiplier.padEnd(5)}${g.join(" ")}`}).join(`
`),u=P(0,0,`${h}
${m.t("menu:cancel")}`,A.WINDOW).setLineSpacing(28).setFontSize("80px").setPositionRelative(this.eggGachaOptionSelectBg,16,9);this.eggGachaOptionsContainer.add(u),o.forEach((y,g)=>{const T=s.add.sprite(0,0,"items",y.icon).setScale(3*this.scale).setPositionRelative(this.eggGachaOptionSelectBg,20,9+(48+g*96)*this.scale);this.eggGachaOptionsContainer.add(T)}),this.eggGachaContainer.add(this.eggGachaOptionsContainer);for(const y of Is(At)){const g=s.add.container(s.scaledCanvas.width-56*y,0),T=ye(0,0,56,22).setOrigin(1,0);g.add(T);const E=P(-48,3,"0",A.WINDOW).setOrigin(0);g.add(E),this.voucherCountLabels.push(E);const b=qs(y),_=s.add.sprite(-19,2,"items",b).setOrigin(0).setScale(.5);g.add(_),this.eggGachaContainer.add(g)}this.eggGachaOverlay=s.add.rectangle(0,0,t.displayWidth,t.displayHeight,0).setOrigin(0).setAlpha(0),this.eggGachaContainer.add(this.eggGachaOverlay),this.eggGachaSummaryContainer=s.add.container().setVisible(!1),this.eggGachaContainer.add(this.eggGachaSummaryContainer);const p=ye(0,0,320,32).setOrigin(0),f=s.add.container(0,148).add(p);this.eggGachaMessageBox=p;const d=P(8,8,"",A.WINDOW,{maxLines:2}).setOrigin(0);f.add(d),this.message=d,this.initTutorialOverlay(this.eggGachaContainer),this.eggGachaContainer.add(f),this.initPromptSprite(f),this.setCursor(0)}show(e){return super.show(e),this.getUi().showText(this.defaultText,0),this.setGachaCursor(1),this.updateLegendaryGacha(),this.updateVoucherCounts(),this.getUi().bringToTop(this.eggGachaContainer),this.eggGachaContainer.setActive(!0).setVisible(!0),Oi(ws.Egg_Gacha),this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft()),this.legendaryGachaTimer(),!0}getDelayValue(e){return this.transitioning&&this.transitionCancelled&&(e=Math.ceil(e/5)),ge(e)}firstDropAnims(){return s.playSound("se/gacha_dial"),[{targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:90,ease:"Cubic.easeInOut"},{targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:0,ease:"Sine.easeInOut"},{targets:{dummy:0},dummy:1,duration:this.getDelayValue(350),onStart:c(()=>{s.playSound("se/gacha_running",{loop:!0})},"onStart")},{delay:this.getDelayValue(1250),onStart:c(()=>{s.playSound("se/gacha_dispense")},"onStart"),targets:{dummy:0},dummy:1,duration:this.getDelayValue(750),onComplete:c(()=>{s.sound.stopByKey("se/gacha_running")},"onComplete")}]}async doPullAnim(e,t){let i;const n=this.gachaHatches[this.gachaCursor],a=t?1.25:1;t&&(n.anims.timeScale=a);const r=new Promise(l=>{i=l}),o=t?[]:this.firstDropAnims();return o.push({targets:e,duration:this.getDelayValue(350/a),y:95,ease:"Bounce.easeOut"},{onStart:c(()=>{s.playSound("se/pb_catch"),this.gachaHatches[this.gachaCursor].play("open")},"onStart"),targets:e,delay:this.getDelayValue(125/a),duration:this.getDelayValue(350/a),props:{scale:{value:.75,ease:"Sine.easeIn"},y:{value:110,ease:"Back.easeOut"}}},{onStart:c(()=>{this.gachaHatches[this.gachaCursor].play("close")},"onStart"),targets:e,y:200,duration:this.getDelayValue(350/a),ease:"Cubic.easeIn"}),this.eggDropTweenChain=s.tweens.chain({onComplete:c(()=>{this.eggDropTweenChain=void 0,n.anims.timeScale=1,i()},"onComplete"),tweens:o}),r}pullEggs(e){const t=[];for(let i=1;i<=e;i++){const n={pulled:!0,sourceType:this.gachaCursor};if(i===e){const r=this.getGuaranteedEggTierFromPullCount(e);r!==xs.COMMON&&!t.some(o=>o.tier>=r)&&(n.tier=r)}const a=new Ii(n);t.push(a)}return Cf(t)}async pull(e=0){le.EGG_GACHA_PULL_COUNT_OVERRIDE&&(e=le.EGG_GACHA_PULL_COUNT_OVERRIDE);const t=this.pullEggs(e);if(this.eggGachaOptionsContainer.setVisible(!1),this.setTransitioning(!0),!await(s.currentBattle?s.gameData.saveAll(!0,!0,!0):s.gameData.saveSystem()).then(a=>a?!0:(s.reset(!0),!1)))return;const n=this.gachaContainers[this.gachaCursor];for(let a=0;a<e&&!this.transitionCancelled;++a){const r=s.add.sprite(127,75,"egg",`egg_${t[a].getKey()}`).setScale(.5);n.addAt(r,2),await this.doPullAnim(r,a).finally(()=>n.remove(r,!0))}this.showSummary(t)}getGuaranteedEggTierFromPullCount(e){switch(e){case 10:return xs.RARE;case 25:return xs.EPIC;default:return xs.COMMON}}showSummary(e){const t=this.getDelayValue(750);this.summaryFinished=!1,this.transitionCancelled=!1,this.setTransitioning(!0),this.eggGachaSummaryContainer.setVisible(!0);const i=e.length<20?1:.5;s.tweens.add({targets:this.eggGachaOverlay,alpha:.5,ease:"Sine.easeOut",duration:t,onComplete:c(()=>{const a=Math.ceil(e.length/5),r=Math.min(e.length,5),o=this.eggGachaOverlay.displayHeight-this.eggGachaMessageBox.displayHeight;e.map((h,u)=>{const p=u%5,f=Math.floor(u/5),d=this.eggGachaOverlay.displayWidth/(r+2),y=o/(a+2),g=y/2*(f/Math.max(a-1,1))+y/4,T=s.add.container(d*(p+1)+d*.5,y*(f+1)+g);T.setScale(1e-4);const E=s.add.sprite(0,0,"egg",`egg_${h.getKey()}`);T.add(E);const b=P(0,14,h.getEggDescriptor(),A.PARTY,{align:"center"});return b.setOrigin(.5,0),b.setTint(qm(h.isManaphyEgg()?xs.EPIC:h.tier)),T.add(b),this.eggGachaSummaryContainer.addAt(T,0),T}).forEach((h,u)=>{const p=this.transitionCancelled?0:this.getDelayValue(u*100);s.time.delayedCall(p,()=>s.tweens.add({targets:h,duration:this.getDelayValue(350),scale:i,ease:"Sine.easeOut",onComplete:c(()=>{u===e.length-1&&(this.setTransitioning(!1),this.summaryFinished=!0)},"onComplete")}))})},"onComplete")})}hideSummary(){this.setTransitioning(!0),s.tweens.add({targets:[this.eggGachaOverlay,this.eggGachaSummaryContainer],alpha:0,duration:this.getDelayValue(250),ease:"Cubic.easeIn",onComplete:c(()=>{this.eggGachaSummaryContainer.setVisible(!1).setAlpha(1).removeAll(!0),this.setTransitioning(!1),this.summaryFinished=!1,this.eggGachaOptionsContainer.setVisible(!0)},"onComplete")})}updateLegendaryGacha(){const e=this.gachaInfoContainers[Xs.LEGENDARY],t=ns(Qm(Date.now()));e.getAt(1).setTexture(t.getIconAtlasKey(),t.getIconId(!1))}consumeVouchers(e,t){s.gameData.voucherCounts[e]=Math.max(s.gameData.voucherCounts[e]-t,0),this.updateVoucherCounts()}updateVoucherCounts(){this.voucherCountLabels.forEach((e,t)=>{e.setText(s.gameData.voucherCounts[t].toString())})}showText(e,t,i,n,a,r){e||(e=this.defaultText),e?.indexOf(`
`)===-1?(this.eggGachaMessageBox.setSize(320,32),this.eggGachaMessageBox.setY(0),this.message.setY(8)):(this.eggGachaMessageBox.setSize(320,46),this.eggGachaMessageBox.setY(-14),this.message.setY(-6)),super.showText(e,t,i,n,a,r)}showError(e){this.showText(e,void 0,()=>this.showText(this.defaultText),ge(1500))}setTransitioning(e){this.transitioning!==e&&(this.transitioning=e,this.transitionCancelled=!1)}static cursorToVoucher(e){switch(e){case 0:return[At.REGULAR,1,1];case 1:return[At.REGULAR,10,10];case 2:return[At.PLUS,1,5];case 3:return[At.PREMIUM,1,10];case 4:return[At.GOLDEN,1,25]}}handleVoucherSelectAction(e){if(e<0||e>5)return;const t=this.getUi(),i=Va.cursorToVoucher(e);if(!i)return t.revertMode(),!0;const[n,a,r]=i;let o;const l=le.EGG_FREE_GACHA_PULLS_OVERRIDE;return!l&&s.gameData.eggs.length+r>99?o="egg:tooManyEggs":!l&&s.gameData.voucherCounts[n]<a&&(o="egg:notEnoughVouchers"),o?(this.showError(m.t(o)),!1):(l||this.consumeVouchers(n,a),this.pull(r),!0)}processTransitionInput(e){if(!this.transitionCancelled&&(e===v.ACTION||e===v.CANCEL))return this.transitionCancelled=!0,this.eggDropTweenChain?.setTimeScale(50),!0}processNormalInput(e){const t=this.getUi();let i;switch(e){case v.ACTION:return this.handleVoucherSelectAction(this.cursor);case v.CANCEL:t.revertMode(),i=!0;break;case v.UP:this.cursor&&(i=this.setCursor(this.cursor-1));break;case v.DOWN:this.cursor<5&&(i=this.setCursor(this.cursor+1));break;case v.LEFT:this.gachaCursor&&(i=this.setGachaCursor(this.gachaCursor-1));break;case v.RIGHT:this.gachaCursor<Object.keys(Xs).length-1&&(i=this.setGachaCursor(this.gachaCursor+1));break}return i||void 0}processSummaryInput(e){if(this.summaryFinished&&(e===v.ACTION||e===v.CANCEL))return this.hideSummary(),!0}processInput(e){let t;return this.transitioning?t=this.processTransitionInput(e):this.eggGachaSummaryContainer.visible?t=this.processSummaryInput(e):t=this.processNormalInput(e),t===void 0?!1:(t?this.getUi().playSelect():this.getUi().playError(),!0)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.eggGachaOptionsContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.eggGachaOptionSelectBg,10,9+(48+this.cursor*96)*this.scale),t}setGachaCursor(e){const i=this.gachaCursor!==e;return i&&(this.gachaCursor=e,this.setTransitioning(!0),s.tweens.add({targets:this.gachaContainers,duration:this.eggGachaContainer.visible?500:0,x:c((n,a,r,o)=>180*(o-e),"x"),ease:"Cubic.easeInOut",onComplete:c(()=>this.setTransitioning(!1),"onComplete")})),i}legendaryGachaTimer(){this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null),this.playTimeTimer=s.time.addEvent({loop:!0,delay:ge(1e3),callback:c(()=>{this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft())},"callback")})}getLegendaryGachaTimeLeft(){const e=864e5-Date.now()%864e5,t=`${Math.floor(e/36e5)}`,i=`${Math.floor(e%36e5/6e4)}`,n=`${Math.floor(e%6e4/1e3)}`;return`${t.padStart(2,"0")}:${i.padStart(2,"0")}:${n.padStart(2,"0")}`}clear(){super.clear(),this.setGachaCursor(-1),this.eggGachaContainer.setVisible(!1),this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null),this.eggGachaContainer.setActive(!1)}};c(Va,"EggGachaUiHandler");let Dl=Va;const Td=class Td extends zs{eggHatchContainer;eventTarget=new EventTarget;constructor(){super(x.EGG_HATCH_SCENE)}setup(){this.eggHatchContainer=s.add.container(0,-s.scaledCanvas.height),s.fieldUI.add(this.eggHatchContainer);const e=s.anims.generateFrameNames("egg_lightrays",{start:0,end:3});s.anims.exists("egg_lightrays")||s.anims.create({key:"egg_lightrays",frames:e,frameRate:32})}show(e){return super.show(e),this.getUi().showText("",0),s.setModifiersVisible(!1),!0}processInput(e){if(e===v.ACTION||e===v.CANCEL){const t=s.phaseManager.getCurrentPhase();if(t?.is("EggHatchPhase")&&t.trySkip())return!0}return s.ui.getMessageHandler().processInput(e)}setCursor(e){return!1}clear(){super.clear(),this.eggHatchContainer.removeAll(!0),this.getUi().hideTooltip()}};c(Td,"EggHatchSceneHandler");let Rl=Td;const Sd=class Sd{ROWS;COLUMNS;handler;totalElements;cursor;scrollCursor;scrollBar;updateGridCallback;updateDetailsCallback;constructor(e,t,i){this.handler=e,this.ROWS=t,this.COLUMNS=i,this.scrollCursor=0,this.cursor=0,this.totalElements=t*i}withScrollBar(e){return this.scrollBar=e,this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this}withUpdateGridCallBack(e){return this.updateGridCallback=e,this}withUpdateSingleElementCallback(e){return this.updateDetailsCallback=e,this}setTotalElements(e){this.totalElements=e,this.scrollBar&&this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this.setScrollCursor(0)}getItemOffset(){return this.scrollCursor*this.COLUMNS}processInput(e){let t=!1;const i=Math.min(this.ROWS,Math.ceil(this.totalElements/this.COLUMNS)),n=Math.max(0,Math.ceil(this.totalElements/this.COLUMNS)-i),a=Math.floor(this.cursor/this.COLUMNS),r=this.cursor%this.COLUMNS,o=this.scrollCursor*this.COLUMNS,l=Math.min(this.totalElements-1,this.totalElements-n*this.COLUMNS-1);switch(e){case v.UP:if(a>0)t=this.setCursor(this.cursor-this.COLUMNS);else if(this.scrollCursor>0)t=this.setScrollCursor(this.scrollCursor-1);else{let h=this.cursor+(i-1)*this.COLUMNS;h>l&&(h-=this.COLUMNS),t=this.setScrollCursor(n,h)}break;case v.DOWN:a<i-1?t=this.setCursor(Math.min(this.cursor+this.COLUMNS,this.totalElements-o-1)):this.scrollCursor<n?t=this.setScrollCursor(this.scrollCursor+1):t=this.setScrollCursor(0,this.cursor%this.COLUMNS);break;case v.LEFT:r>0?t=this.setCursor(this.cursor-1):this.scrollCursor===n&&a===i-1?t=this.setCursor(l):t=this.setCursor(this.cursor+this.COLUMNS-1);break;case v.RIGHT:r<this.COLUMNS-1&&this.cursor+o<this.totalElements-1?t=this.setCursor(this.cursor+1):t=this.setCursor(this.cursor-r);break}return t}reset(){this.setScrollCursor(0),this.setCursor(0)}setCursor(e){return this.cursor=e,this.handler.setCursor(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;i&&(this.scrollCursor=e,this.scrollBar&&this.scrollBar.setScrollCursor(e),this.updateGridCallback&&this.updateGridCallback());let n=!1;const a=this.cursor+this.scrollCursor*this.COLUMNS;return t!==void 0?n=this.setCursor(t):a>=this.totalElements?n=this.setCursor(this.totalElements-this.scrollCursor*this.COLUMNS-1):i&&this.updateDetailsCallback&&this.updateDetailsCallback(a),i||n}};c(Sd,"ScrollableGridUiHandler");let Da=Sd;const Cd=class Cd extends Bt{ROWS=9;COLUMNS=11;eggListContainer;eggListIconContainer;eggIcons;eggSprite;eggNameText;eggDateText;eggHatchWavesText;eggGachaInfoText;eggListMessageBoxContainer;cursorObj;scrollGridHandler;iconAnimHandler;constructor(){super(x.EGG_LIST)}setup(){const e=this.getUi();this.eggListContainer=s.add.container(0,-s.scaledCanvas.height).setVisible(!1),e.add(this.eggListContainer);const t=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,26720).setOrigin(0),i=s.add.image(0,0,"egg_list_bg").setOrigin(0);this.iconAnimHandler=new ja,this.iconAnimHandler.setup(),this.eggNameText=P(8,68,"",A.SUMMARY).setOrigin(0),this.eggDateText=P(8,91,"",A.EGG_LIST),this.eggHatchWavesText=P(8,108,"",A.EGG_LIST).setWordWrapWidth(540),this.eggGachaInfoText=P(8,152,"",A.EGG_LIST).setWordWrapWidth(540),this.eggListIconContainer=s.add.container(113,5),this.cursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.eggSprite=s.add.sprite(54,37,"egg");const n=new _s(310,5,4,170,this.ROWS);this.scrollGridHandler=new Da(this,this.ROWS,this.COLUMNS).withScrollBar(n).withUpdateGridCallBack(()=>this.updateEggIcons()).withUpdateSingleElementCallback(r=>this.setEggDetails(r)),this.eggListMessageBoxContainer=s.add.container(0,s.scaledCanvas.height).setVisible(!1);const a=ye(1,-1,318,28).setOrigin(0,1);this.eggListMessageBoxContainer.add(a),this.message=P(8,-8,"",A.WINDOW,{maxLines:1}).setActive(!1).setVisible(!1),this.cursor=-1,this.eggListContainer.add([t,i,ye(1,85,106,22),ye(1,102,106,50,!0),ye(1,147,106,32,!0),ye(107,1,212,178),this.eggNameText,this.eggDateText,this.eggHatchWavesText,this.eggGachaInfoText,this.eggListIconContainer,this.cursorObj,this.eggSprite,n])}show(e){return super.show(e),this.initEggIcons(),this.getUi().bringToTop(this.eggListContainer),this.eggListContainer.setVisible(!0),this.scrollGridHandler.setTotalElements(s.gameData.eggs.length),this.updateEggIcons(),this.setCursor(0),!0}initEggIcons(){this.eggIcons=[];for(let e=0;e<Math.min(this.ROWS*this.COLUMNS,s.gameData.eggs.length);e++){const t=e%this.COLUMNS*18,i=Math.floor(e/this.COLUMNS)*18,n=s.add.sprite(t-2,i+2,"egg_icons").setScale(.5).setOrigin(0);this.eggListIconContainer.add(n),this.eggIcons.push(n)}}updateEggIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(this.eggIcons.length,s.gameData.eggs.length-e);this.eggIcons.forEach((i,n)=>{if(n!==this.cursor&&this.iconAnimHandler.addOrUpdate(i,Nt.NONE),n<t){const a=s.gameData.eggs[n+e];i.setFrame(a.getKey()).setVisible(!0)}else i.setVisible(!1)})}setEggDetails(e){const t=s.gameData.eggs[e];this.eggSprite.setFrame(`egg_${t.getKey()}`),this.eggNameText.setText(`${m.t("egg:egg")} (${t.getEggDescriptor()})`),this.eggDateText.setText(new Date(t.timestamp).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"2-digit",day:"numeric"})),this.eggHatchWavesText.setText(t.getEggHatchWavesMessage()),this.eggGachaInfoText.setText(t.getEggTypeDescriptor())}processInput(e){const t=this.getUi();let i=!1;return e===v.CANCEL?(t.revertMode(),i=!0):i=this.scrollGridHandler.processInput(e),i&&t.playSelect(),i}setCursor(e){let t=!1;const i=this.cursor;if(t=super.setCursor(e),t){const n=this.eggIcons[e];this.cursorObj.setPositionRelative(n,114,5),i>-1&&this.iconAnimHandler.addOrUpdate(this.eggIcons[i],Nt.NONE),this.iconAnimHandler.addOrUpdate(n,Nt.ACTIVE),this.setEggDetails(e+this.scrollGridHandler.getItemOffset())}return t}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.eggListContainer.setVisible(!1),this.iconAnimHandler.removeAll(),this.eggListIconContainer.removeAll(!0),this.eggIcons=[]}};c(Cd,"EggListUiHandler");let Fl=Cd;const Ed=class Ed extends Phaser.GameObjects.Container{species;icon;shinyIcon;hiddenAbilityIcon;pokeballIcon;eggMoveIcon;constructor(e,t,i){super(s,e,t);const n=i.pokemon;this.species=n.species;const a=2,r=12,o=n.species,l=n.gender===kt.FEMALE,h=n.formIndex,u=n.variant,p=n.shiny,f=s.add.sprite(-a,a,o.getIconAtlasKey(h,p,u));f.setScale(.5),f.setOrigin(0,0),f.setFrame(o.getIconId(l,h,p,u)),this.icon=f,this.checkIconId(l,h,p,u),this.add(this.icon),this.shinyIcon=s.add.image(r,a,"shiny_star_small"),this.shinyIcon.setOrigin(0,0),this.shinyIcon.setScale(.5),this.add(this.shinyIcon);const d=s.add.image(r,a*4,"ha_capsule");d.setOrigin(0,0),d.setScale(.5),this.hiddenAbilityIcon=d,this.add(this.hiddenAbilityIcon);const y=s.add.image(r,a*7,"icon_owned");y.setOrigin(0,0),y.setScale(.5),this.pokeballIcon=y,this.add(this.pokeballIcon);const g=s.add.image(0,a,"icon_egg_move");g.setOrigin(0,0),g.setScale(.5),this.eggMoveIcon=g,this.add(this.eggMoveIcon)}updateAndAnimate(e,t){const i=e.pokemon;this.species=i.species;const a=e.dexEntryBeforeUpdate.caughtAttr,r=BigInt(1<<(i.shiny?1:0)),o=BigInt(1<<i.variant+4),l=(r&a)===BigInt(0)||(o&a)===BigInt(0),h=(BigInt(1<<i.formIndex)*F.DEFAULT_FORM&a)===BigInt(0),u=i.gender===kt.FEMALE,p=i.formIndex,f=i.variant,d=i.shiny;this.icon.setTexture(this.species.getIconAtlasKey(p,d,f)),this.icon.setFrame(this.species.getIconId(u,p,d,f)),this.checkIconId(u,p,d,f),this.shinyIcon.setVisible(i.shiny),this.shinyIcon.setTint(mt(i.variant)),this.eggMoveIcon.setVisible(e.eggMoveUnlocked),this.hiddenAbilityIcon.setVisible(i.abilityIndex===2),this.pokeballIcon.setVisible(!a||h),!a||l||h?t.addOrUpdate(this.icon,Nt.PASSIVE):t.addOrUpdate(this.icon,Nt.NONE)}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};c(Ed,"HatchedPokemonContainer");let Ul=Ed;const bd=class bd extends un{currentPokemonSprite;pokemonNumberText;pokemonNameText;pokemonEggMovesContainer;pokemonEggMoveContainers;pokemonEggMoveBgs;pokemonEggMoveLabels;pokemonHatchedIcon;pokemonListContainer;pokemonCandyIcon;pokemonCandyOverlayIcon;pokemonCandyCountText;constructor(e,t=115,i=9){super(t,i),this.pokemonListContainer=e}setup(){super.setup(),super.changeToEggSummaryLayout(),this.currentPokemonSprite=s.add.sprite(54,80,"pkmn__sub"),this.currentPokemonSprite.setScale(.8),this.currentPokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonListContainer.add(this.currentPokemonSprite),this.pokemonNumberText=P(84,107,"0000",A.EGG_SUMMARY_DEX,{fontSize:78}),this.pokemonNumberText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNumberText),this.pokemonNameText=P(7,109,"",A.EGG_SUMMARY_NAME,{fontSize:64}),this.pokemonNameText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNameText),this.pokemonHatchedIcon=s.add.sprite(-5,90,"egg_icons"),this.pokemonHatchedIcon.setOrigin(0,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonListContainer.add(this.pokemonHatchedIcon),this.pokemonCandyIcon=s.add.sprite(4.5,40,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(4.5,40,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyCountText=P(14,40,"x0",A.SUMMARY,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyCountText),this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.pokemonEggMovesContainer=s.add.container(0,200),this.pokemonEggMovesContainer.setVisible(!1),this.pokemonEggMovesContainer.setScale(.5);for(let e=0;e<4;e++){const t=s.add.container(0,0+6*e),i=s.add.nineslice(70,0,"type_bgs","unknown",92,14,2,2,2,2);i.setOrigin(1,0);const n=P(70-i.width/2,0,"???",A.MOVE_LABEL);n.setOrigin(.5,0),this.pokemonEggMoveBgs.push(i),this.pokemonEggMoveLabels.push(n),t.add(i),t.add(n),t.setScale(.44),this.pokemonEggMoveContainers.push(t),this.pokemonEggMovesContainer.add(t)}super.add(this.pokemonEggMoveContainers)}hideDisplayPokemon(){this.currentPokemonSprite.setVisible(!1)}displayPokemon(e){const t=e.species,i=e.gender===kt.FEMALE,n=e.formIndex,a=e.shiny,r=e.variant;this.currentPokemonSprite.setVisible(!1),t.loadAssets(i,n,a,r,!0).then(()=>{$t(t.speciesId,e.formIndex).cry(),this.currentPokemonSprite.play(t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setPipelineData("shiny",a),this.currentPokemonSprite.setPipelineData("variant",r),this.currentPokemonSprite.setPipelineData("spriteKey",t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setVisible(!0)})}showHatchInfo(e){this.pokemonEggMovesContainer.setVisible(!0);const t=e.pokemon,i=t.species;this.displayPokemon(t),super.show(t,!1,1,e.getDex(),e.getStarterEntry(),!0);const n=yt[i.speciesId];this.pokemonCandyIcon.setTint(ss(Gt(n[0]))),this.pokemonCandyIcon.setVisible(!0),this.pokemonCandyOverlayIcon.setTint(ss(Gt(n[1]))),this.pokemonCandyOverlayIcon.setVisible(!0),this.pokemonCandyCountText.setText(`${s.gameData.starterData[i.speciesId].candyCount}`),this.pokemonCandyCountText.setVisible(!0),this.pokemonNumberText.setText(ri(i.speciesId,4)),this.pokemonNameText.setText(i.name);const a=i&&Lt.hasOwnProperty(i.speciesId);for(let r=0;r<4;r++){const o=a?Fe[Lt[i.speciesId][r]]:null,l=o&&s.gameData.starterData[i.speciesId].eggMoves&Math.pow(2,r);this.pokemonEggMoveBgs[r].setFrame(Se[o?o.type:Se.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[r].setText(o&&l?o.name:"???"),!(o&&e.starterDataEntryBeforeUpdate.eggMoves&Math.pow(2,r))&&l&&this.pokemonEggMoveLabels[r].setText("(+) "+o.name)}this.pokemonEggMovesContainer.setVisible(!0),i.speciesId===pe.MANAPHY||i.speciesId===pe.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame(Js(i))}};c(bd,"PokemonHatchInfoContainer");let Vl=bd;const mr=112,yr=9,zn=9,Vs=11,Gi=18,Id=class Id extends Bt{eggHatchContainer;summaryContainer;pokemonIconsContainer;pokemonContainers;infoContainer;iconAnimHandler;eggHatchBg;eggHatchData;scrollGridHandler;cursorObj;blockExit;eventTarget=new EventTarget;constructor(){super(x.EGG_HATCH_SUMMARY)}setup(){const e=this.getUi();this.summaryContainer=s.add.container(0,-s.scaledCanvas.height),this.summaryContainer.setVisible(!1),e.add(this.summaryContainer),this.eggHatchContainer=s.add.container(0,-s.scaledCanvas.height),this.eggHatchContainer.setVisible(!1),e.add(this.eggHatchContainer),this.iconAnimHandler=new ja,this.iconAnimHandler.setup(),this.eggHatchBg=s.add.image(0,0,"egg_summary_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.summaryContainer.add(this.cursorObj),this.pokemonContainers=[],this.pokemonIconsContainer=s.add.container(mr,yr),this.summaryContainer.add(this.pokemonIconsContainer),this.infoContainer=new Vl(this.summaryContainer),this.infoContainer.setup(),this.infoContainer.changeToEggSummaryLayout(),this.infoContainer.setVisible(!0),this.summaryContainer.add(this.infoContainer);const t=new _s(mr+Vs*Gi,yr+3,4,s.scaledCanvas.height-20,zn);this.summaryContainer.add(t),this.scrollGridHandler=new Da(this,zn,Vs).withScrollBar(t).withUpdateGridCallBack(()=>this.updatePokemonIcons()).withUpdateSingleElementCallback(i=>this.infoContainer.showHatchInfo(this.eggHatchData[i])),this.cursor=-1}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.summaryContainer.setVisible(!1),this.pokemonIconsContainer.removeAll(!0),this.pokemonContainers=[],this.eggHatchBg.setVisible(!1),this.getUi().hideTooltip();const e=s.getActiveKeys();Object.keys(s.anims.anims.entries).forEach(n=>{n.startsWith("pkmn__")&&!e.includes(n)&&s.anims.remove(n)}),Object.keys(s.cache.audio.entries.entries).forEach(n=>{n.startsWith("cry/")&&!e.includes(n)&&delete s.cache.audio.entries.entries[n]}),this.eggHatchData.length=0,this.iconAnimHandler.removeAll()}show(e){super.show(e),e.length>=1&&(this.eggHatchData=e[0].sort(c(function(n,a){const r=n.pokemon.species,o=a.pokemon.species;return Js(r)<Js(o)?-1:Js(r)>Js(o)?1:r.speciesId<o.speciesId?-1:r.speciesId>o.speciesId?1:0},"sortHatchData"))),this.getUi().bringToTop(this.summaryContainer),this.summaryContainer.setVisible(!0),this.eggHatchContainer.setVisible(!0),this.eggHatchBg.setVisible(!0),this.infoContainer.hideDisplayPokemon(),this.scrollGridHandler.setTotalElements(this.eggHatchData.length),this.updatePokemonIcons(),this.setCursor(0),s.playSoundWithoutBgm("evolution_fanfare");const t=s.eggSkipPreference===2?2e3:1e3;return this.blockExit=!0,s.time.delayedCall(t,()=>this.blockExit=!1),!0}updatePokemonIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(zn*Vs,this.eggHatchData.length-e);for(let i=0;i<zn*Vs;i++){const n=this.eggHatchData[i+e];let a=this.pokemonContainers[i];if(i<t){if(!a){const r=i%Vs*Gi,o=Math.floor(i/Vs)*Gi;a=new Ul(r,o,n).setVisible(!1),this.pokemonContainers.push(a),this.pokemonIconsContainer.add(a)}a.setVisible(!0),a.updateAndAnimate(n,this.iconAnimHandler)}else a&&(a.setVisible(!1),this.iconAnimHandler.addOrUpdate(a.icon,Nt.NONE))}}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===v.CANCEL)if(this.blockExit)n=!0;else{const a=s.phaseManager.getCurrentPhase();a?.is("EggSummaryPhase")&&a.end(),i=!0}else this.scrollGridHandler.processInput(e);return i?t.playSelect():n&&t.playError(),i||n}setCursor(e){let t=!1;const i=this.cursor;return t=super.setCursor(e),t&&(this.cursorObj.setPosition(mr-1+Gi*(e%Vs),yr+1+Gi*Math.floor(e/Vs)),i>-1&&this.iconAnimHandler.addOrUpdate(this.pokemonContainers[i].icon,Nt.NONE),this.iconAnimHandler.addOrUpdate(this.pokemonContainers[e].icon,Nt.ACTIVE),this.infoContainer.showHatchInfo(this.eggHatchData[e+this.scrollGridHandler.getItemOffset()])),t}};c(Id,"EggSummaryUiHandler");let Hl=Id;const vd=class vd extends zs{optionSelectContainer;actionsContainer;titleBg;actionBg;optionSelectBg;unlockText;timerText;swapText;actionLabel;cancelLabel;listening=!1;buttonPressed=null;newButtonIcon;targetButtonIcon;cancelFn;timeLeftAutoClose=5;countdownTimer;target;constructor(e=null){super(e)}setup(){const e=this.getUi();this.optionSelectContainer=s.add.container(0,0),this.actionsContainer=s.add.container(0,0),this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),e.add(this.optionSelectContainer),e.add(this.actionsContainer),this.titleBg=ye(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+28+21,this.getWindowWidth(),24),this.titleBg.setOrigin(.5),this.optionSelectContainer.add(this.titleBg),this.actionBg=ye(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+this.getWindowHeight()+28+21+21,this.getWindowWidth(),24),this.actionBg.setOrigin(.5),this.actionsContainer.add(this.actionBg),this.unlockText=P(0,0,m.t("settings:pressButton"),A.WINDOW),this.unlockText.setOrigin(0,0),this.unlockText.setPositionRelative(this.titleBg,36,4),this.optionSelectContainer.add(this.unlockText),this.timerText=P(0,0,"(5)",A.WINDOW),this.timerText.setOrigin(0,0),this.timerText.setPositionRelative(this.unlockText,this.unlockText.width/6+5,0),this.optionSelectContainer.add(this.timerText),this.optionSelectBg=ye(s.scaledCanvas.width-this.getWindowWidth(),-s.scaledCanvas.height+this.getWindowHeight()+28,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setOrigin(.5),this.optionSelectContainer.add(this.optionSelectBg),this.cancelLabel=P(0,0,m.t("settings:back"),A.SETTINGS_LABEL),this.cancelLabel.setOrigin(0,.5),this.cancelLabel.setPositionRelative(this.actionBg,10,this.actionBg.height/2),this.actionsContainer.add(this.cancelLabel)}manageAutoCloseTimer(){clearTimeout(this.countdownTimer),this.countdownTimer=setTimeout(()=>{this.timeLeftAutoClose-=1,this.timerText.setText(`(${this.timeLeftAutoClose})`),this.timeLeftAutoClose>=0?this.manageAutoCloseTimer():this.cancelFn?.()},1e3)}show(e){return super.show(e),this.buttonPressed=null,this.timeLeftAutoClose=5,this.cancelFn=e[0].cancelHandler,this.target=e[0].target,this.getUi().bringToTop(this.optionSelectContainer),this.getUi().bringToTop(this.actionsContainer),this.optionSelectContainer.setVisible(!0),setTimeout(()=>{this.listening=!0,this.manageAutoCloseTimer()},100),!0}getWindowWidth(){return 160}getWindowHeight(){return 64}processInput(e){if(this.buttonPressed===null)return!1;const t=this.getUi();let i=!1;switch(e){case v.LEFT:case v.RIGHT:{i=this.setCursor(this.cursor?0:1);break}case v.ACTION:this.cursor===0?this.cancelFn?.():(i=this.swapAction(),Xt.getInstance().updateIcons(),this.cancelFn?.(i));break}return i?t.playSelect():t.playError(),i}setCursor(e){return this.cursor=e,e===1?(this.actionLabel.setColor(this.getTextColor(A.SETTINGS_SELECTED)),this.actionLabel.setShadowColor(this.getTextColor(A.SETTINGS_SELECTED,!0)),this.cancelLabel.setColor(this.getTextColor(A.WINDOW)),this.cancelLabel.setShadowColor(this.getTextColor(A.WINDOW,!0)),!0):(this.actionLabel.setColor(this.getTextColor(A.WINDOW)),this.actionLabel.setShadowColor(this.getTextColor(A.WINDOW,!0)),this.cancelLabel.setColor(this.getTextColor(A.SETTINGS_SELECTED)),this.cancelLabel.setShadowColor(this.getTextColor(A.SETTINGS_SELECTED,!0)),!0)}clear(){super.clear(),clearTimeout(this.countdownTimer),this.timerText.setText("(5)"),this.timeLeftAutoClose=5,this.listening=!1,this.target=null,this.cancelFn=null,this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),this.newButtonIcon.setVisible(!1),this.buttonPressed=null}onInputDown(e,t,i){clearTimeout(this.countdownTimer),this.timerText.setText(""),this.newButtonIcon.setTexture(i),this.newButtonIcon.setFrame(e),t&&(this.targetButtonIcon.setTexture(i),this.targetButtonIcon.setFrame(t),this.targetButtonIcon.setVisible(!0),this.swapText.setVisible(!0)),this.newButtonIcon.setVisible(!0),this.setCursor(0),this.actionsContainer.setVisible(!0)}};c(vd,"AbstractBindingUiHandler");let Ra=vd;const _d=class _d extends Ra{constructor(e=null){super(e),s.input.gamepad?.on("down",this.gamepadButtonDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"xbox"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,16),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.swapText=P(0,0,m.t("settings:willSwapWith"),A.WINDOW),this.swapText.setOrigin(.5),this.swapText.setPositionRelative(this.optionSelectBg,this.optionSelectBg.width/2-2,this.optionSelectBg.height/2-2),this.swapText.setVisible(!1),this.targetButtonIcon=s.add.sprite(0,0,"xbox"),this.targetButtonIcon.setPositionRelative(this.optionSelectBg,78,48),this.targetButtonIcon.setOrigin(.5),this.targetButtonIcon.setVisible(!1),this.actionLabel=P(0,0,m.t("settings:confirmSwap"),A.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-75,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon),this.optionSelectContainer.add(this.swapText),this.optionSelectContainer.add(this.targetButtonIcon)}getSelectedDevice(){return s.inputController?.selectedDevice[Me.GAMEPAD]}gamepadButtonDown(e,t,i){const n=[12,13,14,15];if(!this.listening||e.id.toLowerCase()!==this.getSelectedDevice()||n.includes(t.index)||this.buttonPressed!==null)return;const a=s.inputController.getActiveConfig(Me.GAMEPAD),r=a.padType,o=Mi(a,t.index),l=a.icons[o];if(!l)return;this.buttonPressed=t.index;const h=la(a,this.target);this.onInputDown(l,h,r)}swapAction(){const e=s.inputController.getActiveConfig(Me.GAMEPAD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}clear(){super.clear(),this.targetButtonIcon.setVisible(!1),this.swapText.setVisible(!1)}};c(_d,"GamepadBindingUiHandler");let Yl=_d;const Ad=class Ad extends Ra{constructor(e=null){super(e),s.input.keyboard?.on("keydown",this.onKeyDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"keyboard"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,32),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.actionLabel=P(0,0,m.t("settings:assignButton"),A.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-80,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon)}getSelectedDevice(){return s.inputController?.selectedDevice[Me.KEYBOARD]}onKeyDown(e){const t=[Phaser.Input.Keyboard.KeyCodes.UP,Phaser.Input.Keyboard.KeyCodes.DOWN,Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.HOME,Phaser.Input.Keyboard.KeyCodes.ENTER,Phaser.Input.Keyboard.KeyCodes.ESC,Phaser.Input.Keyboard.KeyCodes.DELETE],i=e.keyCode;if(!this.listening||this.buttonPressed!==null||t.includes(i))return;const n=s.inputController.getActiveConfig(Me.KEYBOARD),a=Mi(n,i),r=n.icons[a];r&&(this.buttonPressed=i,this.onInputDown(r,null,"keyboard"))}swapAction(){const e=s.inputController.getActiveConfig(Me.KEYBOARD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}};c(Ad,"KeyboardBindingUiHandler");let Gl=Ad;const xd=class xd extends Bi{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 80}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,m.t("menu:loading"),A.WINDOW);e.setOrigin(.5,.5),this.modalContainer.add(e)}};c(xd,"LoadingModalUiHandler");let Wl=xd;var Tr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Up;function dS(){return Up||(Up=1,(function(C,e){(function(t){C.exports=t()})(function(){return c(function t(i,n,a){function r(h,u){if(!n[h]){if(!i[h]){var p=typeof kn=="function"&&kn;if(!u&&p)return p(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var d=n[h]={exports:{}};i[h][0].call(d.exports,function(y){var g=i[h][1][y];return r(g||y)},d,d.exports,t,i,n,a)}return n[h].exports}c(r,"u");for(var o=typeof kn=="function"&&kn,l=0;l<a.length;l++)r(a[l]);return r},"s")({1:[function(t,i,n){var a=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var h,u,p,f,d,y,g,T=[],E=0,b=l.length,_=b,O=a.getTypeOf(l)!=="string";E<l.length;)_=b-E,p=O?(h=l[E++],u=E<b?l[E++]:0,E<b?l[E++]:0):(h=l.charCodeAt(E++),u=E<b?l.charCodeAt(E++):0,E<b?l.charCodeAt(E++):0),f=h>>2,d=(3&h)<<4|u>>4,y=1<_?(15&u)<<2|p>>6:64,g=2<_?63&p:64,T.push(o.charAt(f)+o.charAt(d)+o.charAt(y)+o.charAt(g));return T.join("")},n.decode=function(l){var h,u,p,f,d,y,g=0,T=0,E="data:";if(l.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var b,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&_--,l.charAt(l.length-2)===o.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=r.uint8array?new Uint8Array(0|_):new Array(0|_);g<l.length;)h=o.indexOf(l.charAt(g++))<<2|(f=o.indexOf(l.charAt(g++)))>>4,u=(15&f)<<4|(d=o.indexOf(l.charAt(g++)))>>2,p=(3&d)<<6|(y=o.indexOf(l.charAt(g++))),b[T++]=h,d!==64&&(b[T++]=u),y!==64&&(b[T++]=p);return b}},{"./support":30,"./utils":32}],2:[function(t,i,n){var a=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(u,p,f,d,y){this.compressedSize=u,this.uncompressedSize=p,this.crc32=f,this.compression=d,this.compressedContent=y}c(h,"o"),h.prototype={getContentWorker:c(function(){var u=new r(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},"getContentWorker"),getCompressedWorker:c(function(){return new r(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)},"getCompressedWorker")},h.createWorkerFrom=function(u,p,f){return u.pipe(new o).pipe(new l("uncompressedSize")).pipe(p.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",p)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var a=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:c(function(){return new a("STORE compression")},"compressWorker"),uncompressWorker:c(function(){return new a("STORE decompression")},"uncompressWorker")},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var a=t("./utils"),r=(function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l})();i.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?(function(h,u,p,f){var d=r,y=f+p;h^=-1;for(var g=f;g<y;g++)h=h>>>8^d[255&(h^u[g])];return-1^h})(0|l,o,o.length,0):(function(h,u,p,f){var d=r,y=f+p;h^=-1;for(var g=f;g<y;g++)h=h>>>8^d[255&(h^u.charCodeAt(g))];return-1^h})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var a=null;a=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:a}},{lie:37}],7:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=a?"uint8array":"array";function u(p,f){l.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=f,this.meta={}}c(u,"h"),n.magic="\b\0",o.inherits(u,l),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,p.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(f){p.push({data:f,meta:p.meta})}},n.compressWorker=function(p){return new u("Deflate",p)},n.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function a(d,y){var g,T="";for(g=0;g<y;g++)T+=String.fromCharCode(255&d),d>>>=8;return T}c(a,"A");function r(d,y,g,T,E,b){var _,O,w=d.file,U=d.compression,B=b!==h.utf8encode,K=o.transformTo("string",b(w.name)),V=o.transformTo("string",h.utf8encode(w.name)),te=w.comment,de=o.transformTo("string",b(te)),k=o.transformTo("string",h.utf8encode(te)),j=V.length!==w.name.length,I=k.length!==te.length,$="",re="",H="",ee=w.dir,L=w.date,Ee={crc32:0,compressedSize:0,uncompressedSize:0};y&&!g||(Ee.crc32=d.crc32,Ee.compressedSize=d.compressedSize,Ee.uncompressedSize=d.uncompressedSize);var W=0;y&&(W|=8),B||!j&&!I||(W|=2048);var Y=0,me=0;ee&&(Y|=16),E==="UNIX"?(me=798,Y|=(function(Z,Ce){var Ue=Z;return Z||(Ue=Ce?16893:33204),(65535&Ue)<<16})(w.unixPermissions,ee)):(me=20,Y|=(function(Z){return 63&(Z||0)})(w.dosPermissions)),_=L.getUTCHours(),_<<=6,_|=L.getUTCMinutes(),_<<=5,_|=L.getUTCSeconds()/2,O=L.getUTCFullYear()-1980,O<<=4,O|=L.getUTCMonth()+1,O<<=5,O|=L.getUTCDate(),j&&(re=a(1,1)+a(u(K),4)+V,$+="up"+a(re.length,2)+re),I&&(H=a(1,1)+a(u(de),4)+k,$+="uc"+a(H.length,2)+H);var fe="";return fe+=`
\0`,fe+=a(W,2),fe+=U.magic,fe+=a(_,2),fe+=a(O,2),fe+=a(Ee.crc32,4),fe+=a(Ee.compressedSize,4),fe+=a(Ee.uncompressedSize,4),fe+=a(K.length,2),fe+=a($.length,2),{fileRecord:p.LOCAL_FILE_HEADER+fe+K+$,dirRecord:p.CENTRAL_FILE_HEADER+a(me,2)+fe+a(de.length,2)+"\0\0\0\0"+a(Y,4)+a(T,4)+K+$+de}}c(r,"n");var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),u=t("../crc32"),p=t("../signature");function f(d,y,g,T){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=g,this.encodeFileName=T,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}c(f,"s"),o.inherits(f,l),f.prototype.push=function(d){var y=d.meta.percent||0,g=this.entriesCount,T=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(y+100*(g-T-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var y=this.streamFiles&&!d.file.dir;if(y){var g=r(d,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var y=this.streamFiles&&!d.file.dir,g=r(d,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),y)this.push({data:(function(T){return p.DATA_DESCRIPTOR+a(T.crc32,4)+a(T.compressedSize,4)+a(T.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var g=this.bytesWritten-d,T=(function(E,b,_,O,w){var U=o.transformTo("string",w(O));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(E,2)+a(E,2)+a(b,4)+a(_,4)+a(U.length,2)+U})(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:T,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var y=this;return d.on("data",function(g){y.processChunk(g)}),d.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),d.on("error",function(g){y.error(g)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var y=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var g=0;g<y.length;g++)try{y[g].error(d)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,y=0;y<d.length;y++)d[y].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var a=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(o,l,h){var u=new r(l.streamFiles,h,l.platform,l.encodeFileName),p=0;try{o.forEach(function(f,d){p++;var y=(function(b,_){var O=b||_,w=a[O];if(!w)throw new Error(O+" is not a valid compression method !");return w})(d.options.compression,l.compression),g=d.options.compressionOptions||l.compressionOptions||{},T=d.dir,E=d.date;d._compressWorker(y,g).withStreamInfo("file",{name:f,dir:T,date:E,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new a;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}c(a,"n"),(a.prototype=t("./object")).loadAsync=t("./load"),a.support=t("./support"),a.defaults=t("./defaults"),a.version="3.10.1",a.loadAsync=function(r,o){return new a().loadAsync(r,o)},a.external=t("./external"),i.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var a=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function p(f){return new r.Promise(function(d,y){var g=f.decompressed.getContentWorker().pipe(new h);g.on("error",function(T){y(T)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}c(p,"f"),i.exports=function(f,d){var y=this;return d=a.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var T=new l(d);return T.load(g),T}).then(function(g){var T=[r.Promise.resolve(g)],E=g.files;if(d.checkCRC32)for(var b=0;b<E.length;b++)T.push(p(E[b]));return r.Promise.all(T)}).then(function(g){for(var T=g.shift(),E=T.files,b=0;b<E.length;b++){var _=E[b],O=_.fileNameStr,w=a.resolve(_.fileNameStr);y.file(w,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:d.createFolders}),_.dir||(y.file(w).unsafeOriginalName=O)}return T.zipComment.length&&(y.comment=T.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var a=t("../utils"),r=t("../stream/GenericWorker");function o(l,h){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}c(o,"s"),a.inherits(o,r),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(u){h.push({data:u,meta:{percent:0}})}).on("error",function(u){h.isPaused?this.generatedError=u:h.error(u)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var a=t("readable-stream").Readable;function r(o,l,h){a.call(this,l),this._helper=o;var u=this;o.on("data",function(p,f){u.push(p)||u._helper.pause(),h&&h(f)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}c(r,"n"),t("../utils").inherits(r,a),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:c(function(a,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,r);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,r)},"newBufferFrom"),allocBuffer:c(function(a){if(Buffer.alloc)return Buffer.alloc(a);var r=new Buffer(a);return r.fill(0),r},"allocBuffer"),isBuffer:c(function(a){return Buffer.isBuffer(a)},"isBuffer"),isStream:c(function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"},"isStream")}},{}],15:[function(t,i,n){function a(w,U,B){var K,V=o.getTypeOf(U),te=o.extend(B||{},u);te.date=te.date||new Date,te.compression!==null&&(te.compression=te.compression.toUpperCase()),typeof te.unixPermissions=="string"&&(te.unixPermissions=parseInt(te.unixPermissions,8)),te.unixPermissions&&16384&te.unixPermissions&&(te.dir=!0),te.dosPermissions&&16&te.dosPermissions&&(te.dir=!0),te.dir&&(w=E(w)),te.createFolders&&(K=T(w))&&b.call(this,K,!0);var de=V==="string"&&te.binary===!1&&te.base64===!1;B&&B.binary!==void 0||(te.binary=!de),(U instanceof p&&U.uncompressedSize===0||te.dir||!U||U.length===0)&&(te.base64=!1,te.binary=!0,U="",te.compression="STORE",V="string");var k=null;k=U instanceof p||U instanceof l?U:y.isNode&&y.isStream(U)?new g(w,U):o.prepareContent(w,U,te.binary,te.optimizedBinaryString,te.base64);var j=new f(w,k,te);this.files[w]=j}c(a,"s");var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),u=t("./defaults"),p=t("./compressedObject"),f=t("./zipObject"),d=t("./generate"),y=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),T=c(function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var U=w.lastIndexOf("/");return 0<U?w.substring(0,U):""},"_"),E=c(function(w){return w.slice(-1)!=="/"&&(w+="/"),w},"g"),b=c(function(w,U){return U=U!==void 0?U:u.createFolders,w=E(w),this.files[w]||a.call(this,w,null,{dir:!0,createFolders:U}),this.files[w]},"b");function _(w){return Object.prototype.toString.call(w)==="[object RegExp]"}c(_,"h");var O={load:c(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"load"),forEach:c(function(w){var U,B,K;for(U in this.files)K=this.files[U],(B=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&w(B,K)},"forEach"),filter:c(function(w){var U=[];return this.forEach(function(B,K){w(B,K)&&U.push(K)}),U},"filter"),file:c(function(w,U,B){if(arguments.length!==1)return w=this.root+w,a.call(this,w,U,B),this;if(_(w)){var K=w;return this.filter(function(te,de){return!de.dir&&K.test(te)})}var V=this.files[this.root+w];return V&&!V.dir?V:null},"file"),folder:c(function(w){if(!w)return this;if(_(w))return this.filter(function(V,te){return te.dir&&w.test(V)});var U=this.root+w,B=b.call(this,U),K=this.clone();return K.root=B.name,K},"folder"),remove:c(function(w){w=this.root+w;var U=this.files[w];if(U||(w.slice(-1)!=="/"&&(w+="/"),U=this.files[w]),U&&!U.dir)delete this.files[w];else for(var B=this.filter(function(V,te){return te.name.slice(0,w.length)===w}),K=0;K<B.length;K++)delete this.files[B[K].name];return this},"remove"),generate:c(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"generate"),generateInternalStream:c(function(w){var U,B={};try{if((B=o.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");o.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var K=B.comment||this.comment||"";U=d.generateWorker(this,B,K)}catch(V){(U=new l("error")).error(V)}return new h(U,B.type||"string",B.mimeType)},"generateInternalStream"),generateAsync:c(function(w,U){return this.generateInternalStream(w).accumulate(U)},"generateAsync"),generateNodeStream:c(function(w,U){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(U)},"generateNodeStream")};i.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}c(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===u&&this.data[f+3]===p)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&u===f[2]&&p===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var a=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}c(r,"i"),r.prototype={checkOffset:c(function(o){this.checkIndex(this.index+o)},"checkOffset"),checkIndex:c(function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},"checkIndex"),setIndex:c(function(o){this.checkIndex(o),this.index=o},"setIndex"),skip:c(function(o){this.setIndex(this.index+o)},"skip"),byteAt:c(function(){},"byteAt"),readInt:c(function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},"readInt"),readString:c(function(o){return a.transformTo("string",this.readData(o))},"readString"),readData:c(function(){},"readData"),lastIndexOfSignature:c(function(){},"lastIndexOfSignature"),readAndCheckSignature:c(function(){},"readAndCheckSignature"),readDate:c(function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))},"readDate")},i.exports=r},{"../utils":32}],19:[function(t,i,n){var a=t("./Uint8ArrayReader");function r(o){a.call(this,o)}c(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o)}c(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var a=t("./ArrayReader");function r(o){a.call(this,o)}c(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var a=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");i.exports=function(p){var f=a.getTypeOf(p);return a.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new h(p):r.uint8array?new u(a.transformTo("uint8array",p)):new o(a.transformTo("array",p)):new l(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var a=t("./GenericWorker"),r=t("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}c(o,"s"),r.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var a=t("./GenericWorker"),r=t("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}c(o,"s"),t("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}c(o,"s"),a.inherits(o,r),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}r.prototype.processChunk.call(this,l)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){h.dataIsReady=!0,h.data=u,h.max=u&&u.length||0,h.type=a.getTypeOf(u),h.isPaused||h._tickAndRepeat()},function(u){h.error(u)})}c(o,"s"),a.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function a(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c(a,"n"),a.prototype={push:c(function(r){this.emit("data",r)},"push"),end:c(function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},"end"),error:c(function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},"error"),on:c(function(r,o){return this._listeners[r].push(o),this},"on"),cleanUp:c(function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},"cleanUp"),emit:c(function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},"emit"),pipe:c(function(r){return r.registerPrevious(this)},"pipe"),registerPrevious:c(function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},"registerPrevious"),pause:c(function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},"pause"),resume:c(function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},"resume"),flush:c(function(){},"flush"),processChunk:c(function(r){this.push(r)},"processChunk"),withStreamInfo:c(function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},"withStreamInfo"),mergeStreamInfo:c(function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},"mergeStreamInfo"),lock:c(function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},"lock"),toString:c(function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r},"toString")},i.exports=a},{}],29:[function(t,i,n){var a=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),u=t("../external"),p=null;if(h.nodestream)try{p=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(y,g){return new u.Promise(function(T,E){var b=[],_=y._internalType,O=y._outputType,w=y._mimeType;y.on("data",function(U,B){b.push(U),g&&g(B)}).on("error",function(U){b=[],E(U)}).on("end",function(){try{var U=(function(B,K,V){switch(B){case"blob":return a.newBlob(a.transformTo("arraybuffer",K),V);case"base64":return l.encode(K);default:return a.transformTo(B,K)}})(O,(function(B,K){var V,te=0,de=null,k=0;for(V=0;V<K.length;V++)k+=K[V].length;switch(B){case"string":return K.join("");case"array":return Array.prototype.concat.apply([],K);case"uint8array":for(de=new Uint8Array(k),V=0;V<K.length;V++)de.set(K[V],te),te+=K[V].length;return de;case"nodebuffer":return Buffer.concat(K);default:throw new Error("concat : unsupported type '"+B+"'")}})(_,b),w);T(U)}catch(B){E(B)}b=[]}).resume()})}c(f,"l");function d(y,g,T){var E=g;switch(g){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=g,this._mimeType=T,a.checkSupport(E),this._worker=y.pipe(new r(E)),y.lock()}catch(b){this._worker=new o("error"),this._worker.error(b)}}c(d,"f"),d.prototype={accumulate:c(function(y){return f(this,y)},"accumulate"),on:c(function(y,g){var T=this;return y==="data"?this._worker.on(y,function(E){g.call(T,E.data,E.meta)}):this._worker.on(y,function(){a.delay(g,arguments,T)}),this},"on"),resume:c(function(){return a.delay(this._worker.resume,[],this._worker),this},"resume"),pause:c(function(){return this._worker.pause(),this},"pause"),toNodejsStream:c(function(y){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},y)},"toNodejsStream")},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var a=new ArrayBuffer(0);try{n.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(a),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var a=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;h[254]=h[254]=1;function p(){l.call(this,"utf-8 decode"),this.leftOver=null}c(p,"a");function f(){l.call(this,"utf-8 encode")}c(f,"l"),n.utf8encode=function(d){return r.nodebuffer?o.newBufferFrom(d,"utf-8"):(function(y){var g,T,E,b,_,O=y.length,w=0;for(b=0;b<O;b++)(64512&(T=y.charCodeAt(b)))==55296&&b+1<O&&(64512&(E=y.charCodeAt(b+1)))==56320&&(T=65536+(T-55296<<10)+(E-56320),b++),w+=T<128?1:T<2048?2:T<65536?3:4;for(g=r.uint8array?new Uint8Array(w):new Array(w),b=_=0;_<w;b++)(64512&(T=y.charCodeAt(b)))==55296&&b+1<O&&(64512&(E=y.charCodeAt(b+1)))==56320&&(T=65536+(T-55296<<10)+(E-56320),b++),T<128?g[_++]=T:(T<2048?g[_++]=192|T>>>6:(T<65536?g[_++]=224|T>>>12:(g[_++]=240|T>>>18,g[_++]=128|T>>>12&63),g[_++]=128|T>>>6&63),g[_++]=128|63&T);return g})(d)},n.utf8decode=function(d){return r.nodebuffer?a.transformTo("nodebuffer",d).toString("utf-8"):(function(y){var g,T,E,b,_=y.length,O=new Array(2*_);for(g=T=0;g<_;)if((E=y[g++])<128)O[T++]=E;else if(4<(b=h[E]))O[T++]=65533,g+=b-1;else{for(E&=b===2?31:b===3?15:7;1<b&&g<_;)E=E<<6|63&y[g++],b--;1<b?O[T++]=65533:E<65536?O[T++]=E:(E-=65536,O[T++]=55296|E>>10&1023,O[T++]=56320|1023&E)}return O.length!==T&&(O.subarray?O=O.subarray(0,T):O.length=T),a.applyFromCharCode(O)})(d=a.transformTo(r.uint8array?"uint8array":"array",d))},a.inherits(p,l),p.prototype.processChunk=function(d){var y=a.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=y;(y=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),y.set(g,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var T=(function(b,_){var O;for((_=_||b.length)>b.length&&(_=b.length),O=_-1;0<=O&&(192&b[O])==128;)O--;return O<0||O===0?_:O+h[b[O]]>_?O:_})(y),E=y;T!==y.length&&(r.uint8array?(E=y.subarray(0,T),this.leftOver=y.subarray(T,y.length)):(E=y.slice(0,T),this.leftOver=y.slice(T,y.length))),this.push({data:n.utf8decode(E),meta:d.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=p,a.inherits(f,l),f.prototype.processChunk=function(d){this.push({data:n.utf8encode(d.data),meta:d.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var a=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(g){return g}c(h,"n");function u(g,T){for(var E=0;E<g.length;++E)T[E]=255&g.charCodeAt(E);return T}c(u,"l"),t("setimmediate"),n.newBlob=function(g,T){n.checkSupport("blob");try{return new Blob([g],{type:T})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(g),E.getBlob(T)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:c(function(g,T,E){var b=[],_=0,O=g.length;if(O<=E)return String.fromCharCode.apply(null,g);for(;_<O;)T==="array"||T==="nodebuffer"?b.push(String.fromCharCode.apply(null,g.slice(_,Math.min(_+E,O)))):b.push(String.fromCharCode.apply(null,g.subarray(_,Math.min(_+E,O)))),_+=E;return b.join("")},"stringifyByChunk"),stringifyByChar:c(function(g){for(var T="",E=0;E<g.length;E++)T+=String.fromCharCode(g[E]);return T},"stringifyByChar"),applyCanBeUsed:{uint8array:(function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function f(g){var T=65536,E=n.getTypeOf(g),b=!0;if(E==="uint8array"?b=p.applyCanBeUsed.uint8array:E==="nodebuffer"&&(b=p.applyCanBeUsed.nodebuffer),b)for(;1<T;)try{return p.stringifyByChunk(g,E,T)}catch{T=Math.floor(T/2)}return p.stringifyByChar(g)}c(f,"s");function d(g,T){for(var E=0;E<g.length;E++)T[E]=g[E];return T}c(d,"f"),n.applyFromCharCode=f;var y={};y.string={string:h,array:c(function(g){return u(g,new Array(g.length))},"array"),arraybuffer:c(function(g){return y.string.uint8array(g).buffer},"arraybuffer"),uint8array:c(function(g){return u(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:c(function(g){return u(g,o.allocBuffer(g.length))},"nodebuffer")},y.array={string:f,array:h,arraybuffer:c(function(g){return new Uint8Array(g).buffer},"arraybuffer"),uint8array:c(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:c(function(g){return o.newBufferFrom(g)},"nodebuffer")},y.arraybuffer={string:c(function(g){return f(new Uint8Array(g))},"string"),array:c(function(g){return d(new Uint8Array(g),new Array(g.byteLength))},"array"),arraybuffer:h,uint8array:c(function(g){return new Uint8Array(g)},"uint8array"),nodebuffer:c(function(g){return o.newBufferFrom(new Uint8Array(g))},"nodebuffer")},y.uint8array={string:f,array:c(function(g){return d(g,new Array(g.length))},"array"),arraybuffer:c(function(g){return g.buffer},"arraybuffer"),uint8array:h,nodebuffer:c(function(g){return o.newBufferFrom(g)},"nodebuffer")},y.nodebuffer={string:f,array:c(function(g){return d(g,new Array(g.length))},"array"),arraybuffer:c(function(g){return y.nodebuffer.uint8array(g).buffer},"arraybuffer"),uint8array:c(function(g){return d(g,new Uint8Array(g.length))},"uint8array"),nodebuffer:h},n.transformTo=function(g,T){if(T=T||"",!g)return T;n.checkSupport(g);var E=n.getTypeOf(T);return y[E][g](T)},n.resolve=function(g){for(var T=g.split("/"),E=[],b=0;b<T.length;b++){var _=T[b];_==="."||_===""&&b!==0&&b!==T.length-1||(_===".."?E.pop():E.push(_))}return E.join("/")},n.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(g){var T,E,b="";for(E=0;E<(g||"").length;E++)b+="\\x"+((T=g.charCodeAt(E))<16?"0":"")+T.toString(16).toUpperCase();return b},n.delay=function(g,T,E){setImmediate(function(){g.apply(E||null,T||[])})},n.inherits=function(g,T){function E(){}c(E,"r"),E.prototype=T.prototype,g.prototype=new E},n.extend=function(){var g,T,E={};for(g=0;g<arguments.length;g++)for(T in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],T)&&E[T]===void 0&&(E[T]=arguments[g][T]);return E},n.prepareContent=function(g,T,E,b,_){return l.Promise.resolve(T).then(function(O){return a.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,U){var B=new FileReader;B.onload=function(K){w(K.target.result)},B.onerror=function(K){U(K.target.error)},B.readAsArrayBuffer(O)}):O}).then(function(O){var w=n.getTypeOf(O);return w?(w==="arraybuffer"?O=n.transformTo("uint8array",O):w==="string"&&(_?O=r.decode(O):E&&b!==!0&&(O=(function(U){return u(U,a.uint8array?new Uint8Array(U.length):new Array(U.length))})(O))),O):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function u(p){this.files=[],this.loadOptions=p}c(u,"h"),u.prototype={checkSignature:c(function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(p)+")")}},"checkSignature"),isSignature:c(function(p,f){var d=this.reader.index;this.reader.setIndex(p);var y=this.reader.readString(4)===f;return this.reader.setIndex(d),y},"isSignature"),readBlockEndOfCentral:c(function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",d=r.transformTo(f,p);this.zipComment=this.loadOptions.decodeFileName(d)},"readBlockEndOfCentral"),readBlockZip64EndOfCentral:c(function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,f,d,y=this.zip64EndOfCentralSize-44;0<y;)p=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[p]={id:p,length:f,value:d}},"readBlockZip64EndOfCentral"),readBlockZip64EndOfCentralLocator:c(function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},"readBlockZip64EndOfCentralLocator"),readLocalFiles:c(function(){var p,f;for(p=0;p<this.files.length;p++)f=this.files[p],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},"readLocalFiles"),readCentralDir:c(function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},"readCentralDir"),readEndOfCentral:c(function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var f=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var y=f-d;if(0<y)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},"readEndOfCentral"),prepareReader:c(function(p){this.reader=a(p)},"prepareReader"),load:c(function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()},"load")},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),u=t("./compressions"),p=t("./support");function f(d,y){this.options=d,this.loadOptions=y}c(f,"l"),f.prototype={isEncrypted:c(function(){return(1&this.bitFlag)==1},"isEncrypted"),useUTF8:c(function(){return(2048&this.bitFlag)==2048},"useUTF8"),readLocalPart:c(function(d){var y,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(T){for(var E in u)if(Object.prototype.hasOwnProperty.call(u,E)&&u[E].magic===T)return u[E];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,d.readData(this.compressedSize))},"readLocalPart"),readCentralPart:c(function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var y=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(y),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},"readCentralPart"),processAttributes:c(function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},"processAttributes"),parseZIP64ExtraField:c(function(){if(this.extraFields[1]){var d=a(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},"parseZIP64ExtraField"),readExtraFields:c(function(d){var y,g,T,E=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<E;)y=d.readInt(2),g=d.readInt(2),T=d.readData(g),this.extraFields[y]={id:y,length:g,value:T};d.setIndex(E)},"readExtraFields"),handleUTF8:c(function(){var d=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var g=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var T=this.findExtraFieldUnicodeComment();if(T!==null)this.fileCommentStr=T;else{var E=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},"handleUTF8"),findExtraFieldUnicodePath:c(function(){var d=this.extraFields[28789];if(d){var y=a(d.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:h.utf8decode(y.readData(d.length-5))}return null},"findExtraFieldUnicodePath"),findExtraFieldUnicodeComment:c(function(){var d=this.extraFields[25461];if(d){var y=a(d.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:h.utf8decode(y.readData(d.length-5))}return null},"findExtraFieldUnicodeComment")},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function a(y,g,T){this.name=y,this.dir=T.dir,this.date=T.date,this.comment=T.comment,this.unixPermissions=T.unixPermissions,this.dosPermissions=T.dosPermissions,this._data=g,this._dataBinary=T.binary,this.options={compression:T.compression,compressionOptions:T.compressionOptions}}c(a,"n");var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),u=t("./stream/GenericWorker");a.prototype={internalStream:c(function(y){var g=null,T="string";try{if(!y)throw new Error("No output type specified.");var E=(T=y.toLowerCase())==="string"||T==="text";T!=="binarystring"&&T!=="text"||(T="string"),g=this._decompressWorker();var b=!this._dataBinary;b&&!E&&(g=g.pipe(new l.Utf8EncodeWorker)),!b&&E&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(_){(g=new u("error")).error(_)}return new r(g,T,"")},"internalStream"),async:c(function(y,g){return this.internalStream(y).accumulate(g)},"async"),nodeStream:c(function(y,g){return this.internalStream(y||"nodebuffer").toNodejsStream(g)},"nodeStream"),_compressWorker:c(function(y,g){if(this._data instanceof h&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var T=this._decompressWorker();return this._dataBinary||(T=T.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(T,y,g)},"_compressWorker"),_decompressWorker:c(function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)},"_decompressWorker")};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<p.length;d++)a.prototype[p[d]]=f;i.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(a){var r,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var h=0,u=new l(y),p=a.document.createTextNode("");u.observe(p,{characterData:!0}),r=c(function(){p.data=h=++h%2},"r")}else if(a.setImmediate||a.MessageChannel===void 0)r="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){y(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(y,0)};else{var f=new a.MessageChannel;f.port1.onmessage=y,r=c(function(){f.port2.postMessage(0)},"r")}var d=[];function y(){var g,T;o=!0;for(var E=d.length;E;){for(T=d,d=[],g=-1;++g<E;)T[g]();E=d.length}o=!1}c(y,"u"),i.exports=function(g){d.push(g)!==1||o||r()}}).call(this,typeof Dn<"u"?Dn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var a=t("immediate");function r(){}c(r,"u");var o={},l=["REJECTED"],h=["FULFILLED"],u=["PENDING"];function p(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,E!==r&&g(this,E)}c(p,"o");function f(E,b,_){this.promise=E,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}c(f,"h");function d(E,b,_){a(function(){var O;try{O=b(_)}catch(w){return o.reject(E,w)}O===E?o.reject(E,new TypeError("Cannot resolve promise with itself")):o.resolve(E,O)})}c(d,"f");function y(E){var b=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof b=="function")return function(){b.apply(E,arguments)}}c(y,"c");function g(E,b){var _=!1;function O(B){_||(_=!0,o.reject(E,B))}c(O,"n");function w(B){_||(_=!0,o.resolve(E,B))}c(w,"i");var U=T(function(){b(w,O)});U.status==="error"&&O(U.value)}c(g,"d");function T(E,b){var _={};try{_.value=E(b),_.status="success"}catch(O){_.status="error",_.value=O}return _}c(T,"p"),(i.exports=p).prototype.finally=function(E){if(typeof E!="function")return this;var b=this.constructor;return this.then(function(_){return b.resolve(E()).then(function(){return _})},function(_){return b.resolve(E()).then(function(){throw _})})},p.prototype.catch=function(E){return this.then(null,E)},p.prototype.then=function(E,b){if(typeof E!="function"&&this.state===h||typeof b!="function"&&this.state===l)return this;var _=new this.constructor(r);return this.state!==u?d(_,this.state===h?E:b,this.outcome):this.queue.push(new f(_,E,b)),_},f.prototype.callFulfilled=function(E){o.resolve(this.promise,E)},f.prototype.otherCallFulfilled=function(E){d(this.promise,this.onFulfilled,E)},f.prototype.callRejected=function(E){o.reject(this.promise,E)},f.prototype.otherCallRejected=function(E){d(this.promise,this.onRejected,E)},o.resolve=function(E,b){var _=T(y,b);if(_.status==="error")return o.reject(E,_.value);var O=_.value;if(O)g(E,O);else{E.state=h,E.outcome=b;for(var w=-1,U=E.queue.length;++w<U;)E.queue[w].callFulfilled(b)}return E},o.reject=function(E,b){E.state=l,E.outcome=b;for(var _=-1,O=E.queue.length;++_<O;)E.queue[_].callRejected(b);return E},p.resolve=function(E){return E instanceof this?E:o.resolve(new this(r),E)},p.reject=function(E){var b=new this(r);return o.reject(b,E)},p.all=function(E){var b=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=E.length,O=!1;if(!_)return this.resolve([]);for(var w=new Array(_),U=0,B=-1,K=new this(r);++B<_;)V(E[B],B);return K;function V(te,de){b.resolve(te).then(function(k){w[de]=k,++U!==_||O||(O=!0,o.resolve(K,w))},function(k){O||(O=!0,o.reject(K,k))})}},p.race=function(E){var b=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=E.length,O=!1;if(!_)return this.resolve([]);for(var w=-1,U=new this(r);++w<_;)B=E[w],b.resolve(B).then(function(K){O||(O=!0,o.resolve(U,K))},function(K){O||(O=!0,o.reject(U,K))});var B;return U}},{immediate:36}],38:[function(t,i,n){var a={};(0,t("./lib/utils/common").assign)(a,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var a=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),u=Object.prototype.toString,p=0,f=-1,d=0,y=8;function g(E){if(!(this instanceof g))return new g(E);this.options=r.assign({level:f,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},E||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var _=a.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(_!==p)throw new Error(l[_]);if(b.header&&a.deflateSetHeader(this.strm,b.header),b.dictionary){var O;if(O=typeof b.dictionary=="string"?o.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(_=a.deflateSetDictionary(this.strm,O))!==p)throw new Error(l[_]);this._dict_set=!0}}c(g,"p");function T(E,b){var _=new g(b);if(_.push(E,!0),_.err)throw _.msg||l[_.err];return _.result}c(T,"n"),g.prototype.push=function(E,b){var _,O,w=this.strm,U=this.options.chunkSize;if(this.ended)return!1;O=b===~~b?b:b===!0?4:0,typeof E=="string"?w.input=o.string2buf(E):u.call(E)==="[object ArrayBuffer]"?w.input=new Uint8Array(E):w.input=E,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(U),w.next_out=0,w.avail_out=U),(_=a.deflate(w,O))!==1&&_!==p)return this.onEnd(_),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(w.output,w.next_out))):this.onData(r.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&_!==1);return O===4?(_=a.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===p):O!==2||(this.onEnd(p),!(w.avail_out=0))},g.prototype.onData=function(E){this.chunks.push(E)},g.prototype.onEnd=function(E){E===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},n.Deflate=g,n.deflate=T,n.deflateRaw=function(E,b){return(b=b||{}).raw=!0,T(E,b)},n.gzip=function(E,b){return(b=b||{}).gzip=!0,T(E,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var a=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),u=t("./zlib/zstream"),p=t("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var T=this.options;T.raw&&0<=T.windowBits&&T.windowBits<16&&(T.windowBits=-T.windowBits,T.windowBits===0&&(T.windowBits=-15)),!(0<=T.windowBits&&T.windowBits<16)||g&&g.windowBits||(T.windowBits+=32),15<T.windowBits&&T.windowBits<48&&(15&T.windowBits)==0&&(T.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var E=a.inflateInit2(this.strm,T.windowBits);if(E!==l.Z_OK)throw new Error(h[E]);this.header=new p,a.inflateGetHeader(this.strm,this.header)}c(d,"a");function y(g,T){var E=new d(T);if(E.push(g,!0),E.err)throw E.msg||h[E.err];return E.result}c(y,"o"),d.prototype.push=function(g,T){var E,b,_,O,w,U,B=this.strm,K=this.options.chunkSize,V=this.options.dictionary,te=!1;if(this.ended)return!1;b=T===~~T?T:T===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?B.input=o.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?B.input=new Uint8Array(g):B.input=g,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new r.Buf8(K),B.next_out=0,B.avail_out=K),(E=a.inflate(B,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&V&&(U=typeof V=="string"?o.string2buf(V):f.call(V)==="[object ArrayBuffer]"?new Uint8Array(V):V,E=a.inflateSetDictionary(this.strm,U)),E===l.Z_BUF_ERROR&&te===!0&&(E=l.Z_OK,te=!1),E!==l.Z_STREAM_END&&E!==l.Z_OK)return this.onEnd(E),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&E!==l.Z_STREAM_END&&(B.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=o.utf8border(B.output,B.next_out),O=B.next_out-_,w=o.buf2string(B.output,_),B.next_out=O,B.avail_out=K-O,O&&r.arraySet(B.output,B.output,_,O,0),this.onData(w)):this.onData(r.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(te=!0)}while((0<B.avail_in||B.avail_out===0)&&E!==l.Z_STREAM_END);return E===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(E=a.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(B.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Inflate=d,n.inflate=y,n.inflateRaw=function(g,T){return(T=T||{}).raw=!0,y(g,T)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var u=h.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(l[p]=u[p])}}return l},n.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var r={arraySet:c(function(l,h,u,p,f){if(h.subarray&&l.subarray)l.set(h.subarray(u,u+p),f);else for(var d=0;d<p;d++)l[f+d]=h[u+d]},"arraySet"),flattenChunks:c(function(l){var h,u,p,f,d,y;for(h=p=0,u=l.length;h<u;h++)p+=l[h].length;for(y=new Uint8Array(p),h=f=0,u=l.length;h<u;h++)d=l[h],y.set(d,f),f+=d.length;return y},"flattenChunks")},o={arraySet:c(function(l,h,u,p,f){for(var d=0;d<p;d++)l[f+d]=h[u+d]},"arraySet"),flattenChunks:c(function(l){return[].concat.apply([],l)},"flattenChunks")};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(a)},{}],42:[function(t,i,n){var a=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function u(p,f){if(f<65537&&(p.subarray&&o||!p.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(p,f));for(var d="",y=0;y<f;y++)d+=String.fromCharCode(p[y]);return d}c(u,"l"),l[254]=l[254]=1,n.string2buf=function(p){var f,d,y,g,T,E=p.length,b=0;for(g=0;g<E;g++)(64512&(d=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(y=p.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),b+=d<128?1:d<2048?2:d<65536?3:4;for(f=new a.Buf8(b),g=T=0;T<b;g++)(64512&(d=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(y=p.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(y-56320),g++),d<128?f[T++]=d:(d<2048?f[T++]=192|d>>>6:(d<65536?f[T++]=224|d>>>12:(f[T++]=240|d>>>18,f[T++]=128|d>>>12&63),f[T++]=128|d>>>6&63),f[T++]=128|63&d);return f},n.buf2binstring=function(p){return u(p,p.length)},n.binstring2buf=function(p){for(var f=new a.Buf8(p.length),d=0,y=f.length;d<y;d++)f[d]=p.charCodeAt(d);return f},n.buf2string=function(p,f){var d,y,g,T,E=f||p.length,b=new Array(2*E);for(d=y=0;d<E;)if((g=p[d++])<128)b[y++]=g;else if(4<(T=l[g]))b[y++]=65533,d+=T-1;else{for(g&=T===2?31:T===3?15:7;1<T&&d<E;)g=g<<6|63&p[d++],T--;1<T?b[y++]=65533:g<65536?b[y++]=g:(g-=65536,b[y++]=55296|g>>10&1023,b[y++]=56320|1023&g)}return u(b,y)},n.utf8border=function(p,f){var d;for((f=f||p.length)>p.length&&(f=p.length),d=f-1;0<=d&&(192&p[d])==128;)d--;return d<0||d===0?f:d+l[p[d]]>f?d:f}},{"./common":41}],43:[function(t,i,n){i.exports=function(a,r,o,l){for(var h=65535&a|0,u=a>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;u=u+(h=h+r[l++]|0)|0,--p;);h%=65521,u%=65521}return h|u<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var a=(function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o})();i.exports=function(r,o,l,h){var u=a,p=h+l;r^=-1;for(var f=h;f<p;f++)r=r>>>8^u[255&(r^o[f])];return-1^r}},{}],46:[function(t,i,n){var a,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),u=t("./messages"),p=0,f=4,d=0,y=-2,g=-1,T=4,E=2,b=8,_=9,O=286,w=30,U=19,B=2*O+1,K=15,V=3,te=258,de=te+V+1,k=42,j=113,I=1,$=2,re=3,H=4;function ee(S,Q){return S.msg=u[Q],Q}c(ee,"R");function L(S){return(S<<1)-(4<S?9:0)}c(L,"T");function Ee(S){for(var Q=S.length;0<=--Q;)S[Q]=0}c(Ee,"D");function W(S){var Q=S.state,X=Q.pending;X>S.avail_out&&(X=S.avail_out),X!==0&&(r.arraySet(S.output,Q.pending_buf,Q.pending_out,X,S.next_out),S.next_out+=X,Q.pending_out+=X,S.total_out+=X,S.avail_out-=X,Q.pending-=X,Q.pending===0&&(Q.pending_out=0))}c(W,"F");function Y(S,Q){o._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,Q),S.block_start=S.strstart,W(S.strm)}c(Y,"N");function me(S,Q){S.pending_buf[S.pending++]=Q}c(me,"U");function fe(S,Q){S.pending_buf[S.pending++]=Q>>>8&255,S.pending_buf[S.pending++]=255&Q}c(fe,"P");function Z(S,Q){var X,N,M=S.max_chain_length,R=S.strstart,se=S.prev_length,ie=S.nice_match,z=S.strstart>S.w_size-de?S.strstart-(S.w_size-de):0,oe=S.window,Te=S.w_mask,he=S.prev,_e=S.strstart+te,Ze=oe[R+se-1],De=oe[R+se];S.prev_length>=S.good_match&&(M>>=2),ie>S.lookahead&&(ie=S.lookahead);do if(oe[(X=Q)+se]===De&&oe[X+se-1]===Ze&&oe[X]===oe[R]&&oe[++X]===oe[R+1]){R+=2,X++;do;while(oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&oe[++R]===oe[++X]&&R<_e);if(N=te-(_e-R),R=_e-te,se<N){if(S.match_start=Q,ie<=(se=N))break;Ze=oe[R+se-1],De=oe[R+se]}}while((Q=he[Q&Te])>z&&--M!=0);return se<=S.lookahead?se:S.lookahead}c(Z,"L");function Ce(S){var Q,X,N,M,R,se,ie,z,oe,Te,he=S.w_size;do{if(M=S.window_size-S.lookahead-S.strstart,S.strstart>=he+(he-de)){for(r.arraySet(S.window,S.window,he,he,0),S.match_start-=he,S.strstart-=he,S.block_start-=he,Q=X=S.hash_size;N=S.head[--Q],S.head[Q]=he<=N?N-he:0,--X;);for(Q=X=he;N=S.prev[--Q],S.prev[Q]=he<=N?N-he:0,--X;);M+=he}if(S.strm.avail_in===0)break;if(se=S.strm,ie=S.window,z=S.strstart+S.lookahead,oe=M,Te=void 0,Te=se.avail_in,oe<Te&&(Te=oe),X=Te===0?0:(se.avail_in-=Te,r.arraySet(ie,se.input,se.next_in,Te,z),se.state.wrap===1?se.adler=l(se.adler,ie,Te,z):se.state.wrap===2&&(se.adler=h(se.adler,ie,Te,z)),se.next_in+=Te,se.total_in+=Te,Te),S.lookahead+=X,S.lookahead+S.insert>=V)for(R=S.strstart-S.insert,S.ins_h=S.window[R],S.ins_h=(S.ins_h<<S.hash_shift^S.window[R+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[R+V-1])&S.hash_mask,S.prev[R&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=R,R++,S.insert--,!(S.lookahead+S.insert<V)););}while(S.lookahead<de&&S.strm.avail_in!==0)}c(Ce,"j");function Ue(S,Q){for(var X,N;;){if(S.lookahead<de){if(Ce(S),S.lookahead<de&&Q===p)return I;if(S.lookahead===0)break}if(X=0,S.lookahead>=V&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+V-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),X!==0&&S.strstart-X<=S.w_size-de&&(S.match_length=Z(S,X)),S.match_length>=V)if(N=o._tr_tally(S,S.strstart-S.match_start,S.match_length-V),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=V){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+V-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else N=o._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(N&&(Y(S,!1),S.strm.avail_out===0))return I}return S.insert=S.strstart<V-1?S.strstart:V-1,Q===f?(Y(S,!0),S.strm.avail_out===0?re:H):S.last_lit&&(Y(S,!1),S.strm.avail_out===0)?I:$}c(Ue,"Z");function xe(S,Q){for(var X,N,M;;){if(S.lookahead<de){if(Ce(S),S.lookahead<de&&Q===p)return I;if(S.lookahead===0)break}if(X=0,S.lookahead>=V&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+V-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=V-1,X!==0&&S.prev_length<S.max_lazy_match&&S.strstart-X<=S.w_size-de&&(S.match_length=Z(S,X),S.match_length<=5&&(S.strategy===1||S.match_length===V&&4096<S.strstart-S.match_start)&&(S.match_length=V-1)),S.prev_length>=V&&S.match_length<=S.prev_length){for(M=S.strstart+S.lookahead-V,N=o._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-V),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=M&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+V-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=V-1,S.strstart++,N&&(Y(S,!1),S.strm.avail_out===0))return I}else if(S.match_available){if((N=o._tr_tally(S,0,S.window[S.strstart-1]))&&Y(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return I}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(N=o._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<V-1?S.strstart:V-1,Q===f?(Y(S,!0),S.strm.avail_out===0?re:H):S.last_lit&&(Y(S,!1),S.strm.avail_out===0)?I:$}c(xe,"W");function Le(S,Q,X,N,M){this.good_length=S,this.max_lazy=Q,this.nice_length=X,this.max_chain=N,this.func=M}c(Le,"M");function at(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*B),this.dyn_dtree=new r.Buf16(2*(2*w+1)),this.bl_tree=new r.Buf16(2*(2*U+1)),Ee(this.dyn_ltree),Ee(this.dyn_dtree),Ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(K+1),this.heap=new r.Buf16(2*O+1),Ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*O+1),Ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}c(at,"H");function We(S){var Q;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=E,(Q=S.state).pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?k:j,S.adler=Q.wrap===2?0:1,Q.last_flush=p,o._tr_init(Q),d):ee(S,y)}c(We,"G");function pt(S){var Q=We(S);return Q===d&&(function(X){X.window_size=2*X.w_size,Ee(X.head),X.max_lazy_match=a[X.level].max_lazy,X.good_match=a[X.level].good_length,X.nice_match=a[X.level].nice_length,X.max_chain_length=a[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=V-1,X.match_available=0,X.ins_h=0})(S.state),Q}c(pt,"K");function Ie(S,Q,X,N,M,R){if(!S)return y;var se=1;if(Q===g&&(Q=6),N<0?(se=0,N=-N):15<N&&(se=2,N-=16),M<1||_<M||X!==b||N<8||15<N||Q<0||9<Q||R<0||T<R)return ee(S,y);N===8&&(N=9);var ie=new at;return(S.state=ie).strm=S,ie.wrap=se,ie.gzhead=null,ie.w_bits=N,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=M+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+V-1)/V),ie.window=new r.Buf8(2*ie.w_size),ie.head=new r.Buf16(ie.hash_size),ie.prev=new r.Buf16(ie.w_size),ie.lit_bufsize=1<<M+6,ie.pending_buf_size=4*ie.lit_bufsize,ie.pending_buf=new r.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=Q,ie.strategy=R,ie.method=X,pt(S)}c(Ie,"Y"),a=[new Le(0,0,0,0,function(S,Q){var X=65535;for(X>S.pending_buf_size-5&&(X=S.pending_buf_size-5);;){if(S.lookahead<=1){if(Ce(S),S.lookahead===0&&Q===p)return I;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var N=S.block_start+X;if((S.strstart===0||S.strstart>=N)&&(S.lookahead=S.strstart-N,S.strstart=N,Y(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-de&&(Y(S,!1),S.strm.avail_out===0))return I}return S.insert=0,Q===f?(Y(S,!0),S.strm.avail_out===0?re:H):(S.strstart>S.block_start&&(Y(S,!1),S.strm.avail_out),I)}),new Le(4,4,8,4,Ue),new Le(4,5,16,8,Ue),new Le(4,6,32,32,Ue),new Le(4,4,16,16,xe),new Le(8,16,32,32,xe),new Le(8,16,128,128,xe),new Le(8,32,128,256,xe),new Le(32,128,258,1024,xe),new Le(32,258,258,4096,xe)],n.deflateInit=function(S,Q){return Ie(S,Q,b,15,8,0)},n.deflateInit2=Ie,n.deflateReset=pt,n.deflateResetKeep=We,n.deflateSetHeader=function(S,Q){return S&&S.state?S.state.wrap!==2?y:(S.state.gzhead=Q,d):y},n.deflate=function(S,Q){var X,N,M,R;if(!S||!S.state||5<Q||Q<0)return S?ee(S,y):y;if(N=S.state,!S.output||!S.input&&S.avail_in!==0||N.status===666&&Q!==f)return ee(S,S.avail_out===0?-5:y);if(N.strm=S,X=N.last_flush,N.last_flush=Q,N.status===k)if(N.wrap===2)S.adler=0,me(N,31),me(N,139),me(N,8),N.gzhead?(me(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),me(N,255&N.gzhead.time),me(N,N.gzhead.time>>8&255),me(N,N.gzhead.time>>16&255),me(N,N.gzhead.time>>24&255),me(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),me(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(me(N,255&N.gzhead.extra.length),me(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(S.adler=h(S.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(me(N,0),me(N,0),me(N,0),me(N,0),me(N,0),me(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),me(N,3),N.status=j);else{var se=b+(N.w_bits-8<<4)<<8;se|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(se|=32),se+=31-se%31,N.status=j,fe(N,se),N.strstart!==0&&(fe(N,S.adler>>>16),fe(N,65535&S.adler)),S.adler=1}if(N.status===69)if(N.gzhead.extra){for(M=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),W(S),M=N.pending,N.pending!==N.pending_buf_size));)me(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){M=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),W(S),M=N.pending,N.pending===N.pending_buf_size)){R=1;break}R=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,me(N,R)}while(R!==0);N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),R===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){M=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),W(S),M=N.pending,N.pending===N.pending_buf_size)){R=1;break}R=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,me(N,R)}while(R!==0);N.gzhead.hcrc&&N.pending>M&&(S.adler=h(S.adler,N.pending_buf,N.pending-M,M)),R===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&W(S),N.pending+2<=N.pending_buf_size&&(me(N,255&S.adler),me(N,S.adler>>8&255),S.adler=0,N.status=j)):N.status=j),N.pending!==0){if(W(S),S.avail_out===0)return N.last_flush=-1,d}else if(S.avail_in===0&&L(Q)<=L(X)&&Q!==f)return ee(S,-5);if(N.status===666&&S.avail_in!==0)return ee(S,-5);if(S.avail_in!==0||N.lookahead!==0||Q!==p&&N.status!==666){var ie=N.strategy===2?(function(z,oe){for(var Te;;){if(z.lookahead===0&&(Ce(z),z.lookahead===0)){if(oe===p)return I;break}if(z.match_length=0,Te=o._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,Te&&(Y(z,!1),z.strm.avail_out===0))return I}return z.insert=0,oe===f?(Y(z,!0),z.strm.avail_out===0?re:H):z.last_lit&&(Y(z,!1),z.strm.avail_out===0)?I:$})(N,Q):N.strategy===3?(function(z,oe){for(var Te,he,_e,Ze,De=z.window;;){if(z.lookahead<=te){if(Ce(z),z.lookahead<=te&&oe===p)return I;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=V&&0<z.strstart&&(he=De[_e=z.strstart-1])===De[++_e]&&he===De[++_e]&&he===De[++_e]){Ze=z.strstart+te;do;while(he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&he===De[++_e]&&_e<Ze);z.match_length=te-(Ze-_e),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=V?(Te=o._tr_tally(z,1,z.match_length-V),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(Te=o._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),Te&&(Y(z,!1),z.strm.avail_out===0))return I}return z.insert=0,oe===f?(Y(z,!0),z.strm.avail_out===0?re:H):z.last_lit&&(Y(z,!1),z.strm.avail_out===0)?I:$})(N,Q):a[N.level].func(N,Q);if(ie!==re&&ie!==H||(N.status=666),ie===I||ie===re)return S.avail_out===0&&(N.last_flush=-1),d;if(ie===$&&(Q===1?o._tr_align(N):Q!==5&&(o._tr_stored_block(N,0,0,!1),Q===3&&(Ee(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),W(S),S.avail_out===0))return N.last_flush=-1,d}return Q!==f?d:N.wrap<=0?1:(N.wrap===2?(me(N,255&S.adler),me(N,S.adler>>8&255),me(N,S.adler>>16&255),me(N,S.adler>>24&255),me(N,255&S.total_in),me(N,S.total_in>>8&255),me(N,S.total_in>>16&255),me(N,S.total_in>>24&255)):(fe(N,S.adler>>>16),fe(N,65535&S.adler)),W(S),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?d:1)},n.deflateEnd=function(S){var Q;return S&&S.state?(Q=S.state.status)!==k&&Q!==69&&Q!==73&&Q!==91&&Q!==103&&Q!==j&&Q!==666?ee(S,y):(S.state=null,Q===j?ee(S,-3):d):y},n.deflateSetDictionary=function(S,Q){var X,N,M,R,se,ie,z,oe,Te=Q.length;if(!S||!S.state||(R=(X=S.state).wrap)===2||R===1&&X.status!==k||X.lookahead)return y;for(R===1&&(S.adler=l(S.adler,Q,Te,0)),X.wrap=0,Te>=X.w_size&&(R===0&&(Ee(X.head),X.strstart=0,X.block_start=0,X.insert=0),oe=new r.Buf8(X.w_size),r.arraySet(oe,Q,Te-X.w_size,X.w_size,0),Q=oe,Te=X.w_size),se=S.avail_in,ie=S.next_in,z=S.input,S.avail_in=Te,S.next_in=0,S.input=Q,Ce(X);X.lookahead>=V;){for(N=X.strstart,M=X.lookahead-(V-1);X.ins_h=(X.ins_h<<X.hash_shift^X.window[N+V-1])&X.hash_mask,X.prev[N&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=N,N++,--M;);X.strstart=N,X.lookahead=V-1,Ce(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=V-1,X.match_available=0,S.next_in=ie,S.input=z,S.avail_in=se,X.wrap=R,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(a,r){var o,l,h,u,p,f,d,y,g,T,E,b,_,O,w,U,B,K,V,te,de,k,j,I,$;o=a.state,l=a.next_in,I=a.input,h=l+(a.avail_in-5),u=a.next_out,$=a.output,p=u-(r-a.avail_out),f=u+(a.avail_out-257),d=o.dmax,y=o.wsize,g=o.whave,T=o.wnext,E=o.window,b=o.hold,_=o.bits,O=o.lencode,w=o.distcode,U=(1<<o.lenbits)-1,B=(1<<o.distbits)-1;e:do{_<15&&(b+=I[l++]<<_,_+=8,b+=I[l++]<<_,_+=8),K=O[b&U];t:for(;;){if(b>>>=V=K>>>24,_-=V,(V=K>>>16&255)===0)$[u++]=65535&K;else{if(!(16&V)){if((64&V)==0){K=O[(65535&K)+(b&(1<<V)-1)];continue t}if(32&V){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}te=65535&K,(V&=15)&&(_<V&&(b+=I[l++]<<_,_+=8),te+=b&(1<<V)-1,b>>>=V,_-=V),_<15&&(b+=I[l++]<<_,_+=8,b+=I[l++]<<_,_+=8),K=w[b&B];s:for(;;){if(b>>>=V=K>>>24,_-=V,!(16&(V=K>>>16&255))){if((64&V)==0){K=w[(65535&K)+(b&(1<<V)-1)];continue s}a.msg="invalid distance code",o.mode=30;break e}if(de=65535&K,_<(V&=15)&&(b+=I[l++]<<_,(_+=8)<V&&(b+=I[l++]<<_,_+=8)),d<(de+=b&(1<<V)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(b>>>=V,_-=V,(V=u-p)<de){if(g<(V=de-V)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(j=E,(k=0)===T){if(k+=y-V,V<te){for(te-=V;$[u++]=E[k++],--V;);k=u-de,j=$}}else if(T<V){if(k+=y+T-V,(V-=T)<te){for(te-=V;$[u++]=E[k++],--V;);if(k=0,T<te){for(te-=V=T;$[u++]=E[k++],--V;);k=u-de,j=$}}}else if(k+=T-V,V<te){for(te-=V;$[u++]=E[k++],--V;);k=u-de,j=$}for(;2<te;)$[u++]=j[k++],$[u++]=j[k++],$[u++]=j[k++],te-=3;te&&($[u++]=j[k++],1<te&&($[u++]=j[k++]))}else{for(k=u-de;$[u++]=$[k++],$[u++]=$[k++],$[u++]=$[k++],2<(te-=3););te&&($[u++]=$[k++],1<te&&($[u++]=$[k++]))}break}}break}}while(l<h&&u<f);l-=te=_>>3,b&=(1<<(_-=te<<3))-1,a.next_in=l,a.next_out=u,a.avail_in=l<h?h-l+5:5-(l-h),a.avail_out=u<f?f-u+257:257-(u-f),o.hold=b,o.bits=_}},{}],49:[function(t,i,n){var a=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),u=1,p=2,f=0,d=-2,y=1,g=852,T=592;function E(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}c(E,"L");function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}c(b,"s");function _(k){var j;return k&&k.state?(j=k.state,k.total_in=k.total_out=j.total=0,k.msg="",j.wrap&&(k.adler=1&j.wrap),j.mode=y,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new a.Buf32(g),j.distcode=j.distdyn=new a.Buf32(T),j.sane=1,j.back=-1,f):d}c(_,"a");function O(k){var j;return k&&k.state?((j=k.state).wsize=0,j.whave=0,j.wnext=0,_(k)):d}c(O,"o");function w(k,j){var I,$;return k&&k.state?($=k.state,j<0?(I=0,j=-j):(I=1+(j>>4),j<48&&(j&=15)),j&&(j<8||15<j)?d:($.window!==null&&$.wbits!==j&&($.window=null),$.wrap=I,$.wbits=j,O(k))):d}c(w,"h");function U(k,j){var I,$;return k?($=new b,(k.state=$).window=null,(I=w(k,j))!==f&&(k.state=null),I):d}c(U,"u");var B,K,V=!0;function te(k){if(V){var j;for(B=new a.Buf32(512),K=new a.Buf32(32),j=0;j<144;)k.lens[j++]=8;for(;j<256;)k.lens[j++]=9;for(;j<280;)k.lens[j++]=7;for(;j<288;)k.lens[j++]=8;for(h(u,k.lens,0,288,B,0,k.work,{bits:9}),j=0;j<32;)k.lens[j++]=5;h(p,k.lens,0,32,K,0,k.work,{bits:5}),V=!1}k.lencode=B,k.lenbits=9,k.distcode=K,k.distbits=5}c(te,"j");function de(k,j,I,$){var re,H=k.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new a.Buf8(H.wsize)),$>=H.wsize?(a.arraySet(H.window,j,I-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):($<(re=H.wsize-H.wnext)&&(re=$),a.arraySet(H.window,j,I-$,re,H.wnext),($-=re)?(a.arraySet(H.window,j,I-$,$,0),H.wnext=$,H.whave=H.wsize):(H.wnext+=re,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=re))),0}c(de,"Z"),n.inflateReset=O,n.inflateReset2=w,n.inflateResetKeep=_,n.inflateInit=function(k){return U(k,15)},n.inflateInit2=U,n.inflate=function(k,j){var I,$,re,H,ee,L,Ee,W,Y,me,fe,Z,Ce,Ue,xe,Le,at,We,pt,Ie,S,Q,X,N,M=0,R=new a.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return d;(I=k.state).mode===12&&(I.mode=13),ee=k.next_out,re=k.output,Ee=k.avail_out,H=k.next_in,$=k.input,L=k.avail_in,W=I.hold,Y=I.bits,me=L,fe=Ee,Q=f;e:for(;;)switch(I.mode){case y:if(I.wrap===0){I.mode=13;break}for(;Y<16;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(2&I.wrap&&W===35615){R[I.check=0]=255&W,R[1]=W>>>8&255,I.check=o(I.check,R,2,0),Y=W=0,I.mode=2;break}if(I.flags=0,I.head&&(I.head.done=!1),!(1&I.wrap)||(((255&W)<<8)+(W>>8))%31){k.msg="incorrect header check",I.mode=30;break}if((15&W)!=8){k.msg="unknown compression method",I.mode=30;break}if(Y-=4,S=8+(15&(W>>>=4)),I.wbits===0)I.wbits=S;else if(S>I.wbits){k.msg="invalid window size",I.mode=30;break}I.dmax=1<<S,k.adler=I.check=1,I.mode=512&W?10:12,Y=W=0;break;case 2:for(;Y<16;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(I.flags=W,(255&I.flags)!=8){k.msg="unknown compression method",I.mode=30;break}if(57344&I.flags){k.msg="unknown header flags set",I.mode=30;break}I.head&&(I.head.text=W>>8&1),512&I.flags&&(R[0]=255&W,R[1]=W>>>8&255,I.check=o(I.check,R,2,0)),Y=W=0,I.mode=3;case 3:for(;Y<32;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.head&&(I.head.time=W),512&I.flags&&(R[0]=255&W,R[1]=W>>>8&255,R[2]=W>>>16&255,R[3]=W>>>24&255,I.check=o(I.check,R,4,0)),Y=W=0,I.mode=4;case 4:for(;Y<16;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.head&&(I.head.xflags=255&W,I.head.os=W>>8),512&I.flags&&(R[0]=255&W,R[1]=W>>>8&255,I.check=o(I.check,R,2,0)),Y=W=0,I.mode=5;case 5:if(1024&I.flags){for(;Y<16;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.length=W,I.head&&(I.head.extra_len=W),512&I.flags&&(R[0]=255&W,R[1]=W>>>8&255,I.check=o(I.check,R,2,0)),Y=W=0}else I.head&&(I.head.extra=null);I.mode=6;case 6:if(1024&I.flags&&(L<(Z=I.length)&&(Z=L),Z&&(I.head&&(S=I.head.extra_len-I.length,I.head.extra||(I.head.extra=new Array(I.head.extra_len)),a.arraySet(I.head.extra,$,H,Z,S)),512&I.flags&&(I.check=o(I.check,$,Z,H)),L-=Z,H+=Z,I.length-=Z),I.length))break e;I.length=0,I.mode=7;case 7:if(2048&I.flags){if(L===0)break e;for(Z=0;S=$[H+Z++],I.head&&S&&I.length<65536&&(I.head.name+=String.fromCharCode(S)),S&&Z<L;);if(512&I.flags&&(I.check=o(I.check,$,Z,H)),L-=Z,H+=Z,S)break e}else I.head&&(I.head.name=null);I.length=0,I.mode=8;case 8:if(4096&I.flags){if(L===0)break e;for(Z=0;S=$[H+Z++],I.head&&S&&I.length<65536&&(I.head.comment+=String.fromCharCode(S)),S&&Z<L;);if(512&I.flags&&(I.check=o(I.check,$,Z,H)),L-=Z,H+=Z,S)break e}else I.head&&(I.head.comment=null);I.mode=9;case 9:if(512&I.flags){for(;Y<16;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(W!==(65535&I.check)){k.msg="header crc mismatch",I.mode=30;break}Y=W=0}I.head&&(I.head.hcrc=I.flags>>9&1,I.head.done=!0),k.adler=I.check=0,I.mode=12;break;case 10:for(;Y<32;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}k.adler=I.check=E(W),Y=W=0,I.mode=11;case 11:if(I.havedict===0)return k.next_out=ee,k.avail_out=Ee,k.next_in=H,k.avail_in=L,I.hold=W,I.bits=Y,2;k.adler=I.check=1,I.mode=12;case 12:if(j===5||j===6)break e;case 13:if(I.last){W>>>=7&Y,Y-=7&Y,I.mode=27;break}for(;Y<3;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}switch(I.last=1&W,Y-=1,3&(W>>>=1)){case 0:I.mode=14;break;case 1:if(te(I),I.mode=20,j!==6)break;W>>>=2,Y-=2;break e;case 2:I.mode=17;break;case 3:k.msg="invalid block type",I.mode=30}W>>>=2,Y-=2;break;case 14:for(W>>>=7&Y,Y-=7&Y;Y<32;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if((65535&W)!=(W>>>16^65535)){k.msg="invalid stored block lengths",I.mode=30;break}if(I.length=65535&W,Y=W=0,I.mode=15,j===6)break e;case 15:I.mode=16;case 16:if(Z=I.length){if(L<Z&&(Z=L),Ee<Z&&(Z=Ee),Z===0)break e;a.arraySet(re,$,H,Z,ee),L-=Z,H+=Z,Ee-=Z,ee+=Z,I.length-=Z;break}I.mode=12;break;case 17:for(;Y<14;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(I.nlen=257+(31&W),W>>>=5,Y-=5,I.ndist=1+(31&W),W>>>=5,Y-=5,I.ncode=4+(15&W),W>>>=4,Y-=4,286<I.nlen||30<I.ndist){k.msg="too many length or distance symbols",I.mode=30;break}I.have=0,I.mode=18;case 18:for(;I.have<I.ncode;){for(;Y<3;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.lens[se[I.have++]]=7&W,W>>>=3,Y-=3}for(;I.have<19;)I.lens[se[I.have++]]=0;if(I.lencode=I.lendyn,I.lenbits=7,X={bits:I.lenbits},Q=h(0,I.lens,0,19,I.lencode,0,I.work,X),I.lenbits=X.bits,Q){k.msg="invalid code lengths set",I.mode=30;break}I.have=0,I.mode=19;case 19:for(;I.have<I.nlen+I.ndist;){for(;Le=(M=I.lencode[W&(1<<I.lenbits)-1])>>>16&255,at=65535&M,!((xe=M>>>24)<=Y);){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(at<16)W>>>=xe,Y-=xe,I.lens[I.have++]=at;else{if(at===16){for(N=xe+2;Y<N;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(W>>>=xe,Y-=xe,I.have===0){k.msg="invalid bit length repeat",I.mode=30;break}S=I.lens[I.have-1],Z=3+(3&W),W>>>=2,Y-=2}else if(at===17){for(N=xe+3;Y<N;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}Y-=xe,S=0,Z=3+(7&(W>>>=xe)),W>>>=3,Y-=3}else{for(N=xe+7;Y<N;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}Y-=xe,S=0,Z=11+(127&(W>>>=xe)),W>>>=7,Y-=7}if(I.have+Z>I.nlen+I.ndist){k.msg="invalid bit length repeat",I.mode=30;break}for(;Z--;)I.lens[I.have++]=S}}if(I.mode===30)break;if(I.lens[256]===0){k.msg="invalid code -- missing end-of-block",I.mode=30;break}if(I.lenbits=9,X={bits:I.lenbits},Q=h(u,I.lens,0,I.nlen,I.lencode,0,I.work,X),I.lenbits=X.bits,Q){k.msg="invalid literal/lengths set",I.mode=30;break}if(I.distbits=6,I.distcode=I.distdyn,X={bits:I.distbits},Q=h(p,I.lens,I.nlen,I.ndist,I.distcode,0,I.work,X),I.distbits=X.bits,Q){k.msg="invalid distances set",I.mode=30;break}if(I.mode=20,j===6)break e;case 20:I.mode=21;case 21:if(6<=L&&258<=Ee){k.next_out=ee,k.avail_out=Ee,k.next_in=H,k.avail_in=L,I.hold=W,I.bits=Y,l(k,fe),ee=k.next_out,re=k.output,Ee=k.avail_out,H=k.next_in,$=k.input,L=k.avail_in,W=I.hold,Y=I.bits,I.mode===12&&(I.back=-1);break}for(I.back=0;Le=(M=I.lencode[W&(1<<I.lenbits)-1])>>>16&255,at=65535&M,!((xe=M>>>24)<=Y);){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(Le&&(240&Le)==0){for(We=xe,pt=Le,Ie=at;Le=(M=I.lencode[Ie+((W&(1<<We+pt)-1)>>We)])>>>16&255,at=65535&M,!(We+(xe=M>>>24)<=Y);){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}W>>>=We,Y-=We,I.back+=We}if(W>>>=xe,Y-=xe,I.back+=xe,I.length=at,Le===0){I.mode=26;break}if(32&Le){I.back=-1,I.mode=12;break}if(64&Le){k.msg="invalid literal/length code",I.mode=30;break}I.extra=15&Le,I.mode=22;case 22:if(I.extra){for(N=I.extra;Y<N;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.length+=W&(1<<I.extra)-1,W>>>=I.extra,Y-=I.extra,I.back+=I.extra}I.was=I.length,I.mode=23;case 23:for(;Le=(M=I.distcode[W&(1<<I.distbits)-1])>>>16&255,at=65535&M,!((xe=M>>>24)<=Y);){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if((240&Le)==0){for(We=xe,pt=Le,Ie=at;Le=(M=I.distcode[Ie+((W&(1<<We+pt)-1)>>We)])>>>16&255,at=65535&M,!(We+(xe=M>>>24)<=Y);){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}W>>>=We,Y-=We,I.back+=We}if(W>>>=xe,Y-=xe,I.back+=xe,64&Le){k.msg="invalid distance code",I.mode=30;break}I.offset=at,I.extra=15&Le,I.mode=24;case 24:if(I.extra){for(N=I.extra;Y<N;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}I.offset+=W&(1<<I.extra)-1,W>>>=I.extra,Y-=I.extra,I.back+=I.extra}if(I.offset>I.dmax){k.msg="invalid distance too far back",I.mode=30;break}I.mode=25;case 25:if(Ee===0)break e;if(Z=fe-Ee,I.offset>Z){if((Z=I.offset-Z)>I.whave&&I.sane){k.msg="invalid distance too far back",I.mode=30;break}Ce=Z>I.wnext?(Z-=I.wnext,I.wsize-Z):I.wnext-Z,Z>I.length&&(Z=I.length),Ue=I.window}else Ue=re,Ce=ee-I.offset,Z=I.length;for(Ee<Z&&(Z=Ee),Ee-=Z,I.length-=Z;re[ee++]=Ue[Ce++],--Z;);I.length===0&&(I.mode=21);break;case 26:if(Ee===0)break e;re[ee++]=I.length,Ee--,I.mode=21;break;case 27:if(I.wrap){for(;Y<32;){if(L===0)break e;L--,W|=$[H++]<<Y,Y+=8}if(fe-=Ee,k.total_out+=fe,I.total+=fe,fe&&(k.adler=I.check=I.flags?o(I.check,re,fe,ee-fe):r(I.check,re,fe,ee-fe)),fe=Ee,(I.flags?W:E(W))!==I.check){k.msg="incorrect data check",I.mode=30;break}Y=W=0}I.mode=28;case 28:if(I.wrap&&I.flags){for(;Y<32;){if(L===0)break e;L--,W+=$[H++]<<Y,Y+=8}if(W!==(4294967295&I.total)){k.msg="incorrect length check",I.mode=30;break}Y=W=0}I.mode=29;case 29:Q=1;break e;case 30:Q=-3;break e;case 31:return-4;case 32:default:return d}return k.next_out=ee,k.avail_out=Ee,k.next_in=H,k.avail_in=L,I.hold=W,I.bits=Y,(I.wsize||fe!==k.avail_out&&I.mode<30&&(I.mode<27||j!==4))&&de(k,k.output,k.next_out,fe-k.avail_out)?(I.mode=31,-4):(me-=k.avail_in,fe-=k.avail_out,k.total_in+=me,k.total_out+=fe,I.total+=fe,I.wrap&&fe&&(k.adler=I.check=I.flags?o(I.check,re,fe,k.next_out-fe):r(I.check,re,fe,k.next_out-fe)),k.data_type=I.bits+(I.last?64:0)+(I.mode===12?128:0)+(I.mode===20||I.mode===15?256:0),(me==0&&fe===0||j===4)&&Q===f&&(Q=-5),Q)},n.inflateEnd=function(k){if(!k||!k.state)return d;var j=k.state;return j.window&&(j.window=null),k.state=null,f},n.inflateGetHeader=function(k,j){var I;return k&&k.state?(2&(I=k.state).wrap)==0?d:((I.head=j).done=!1,f):d},n.inflateSetDictionary=function(k,j){var I,$=j.length;return k&&k.state?(I=k.state).wrap!==0&&I.mode!==11?d:I.mode===11&&r(1,j,$,0)!==I.check?-3:de(k,j,$,$)?(I.mode=31,-4):(I.havedict=1,f):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var a=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(u,p,f,d,y,g,T,E){var b,_,O,w,U,B,K,V,te,de=E.bits,k=0,j=0,I=0,$=0,re=0,H=0,ee=0,L=0,Ee=0,W=0,Y=null,me=0,fe=new a.Buf16(16),Z=new a.Buf16(16),Ce=null,Ue=0;for(k=0;k<=15;k++)fe[k]=0;for(j=0;j<d;j++)fe[p[f+j]]++;for(re=de,$=15;1<=$&&fe[$]===0;$--);if($<re&&(re=$),$===0)return y[g++]=20971520,y[g++]=20971520,E.bits=1,0;for(I=1;I<$&&fe[I]===0;I++);for(re<I&&(re=I),k=L=1;k<=15;k++)if(L<<=1,(L-=fe[k])<0)return-1;if(0<L&&(u===0||$!==1))return-1;for(Z[1]=0,k=1;k<15;k++)Z[k+1]=Z[k]+fe[k];for(j=0;j<d;j++)p[f+j]!==0&&(T[Z[p[f+j]]++]=j);if(B=u===0?(Y=Ce=T,19):u===1?(Y=r,me-=257,Ce=o,Ue-=257,256):(Y=l,Ce=h,-1),k=I,U=g,ee=j=W=0,O=-1,w=(Ee=1<<(H=re))-1,u===1&&852<Ee||u===2&&592<Ee)return 1;for(;;){for(K=k-ee,te=T[j]<B?(V=0,T[j]):T[j]>B?(V=Ce[Ue+T[j]],Y[me+T[j]]):(V=96,0),b=1<<k-ee,I=_=1<<H;y[U+(W>>ee)+(_-=b)]=K<<24|V<<16|te|0,_!==0;);for(b=1<<k-1;W&b;)b>>=1;if(b!==0?(W&=b-1,W+=b):W=0,j++,--fe[k]==0){if(k===$)break;k=p[f+T[j]]}if(re<k&&(W&w)!==O){for(ee===0&&(ee=re),U+=I,L=1<<(H=k-ee);H+ee<$&&!((L-=fe[H+ee])<=0);)H++,L<<=1;if(Ee+=1<<H,u===1&&852<Ee||u===2&&592<Ee)return 1;y[O=W&w]=re<<24|H<<16|U-g|0}}return W!==0&&(y[U+W]=k-ee<<24|64<<16|0),E.bits=re,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var a=t("../utils/common"),r=0,o=1;function l(M){for(var R=M.length;0<=--R;)M[R]=0}c(l,"n");var h=0,u=29,p=256,f=p+1+u,d=30,y=19,g=2*f+1,T=15,E=16,b=7,_=256,O=16,w=17,U=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],de=new Array(2*(f+2));l(de);var k=new Array(2*d);l(k);var j=new Array(512);l(j);var I=new Array(256);l(I);var $=new Array(u);l($);var re,H,ee,L=new Array(d);function Ee(M,R,se,ie,z){this.static_tree=M,this.extra_bits=R,this.extra_base=se,this.elems=ie,this.max_length=z,this.has_stree=M&&M.length}c(Ee,"D");function W(M,R){this.dyn_tree=M,this.max_code=0,this.stat_desc=R}c(W,"F");function Y(M){return M<256?j[M]:j[256+(M>>>7)]}c(Y,"N");function me(M,R){M.pending_buf[M.pending++]=255&R,M.pending_buf[M.pending++]=R>>>8&255}c(me,"U");function fe(M,R,se){M.bi_valid>E-se?(M.bi_buf|=R<<M.bi_valid&65535,me(M,M.bi_buf),M.bi_buf=R>>E-M.bi_valid,M.bi_valid+=se-E):(M.bi_buf|=R<<M.bi_valid&65535,M.bi_valid+=se)}c(fe,"P");function Z(M,R,se){fe(M,se[2*R],se[2*R+1])}c(Z,"L");function Ce(M,R){for(var se=0;se|=1&M,M>>>=1,se<<=1,0<--R;);return se>>>1}c(Ce,"j");function Ue(M,R,se){var ie,z,oe=new Array(T+1),Te=0;for(ie=1;ie<=T;ie++)oe[ie]=Te=Te+se[ie-1]<<1;for(z=0;z<=R;z++){var he=M[2*z+1];he!==0&&(M[2*z]=Ce(oe[he]++,he))}}c(Ue,"Z");function xe(M){var R;for(R=0;R<f;R++)M.dyn_ltree[2*R]=0;for(R=0;R<d;R++)M.dyn_dtree[2*R]=0;for(R=0;R<y;R++)M.bl_tree[2*R]=0;M.dyn_ltree[2*_]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}c(xe,"W");function Le(M){8<M.bi_valid?me(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}c(Le,"M");function at(M,R,se,ie){var z=2*R,oe=2*se;return M[z]<M[oe]||M[z]===M[oe]&&ie[R]<=ie[se]}c(at,"H");function We(M,R,se){for(var ie=M.heap[se],z=se<<1;z<=M.heap_len&&(z<M.heap_len&&at(R,M.heap[z+1],M.heap[z],M.depth)&&z++,!at(R,ie,M.heap[z],M.depth));)M.heap[se]=M.heap[z],se=z,z<<=1;M.heap[se]=ie}c(We,"G");function pt(M,R,se){var ie,z,oe,Te,he=0;if(M.last_lit!==0)for(;ie=M.pending_buf[M.d_buf+2*he]<<8|M.pending_buf[M.d_buf+2*he+1],z=M.pending_buf[M.l_buf+he],he++,ie===0?Z(M,z,R):(Z(M,(oe=I[z])+p+1,R),(Te=B[oe])!==0&&fe(M,z-=$[oe],Te),Z(M,oe=Y(--ie),se),(Te=K[oe])!==0&&fe(M,ie-=L[oe],Te)),he<M.last_lit;);Z(M,_,R)}c(pt,"K");function Ie(M,R){var se,ie,z,oe=R.dyn_tree,Te=R.stat_desc.static_tree,he=R.stat_desc.has_stree,_e=R.stat_desc.elems,Ze=-1;for(M.heap_len=0,M.heap_max=g,se=0;se<_e;se++)oe[2*se]!==0?(M.heap[++M.heap_len]=Ze=se,M.depth[se]=0):oe[2*se+1]=0;for(;M.heap_len<2;)oe[2*(z=M.heap[++M.heap_len]=Ze<2?++Ze:0)]=1,M.depth[z]=0,M.opt_len--,he&&(M.static_len-=Te[2*z+1]);for(R.max_code=Ze,se=M.heap_len>>1;1<=se;se--)We(M,oe,se);for(z=_e;se=M.heap[1],M.heap[1]=M.heap[M.heap_len--],We(M,oe,1),ie=M.heap[1],M.heap[--M.heap_max]=se,M.heap[--M.heap_max]=ie,oe[2*z]=oe[2*se]+oe[2*ie],M.depth[z]=(M.depth[se]>=M.depth[ie]?M.depth[se]:M.depth[ie])+1,oe[2*se+1]=oe[2*ie+1]=z,M.heap[1]=z++,We(M,oe,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],(function(De,Vt){var js,qt,Ps,lt,Bs,oi,as=Vt.dyn_tree,Di=Vt.max_code,$a=Vt.stat_desc.static_tree,An=Vt.stat_desc.has_stree,Xa=Vt.stat_desc.extra_bits,xn=Vt.stat_desc.extra_base,q=Vt.stat_desc.max_length,ys=0;for(lt=0;lt<=T;lt++)De.bl_count[lt]=0;for(as[2*De.heap[De.heap_max]+1]=0,js=De.heap_max+1;js<g;js++)q<(lt=as[2*as[2*(qt=De.heap[js])+1]+1]+1)&&(lt=q,ys++),as[2*qt+1]=lt,Di<qt||(De.bl_count[lt]++,Bs=0,xn<=qt&&(Bs=Xa[qt-xn]),oi=as[2*qt],De.opt_len+=oi*(lt+Bs),An&&(De.static_len+=oi*($a[2*qt+1]+Bs)));if(ys!==0){do{for(lt=q-1;De.bl_count[lt]===0;)lt--;De.bl_count[lt]--,De.bl_count[lt+1]+=2,De.bl_count[q]--,ys-=2}while(0<ys);for(lt=q;lt!==0;lt--)for(qt=De.bl_count[lt];qt!==0;)Di<(Ps=De.heap[--js])||(as[2*Ps+1]!==lt&&(De.opt_len+=(lt-as[2*Ps+1])*as[2*Ps],as[2*Ps+1]=lt),qt--)}})(M,R),Ue(oe,Ze,M.bl_count)}c(Ie,"Y");function S(M,R,se){var ie,z,oe=-1,Te=R[1],he=0,_e=7,Ze=4;for(Te===0&&(_e=138,Ze=3),R[2*(se+1)+1]=65535,ie=0;ie<=se;ie++)z=Te,Te=R[2*(ie+1)+1],++he<_e&&z===Te||(he<Ze?M.bl_tree[2*z]+=he:z!==0?(z!==oe&&M.bl_tree[2*z]++,M.bl_tree[2*O]++):he<=10?M.bl_tree[2*w]++:M.bl_tree[2*U]++,oe=z,Ze=(he=0)===Te?(_e=138,3):z===Te?(_e=6,3):(_e=7,4))}c(S,"X");function Q(M,R,se){var ie,z,oe=-1,Te=R[1],he=0,_e=7,Ze=4;for(Te===0&&(_e=138,Ze=3),ie=0;ie<=se;ie++)if(z=Te,Te=R[2*(ie+1)+1],!(++he<_e&&z===Te)){if(he<Ze)for(;Z(M,z,M.bl_tree),--he!=0;);else z!==0?(z!==oe&&(Z(M,z,M.bl_tree),he--),Z(M,O,M.bl_tree),fe(M,he-3,2)):he<=10?(Z(M,w,M.bl_tree),fe(M,he-3,3)):(Z(M,U,M.bl_tree),fe(M,he-11,7));oe=z,Ze=(he=0)===Te?(_e=138,3):z===Te?(_e=6,3):(_e=7,4)}}c(Q,"V"),l(L);var X=!1;function N(M,R,se,ie){fe(M,(h<<1)+(ie?1:0),3),(function(z,oe,Te,he){Le(z),me(z,Te),me(z,~Te),a.arraySet(z.pending_buf,z.window,oe,Te,z.pending),z.pending+=Te})(M,R,se)}c(N,"J"),n._tr_init=function(M){X||((function(){var R,se,ie,z,oe,Te=new Array(T+1);for(z=ie=0;z<u-1;z++)for($[z]=ie,R=0;R<1<<B[z];R++)I[ie++]=z;for(I[ie-1]=z,z=oe=0;z<16;z++)for(L[z]=oe,R=0;R<1<<K[z];R++)j[oe++]=z;for(oe>>=7;z<d;z++)for(L[z]=oe<<7,R=0;R<1<<K[z]-7;R++)j[256+oe++]=z;for(se=0;se<=T;se++)Te[se]=0;for(R=0;R<=143;)de[2*R+1]=8,R++,Te[8]++;for(;R<=255;)de[2*R+1]=9,R++,Te[9]++;for(;R<=279;)de[2*R+1]=7,R++,Te[7]++;for(;R<=287;)de[2*R+1]=8,R++,Te[8]++;for(Ue(de,f+1,Te),R=0;R<d;R++)k[2*R+1]=5,k[2*R]=Ce(R,5);re=new Ee(de,B,p+1,f,T),H=new Ee(k,K,0,d,T),ee=new Ee(new Array(0),V,0,y,b)})(),X=!0),M.l_desc=new W(M.dyn_ltree,re),M.d_desc=new W(M.dyn_dtree,H),M.bl_desc=new W(M.bl_tree,ee),M.bi_buf=0,M.bi_valid=0,xe(M)},n._tr_stored_block=N,n._tr_flush_block=function(M,R,se,ie){var z,oe,Te=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=(function(he){var _e,Ze=4093624447;for(_e=0;_e<=31;_e++,Ze>>>=1)if(1&Ze&&he.dyn_ltree[2*_e]!==0)return r;if(he.dyn_ltree[18]!==0||he.dyn_ltree[20]!==0||he.dyn_ltree[26]!==0)return o;for(_e=32;_e<p;_e++)if(he.dyn_ltree[2*_e]!==0)return o;return r})(M)),Ie(M,M.l_desc),Ie(M,M.d_desc),Te=(function(he){var _e;for(S(he,he.dyn_ltree,he.l_desc.max_code),S(he,he.dyn_dtree,he.d_desc.max_code),Ie(he,he.bl_desc),_e=y-1;3<=_e&&he.bl_tree[2*te[_e]+1]===0;_e--);return he.opt_len+=3*(_e+1)+5+5+4,_e})(M),z=M.opt_len+3+7>>>3,(oe=M.static_len+3+7>>>3)<=z&&(z=oe)):z=oe=se+5,se+4<=z&&R!==-1?N(M,R,se,ie):M.strategy===4||oe===z?(fe(M,2+(ie?1:0),3),pt(M,de,k)):(fe(M,4+(ie?1:0),3),(function(he,_e,Ze,De){var Vt;for(fe(he,_e-257,5),fe(he,Ze-1,5),fe(he,De-4,4),Vt=0;Vt<De;Vt++)fe(he,he.bl_tree[2*te[Vt]+1],3);Q(he,he.dyn_ltree,_e-1),Q(he,he.dyn_dtree,Ze-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,Te+1),pt(M,M.dyn_ltree,M.dyn_dtree)),xe(M),ie&&Le(M)},n._tr_tally=function(M,R,se){return M.pending_buf[M.d_buf+2*M.last_lit]=R>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&R,M.pending_buf[M.l_buf+M.last_lit]=255&se,M.last_lit++,R===0?M.dyn_ltree[2*se]++:(M.matches++,R--,M.dyn_ltree[2*(I[se]+p+1)]++,M.dyn_dtree[2*Y(R)]++),M.last_lit===M.lit_bufsize-1},n._tr_align=function(M){fe(M,2,3),Z(M,_,de),(function(R){R.bi_valid===16?(me(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):8<=R.bi_valid&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(M)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(a){(function(r,o){if(!r.setImmediate){var l,h,u,p,f=1,d={},y=!1,g=r.document,T=Object.getPrototypeOf&&Object.getPrototypeOf(r);T=T&&T.setTimeout?T:r,l={}.toString.call(r.process)==="[object process]"?function(O){process.nextTick(function(){b(O)})}:(function(){if(r.postMessage&&!r.importScripts){var O=!0,w=r.onmessage;return r.onmessage=function(){O=!1},r.postMessage("","*"),r.onmessage=w,O}})()?(p="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",_,!1):r.attachEvent("onmessage",_),function(O){r.postMessage(p+O,"*")}):r.MessageChannel?((u=new MessageChannel).port1.onmessage=function(O){b(O.data)},function(O){u.port2.postMessage(O)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(O){var w=g.createElement("script");w.onreadystatechange=function(){b(O),w.onreadystatechange=null,h.removeChild(w),w=null},h.appendChild(w)}):function(O){setTimeout(b,0,O)},T.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var w=new Array(arguments.length-1),U=0;U<w.length;U++)w[U]=arguments[U+1];var B={callback:O,args:w};return d[f]=B,l(f),f++},T.clearImmediate=E}function E(O){delete d[O]}c(E,"f");function b(O){if(y)setTimeout(b,0,O);else{var w=d[O];if(w){y=!0;try{(function(U){var B=U.callback,K=U.args;switch(K.length){case 0:B();break;case 1:B(K[0]);break;case 2:B(K[0],K[1]);break;case 3:B(K[0],K[1],K[2]);break;default:B.apply(o,K)}})(w)}finally{E(O),y=!1}}}}c(b,"c");function _(O){O.source===r&&typeof O.data=="string"&&O.data.indexOf(p)===0&&b(+O.data.slice(p.length))}c(_,"d")})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof Dn<"u"?Dn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Tr)),Tr.exports}c(dS,"requireJszip_min");var pS=dS();const fS=aT(pS),Od=class Od extends As{ERR_USERNAME="invalid username";ERR_PASSWORD="invalid password";ERR_ACCOUNT_EXIST="account doesn't exist";ERR_PASSWORD_MATCH="password doesn't match";ERR_NO_SAVES="No save files found";ERR_TOO_MANY_SAVES="Too many save files found";googleImage;discordImage;usernameInfoImage;saveDownloadImage;externalPartyContainer;infoContainer;externalPartyBg;externalPartyTitle;constructor(e=null){super(e)}setup(){super.setup(),this.buildExternalPartyContainer(),this.buildInfoContainer()}buildExternalPartyContainer(){this.externalPartyContainer=s.add.container(0,0),this.externalPartyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width/2,s.scaledCanvas.height/2),Phaser.Geom.Rectangle.Contains),this.externalPartyTitle=P(0,4,"",A.SETTINGS_LABEL),this.externalPartyTitle.setOrigin(.5,0),this.externalPartyBg=ye(0,0,0,0),this.externalPartyContainer.add(this.externalPartyBg),this.externalPartyContainer.add(this.externalPartyTitle),this.googleImage=this.buildInteractableImage("google","google-icon"),this.discordImage=this.buildInteractableImage("discord","discord-icon"),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.getUi().add(this.externalPartyContainer),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.externalPartyContainer.setVisible(!1)}buildInfoContainer(){this.infoContainer=s.add.container(0,0),this.usernameInfoImage=this.buildInteractableImage("settings_icon","username-info-icon",{x:20,scale:.5}),this.saveDownloadImage=this.buildInteractableImage("saving_icon","save-download-icon",{x:0,scale:.75}),this.infoContainer.add(this.usernameInfoImage),this.infoContainer.add(this.saveDownloadImage),this.getUi().add(this.infoContainer),this.infoContainer.setVisible(!1),this.infoContainer.disableInteractive()}getModalTitle(e){return m.t("menu:login")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[m.t("menu:login"),m.t("menu:register")]}getReadableErrorMessage(e){const t=e?.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case this.ERR_USERNAME:return m.t("menu:invalidLoginUsername");case this.ERR_PASSWORD:return m.t("menu:invalidLoginPassword");case this.ERR_ACCOUNT_EXIST:return m.t("menu:accountNonExistent");case this.ERR_PASSWORD_MATCH:return m.t("menu:unmatchingPassword");case this.ERR_NO_SAVES:return"P01: "+m.t("menu:noSaves");case this.ERR_TOO_MANY_SAVES:return"P02: "+m.t("menu:tooManySaves")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:m.t("menu:username")}),e.push({label:m.t("menu:password"),isPassword:!0}),e}show(e){if(super.show(e)){const t=e[0];this.processExternalProvider(t);const i=this.submitAction;return this.submitAction=n=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const a=c(l=>{s.ui.setMode(x.LOGIN_FORM,Object.assign(t,{errorMessage:l?.trim()})),s.ui.playError()},"onFail");if(!this.inputs[0].text)return a(m.t("menu:emptyUsername"));const[r,o]=this.inputs;nt.account.login({username:r.text,password:o.text}).then(l=>{!l&&i?i():a(l)})}},!0}return!1}clear(){super.clear(),this.externalPartyContainer.setVisible(!1),this.infoContainer.setVisible(!1),this.setMouseCursorStyle("default"),[this.discordImage,this.googleImage,this.usernameInfoImage,this.saveDownloadImage].forEach(e=>e.off("pointerdown"))}processExternalProvider(e){this.externalPartyTitle.setText(m.t("menu:orUse")??""),this.externalPartyTitle.setX(20+this.externalPartyTitle.text.length),this.externalPartyTitle.setVisible(!0),this.externalPartyContainer.setPositionRelative(this.modalContainer,175,0),this.externalPartyContainer.setVisible(!0),this.externalPartyBg.setSize(this.externalPartyTitle.text.length+50,this.modalBg.height),this.getUi().moveTo(this.externalPartyContainer,this.getUi().length-1),this.googleImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-60),this.discordImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-40),this.infoContainer.setPosition(5,-76),this.infoContainer.setVisible(!0),this.getUi().moveTo(this.infoContainer,this.getUi().length-1),this.usernameInfoImage.setPositionRelative(this.infoContainer,0,0),this.saveDownloadImage.setPositionRelative(this.infoContainer,20,0),this.discordImage.on("pointerdown",()=>{const a=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(a,"_self")}),this.googleImage.on("pointerdown",()=>{const a=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&response_type=code&scope=openid`;window.open(a,"_self")});const t=c(i=>{s.ui.setMode(x.LOADING,{buttonActions:[]}),s.ui.setModeForceTransition(x.LOGIN_FORM,Object.assign(e,{errorMessage:i?.trim()})),s.ui.playError()},"onFail");this.usernameInfoImage.on("pointerdown",()=>{if(s.tweens.getTweensOf(this.infoContainer).length===0){const i=Object.keys(localStorage),n="data_",a=i.filter(r=>r.indexOf(n)>=0);if(a.length>0&&a.length<=2){const r=[];for(let o=0;o<a.length;o++)r.push({label:a[o].replace(n,""),handler:c(()=>(s.ui.revertMode(),this.infoContainer.disableInteractive(),!0),"handler")});s.ui.setOverlayMode(x.OPTION_SELECT,{options:r,delay:1e3}),this.infoContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width,s.game.canvas.height),Phaser.Geom.Rectangle.Contains)}else return a.length>2?t(this.ERR_TOO_MANY_SAVES):t(this.ERR_NO_SAVES)}}),this.saveDownloadImage.on("pointerdown",()=>{const i=Object.keys(localStorage),n="data_",a="sessionData",r=i.filter(l=>l.indexOf(n)>=0),o=i.filter(l=>l.indexOf(a)>=0);if(r.length>0||o.length>0){const l=new fS;for(let h=0;h<r.length;h++)l.file(r[h]+".prsv",localStorage.getItem(r[h]));for(let h=0;h<o.length;h++)l.file(o[h]+".prsv",localStorage.getItem(o[h]));l.generateAsync({type:"blob"}).then(h=>{const u=URL.createObjectURL(h),p=document.createElement("a");p.href=u,p.download="pokerogue_saves.zip",p.click(),URL.revokeObjectURL(u)})}else return t(this.ERR_NO_SAVES)}),this.externalPartyContainer.setAlpha(0),s.tweens.add({targets:this.externalPartyContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),this.infoContainer.setAlpha(0),s.tweens.add({targets:this.infoContainer,duration:ge(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1})}buildInteractableImage(e,t,i={}){const{scale:n=.07,x:a=0,y:r=0,origin:o={x:0,y:0}}=i,l=s.add.image(a,r,e);return l.setName(t),l.setOrigin(o.x,o.y),l.setScale(n),l.setInteractive(),this.addInteractionHoverEffect(l),l}};c(Od,"LoginFormUiHandler");let Kl=Od;const Vp=-150,gS=0,Hp=0,wd=class wd extends Phaser.GameObjects.Container{defaultWidth;defaultHeight;bg;musicText;shown;constructor(){super(s,Vp,Hp)}setup(){this.defaultWidth=230,this.defaultHeight=100,this.bg=s.add.nineslice(-5,-5,"bgm_bar",void 0,this.defaultWidth,this.defaultHeight,0,0,10,10),this.bg.setOrigin(0,0),this.add(this.bg),this.musicText=P(5,5,"",A.BGM_BAR),this.musicText.setOrigin(0,0),this.musicText.setWordWrapWidth(650,!0),this.add(this.musicText),this.setVisible(!1),this.shown=!1}setBgmToBgmBar(e){this.musicText.setText(`${m.t("bgmName:music")}${this.getRealBgmName(e)}`),this.musicText.width=this.bg.width-20,this.musicText.setWordWrapWidth(this.defaultWidth*4),this.bg.width=Math.min(this.defaultWidth,this.musicText.displayWidth+23),this.bg.height=Math.min(this.defaultHeight,this.musicText.displayHeight+20),s.fieldUI.bringToTop(this),this.y=Hp}toggleBgmBar(e){if(this.musicText.text===""){this.setVisible(!1);return}if(!s.showBgmBar){this.setVisible(!1);return}s.tweens.add({targets:this,x:e?gS:Vp,duration:500,ease:"Sine.easeInOut",onComplete:c(()=>{this.setVisible(!0)},"onComplete")})}getRealBgmName(e){return m.t([`bgmName:${Tt(e)}`,"bgmName:missingEntries"],{name:wi(e)})}};c(wd,"BgmBar");let zl=wd;var $i=(C=>(C[C.GAME_SETTINGS=0]="GAME_SETTINGS",C[C.ACHIEVEMENTS=1]="ACHIEVEMENTS",C[C.STATS=2]="STATS",C[C.EGG_LIST=3]="EGG_LIST",C[C.EGG_GACHA=4]="EGG_GACHA",C[C.POKEDEX=5]="POKEDEX",C[C.MANAGE_DATA=6]="MANAGE_DATA",C[C.COMMUNITY=7]="COMMUNITY",C[C.SAVE_AND_QUIT=8]="SAVE_AND_QUIT",C[C.LOG_OUT=9]="LOG_OUT",C))($i||{});let Yp="https://wiki.pokerogue.net/start";const mS="https://discord.gg/pokerogue",yS="https://github.com/pagefaultgames/pokerogue",TS="https://www.reddit.com/r/pokerogue",SS="https://github.com/sponsors/pagefaultgames",Md=class Md extends Bt{textPadding=8;defaultMessageBoxWidth=220;defaultWordWrapWidth=1224;menuContainer;menuMessageBoxContainer;menuOverlay;menuBg;optionSelectText;cursorObj;excludedMenus;menuOptions;manageDataConfig;communityConfig;menuMessageBox;dialogueMessageBox;scale=.1666666667;bgmBar;constructor(e=null){super(e),this.excludedMenus=()=>[{condition:[x.COMMAND,x.TITLE].includes(e??x.TITLE),options:[4,3]},{condition:ra,options:[9]}],this.menuOptions=Is($i).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t)))}setup(){const e=this.getUi(),t=m.resolvedLanguage?.substring(0,2);["de","fr","ko","zh"].includes(t)&&(Yp=`https://wiki.pokerogue.net/${t}:start`),this.bgmBar=new zl,this.bgmBar.setup(),e.bgmBar=this.bgmBar,this.menuContainer=s.add.container(1,-s.scaledCanvas.height+1),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height),Phaser.Geom.Rectangle.Contains),this.menuOverlay=new Phaser.GameObjects.Rectangle(s,-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,16777215,.3),this.menuOverlay.setName("menu-overlay"),this.menuOverlay.setOrigin(0,0),this.menuContainer.add(this.menuOverlay),this.menuContainer.add(this.bgmBar),this.menuContainer.setVisible(!1)}render(){const e=this.getUi();this.excludedMenus=()=>[{condition:!!s.phaseManager.getCurrentPhase()?.is("SelectModifierPhase"),options:[4]},{condition:ra,options:[9]}],this.menuOptions=Is($i).filter(r=>!this.excludedMenus().some(o=>o.condition&&o.options.includes(r))),this.optionSelectText=P(0,0,this.menuOptions.map(r=>`${m.t(`menuUiHandler:${Tt($i[r])}`)}`).join(`
`),A.WINDOW,{maxLines:this.menuOptions.length}),this.optionSelectText.setLineSpacing(12),this.scale=gh(A.WINDOW,s.uiTheme).scale,this.menuBg=ye(s.scaledCanvas.width-(this.optionSelectText.displayWidth+25),0,this.optionSelectText.displayWidth+19+24*this.scale,s.scaledCanvas.height-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPositionRelative(this.menuBg,10+24*this.scale,6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.menuMessageBox=ye(0,0,this.defaultMessageBoxWidth,48),this.menuMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.menuMessageBox),this.dialogueMessageBox=ye(-this.textPadding,0,s.scaledCanvas.width+this.textPadding*2,49,!1,!1,0,0,is.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const t=P(this.textPadding,this.textPadding,"",A.WINDOW,{maxLines:2});t.setName("menu-message"),t.setOrigin(0,0),this.menuMessageBoxContainer.add(t),this.initTutorialOverlay(this.menuContainer),this.initPromptSprite(this.menuMessageBoxContainer),this.message=t,this.setDialogTestMode(!1),this.menuContainer.add(this.menuMessageBoxContainer);const i=[],n=c((r,o,l)=>{e.revertMode(),e.showText(r,null,()=>{const h={options:new Array(5).fill(null).map((u,p)=>p).filter(o).map(u=>({label:m.t("menuUiHandler:slot",{slotNumber:u+1}),handler:c(()=>(l(u),e.revertMode(),e.showText("",0),!0),"handler")})).concat([{label:m.t("menuUiHandler:cancel"),handler:c(()=>(e.revertMode(),e.showText("",0),!0),"handler")}]),xOffset:98};e.setOverlayMode(x.MENU_OPTION_SELECT,h)})},"confirmSlot");(Ci||cr)&&i.push({label:m.t("menuUiHandler:importSession"),handler:c(()=>(n(m.t("menuUiHandler:importSlotSelect"),()=>!0,r=>s.gameData.importData(qe.SESSION,r)),!0),"handler"),keepOpen:!0}),i.push({label:m.t("menuUiHandler:exportSession"),handler:c(()=>{const r=[];return Promise.all(new Array(5).fill(null).map((o,l)=>{const h=l;return s.gameData.getSession(h).then(u=>{u&&r.push(h)})})).then(()=>{n(m.t("menuUiHandler:exportSlotSelect"),o=>r.indexOf(o)>-1,o=>s.gameData.tryExportData(qe.SESSION,o))}),!0},"handler"),keepOpen:!0}),i.push({label:m.t("menuUiHandler:importRunHistory"),handler:c(()=>(s.gameData.importData(qe.RUN_HISTORY),!0),"handler"),keepOpen:!0}),i.push({label:m.t("menuUiHandler:exportRunHistory"),handler:c(()=>(s.gameData.tryExportData(qe.RUN_HISTORY),!0),"handler"),keepOpen:!0}),(Ci||cr)&&i.push({label:m.t("menuUiHandler:importData"),handler:c(()=>(e.revertMode(),s.gameData.importData(qe.SYSTEM),!0),"handler"),keepOpen:!0}),i.push({label:m.t("menuUiHandler:exportData"),handler:c(()=>(s.gameData.tryExportData(qe.SYSTEM),!0),"handler"),keepOpen:!0},{label:m.t("menu:changePassword"),handler:c(()=>(e.setOverlayMode(x.CHANGE_PASSWORD_FORM,{buttonActions:[()=>e.revertMode(),()=>e.revertMode()]}),!0),"handler"),keepOpen:!0},{label:m.t("menuUiHandler:consentPreferences"),handler:c(()=>{const r=document.querySelector(".termly-display-preferences"),o=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return r.dispatchEvent(o),r.focus(),!0},"handler"),keepOpen:!0}),(Ci||cr)&&i.push({label:"Test Dialogue",handler:c(()=>{e.playSelect();const r="",o={};return o.buttonActions=[l=>{e.revertMode(),e.playSelect();const u=decodeURIComponent(escape(atob(l))),p=e.getHandler();p.tutorialActive=!0;const f={},d=u.split(" "),y=d[0],g=/\{\{(\w*)\}\}/g,T=m.t(y).match(g)??[];if(T.length>0)for(let E=0;E<T.length;E++)typeof d[E+1]<"u"&&(f[T[E].replace(/\W/g,"")]=m.t(d[E+1]));this.setDialogTestMode(!0),e.showText(String(m.t(y,f)),null,()=>s.ui.showText("",0,()=>{p.tutorialActive=!1,this.setDialogTestMode(!1)}),null,!0)},()=>{e.revertMode()}],e.setMode(x.TEST_DIALOGUE,o,r),!0},"handler"),keepOpen:!0}),i.push({label:m.t("menuUiHandler:cancel"),handler:c(()=>(s.ui.revertMode(),!0),"handler"),keepOpen:!0}),this.manageDataConfig={xOffset:98,options:i,maxOptions:7};const a=[{label:"Wiki",handler:c(()=>(window.open(Yp,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"Discord",handler:c(()=>(window.open(mS,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"GitHub",handler:c(()=>(window.open(yS,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:"Reddit",handler:c(()=>(window.open(TS,"_blank")?.focus(),!0),"handler"),keepOpen:!0},{label:m.t("menuUiHandler:donate"),handler:c(()=>(window.open(SS,"_blank")?.focus(),!0),"handler"),keepOpen:!0}];ke?.hasAdminRole&&a.push({label:"Admin",handler:c(()=>{const r=[Nl.ADMIN],o=[];return Object.values(Nl).filter(l=>!Number.isNaN(Number(l))&&!r.includes(l)).forEach(l=>{o.push({label:uS(l),handler:c(()=>(e.playSelect(),e.setOverlayMode(x.ADMIN,{buttonActions:[()=>{e.revertMode(),e.revertMode()},()=>{e.revertMode(),e.revertMode()}]},l),!0),"handler")})}),o.push({label:"Cancel",handler:c(()=>(e.revertMode(),!0),"handler")}),s.ui.setOverlayMode(x.OPTION_SELECT,{options:o,delay:0}),!0},"handler"),keepOpen:!0}),a.push({label:m.t("menuUiHandler:cancel"),handler:c(()=>(s.ui.revertMode(),!0),"handler")}),this.communityConfig={xOffset:98,options:a},this.setCursor(0)}show(e){return this.render(),super.show(e),this.menuOptions=Is($i).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t))),this.menuContainer.setVisible(!0),this.setCursor(0),this.getUi().moveTo(this.menuContainer,this.getUi().length-1),this.getUi().hideTooltip(),s.playSound("ui/menu_open"),this.menuContainer.bringToTop(this.tutorialOverlay),this.menuContainer.bringToTop(this.menuMessageBoxContainer),Oi(ws.Menu),this.bgmBar.toggleBgmBar(!0),!0}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===v.ACTION){let a=this.cursor;const r=this.excludedMenus().find(o=>o.condition);if(r!==void 0&&r.options!==void 0&&r.options.length>0){const o=r.options.sort();for(const l of o)if(a>=l)a++;else break}switch(this.showText("",0),a){case 0:t.setOverlayMode(x.SETTINGS),i=!0;break;case 1:t.setOverlayMode(x.ACHIEVEMENTS),i=!0;break;case 2:t.setOverlayMode(x.GAME_STATS),i=!0;break;case 3:s.gameData.eggs.length?(t.revertMode(),t.setOverlayMode(x.EGG_LIST),i=!0):(t.showText(m.t("menuUiHandler:noEggs"),null,()=>t.showText(""),ge(1500)),n=!0);break;case 4:t.revertMode(),t.setOverlayMode(x.EGG_GACHA),i=!0;break;case 5:t.revertMode(),t.setOverlayMode(x.POKEDEX),i=!0;break;case 6:this.manageDataConfig.options.some(o=>o.label===m.t("menuUiHandler:linkDiscord")||o.label===m.t("menuUiHandler:unlinkDiscord"))||this.manageDataConfig.options.splice(this.manageDataConfig.options.length-1,0,{label:ke?.discordId===""?m.t("menuUiHandler:linkDiscord"):m.t("menuUiHandler:unlinkDiscord"),handler:c(()=>{if(ke?.discordId===""){const o=br(Qs),u=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&state=${o}&prompt=none`;return window.open(u,"_self"),!0}return nt.unlinkDiscord().then(o=>{ts().then(()=>s.reset(!0,!0))}),!0},"handler")},{label:ke?.googleId===""?m.t("menuUiHandler:linkGoogle"):m.t("menuUiHandler:unlinkGoogle"),handler:c(()=>{if(ke?.googleId===""){const o=br(Qs),u=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&response_type=code&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&scope=openid&state=${o}`;return window.open(u,"_self"),!0}return nt.unlinkGoogle().then(o=>{ts().then(()=>s.reset(!0,!0))}),!0},"handler")}),t.setOverlayMode(x.MENU_OPTION_SELECT,this.manageDataConfig),i=!0;break;case 7:t.setOverlayMode(x.MENU_OPTION_SELECT,this.communityConfig),i=!0;break;case 8:if(s.currentBattle){i=!0;const o=c(()=>{t.setMode(x.LOADING,{buttonActions:[],fadeOut:c(()=>s.gameData.saveAll(!0,!0,!0,!0).then(()=>{s.reset(!0)}),"fadeOut")})},"doSaveQuit");s.currentBattle.turn>1?t.showText(m.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(x.CONFIRM,o,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):o()}else n=!0;break;case 9:{i=!0;const o=c(()=>{t.setMode(x.LOADING,{buttonActions:[],fadeOut:c(()=>nt.account.logout().then(()=>{ts().then(()=>s.reset(!0,!0))}),"fadeOut")})},"doLogout");s.currentBattle?t.showText(m.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(x.CONFIRM,o,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):o();break}}}else if(e===v.CANCEL)i=!0,t.revertMode().then(a=>{a||t.setMode(x.MESSAGE)});else switch(e){case v.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case v.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break}return i?t.playSelect():n&&t.playError(),i||n}setDialogTestMode(e){this.menuMessageBox.setVisible(!e),this.dialogueMessageBox.setVisible(e),this.message.setWordWrapWidth(e?s.ui.getMessageHandler().wordWrapWidth:this.defaultWordWrapWidth),this.message.setX(e?this.textPadding+1:this.textPadding),this.message.setY(e?this.textPadding+.4:this.textPadding)}showText(e,t,i,n,a,r){this.menuMessageBoxContainer.setVisible(!!e),super.showText(e,t,i,n,a,r)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale),t}clear(){super.clear(),this.menuContainer.setVisible(!1),this.bgmBar.toggleBgmBar(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};c(Md,"MenuUiHandler");let jl=Md;const Nd=class Nd extends zs{cursorContainer;cursorObj;optionsContainer;optionScrollTweens=new Array(4).fill(null);tooltipWindow;tooltipContainer;tooltipScrollTween;descriptionWindow;descriptionContainer;descriptionScrollTween;rarityBall;dexProgressWindow;dexProgressContainer;showDexProgress=!1;overrideSettings;encounterOptions=[];optionsMeetsReqs;viewPartyIndex=0;viewPartyXPosition=0;blockInput=!0;constructor(){super(x.MYSTERY_ENCOUNTER)}setup(){const e=this.getUi();this.cursorContainer=s.add.container(18,-38.7),this.cursorContainer.setVisible(!1),e.add(this.cursorContainer),this.optionsContainer=s.add.container(12,-38.7),this.optionsContainer.setVisible(!1),e.add(this.optionsContainer),this.dexProgressContainer=s.add.container(214,-43),this.dexProgressContainer.setVisible(!1),e.add(this.dexProgressContainer),this.descriptionContainer=s.add.container(0,-152),this.descriptionContainer.setVisible(!1),e.add(this.descriptionContainer),this.tooltipContainer=s.add.container(210,-48),this.tooltipContainer.setVisible(!1),e.add(this.tooltipContainer),this.setCursor(this.getCursor()),this.descriptionWindow=ye(0,0,150,105,!1,!1,0,0,is.THIN),this.descriptionContainer.add(this.descriptionWindow),this.tooltipWindow=ye(0,0,110,48,!1,!1,0,0,is.THIN),this.tooltipContainer.add(this.tooltipWindow),this.dexProgressWindow=ye(0,0,24,28,!1,!1,0,0,is.THIN),this.dexProgressContainer.add(this.dexProgressWindow),this.rarityBall=s.add.sprite(141,9,"pb"),this.rarityBall.setScale(.75),this.descriptionContainer.add(this.rarityBall);const t=s.add.sprite(12,10,"encounter_radar");t.setScale(.8),this.dexProgressContainer.add(t),this.dexProgressContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,24,28),Phaser.Geom.Rectangle.Contains)}show(e){super.show(e),this.overrideSettings=e[0]??{};const t=ve(this.overrideSettings?.hideDescription)?!0:!this.overrideSettings.hideDescription,i=ve(this.overrideSettings?.slideInDescription)?!0:this.overrideSettings.slideInDescription,n=this.overrideSettings?.startingCursorIndex??0;this.cursorContainer.setVisible(!0),this.descriptionContainer.setVisible(t),this.optionsContainer.setVisible(!0),this.dexProgressContainer.setVisible(!0),this.displayEncounterOptions(i);const a=this.getCursor();return a===(this.optionsContainer?.length||0)-1?this.setCursor(a):this.setCursor(n),this.blockInput&&setTimeout(()=>{this.unblockInput()},1e3),this.displayOptionTooltip(),!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();if(e===v.CANCEL||e===v.ACTION){if(e===v.ACTION){const a=this.encounterOptions[n];if(n===this.viewPartyIndex){i=!0;const r={...this.overrideSettings,slideInDescription:!1};s.ui.setMode(x.PARTY,tn.CHECK,-1,()=>{s.ui.setMode(x.MYSTERY_ENCOUNTER,r),setTimeout(()=>{this.setCursor(this.viewPartyIndex),this.unblockInput()},300)})}else this.blockInput||!this.optionsMeetsReqs[n]&&(a.optionMode===Ts.DISABLED_OR_DEFAULT||a.optionMode===Ts.DISABLED_OR_SPECIAL)?i=!1:s.phaseManager.getCurrentPhase().handleOptionSelect(a,n)?i=!0:t.playError()}}else{switch(this.optionsContainer.getAll()?.length){default:case 3:i=this.handleTwoOptionMoveInput(e);break;case 4:i=this.handleThreeOptionMoveInput(e);break;case 5:i=this.handleFourOptionMoveInput(e);break}this.displayOptionTooltip()}return i&&t.playSelect(),i}handleTwoOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case v.UP:i<this.viewPartyIndex&&(t=this.setCursor(this.viewPartyIndex));break;case v.DOWN:i===this.viewPartyIndex&&(t=this.setCursor(1));break;case v.LEFT:i>0&&(t=this.setCursor(i-1));break;case v.RIGHT:i<this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}handleThreeOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case v.UP:i===2?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case v.DOWN:i===this.viewPartyIndex?t=this.setCursor(1):t=this.setCursor(2);break;case v.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i===1&&(t=this.setCursor(i-1));break;case v.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i<1&&(t=this.setCursor(i+1));break}return t}handleFourOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case v.UP:i>=2&&i!==this.viewPartyIndex?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case v.DOWN:i<=1?t=this.setCursor(i+2):i===this.viewPartyIndex&&(t=this.setCursor(1));break;case v.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i%2===1&&(t=this.setCursor(i-1));break;case v.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i%2===0&&i!==this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}unblockInput(){if(this.blockInput){this.blockInput=!1;for(let e=0;e<this.optionsContainer.length-1;e++){const t=this.encounterOptions[e].optionMode;!this.optionsMeetsReqs[e]&&(t===Ts.DISABLED_OR_DEFAULT||t===Ts.DISABLED_OR_SPECIAL)||this.optionsContainer.getAt(e).setAlpha(1)}}}getCursor(){return this.cursor?this.cursor:0}setCursor(e){const i=this.getCursor()!==e;return i&&(this.cursor=e),this.viewPartyIndex=this.optionsContainer.getAll()?.length-1,this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorContainer.add(this.cursorObj)),e===this.viewPartyIndex?this.cursorObj.setPosition(this.viewPartyXPosition,-17):this.optionsContainer.getAll()?.length===3?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),15):this.optionsContainer.getAll()?.length===4?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)):this.optionsContainer.getAll()?.length===5&&this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)),i}displayEncounterOptions(e=!0){this.getUi().clearText();const t=s.currentBattle.mysteryEncounter;this.encounterOptions=this.overrideSettings?.overrideOptions??t.options,this.optionsMeetsReqs=[];const i=jt(t.dialogue.encounterOptionsDialogue?.title,A.TOOLTIP_TITLE),n=jt(t.dialogue.encounterOptionsDialogue?.description,A.TOOLTIP_CONTENT),a=jt(t.dialogue.encounterOptionsDialogue?.query,A.TOOLTIP_CONTENT);this.optionsContainer.removeAll(!0);for(let g=0;g<this.encounterOptions.length;g++){const T=this.encounterOptions[g];let E;switch(this.encounterOptions.length){default:case 2:E=St(g%2===0?0:100,8,"-",A.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 3:E=St(g%2===0?0:100,g<2?0:16,"-",A.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 4:E=St(g%2===0?0:100,g<2?0:16,"-",A.WINDOW,{fontSize:"80px",lineSpacing:-8});break}this.optionsMeetsReqs.push(T.meetsRequirements());const b=T.dialogue,_=!this.optionsMeetsReqs[g]&&b.disabledButtonLabel?b.disabledButtonLabel:b.buttonLabel;let O;T.hasRequirements()&&this.optionsMeetsReqs[g]&&(T.optionMode===Ts.DEFAULT_OR_SPECIAL||T.optionMode===Ts.DISABLED_OR_SPECIAL)?O=jt(_,A.ME_OPTION_SPECIAL):O=jt(_,b.style?b.style:A.ME_OPTION_DEFAULT),O&&E.setText(O),!this.optionsMeetsReqs[g]&&(T.optionMode===Ts.DISABLED_OR_DEFAULT||T.optionMode===Ts.DISABLED_OR_SPECIAL)&&E.setAlpha(.5),this.blockInput&&E.setAlpha(.5);const w=90,U=s.make.graphics({});U.setScale(6),U.fillStyle(16777215),U.beginPath(),U.fillRect(E.x+11,E.y+140,w,18);const B=U.createGeometryMask();E.setMask(B);const K=E.displayWidth,V=this.optionScrollTweens[g];V&&(V.remove(),this.optionScrollTweens[g]=null),K>w&&(this.optionScrollTweens[g]=s.tweens.add({targets:E,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((K-w)/15*2e3),x:`-=${K-w}`})),this.optionsContainer.add(E)}const r=St(s.scaledCanvas.width,-24,rr(m.t("mysteryEncounterMessages:viewPartyButton"),A.PARTY),A.PARTY);this.optionsContainer.add(r),r.x-=r.displayWidth+16,this.viewPartyXPosition=r.x-10;const o=St(0,0,i??"",A.TOOLTIP_TITLE,{wordWrap:{width:750},align:"center",lineSpacing:-8});this.descriptionContainer.add(o),o.setPosition(72-o.displayWidth/2,5.5);const l=t.encounterTier===ft.COMMON?0:t.encounterTier===ft.GREAT?1:t.encounterTier===ft.ULTRA?2:t.encounterTier===ft.ROGUE?3:4,h=Ji(l);this.rarityBall.setTexture("pb",h);const u=St(6,25,n??"",A.TOOLTIP_CONTENT,{wordWrap:{width:830}}),p=s.make.graphics({});p.setScale(6),p.fillStyle(16777215),p.beginPath(),p.fillRect(6,53,206,57);const f=p.createGeometryMask();u.setMask(f);const d=Math.floor(u.displayHeight/9.2);this.descriptionScrollTween&&(this.descriptionScrollTween.remove(),this.descriptionScrollTween=void 0),d>6&&(this.descriptionScrollTween=s.tweens.add({targets:u,delay:ge(2e3),loop:-1,hold:ge(2e3),duration:ge((d-6)*2e3),y:`-=${10*(d-6)}`})),this.descriptionContainer.add(u);const y=St(0,0,a??"",A.TOOLTIP_CONTENT,{wordWrap:{width:830}});this.descriptionContainer.add(y),y.setPosition(75-y.displayWidth/2,90),e&&(this.descriptionContainer.x-=150,s.tweens.add({targets:this.descriptionContainer,x:"+=150",ease:"Sine.easeInOut",duration:1e3}))}displayOptionTooltip(){const e=this.getCursor();if(this.tooltipContainer.length>1&&this.tooltipContainer.removeBetween(1,this.tooltipContainer.length,!0),this.tooltipContainer.setVisible(!0),ve(e)||e>this.optionsContainer.length-2){this.showHideDexProgress(!1);return}let t;const i=this.encounterOptions[e],n=i.dialogue;if(!this.optionsMeetsReqs[e]&&(i.optionMode===Ts.DISABLED_OR_DEFAULT||i.optionMode===Ts.DISABLED_OR_SPECIAL)&&n.disabledButtonTooltip?t=jt(n.disabledButtonTooltip,A.TOOLTIP_CONTENT):t=jt(n.buttonTooltip,A.TOOLTIP_CONTENT),t){const a=[...t.match(new RegExp(/\[color=[^[]*\]\[shadow=[^[]*\]/i))][0];t=t.replace(/(\(\+\)[^([]*)/gi,r=>"[/color][/shadow]"+rr(r,A.SUMMARY_GREEN)+"[/color][/shadow]"+a),t=t.replace(/(\(-\)[^([]*)/gi,r=>"[/color][/shadow]"+rr(r,A.SUMMARY_BLUE)+"[/color][/shadow]"+a)}if(t){const a=St(6,7,t,A.TOOLTIP_CONTENT,{wordWrap:{width:600},fontSize:"72px",padding:{top:8},lineSpacing:1.25});this.tooltipContainer.add(a);const r=s.make.graphics({});r.setScale(6),r.fillStyle(16777215),r.beginPath(),r.fillRect(this.tooltipContainer.x,this.tooltipContainer.y+188.5,150,32);const o=r.createGeometryMask();a.setMask(o);const l=Math.floor(a.displayHeight/10.2);this.tooltipScrollTween&&(this.tooltipScrollTween.remove(),this.tooltipScrollTween=void 0),l>3&&(this.tooltipScrollTween=s.tweens.add({targets:a,delay:ge(1200),loop:-1,hold:ge(1200),duration:ge((l-3)*1200),y:`-=${11.2*(l-3)}`}))}i.hasDexProgress&&!this.showDexProgress?this.showHideDexProgress(!0):i.hasDexProgress||this.showHideDexProgress(!1)}clear(){super.clear(),this.overrideSettings=void 0,this.optionsContainer.setVisible(!1),this.optionsContainer.removeAll(!0),this.dexProgressContainer.setVisible(!1),this.descriptionContainer.setVisible(!1),this.tooltipContainer.setVisible(!1),this.descriptionContainer.removeBetween(2,this.descriptionContainer.length,!0),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=void 0}showHideDexProgress(e){e&&!this.showDexProgress?(this.showDexProgress=!0,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-63,ease:"Sine.easeInOut",duration:750,onComplete:c(()=>{this.dexProgressContainer.on("pointerover",()=>{s.ui.showTooltip("",m.t("mysteryEncounterMessages:affectsPokedex"),!0)}),this.dexProgressContainer.on("pointerout",()=>{s.ui.hideTooltip()})},"onComplete")})):!e&&this.showDexProgress&&(this.showDexProgress=!1,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-43,ease:"Sine.easeInOut",duration:750,onComplete:c(()=>{this.dexProgressContainer.off("pointerover"),this.dexProgressContainer.off("pointerout")},"onComplete")}))}};c(Nd,"MysteryEncounterUiHandler");let $l=Nd;const kd=class kd extends As{keys;reducedKeys;parallelKeys;nameKeys;moveKeys;abilityKeys;row;setup(){super.setup(),this.nameKeys=it.map(e=>e.name).filter((e,t,i)=>i.indexOf(e)===t),this.moveKeys=Fe.map(e=>e.name),this.abilityKeys=Et.map(e=>e.name)}getModalTitle(e){return m.t("pokedexUiHandler:scanChooseOption")}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[m.t("pokedexUiHandler:scanSelect"),m.t("pokedexUiHandler:scanCancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){switch(this.row){case dt.NAME:return[{label:m.t("pokedexUiHandler:scanLabelName")}];case dt.MOVE_1:case dt.MOVE_2:return[{label:m.t("pokedexUiHandler:scanLabelMove")}];case dt.ABILITY_1:return[{label:m.t("pokedexUiHandler:scanLabelAbility")}];case dt.ABILITY_2:return[{label:m.t("pokedexUiHandler:scanLabelPassive")}];default:return[{label:""}]}}reduceKeys(){switch(this.row){case dt.NAME:{this.reducedKeys=this.nameKeys;break}case dt.MOVE_1:case dt.MOVE_2:{this.reducedKeys=this.moveKeys;break}case dt.ABILITY_1:case dt.ABILITY_2:{this.reducedKeys=this.abilityKeys;break}default:this.reducedKeys=this.keys}}show(e){this.row=e[2];const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),this.reduceKeys(),setTimeout(()=>{n.setFocus()},50),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===x.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===x.AUTO_COMPLETE&&t.revertMode();let o=[];const l=this.reducedKeys.filter(h=>h.toLowerCase().includes(a.text.toLowerCase()));if(a.text!==""&&l.length>0&&(o=l.slice(0).map(h=>({label:h,handler:c(()=>((!ve(r.data)||r.inputType?.toLowerCase()==="deletecontentbackward")&&a.setText(h),t.revertMode(),!0),"handler")}))),o.length>0){const h={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(x.AUTO_COMPLETE,h)}}),super.show(e)){const a=e[0],r=this.formLabels[0],o=r.width<420?200:200-(r.width-420)/5.75;return this.inputs[0].resize(o*5.75,116),this.inputContainers[0].list[0].width=o,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=l=>{if(t.getMode()===x.POKEDEX_SCAN){this.sanitizeInputs();const h=this.reducedKeys.includes(this.inputs[0].text)?this.inputs[0].text:"",u=btoa(unescape(encodeURIComponent(h)));return a.buttonActions[0](u),!0}return!1},!0}return!1}clear(){super.clear(),this.formLabels.forEach(e=>{e.destroy()})}};c(kd,"PokedexScanUiHandler");let Xl=kd;const Pd=class Pd extends As{getModalTitle(e){return m.t("menu:register")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonTopMargin(){return 12}getButtonLabels(e){return[m.t("menu:register"),m.t("menu:backToLogin")]}getReadableErrorMessage(e){const t=e?.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case"invalid username":return m.t("menu:invalidRegisterUsername");case"invalid password":return m.t("menu:invalidRegisterPassword");case"failed to add account record":return m.t("menu:usernameAlreadyUsed")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:m.t("menu:username")}),e.push({label:m.t("menu:password"),isPassword:!0}),e.push({label:m.t("menu:confirmPassword"),isPassword:!0}),e}setup(){super.setup();const e=P(10,87,m.t("menu:registrationAgeWarning"),A.TOOLTIP_CONTENT,{fontSize:"42px",wordWrap:{width:850}});this.modalContainer.add(e)}show(e){if(super.show(e)){const t=e[0],i=this.submitAction;return this.submitAction=n=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(x.LOADING,{buttonActions:[]});const a=c(l=>{s.ui.setMode(x.REGISTRATION_FORM,Object.assign(t,{errorMessage:l?.trim()})),s.ui.playError()},"onFail");if(!this.inputs[0].text)return a(m.t("menu:emptyUsername"));if(!this.inputs[1].text)return a(this.getReadableErrorMessage("invalid password"));if(this.inputs[1].text!==this.inputs[2].text)return a(m.t("menu:passwordNotMatchingConfirmPassword"));const[r,o]=this.inputs;nt.account.register({username:r.text,password:o.text}).then(l=>{l?a(l):nt.account.login({username:r.text,password:o.text}).then(h=>{h?a(h):i?.()})})}},!0}return!1}};c(Pd,"RegistrationFormUiHandler");let ql=Pd;const Bd=class Bd extends As{getModalTitle(e){return m.t("menu:renamePokemon")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[m.t("menu:rename"),m.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:m.t("menu:nickname")}]}show(e){if(super.show(e)){const t=e[0];return e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender(!1):this.inputs[0].text=e[1],this.submitAction=i=>{this.sanitizeInputs();const n=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return t.buttonActions[0](n),!0},!0}return!1}};c(Bd,"RenameFormUiHandler");let Ql=Bd;const Ld=class Ld extends Phaser.GameObjects.Container{icon;animActive;shown;constructor(){super(s,s.scaledCanvas.width-4,s.scaledCanvas.height-4)}setup(){this.icon=s.add.sprite(0,0,"saving_icon"),this.icon.setOrigin(1,1),this.add(this.icon),this.animActive=!1,this.shown=!1,this.setAlpha(0),this.setVisible(!1)}show(){this.shown=!0,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:1,duration:ge(250),ease:"Sine.easeInOut",onComplete:c(()=>{s.time.delayedCall(ge(500),()=>{this.animActive=!1,this.shown||this.hide()})},"onComplete")}),this.setVisible(!0),this.shown=!0)}hide(){this.shown=!1,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:0,duration:ge(250),ease:"Sine.easeInOut",onComplete:c(()=>{this.animActive=!1,this.setVisible(!1),this.shown&&this.show()},"onComplete")}),this.shown=!1)}};c(Ld,"SavingIconHandler");let Zl=Ld;const Dd=class Dd extends Bi{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,`Your session is out of date.
Your data will be reloaded`,A.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}show(e){const t={buttonActions:[]};return super.show([t])}};c(Dd,"SessionReloadModalUiHandler");let Jl=Dd;const Rd=class Rd extends zs{fieldIndex;move;targetSelectCallback;cursor0;cursor1;isMultipleTargets=!1;targets;targetsHighlighted;targetFlashTween;enemyModifiers;targetBattleInfoMoveTween=[];constructor(){super(x.TARGET_SELECT),this.cursor=-1}setup(){}show(e){if(e.length<3)return!1;super.show(e),this.fieldIndex=e[0],this.move=e[1],this.targetSelectCallback=e[2];const t=s.getPlayerField()[this.fieldIndex],i=lh(t,this.move);return this.targets=i.targets,this.isMultipleTargets=i.multiple??!1,this.targets.length?(this.enemyModifiers=s.getModifierBar(!0),this.fieldIndex===ct.PLAYER?this.resetCursor(this.cursor0,t):this.fieldIndex===ct.PLAYER_2&&this.resetCursor(this.cursor1,t),!0):!1}resetCursor(e,t){ve(e)||([ct.PLAYER,ct.PLAYER_2].includes(e)||t.tempSummonData.waveTurnCount===1)&&(e=-1),this.setCursor(this.targets.includes(e)?e:this.targets[0])}processInput(e){const t=this.getUi();let i=!1;if(e===v.ACTION||e===v.CANCEL){const n=this.isMultipleTargets?this.targets:[this.cursor];this.targetSelectCallback(e===v.ACTION?n:[]),i=!0,this.fieldIndex===ct.PLAYER?(ve(this.cursor0)||this.cursor0!==this.cursor)&&(this.cursor0=this.cursor):this.fieldIndex===ct.PLAYER_2&&(ve(this.cursor1)||this.cursor1!==this.cursor)&&(this.cursor1=this.cursor)}else if(this.isMultipleTargets)i=!1;else switch(e){case v.UP:this.cursor<ct.ENEMY&&this.targets.findIndex(n=>n>=ct.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n>=ct.ENEMY)));break;case v.DOWN:this.cursor>=ct.ENEMY&&this.targets.findIndex(n=>n<ct.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n<ct.ENEMY)));break;case v.LEFT:this.cursor%2&&this.targets.findIndex(n=>n===this.cursor-1)>-1&&(i=this.setCursor(this.cursor-1));break;case v.RIGHT:!(this.cursor%2)&&this.targets.findIndex(n=>n===this.cursor+1)>-1&&(i=this.setCursor(this.cursor+1));break}return i&&t.playSelect(),i}setCursor(e){const t=s.getField()[e],i=this.targets.map(r=>s.getField()[r]);this.targetsHighlighted=this.isMultipleTargets?i:[t];const n=super.setCursor(e);if(this.targetFlashTween){this.targetFlashTween.stop();for(const r of i)r.setAlpha(r.getTag(vs)?.5:1),this.highlightItems(r.id,1)}if(this.targetFlashTween=s.tweens.add({targets:this.targetsHighlighted,key:{start:1,to:.25},loop:-1,loopDelay:150,duration:ge(450),ease:"Sine.easeInOut",yoyo:!0,onUpdate:c(r=>{for(const o of this.targetsHighlighted)o.setAlpha(r.getValue()??1),this.highlightItems(o.id,r.getValue()??1)},"onUpdate")}),this.targetBattleInfoMoveTween.length>=1){this.targetBattleInfoMoveTween.filter(r=>r!==void 0).forEach(r=>r.stop());for(const r of i)r.getBattleInfo().resetY()}return this.targetsHighlighted.map(r=>r.getBattleInfo()).map(r=>{this.targetBattleInfoMoveTween.push(s.tweens.add({targets:[r],y:{start:r.getBaseY(),to:r.getBaseY()+1},loop:-1,duration:ge(250),ease:"Linear",yoyo:!0}))}),n}eraseCursor(){this.targetFlashTween&&(this.targetFlashTween.stop(),this.targetFlashTween=null);for(const e of this.targetsHighlighted)e.setAlpha(e.getTag(vs)?.5:1),this.highlightItems(e.id,1);this.targetBattleInfoMoveTween.length>=1&&(this.targetBattleInfoMoveTween.filter(e=>e!==void 0).forEach(e=>e.stop()),this.targetBattleInfoMoveTween=[]);for(const e of this.targetsHighlighted)e.getBattleInfo().resetY()}highlightItems(e,t){const i=this.enemyModifiers.getAll("name",e.toString());for(const n of i)n.setAlpha(t)}clear(){super.clear(),this.eraseCursor()}};c(Rd,"TargetSelectUiHandler");let eh=Rd;const Fd=class Fd extends As{keys;setup(){super.setup();const e=c((n,a,r)=>Object.keys(n??{}).map((o,l)=>{const h=Object.values(n)[l];if(typeof h=="object"&&!ve(h))return e(h,a??o,a?r?[...r,o]:[o]:void 0).filter(u=>u.length>0);if(typeof h=="string"||ve(h))return r?`${a}:${r.join(".")}.${o}`:`${a}:${o}`}).filter(o=>o),"flattenKeys"),i=e(m.getDataByLanguage(String(m.resolvedLanguage))).filter(n=>n.length>0).flat(Number.POSITIVE_INFINITY).map(String);this.keys=i}getModalTitle(e){return"Test Dialogue"}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return["Check","Cancel"]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:"Dialogue"}]}show(e){const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===x.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===x.AUTO_COMPLETE&&t.revertMode();let o=[];const l=a.text.split(" "),h=this.keys.filter(u=>u.toLowerCase().includes(l[l.length-1].toLowerCase()));if(a.text!==""&&h.length>0&&(o=h.slice(0).map(u=>({label:u,handler:c(()=>{if(!ve(r.data)||r.inputType?.toLowerCase()==="deletecontentbackward"){const p=a.text.split(" ");p[p.length-1]=u,a.setText(p.join(" "))}return t.revertMode(),!0},"handler")}))),o.length>0){const u={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(x.AUTO_COMPLETE,u)}}),super.show(e)){const a=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=r=>{if(t.getMode()===x.TEST_DIALOGUE){this.sanitizeInputs();const o=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return a.buttonActions[0](o),!0}return!1},!0}return!1}};c(Fd,"TestDialogueUiHandler");let th=Fd;const Ud=class Ud extends Bi{reconnectTimer;reconnectDuration;reconnectCallback;minTime=1e3*5;maxTime=1e3*60*5;randVarianceTime=1e3*10;constructor(e=null){super(e),this.reconnectDuration=this.minTime}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 64}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=P(this.getWidth()/2,this.getHeight()/2,m.t("menu:errorServerDown"),A.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}tryReconnect(){ts().then(e=>{e[0]||[200,400].includes(e[1])?(this.reconnectTimer=null,this.reconnectDuration=this.minTime,s.playSound("se/pb_bounce_1"),this.reconnectCallback()):e[1]===401?(Xn(Qs),s.reset(!0,!0)):(this.reconnectDuration=Math.min(this.reconnectDuration*2,this.maxTime),this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration+Math.random()*this.randVarianceTime))})}show(e){if(e.length>=1&&e[0]instanceof Function){const t={buttonActions:[]};return this.reconnectCallback=e[0],this.reconnectDuration=this.minTime,this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration),super.show([t])}return!1}};c(Ud,"UnavailableModalUiHandler");let sh=Ud;const Vd=class Vd extends As{getModalTitle(e){return m.t("menu:renameRun")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[m.t("menu:rename"),m.t("menu:cancel")]}getReadableErrorMessage(e){const t=e?.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:m.t("menu:runName")}]}show(e){if(!super.show(e))return!1;this.inputs?.length&&this.inputs.forEach(i=>{i.text=""});const t=e[0];return this.submitAction=i=>{this.sanitizeInputs();const n=btoa(encodeURIComponent(this.inputs[0].text));return t.buttonActions[0](n),!0},!0}};c(Vd,"RenameRunFormUiHandler");let ih=Vd;const Gp=[x.SAVE_SLOT,x.PARTY,x.SUMMARY,x.STARTER_SELECT,x.EVOLUTION_SCENE,x.EGG_HATCH_SCENE,x.EGG_LIST,x.EGG_GACHA,x.POKEDEX,x.POKEDEX_PAGE,x.CHALLENGE_SELECT,x.RUN_HISTORY],jn=[x.TITLE,x.CONFIRM,x.OPTION_SELECT,x.MENU,x.MENU_OPTION_SELECT,x.GAMEPAD_BINDING,x.KEYBOARD_BINDING,x.SETTINGS,x.SETTINGS_AUDIO,x.SETTINGS_DISPLAY,x.SETTINGS_GAMEPAD,x.SETTINGS_KEYBOARD,x.ACHIEVEMENTS,x.GAME_STATS,x.POKEDEX_SCAN,x.LOGIN_FORM,x.REGISTRATION_FORM,x.LOADING,x.SESSION_RELOAD,x.UNAVAILABLE,x.RENAME_POKEMON,x.RENAME_RUN,x.TEST_DIALOGUE,x.AUTO_COMPLETE,x.ADMIN,x.MYSTERY_ENCOUNTER,x.RUN_INFO,x.CHANGE_PASSWORD_FORM],Hd=class Hd extends Phaser.GameObjects.Container{mode;modeChain;handlers;overlay;achvBar;bgmBar;savingIcon;tooltipContainer;tooltipBg;tooltipTitle;tooltipContent;overlayActive;constructor(){super(s,0,s.scaledCanvas.height),this.mode=x.MESSAGE,this.modeChain=[],this.handlers=[new Pl,new Zm,new Jm,new ey,new ty,new eh,new sy,new Wo,new ph,new iy,new bn,new pa,new Rl,new Hl,new ca,new fp,new jl,new fp(x.MENU_OPTION_SELECT),new Na,new xa,new Aa,new wa,new Yl,new Ma,new Gl,new wl,new ny,new Fl,new Dl,new Sn,new Xl(x.TEST_DIALOGUE),new Tn,new Kl,new ql,new Wl,new Jl,new sh,new Bl,new Ql,new ih,new Cl,new ya,new th(x.TEST_DIALOGUE),new kl,new Ml,new $l,new Ll]}setup(){this.setName(`ui-${x[this.mode]}`);for(const e of this.handlers)e.setup();this.overlay=s.add.rectangle(0,0,s.scaledCanvas.width,s.scaledCanvas.height,0),this.overlay.setName("rect-ui-overlay"),this.overlay.setOrigin(0,0),s.uiContainer.add(this.overlay),this.overlay.setVisible(!1),this.setupTooltip(),this.achvBar=new Ol,this.achvBar.setup(),s.uiContainer.add(this.achvBar),this.savingIcon=new Zl,this.savingIcon.setup(),s.uiContainer.add(this.savingIcon)}setupTooltip(){this.tooltipContainer=s.add.container(0,0),this.tooltipContainer.setName("tooltip"),this.tooltipContainer.setVisible(!1),this.tooltipBg=ye(0,0,128,31),this.tooltipBg.setName("window-tooltip-bg"),this.tooltipBg.setOrigin(0,0),this.tooltipTitle=P(64,4,"",A.TOOLTIP_TITLE),this.tooltipTitle.setName("text-tooltip-title"),this.tooltipTitle.setOrigin(.5,0),this.tooltipContent=P(6,16,"",A.TOOLTIP_CONTENT),this.tooltipContent.setName("text-tooltip-content"),this.tooltipContent.setWordWrapWidth(850),this.tooltipContainer.add(this.tooltipBg),this.tooltipContainer.add(this.tooltipTitle),this.tooltipContainer.add(this.tooltipContent),s.uiContainer.add(this.tooltipContainer)}getHandler(){return this.handlers[this.mode]}getMessageHandler(){return this.handlers[x.MESSAGE]}processInfoButton(e){return this.overlayActive?!1:[x.CONFIRM,x.COMMAND,x.FIGHT,x.MESSAGE,x.TARGET_SELECT].includes(this.mode)?(s?.processInfoButton(e),!0):(s?.processInfoButton(!1),!0)}processInput(e){if(this.overlayActive)return!1;const t=this.getHandler();return t instanceof ay&&t.tutorialActive?t.processTutorialInput(e):t.processInput(e)}showTextPromise(e,t=0,i=!0,n){return new Promise(a=>{this.showText(e??"",null,()=>a(),t,i,n)})}showText(e,t,i,n,a,r){const o=[],l=["#POKEMON1","#POKEMON2"];for(let h=0;h<s.getPlayerField().length;h++)o.push(s.getPlayerField()[h].getNameToRender()),e=e.split(o[h]).join(l[h]);if(a&&e.indexOf("$")>-1){const h=e.split(/\$/g).map(p=>p.trim());let u=c(()=>i&&i(),"showMessageAndCallback");for(let p=h.length-1;p>=0;p--){const f=u;h[p]=h[p].split(l[0]).join(o[0]),h[p]=h[p].split(l[1]).join(o[1]),u=c(()=>this.showText(h[p],null,f,null,!0),"showMessageAndCallback")}u()}else{const h=this.getHandler();for(let u=0;u<s.getPlayerField().length;u++)e=e.split(l[u]).join(o[u]);h instanceof Bt?h.showText(e,t,i,n,a,r):this.getMessageHandler().showText(e,t,i,n,a,r)}}showDialogue(e,t,i=0,n,a,r){let o=!1,l=e;const h=s.gameData.gender??Be.UNSET,u=Be[h].toLowerCase();if(m.exists(e)){const f=e;if(o=!0,l=m.t(f,{context:u}),this.shouldSkipDialogue(f)){n();return}}let p=c(()=>{o&&s.gameData.saveSeenDialogue(e),n()},"showMessageAndCallback");if(l.indexOf("$")>-1){const f=l.split(/\$/g).map(d=>d.trim());for(let d=f.length-1;d>=0;d--){const y=p;p=c(()=>this.showDialogue(f[d],t,null,y),"showMessageAndCallback")}p()}else{const f=this.getHandler();f instanceof Bt?f.showDialogue(l,t,i,p,a,!0,r):this.getMessageHandler().showDialogue(l,t,i,p,a,!0,r)}}shouldSkipDialogue(e){return!!(m.exists(e)&&s.skipSeenDialogues&&s.gameData.getSeenDialogues()[e]===!0)}getTooltip(){return{visible:this.tooltipContainer.visible,title:this.tooltipTitle.text,content:this.tooltipContent.text}}showTooltip(e,t,i){this.tooltipContainer.setVisible(!0),this.editTooltip(e,t),i?s.uiContainer.moveAbove(this.tooltipContainer,this):s.uiContainer.moveBelow(this.tooltipContainer,this)}editTooltip(e,t){this.tooltipTitle.setText(e||"");const i=this.tooltipContent.runWordWrap(t);this.tooltipContent.setText(i),this.tooltipContent.y=e?16:4,this.tooltipBg.width=Math.min(Math.max(this.tooltipTitle.displayWidth,this.tooltipContent.displayWidth)+12,838),this.tooltipBg.height=(e?31:19)+10.5*(i.split(`
`).length-1),this.tooltipTitle.x=this.tooltipBg.width/2}hideTooltip(){this.tooltipContainer.setVisible(!1),this.tooltipTitle.clearTint()}update(){if(this.tooltipContainer.visible){const e=s.inputMethod==="touch",t=s.game.input.activePointer.x,i=s.game.input.activePointer.y,n=this.tooltipBg.width,a=this.tooltipBg.height,r=2;let o=e?r:t/6+r,l=e?r:i/6+r;e?t<=s.game.canvas.width/2&&i<=s.game.canvas.height/2&&(o=s.scaledCanvas.width-n-r):(o+n+r>s.scaledCanvas.width&&(o=Math.max(r,t/6-n-r)),l+a+r>s.scaledCanvas.height&&(l=Math.max(r,i/6-a-r))),this.tooltipContainer.setPosition(o,l)}}clearText(){const e=this.getHandler();e instanceof Bt?e.clearText():this.getMessageHandler().clearText()}setCursor(e){const t=this.getHandler().setCursor(e);return t&&this.playSelect(),t}playSelect(){s.playSound("ui/select")}playError(){s.playSound("ui/error")}fadeOut(e){return new Promise(t=>{if(this.overlayActive)return t();this.overlayActive=!0,this.overlay.setAlpha(0),this.overlay.setVisible(!0),s.tweens.add({targets:this.overlay,alpha:1,duration:e,ease:"Sine.easeOut",onComplete:c(()=>t(),"onComplete")})})}fadeIn(e){return new Promise(t=>{if(!this.overlayActive)return t();s.tweens.add({targets:this.overlay,alpha:0,duration:e,ease:"Sine.easeIn",onComplete:c(()=>{this.overlay.setVisible(!1),t()},"onComplete")}),this.overlayActive=!1})}setModeInternal(e,t,i,n,a){return new Promise(r=>{if(this.mode===e&&!i){r();return}const o=c(()=>{if(this.mode!==e){t&&this.getHandler().clear(),n&&this.mode&&!t&&(this.modeChain.push(this.mode),s.updateGameInfo()),this.mode=e;const l=document?.getElementById("touchControls");l&&(l.dataset.uiMode=x[e]),this.getHandler().show(a)}r()},"doSetMode");!n&&(Gp.indexOf(this.mode)>-1||Gp.indexOf(e)>-1)&&jn.indexOf(this.mode)===-1&&jn.indexOf(e)===-1||n&&jn.indexOf(e)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{o(),this.fadeIn(250)})}):o()})}getMode(){return this.mode}setMode(e,...t){return this.setModeInternal(e,!0,!1,!1,t)}setModeForceTransition(e,...t){return this.setModeInternal(e,!0,!0,!1,t)}setModeWithoutClear(e,...t){return this.setModeInternal(e,!1,!1,!1,t)}setOverlayMode(e,...t){return this.setModeInternal(e,!1,!1,!0,t)}resetModeChain(){this.modeChain=[],s.updateGameInfo()}revertMode(){return new Promise(e=>{if(!this?.modeChain?.length)return e(!1);const t=this.mode,i=c(()=>{this.getHandler().clear(),this.mode=this.modeChain.pop(),s.updateGameInfo();const n=document.getElementById("touchControls");n&&(n.dataset.uiMode=x[this.mode]),e(!0)},"doRevertMode");jn.indexOf(t)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{i(),this.fadeIn(250)})}):i()})}revertModes(){return new Promise(e=>{if(!this?.modeChain?.length)return e();this.revertMode().then(t=>dh(t,this.revertModes).then(()=>e()))})}getModeChain(){return this.modeChain}getGamepadType(){return s.inputMethod==="gamepad"?s.inputController.getConfig(s.inputController.selectedDevice[Me.GAMEPAD]).padType:s.inputMethod}freeUIData(){this.handlers.forEach(e=>e.destroy()),this.handlers=[],Xt.getInstance().clearNavigationMenus()}};c(Hd,"UI");let nh=Hd;const Yd=class Yd extends ry{rexUI;inputController;uiInputs;sessionPlayTime=null;lastSavePlayTime=null;masterVolume=.5;bgmVolume=1;fieldVolume=1;seVolume=1;uiVolume=1;gameSpeed=1;damageNumbersMode=0;reroll=!1;shopCursorTarget=oy.REWARDS;commandCursorMemory=!1;dexForDevs=!1;showMovesetFlyout=!0;showArenaFlyout=!0;showTimeOfDayWidget=!0;timeOfDayAnimation=Mf.NONE;showLevelUpStats=!0;enableTutorials=!1;enableMoveInfo=!0;enableRetries=!1;hideIvs=!1;candyUpgradeNotification=0;candyUpgradeDisplay=0;moneyFormat=ly.NORMAL;uiTheme=hy.DEFAULT;windowType=0;experimentalSprites=!1;musicPreference=cy.ALLGENS;moveAnimations=!0;expGainsSpeed=Tf.DEFAULT;skipSeenDialogues=!1;eggSkipPreference=0;expParty=ii.DEFAULT;hpBarSpeed=0;fusionPaletteSwaps=!0;enableTouchControls=!1;enableVibration=!1;showBgmBar=!0;hideUsername=!1;battleStyle=Th.SWITCH;typeHints=!1;disableMenu=!1;gameData;sessionSlotId;phaseManager;field;fieldUI;charSprite;pbTray;pbTrayEnemy;abilityBar;partyExpBar;candyBar;arenaBg;arenaBgTransition;arenaPlayer;arenaPlayerTransition;arenaEnemy;arenaNextEnemy;arena;gameMode;score;lockModifierTiers;trainer;lastEnemyTrainer;currentBattle;pokeballCounts;money;pokemonInfoContainer;party;mysteryEncounterSaveData=new Pi;lastMysteryEncounter;biomeWaveText;moneyText;scoreText;luckLabelText;luckText;modifierBar;enemyModifierBar;arenaFlyout;fieldOverlay;shopOverlay;shopOverlayShown=!1;shopOverlayOpacity=.8;modifiers;enemyModifiers;uiContainer;ui;seed;waveSeed;waveCycleOffset;offsetGym;damageNumberHandler;spriteSparkleHandler;fieldSpritePipeline;spritePipeline;bgm;bgmResumeTimer;bgmCache=new Set;playTimeTimer;rngCounter=0;rngSeedOverride="";rngOffset=0;inputMethod;infoToggles=[];eventManager;eventTarget=new EventTarget;constructor(){super("battle"),this.phaseManager=new cl,this.eventManager=new uy,this.updateGameInfo(),rT(this)}loadPokemonAtlas(e,t,i){i===void 0&&(i=this.experimentalSprites);const n=t.includes("variant/")||/_[0-3]$/.test(t);i&&(i=dy(e)),n&&(t=t.replace("variant/","")),this.load.atlas(e,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.png`,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.json`)}async preload(){const e=[Ot.TACKLE,Ot.TAIL_WHIP,Ot.FOCUS_ENERGY,Ot.STRUGGLE];await Promise.all([this.initVariantData(),py().then(()=>fy(!0)),Promise.all(e.map(t=>ch(t))).then(()=>uh(e,!0)),this.initStarterColors()]).catch(t=>{throw new Error(`Unexpected error during BattleScene preLoad!
Reason: ${t}`)})}create(){this.scene.remove(gy.KEY),lS.apply(this),this.inputController=new Nr,this.uiInputs=new yl(this.inputController),this.gameData=new Ba,my(),this.load.setBaseURL(),this.spritePipeline=new ul(this.game),this.renderer.pipelines.add("Sprite",this.spritePipeline),this.fieldSpritePipeline=new Ea(this.game),this.renderer.pipelines.add("FieldSprite",this.fieldSpritePipeline),this.launchBattle()}update(){this.ui?.update()}launchBattle(){this.arenaBg=this.add.sprite(0,0,"plains_bg"),this.arenaBg.setName("sprite-arena-bg"),this.arenaBgTransition=this.add.sprite(0,0,"plains_bg"),this.arenaBgTransition.setName("sprite-arena-bg-transition");for(const h of[this.arenaBgTransition,this.arenaBg])h.setPipeline(this.fieldSpritePipeline),h.setScale(6),h.setOrigin(0),h.setSize(320,240);const e=this.add.container(0,0);e.setName("field"),e.setScale(6),this.field=e;const t=this.add.container(0,this.game.canvas.height);t.setName("field-ui"),t.setDepth(1),t.setScale(6),this.fieldUI=t;const i=this.make.rexTransitionImagePack({x:0,y:0,scale:6,key:"loading_bg",origin:{x:0,y:0}},!0);i.transit({mode:"blinds",ease:"Cubic.easeInOut",duration:1250}),i.once("complete",()=>{i.destroy()}),this.add.existing(i);const n=this.add.container(0,0);n.setName("ui"),n.setDepth(2),n.setScale(6),this.uiContainer=n;const a=this.scaledCanvas.width,r=this.scaledCanvas.height-48;this.fieldOverlay=this.add.rectangle(0,r*-1-48,a,r,4342338),this.fieldOverlay.setName("rect-field-overlay"),this.fieldOverlay.setOrigin(0,0),this.fieldOverlay.setAlpha(0),this.fieldUI.add(this.fieldOverlay),this.shopOverlay=this.add.rectangle(0,r*-1-48,a,r,460551),this.shopOverlay.setName("rect-shop-overlay"),this.shopOverlay.setOrigin(0,0),this.shopOverlay.setAlpha(0),this.fieldUI.add(this.shopOverlay),this.modifiers=[],this.enemyModifiers=[],this.modifierBar=new gp,this.modifierBar.setName("modifier-bar"),this.add.existing(this.modifierBar),n.add(this.modifierBar),this.enemyModifierBar=new gp(!0),this.enemyModifierBar.setName("enemy-modifier-bar"),this.add.existing(this.enemyModifierBar),n.add(this.enemyModifierBar),this.charSprite=new Al,this.charSprite.setName("sprite-char"),this.charSprite.setup(),this.fieldUI.add(this.charSprite),this.pbTray=new La(!0),this.pbTray.setName("pb-tray"),this.pbTray.setup(),this.pbTrayEnemy=new La(!1),this.pbTrayEnemy.setName("enemy-pb-tray"),this.pbTrayEnemy.setup(),this.fieldUI.add(this.pbTray),this.fieldUI.add(this.pbTrayEnemy),this.abilityBar=new bl,this.abilityBar.setName("ability-bar"),this.abilityBar.setup(),this.fieldUI.add(this.abilityBar),this.partyExpBar=new xl,this.partyExpBar.setName("party-exp-bar"),this.partyExpBar.setup(),this.fieldUI.add(this.partyExpBar),this.candyBar=new _l,this.candyBar.setName("candy-bar"),this.candyBar.setup(),this.fieldUI.add(this.candyBar),this.biomeWaveText=P(this.scaledCanvas.width-2,0,or.toString(),A.BATTLE_INFO),this.biomeWaveText.setName("text-biome-wave"),this.biomeWaveText.setOrigin(1,.5),this.fieldUI.add(this.biomeWaveText),this.moneyText=P(this.scaledCanvas.width-2,0,"",A.MONEY),this.moneyText.setName("text-money"),this.moneyText.setOrigin(1,.5),this.fieldUI.add(this.moneyText),this.scoreText=P(this.scaledCanvas.width-2,0,"",A.PARTY,{fontSize:"54px"}),this.scoreText.setName("text-score"),this.scoreText.setOrigin(1,.5),this.fieldUI.add(this.scoreText),this.luckText=P(this.scaledCanvas.width-2,0,"",A.PARTY,{fontSize:"54px"}),this.luckText.setName("text-luck"),this.luckText.setOrigin(1,.5),this.luckText.setVisible(!1),this.fieldUI.add(this.luckText),this.luckLabelText=P(this.scaledCanvas.width-2,0,m.t("common:luckIndicator"),A.PARTY,{fontSize:"54px"}),this.luckLabelText.setName("text-luck-label"),this.luckLabelText.setOrigin(1,.5),this.luckLabelText.setVisible(!1),this.fieldUI.add(this.luckLabelText),this.arenaFlyout=new vl,this.fieldUI.add(this.arenaFlyout),this.fieldUI.moveBelow(this.arenaFlyout,this.fieldOverlay),this.updateUIPositions(),this.damageNumberHandler=new Tl,this.spriteSparkleHandler=new Sl,this.spriteSparkleHandler.setup(),this.pokemonInfoContainer=new un(this.scaledCanvas.width+52,-this.scaledCanvas.height+66),this.pokemonInfoContainer.setup(),this.fieldUI.add(this.pokemonInfoContainer),this.party=[],this.arenaPlayer=new Pn(!0),this.arenaPlayer.setName("arena-player"),this.arenaPlayerTransition=new Pn(!0),this.arenaPlayerTransition.setName("arena-player-transition"),this.arenaEnemy=new Pn(!1),this.arenaEnemy.setName("arena-enemy"),this.arenaNextEnemy=new Pn(!1),this.arenaNextEnemy.setName("arena-next-enemy"),this.arenaBgTransition.setVisible(!1),this.arenaPlayerTransition.setVisible(!1),this.arenaNextEnemy.setVisible(!1);for(const h of[this.arenaPlayer,this.arenaPlayerTransition,this.arenaEnemy,this.arenaNextEnemy])h instanceof rs.GameObjects.Sprite&&h.setOrigin(0,0),e.add(h);const o=this.addFieldSprite(0,0,`trainer_${this.gameData.gender===Be.FEMALE?"f":"m"}_back`);o.setOrigin(.5,1),o.setName("sprite-trainer"),e.add(o),this.trainer=o,this.anims.create({key:"prompt",frames:this.anims.generateFrameNumbers("prompt",{start:1,end:4}),frameRate:6,repeat:-1,showOnStart:!0}),this.anims.create({key:"tera_sparkle",frames:this.anims.generateFrameNumbers("tera_sparkle",{start:0,end:12}),frameRate:18,repeat:0,showOnStart:!0,hideOnComplete:!0}),this.reset(!1,!1,!0);const l=new nh;this.uiContainer.add(l),this.ui=l,l.setup(),this.phaseManager.toTitleScreen(!0),this.phaseManager.shiftPhase()}initSession(){this.sessionPlayTime===null&&(this.sessionPlayTime=0),this.lastSavePlayTime===null&&(this.lastSavePlayTime=0),this.playTimeTimer&&this.playTimeTimer.destroy(),this.playTimeTimer=this.time.addEvent({delay:ge(1e3),repeat:-1,callback:c(()=>{this.gameData&&this.gameData.gameStats.playTime++,this.sessionPlayTime!==null&&this.sessionPlayTime++,this.lastSavePlayTime!==null&&this.lastSavePlayTime++},"callback")}),this.updateBiomeWaveText(),this.updateMoneyText(),this.updateScoreText()}async initExpSprites(){if(mp.size>0)return;const t=await(await this.cachedFetch("./exp-sprites.json")).json();if(!Array.isArray(t))throw new Error("EXP Sprites were not array when fetched!");for(const i of t)mp.add(i)}async initVariantData(){Zy();const e=await this.cachedFetch("./images/pokemon/variant/_masterlist.json").then(i=>i.json());for(const i of Object.keys(e))Ep[i]=e[i];if(!this.experimentalSprites)return;const t=await this.cachedFetch("./images/pokemon/variant/_exp_masterlist.json").then(i=>i.json());yy(Ep,t)}cachedFetch(e,t){const i=this.game.manifest;if(i){const n=i[`/${e.replace("./","")}`];n&&(e+=`?t=${n}`)}return fetch(e,t)}async initStarterColors(){if(Object.keys(yt).length>0)return;const e=await this.cachedFetch("./starter-colors.json").then(t=>t.json());for(const t of Object.keys(e))yt[t]=e[t]}getPlayerParty(){return this.party}getPokemonAllowedInBattle(){return this.getPlayerParty().filter(e=>e.isAllowedInBattle())}getPlayerPokemon(e=!0){return this.getPlayerField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getPlayerField(e=!1){const t=this.getPlayerParty();return t.slice(0,Math.min(t.length,this.currentBattle?.double?2:1)).filter(i=>!e||i.isActive())}getEnemyParty(){return this.currentBattle?.enemyParty??[]}getEnemyPokemon(e=!0){return this.getEnemyField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getEnemyField(){const e=this.getEnemyParty();return e.slice(0,Math.min(e.length,this.currentBattle?.double?2:1))}getField(e=!1){const t=new Array(4).fill(null),i=this.getPlayerField(),n=this.getEnemyField();return t.splice(0,i.length,...i),t.splice(2,n.length,...n),e?t.filter(a=>a?.isActive()):t}redirectPokemonMoves(e,t){if(this.currentBattle.double!==!1&&t?.isActive(!0)){let i;do i=this.phaseManager.findPhase(n=>n.is("MovePhase")&&n.targets.length===1&&n.targets[0]===e.getBattlerIndex()&&n.pokemon.isPlayer()!==t.isPlayer()),i&&i.targets[0]!==t.getBattlerIndex()&&(i.targets[0]=t.getBattlerIndex());while(i)}}getModifierBar(e=!1){return e?this.enemyModifierBar:this.modifierBar}addInfoToggle(...e){this.infoToggles.push(...e)}getInfoToggles(e=!1){return e?this.infoToggles.filter(t=>t?.isActive()):this.infoToggles}getPokemonById(e){return ve(e)?null:this.getPlayerParty().concat(this.getEnemyParty()).find(i=>i.id===e)??null}addPlayerPokemon(e,t,i,n,a,r,o,l,h,u,p){const f=new Ty(e,t,i,n,a,r,o,l,h,u);if(p&&p(f),le.IVS_OVERRIDE!==null)if(Array.isArray(le.IVS_OVERRIDE)){if(le.IVS_OVERRIDE.length!==6)throw new Error("The Player IVs override must be an array of length 6 or a number!");if(le.IVS_OVERRIDE.some(d=>!Bn(d,0,31)))throw new Error("All IVs in the player IV override must be between 0 and 31!");f.ivs=le.IVS_OVERRIDE}else{if(!Bn(le.IVS_OVERRIDE,0,31))throw new Error("The Player IV override must be a value between 0 and 31!");f.ivs=new Array(6).fill(le.IVS_OVERRIDE)}return le.NATURE_OVERRIDE!==null&&(f.nature=le.NATURE_OVERRIDE),f.init(),f}addEnemyPokemon(e,t,i,n=!1,a=!1,r,o){le.ENEMY_LEVEL_OVERRIDE>0&&(t=le.ENEMY_LEVEL_OVERRIDE),le.ENEMY_SPECIES_OVERRIDE&&(e=ns(le.ENEMY_SPECIES_OVERRIDE),n=this.getEncounterBossSegments(this.currentBattle.waveIndex,t,e)>1);const l=new Sy(e,t,i,n,a,r);if(le.ENEMY_FUSION_OVERRIDE&&l.generateFusionSpecies(),n&&!r){const h=Cy(Ve(4294967296));for(let u=0;u<l.ivs.length;u++)l.ivs[u]=Math.round(rs.Math.Linear(Math.min(l.ivs[u],h[u]),Math.max(l.ivs[u],h[u]),.75))}if(o&&o(l),le.ENEMY_IVS_OVERRIDE!==null)if(Array.isArray(le.ENEMY_IVS_OVERRIDE)){if(le.ENEMY_IVS_OVERRIDE.length!==6)throw new Error("The Enemy IVs override must be an array of length 6 or a number!");if(le.ENEMY_IVS_OVERRIDE.some(h=>!Bn(h,0,31)))throw new Error("All IVs in the enemy IV override must be between 0 and 31!");l.ivs=le.ENEMY_IVS_OVERRIDE}else{if(!Bn(le.ENEMY_IVS_OVERRIDE,0,31))throw new Error("The Enemy IV override must be a value between 0 and 31!");l.ivs=new Array(6).fill(le.ENEMY_IVS_OVERRIDE)}return le.ENEMY_NATURE_OVERRIDE!==null&&(l.nature=le.ENEMY_NATURE_OVERRIDE),l.init(),l}removePokemonFromPlayerParty(e,t=!0){if(!e)return;const i=this.party.indexOf(e);this.party.splice(i,1),t&&(this.field.remove(e,!0),e.destroy()),this.updateModifiers(!0)}addPokemonIcon(e,t,i,n=.5,a=.5,r=!0,o=!1){const l=this.add.container(t,i);l.setName(`${e.name}-icon`);const h=this.add.sprite(0,0,e.getIconAtlasKey(r,o));if(h.setName(`sprite-${e.name}-icon`),h.setFrame(e.getIconId(r,o)),h.frame.name!==e.getIconId(r,o)){`${e.name}`;const u=e.shiny;e.shiny=!1,h.setTexture(e.getIconAtlasKey(r,o)),h.setFrame(e.getIconId(!0,o)),e.shiny=u}if(h.setOrigin(.5,0),l.add(h),e.isFusion(o)){const u=this.add.sprite(0,0,e.getFusionIconAtlasKey(r,o));u.setName("sprite-fusion-icon"),u.setOrigin(.5,0),u.setFrame(e.getFusionIconId(r,o));const p=h.width,f=h.height,d=h.frame,y=(h.frame.cutHeight<=u.frame.cutHeight?Math.ceil:Math.floor)((h.frame.cutHeight+u.frame.cutHeight)/4),g=`${h.frame.name}f${u.frame.name}`;h.frame.texture.has(g)||h.frame.texture.add(g,h.frame.sourceIndex,h.frame.cutX,h.frame.cutY,h.frame.cutWidth,y),h.setFrame(g),u.y=h.frame.cutHeight;const T=u.frame,E=u.frame.cutY+h.frame.cutHeight,b=u.frame.cutHeight-h.frame.cutHeight,_=`${u.frame.name}f${h.frame.name}`;u.frame.texture.has(_)||u.frame.texture.add(_,u.frame.sourceIndex,u.frame.cutX,E,u.frame.cutWidth,b),u.setFrame(_);const O=(d.y+T.y)/2;h.frame.y=u.frame.y=O,l.add(u),n!==.5&&(l.x-=p*(n-.5)),a!==0&&(l.y-=f*a)}else n!==.5&&(l.x-=h.width*(n-.5)),a!==0&&(l.y-=h.height*a);return l}setSeed(e){this.seed=e,this.rngCounter=0,this.waveCycleOffset=this.getGeneratedWaveCycleOffset(),this.offsetGym=this.gameMode.isClassic&&this.getGeneratedOffsetGym()}randBattleSeedInt(e,t=0){return this.currentBattle?.randSeedInt(e,t)}reset(e=!1,t=!1,i=!1){t&&(this.gameData=new Ba),this.gameMode=oa(ce.CLASSIC),this.disableMenu=!1,this.score=0,this.money=0,this.lockModifierTiers=!1,this.pokeballCounts=Object.fromEntries(Is(Si).filter(n=>n<=Si.MASTER_BALL).map(n=>[n,0])),this.pokeballCounts[Si.POKEBALL]+=5,le.POKEBALL_OVERRIDE.active&&(this.pokeballCounts=le.POKEBALL_OVERRIDE.pokeballs),this.modifiers=[],this.enemyModifiers=[],this.modifierBar.removeAll(!0),this.enemyModifierBar.removeAll(!0);for(const n of this.getPlayerParty())n.destroy();this.party=[];for(const n of this.getEnemyParty())n.destroy();if(this.currentBattle?.mysteryEncounter?.introVisuals&&this.field.remove(this.currentBattle.mysteryEncounter?.introVisuals,!0),this.currentBattle=null,this.setSeed(le.SEED_OVERRIDE||Ey(24)),this.seed,this.resetSeed(),this.biomeWaveText.setText(or.toString()),this.biomeWaveText.setVisible(!1),this.updateMoneyText(),this.moneyText.setVisible(!1),this.updateScoreText(),this.scoreText.setVisible(!1),[this.luckLabelText,this.luckText].forEach(n=>{n.setVisible(!1)}),this.newArena(le.STARTING_BIOME_OVERRIDE||Je.TOWN),this.field.setVisible(!0),this.arenaBgTransition.setPosition(0,0),this.arenaPlayer.setPosition(300,0),this.arenaPlayerTransition.setPosition(0,0),this.arenaEnemy.setPosition(-280,0),this.arenaNextEnemy.setPosition(-280,0),this.arenaNextEnemy.setVisible(!1),this.arena.init(),this.trainer.setTexture(`trainer_${this.gameData.gender===Be.FEMALE?"f":"m"}_back`),this.trainer.setPosition(406,186),this.trainer.setVisible(!0),this.mysteryEncounterSaveData=new Pi,this.updateGameInfo(),i){const n=[...it,...Fe,...Et,...Is(ei).map(a=>by(a)).flatMap(a=>Object.values(a).flat().map(r=>r.modifierType).filter(r=>"localize"in r&&typeof r.localize=="function"))];for(const a of n)a.localize()}e&&(this.initVariantData(),this.fadeOutBgm(250,!1),this.tweens.add({targets:[this.uiContainer],alpha:0,duration:250,ease:"Sine.easeInOut",onComplete:c(()=>{this.ui.freeUIData(),this.uiContainer.remove(this.ui,!0),this.uiContainer.destroy(),this.children.removeAll(!0),this.game.domContainer.innerHTML="",this.launchBattle()},"onComplete")}))}getDoubleBattleChance(e,t){const i=new Pt(e%10===0?32:8);this.applyModifiers(Iy,!0,i);for(const n of t)Oe("DoubleBattleChanceAbAttr",{pokemon:n,chance:i});return Math.max(i.value,1)}isNewBiome(e=this.currentBattle){const t=!(e.waveIndex%10),i=this.gameMode.hasShortBiomes||this.gameMode.isDaily,n=this.gameMode.hasShortBiomes&&e.waveIndex%5===0,a=e.waveIndex%50===49;return t||n||i&&a}newBattle(e,t,i,n,a){const r=le.STARTING_WAVE_OVERRIDE||or,o=e||(this.currentBattle?.waveIndex||r-1)+1;let l,h,u,p=null;this.resetSeed(o);const f=this.getPlayerField();if(this.gameMode.isFixedBattle(o)&&i===void 0)p=this.gameMode.getFixedBattle(o),l=p.double,h=p.battleType,this.executeWithSeedOffset(()=>u=p?.getTrainer(),(p.seedOffsetWaveIndex||o)<<8),u&&this.field.add(u);else{if(!this.gameMode.hasTrainers||le.BATTLE_TYPE_OVERRIDE===ue.WILD||le.DISABLE_STANDARD_TRAINERS_OVERRIDE&&ve(i)?h=ue.WILD:h=le.BATTLE_TYPE_OVERRIDE??t??(this.gameMode.isWaveTrainer(o,this.arena)?ue.TRAINER:ue.WILD),h===ue.TRAINER){const g=le.RANDOM_TRAINER_OVERRIDE?.trainerType??this.arena.randomTrainerType(o);let T=!1;Ei[g].doubleOnly?T=!0:Ei[g].hasDouble&&(T=le.RANDOM_TRAINER_OVERRIDE?.alwaysDouble||!Ve(this.getDoubleBattleChance(o,f)),Ei[g].trainerTypeDouble&&![D.TATE,D.LIZA].includes(g)&&(T=!1));const E=T?tt.DOUBLE:Ve(2)?tt.FEMALE:tt.DEFAULT;u=i!==void 0?i.toTrainer():new Zt(g,E),this.field.add(u)}!le.BATTLE_TYPE_OVERRIDE&&(this.isWaveMysteryEncounter(h,o)||h===ue.MYSTERY_ENCOUNTER)&&(h=ue.MYSTERY_ENCOUNTER,this.mysteryEncounterSaveData.encounterSpawnChance=cf)}if(n===void 0&&o>1?h===ue.WILD&&!this.gameMode.isWaveFinal(o)?l=!Ve(this.getDoubleBattleChance(o,f)):h===ue.TRAINER&&(l=u?.variant===tt.DOUBLE):p||(l=!!n),this.gameMode.isEndlessBoss(o)&&(l=!1),!ve(le.BATTLE_STYLE_OVERRIDE)){let g=null;switch(le.BATTLE_STYLE_OVERRIDE){case"double":g="double";break;case"single":g="single";break;case"even-doubles":g=o%2?"single":"double";break;case"odd-doubles":g=o%2?"double":"single";break}g==="double"&&(l=!0),h!==ue.TRAINER&&g==="single"&&(l=!1)}const d=this.currentBattle,y=this.getMaxExpLevel();if(this.lastEnemyTrainer=d?.trainer??null,this.lastMysteryEncounter=d?.mysteryEncounter,h===ue.MYSTERY_ENCOUNTER&&(l=!1),d?.double&&!l){this.phaseManager.tryRemovePhase(g=>g.is("SwitchPhase"));for(const g of this.getPlayerField())g.lapseTag(Xe.COMMANDED)}if(this.executeWithSeedOffset(()=>{this.currentBattle=new vy(this.gameMode,o,h,u,l)},o<<3,this.waveSeed),this.currentBattle.incrementTurn(),h===ue.MYSTERY_ENCOUNTER&&(this.currentBattle.mysteryEncounterType=a),!e&&d){const g=this.isNewBiome(d),T=g||[ue.TRAINER,ue.MYSTERY_ENCOUNTER].includes(this.currentBattle.battleType)||this.currentBattle.battleSpec===Ht.FINAL_BOSS;for(const E of this.getEnemyParty())E.destroy();if(this.trySpreadPokerus(),!g&&o%10===5&&this.arena.updatePoolsForTimeOfDay(),T){this.arena.resetArenaEffects();for(const E of f)E.lapseTag(Xe.COMMANDED);f.forEach((E,b)=>{E.isOnField()&&this.phaseManager.pushNew("ReturnPhase",b)});for(const E of this.getPlayerParty())E.resetBattleAndWaveData(),E.resetTera(),Oe("PostBattleInitAbAttr",{pokemon:E}),(E.hasSpecies(pe.TERAPAGOS)||this.gameMode.isClassic&&this.currentBattle.waveIndex>180&&this.currentBattle.waveIndex<=190)&&(this.arena.playerTerasUsed=0);this.trainer.visible||this.phaseManager.pushNew("ShowTrainerPhase")}for(const E of this.getPlayerParty())this.triggerPokemonFormChange(E,_y);!this.gameMode.hasRandomBiomes&&!g?this.phaseManager.pushNew("NextEncounterPhase"):(this.phaseManager.pushNew("NewBiomeEncounterPhase"),this.getMaxExpLevel()>y&&this.phaseManager.pushNew("LevelCapPhase"))}return this.currentBattle}newArena(e,t=0){return this.arena=new af(e,t),this.eventTarget.dispatchEvent(new Ay),this.arenaBg.pipelineData={terrainColorRatio:this.arena.getBgTerrainColorRatioForBiome()},this.arena}updateFieldScale(){return new Promise(e=>{const t=Math.floor(Math.pow(1/this.getField(!0).map(i=>i.getSpriteScale()).reduce((i,n)=>i=Math.max(n,i),0),.7)*40)/40;this.setFieldScale(t).then(()=>e())})}setFieldScale(e,t=!1){return new Promise(i=>{if(e*=6,this.field.scale===e)return i();const n=this.arenaBg.width*6,a=792,r=this.arenaBg.width*e,o=132*e;this.tweens.add({targets:this.field,scale:e,x:(n-r)/2,y:a-o,duration:t?0:ge(Math.abs(this.field.scale-e)*200),ease:"Sine.easeInOut",onComplete:c(()=>i(),"onComplete")})})}getSpeciesFormIndex(e,t,i,n){if(!e.forms?.length)return 0;const a=["EggLapsePhase","EggHatchPhase"].includes(this.phaseManager.getCurrentPhase()?.phaseName??"");if(!a&&this.currentBattle?.battleType===ue.TRAINER&&!ve(this.currentBattle.trainer)&&this.currentBattle.trainer.config.hasSpecialtyType()){if(e.speciesId===pe.WORMADAM)switch(this.currentBattle.trainer.config.specialtyType){case Se.GROUND:return 1;case Se.STEEL:return 2;case Se.GRASS:return 0}if(e.speciesId===pe.ROTOM)switch(this.currentBattle.trainer.config.specialtyType){case Se.FLYING:return 4;case Se.GHOST:return 0;case Se.FIRE:return 1;case Se.GRASS:return 5;case Se.WATER:return 2;case Se.ICE:return 3}if(e.speciesId===pe.ORICORIO)switch(this.currentBattle.trainer.config.specialtyType){case Se.GHOST:return 3;case Se.FIRE:return 0;case Se.ELECTRIC:return 1;case Se.PSYCHIC:return 2}if(e.speciesId===pe.PALDEA_TAUROS)switch(this.currentBattle.trainer.config.specialtyType){case Se.FIRE:return 1;case Se.WATER:return 2}if(e.speciesId===pe.SILVALLY||e.speciesId===pe.ARCEUS)return this.currentBattle.trainer.config.specialtyType}switch(e.speciesId){case pe.UNOWN:case pe.SHELLOS:case pe.GASTRODON:case pe.BASCULIN:case pe.DEERLING:case pe.SAWSBUCK:case pe.SCATTERBUG:case pe.SPEWPA:case pe.VIVILLON:case pe.FLABEBE:case pe.FLOETTE:case pe.FLORGES:case pe.FURFROU:case pe.PUMPKABOO:case pe.GOURGEIST:case pe.ORICORIO:case pe.MAGEARNA:case pe.ZARUDE:case pe.SQUAWKABILLY:case pe.TATSUGIRI:case pe.PALDEA_TAUROS:return Ve(e.forms.length);case pe.MAUSHOLD:case pe.DUDUNSPARCE:return Ve(4)?0:1;case pe.SINISTEA:case pe.POLTEAGEIST:case pe.POLTCHAGEIST:case pe.SINISTCHA:return Ve(16)?0:1;case pe.PIKACHU:return this.currentBattle?.battleType===ue.TRAINER&&this.currentBattle?.waveIndex<30?0:Ve(8);case pe.EEVEE:return this.currentBattle?.battleType===ue.TRAINER&&this.currentBattle?.waveIndex<30&&!a?0:Ve(2);case pe.FROAKIE:case pe.FROGADIER:case pe.GRENINJA:return this.currentBattle?.battleType===ue.TRAINER&&!a?0:Ve(2);case pe.URSHIFU:return Ve(2);case pe.ZYGARDE:return Ve(4);case pe.MINIOR:return Ve(7);case pe.ALCREMIE:return Ve(9);case pe.MEOWSTIC:case pe.INDEEDEE:case pe.BASCULEGION:case pe.OINKOLOGNE:return t===kt.FEMALE?1:0;case pe.TOXTRICITY:{const r=[_t.LONELY,_t.BOLD,_t.RELAXED,_t.TIMID,_t.SERIOUS,_t.MODEST,_t.MILD,_t.QUIET,_t.BASHFUL,_t.CALM,_t.GENTLE,_t.CAREFUL];return i!==void 0&&r.indexOf(i)>-1?1:0}case pe.GIMMIGHOUL:return this.gameMode.hasMysteryEncounters&&!a?1:Ve(e.forms.length)}if(n){switch(e.speciesId){case pe.BURMY:case pe.WORMADAM:case pe.ROTOM:case pe.LYCANROC:return Ve(e.forms.length)}return 0}return this.arena.getSpeciesFormIndex(e)}getGeneratedOffsetGym(){let e=!1;return this.executeWithSeedOffset(()=>{e=!Ve(2)},0,this.seed.toString()),e}getGeneratedWaveCycleOffset(){let e=0;return this.executeWithSeedOffset(()=>{e=Ve(8)*5},0,this.seed.toString()),e}getEncounterBossSegments(e,t,i,n=!1){if(le.ENEMY_HEALTH_SEGMENTS_OVERRIDE>1)return le.ENEMY_HEALTH_SEGMENTS_OVERRIDE;if(le.ENEMY_HEALTH_SEGMENTS_OVERRIDE===1)return 0;if(this.gameMode.isDaily&&this.gameMode.isWaveFinal(e))return 5;let a;if(n||i&&(i.subLegendary||i.legendary||i.mythical)?a=!0:this.executeWithSeedOffset(()=>{a=e%10===0||this.gameMode.hasRandomBosses&&Ve(100)<Math.min(Math.max(Math.ceil((e-250)/50),0)*2,30)},e<<2),!a)return 0;let r=2;return t>=100&&r++,i&&i.baseTotal>=670&&r++,r+=Math.floor(e/250),r}trySpreadPokerus(){const e=this.getPlayerParty(),t=[],i=c((n,a)=>{const r=e[n+a];!r.pokerus&&!Ve(10)&&(r.pokerus=!0,t.push(n+a))},"spread");e.forEach((n,a)=>{!n.pokerus||t.indexOf(a)>-1||this.executeWithSeedOffset(()=>{a&&i(a,-1),a<e.length-1&&i(a,1)},this.currentBattle.waveIndex+(a<<8))})}resetSeed(e){const t=e??this.currentBattle?.waveIndex??0;this.waveSeed=yp(this.seed,t),rs.Math.RND.sow([this.waveSeed]),this.waveSeed,this.rngCounter=0}executeWithSeedOffset(e,t,i){if(!e)return;const n=this.rngCounter,a=this.rngOffset,r=this.rngSeedOverride,o=rs.Math.RND.state();rs.Math.RND.sow([yp(i||this.seed,t)]),this.rngCounter=0,this.rngOffset=t,this.rngSeedOverride=i||"",e(),rs.Math.RND.state(o),this.rngCounter=n,this.rngOffset=a,this.rngSeedOverride=r}addFieldSprite(e,t,i,n,a=0){const r=this.add.sprite(e,t,i,n);return r.setPipeline(this.fieldSpritePipeline),a&&(r.pipelineData.terrainColorRatio=a),r}addPokemonSprite(e,t,i,n,a,r=!1,o=!1){const l=this.addFieldSprite(t,i,n,a);return this.initPokemonSprite(l,e,r,o),l}initPokemonSprite(e,t,i=!1,n=!1){return e.setPipeline(this.spritePipeline,{tone:[0,0,0,0],hasShadow:i,ignoreOverride:n,teraColor:t?nn(t.getTeraType()):void 0,isTerastallized:t?t.isTerastallized:!1}),this.spriteSparkleHandler.add(e),e}moveBelowOverlay(e){this.fieldUI.moveBelow(e,this.fieldOverlay)}processInfoButton(e){this.arenaFlyout.toggleFlyout(e)}showFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:.5,ease:"Sine.easeOut",duration:e,onComplete:c(()=>t(),"onComplete")})})}hideFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:c(()=>t(),"onComplete")})})}updateShopOverlayOpacity(e){this.shopOverlayOpacity=e,this.shopOverlayShown&&this.shopOverlay.setAlpha(this.shopOverlayOpacity)}showShopOverlay(e){return this.shopOverlayShown=!0,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:this.shopOverlayOpacity,ease:"Sine.easeOut",duration:e,onComplete:c(()=>t(),"onComplete")})})}hideShopOverlay(e){return this.shopOverlayShown=!1,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:c(()=>t(),"onComplete")})})}showEnemyModifierBar(){this.enemyModifierBar.setVisible(!0)}hideEnemyModifierBar(){this.enemyModifierBar.setVisible(!1)}updateBiomeWaveText(){const e=!(this.currentBattle.waveIndex%10),t=ea(this.arena.biomeType);this.fieldUI.moveAbove(this.biomeWaveText,this.luckText),this.biomeWaveText.setText(t+" - "+this.currentBattle.waveIndex.toString()),this.biomeWaveText.setColor(e?"#f89890":"#ffffff"),this.biomeWaveText.setShadowColor(e?"#984038":"#636363"),this.biomeWaveText.setVisible(!0)}updateMoneyText(e=!0){if(this.money===void 0)return;const t=gf(this.moneyFormat,this.money);this.moneyText.setText(m.t("battleScene:moneyOwned",{formattedMoney:t})),this.fieldUI.moveAbove(this.moneyText,this.luckText),e&&this.moneyText.setVisible(!0)}animateMoneyChanged(e){if(this.tweens.getTweensOf(this.moneyText).length>0)return;const t=this.moneyText.scale*.14*(e?1:-1);this.moneyText.setShadowColor(e?"#008000":"#FF0000"),this.tweens.add({targets:this.moneyText,duration:250,scale:this.moneyText.scale+t,loop:0,yoyo:!0,onComplete:c(i=>this.moneyText.setShadowColor(He(A.MONEY,!0)),"onComplete")})}updateScoreText(){this.scoreText.setText(`Score: ${this.score.toString()}`),this.scoreText.setVisible(this.gameMode.isDaily)}updateAndShowText(e){const t=[this.luckLabelText,this.luckText];for(const n of t)n.setAlpha(0);const i=Tp(this.getPlayerParty());this.luckText.setText(mf(i)),i<14?this.luckText.setTint(yf(i)):this.luckText.setTint(16772956,4718441,7039999,16738665),this.luckLabelText.setX(this.scaledCanvas.width-2-(this.luckText.displayWidth+2)),this.tweens.add({targets:t,duration:e,alpha:1,onComplete:c(()=>{for(const n of t)n.setVisible(!0)},"onComplete")})}hideLuckText(e){if(this.reroll)return;const t=[this.luckLabelText,this.luckText];this.tweens.add({targets:t,duration:e,alpha:0,onComplete:c(()=>{for(const i of t)i.setVisible(!1)},"onComplete")})}updateUIPositions(){const e=this.enemyModifiers.filter(n=>n.isIconVisible()).length,t=this.biomeWaveText.getBottomLeft().y-this.biomeWaveText.getTopLeft().y;this.biomeWaveText.setY(-this.scaledCanvas.height+(e?e<=12?15:24:0)+t/2),this.moneyText.setY(this.biomeWaveText.y+10),this.scoreText.setY(this.moneyText.y+10),[this.luckLabelText,this.luckText].map(n=>n.setY((this.scoreText.visible?this.scoreText:this.moneyText).y+10));const i=(this.scoreText.visible?this.scoreText:this.moneyText).y+15;this.partyExpBar.setY(i),this.candyBar.setY(i+15),this.ui?.achvBar.setY(this.scaledCanvas.height+i)}sendTextToBack(){this.fieldUI.sendToBack(this.biomeWaveText),this.fieldUI.sendToBack(this.moneyText),this.fieldUI.sendToBack(this.scoreText)}addFaintedEnemyScore(e){let t=e.getSpeciesForm().getBaseExp()*(e.level/this.getMaxExpLevel())*(e.ivs.reduce((i,n)=>n+=i,0)/93*.2+.8);this.findModifiers(i=>i instanceof ls&&i.pokemonId===e.id,!1).map(i=>t*=i.getScoreMultiplier()),e.isBoss()&&(t*=Math.sqrt(e.bossSegments)),this.currentBattle.battleScore+=Math.ceil(t)}getMaxExpLevel(e=!1){const t=le.LEVEL_CAP_OVERRIDE??0;if(t>0)return t;if(e||t<0)return Number.MAX_SAFE_INTEGER;const i=Math.ceil((this.currentBattle?.waveIndex||1)/10)*10,n=this.gameMode.getWaveForDifficulty(i),a=(1+n/2+Math.pow(n/25,2))*1.2;return Math.ceil(a/2)*2+2}randomSpecies(e,t,i,n,a){if(i)return this.arena.randomSpecies(e,t,void 0,Tp(this.party));const r=n?[...new Set(it.filter(o=>o.isCatchable()).filter(n).map(o=>{if(!a)for(;wt.hasOwnProperty(o.speciesId);)o=ns(wt[o.speciesId]);return o}))]:it.filter(o=>o.isCatchable());return r[Ve(r.length)]}generateRandomBiome(e){const t=e%250,i=Is(Je).filter(h=>h!==Je.TOWN&&h!==Je.END),n=lr[Je.END][0]-2,a=new Array(n+1).fill(null).map((h,u)=>(1-Math.min(Math.abs(u/(n-1)-t/250)+.25,1))/.75*250),r=[];let o=0;for(const h of i)o+=Math.ceil(a[lr[h][0]-1]/lr[h][1]),r.push(o);const l=Ve(o);for(let h=0;h<i.length;h++)if(l<r[h])return i[h];return i[Ve(i.length)]}isBgmPlaying(){return this.bgm?.isPlaying??!1}playBgm(e,t){if(e===void 0&&(e=this.currentBattle?.getBgmOverride()||this.arena?.bgm),e=fh.getEventBgmReplacement(e),this.bgm&&e===this.bgm.key){this.bgm.isPlaying||this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}t&&!this.bgm&&(t=!1),this.bgmCache.add(e),this.loadBgm(e);let i=0;i=e===this.arena.bgm?this.arena.getBgmLoopPoint():this.getBgmLoopPoint(e);let n=!1;const a=c(()=>{if(this.ui.bgmBar.setBgmToBgmBar(e),e===null&&this.bgm&&!this.bgm.pendingRemove){this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=this.sound.add(e,{loop:!0}),this.bgm.play({volume:this.masterVolume*this.bgmVolume}),i&&this.bgm.on("looped",()=>this.bgm.play({seek:i}))},"playNewBgm");if(this.load.once(rs.Loader.Events.COMPLETE,()=>{n=!0,(!t||!this.bgm.isPlaying)&&a()}),t){const r=c(()=>{n&&(!this.bgm.isPlaying||this.bgm.pendingRemove)&&a()},"onBgmFaded");this.time.delayedCall(this.fadeOutBgm(500,!0)?750:250,r)}this.load.isLoading()||this.load.start()}pauseBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying?(this.bgm.pause(),!0):!1}resumeBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPaused?(this.bgm.resume(),!0):!1}updateSoundVolume(){if(this.sound)for(const e of this.sound.getAllPlaying())if(this.bgmCache.has(e.key))e.setVolume(this.masterVolume*this.bgmVolume);else{const t=e.key.split("/");switch(t[0]){case"battle_anims":case"cry":t[1].startsWith("PRSFX- ")?e.setVolume(this.masterVolume*this.fieldVolume*.5):e.setVolume(this.masterVolume*this.fieldVolume);break;case"se":case"ui":e.setVolume(this.masterVolume*this.seVolume)}}}fadeOutBgm(e=500,t=!0){return this.bgm&&this.sound.getAllPlaying().find(n=>n.key===this.bgm.key)?(Os.fadeOut(this,this.bgm,e,t),!0):!1}fadeAndSwitchBgm(e,t=!1,i=2e3){this.fadeOutBgm(i,t),this.time.delayedCall(i,()=>{this.playBgm(e)})}playSound(e,t){const i=typeof e=="string"?e:e.key;t=t??{};try{const n=i.split("/");switch(t.volume=t.volume??1,n[0]){case"level_up_fanfare":case"item_fanfare":case"minor_fanfare":case"heal":case"evolution":case"evolution_fanfare":t.volume*=this.masterVolume*this.bgmVolume;break;case"battle_anims":case"cry":t.volume*=this.masterVolume*this.fieldVolume,n[1].startsWith("PRSFX- ")&&(t.volume*=.5);break;case"ui":t.volume*=this.masterVolume*this.uiVolume;break;case"se":t.volume*=this.masterVolume*this.seVolume;break}return this.sound.play(i,t),this.sound.get(i)}catch{return e}}playSoundWithoutBgm(e,t){this.bgmCache.add(e);const i=this.pauseBgm();this.playSound(e);const n=this.sound.get(e);return this.bgmResumeTimer&&this.bgmResumeTimer.destroy(),i&&(this.bgmResumeTimer=this.time.delayedCall(t||ge(n.totalDuration*1e3),()=>{this.resumeBgm(),this.bgmResumeTimer=null})),n}getBgmLoopPoint(e){switch(e){case"title":return 46.5;case"battle_kanto_champion":return 13.95;case"battle_johto_champion":return 23.498;case"battle_hoenn_champion_g5":return 11.328;case"battle_hoenn_champion_g6":return 11.762;case"battle_sinnoh_champion":return 12.235;case"battle_champion_alder":return 27.653;case"battle_champion_iris":return 10.145;case"battle_kalos_champion":return 10.38;case"battle_champion_kukui":return 15.784;case"battle_alola_champion":return 13.025;case"battle_galar_champion":return 61.635;case"battle_mustard":return 22.442;case"battle_champion_geeta":return 37.447;case"battle_champion_nemona":return 14.914;case"battle_champion_kieran":return 7.206;case"battle_hoenn_elite":return 11.35;case"battle_unova_elite":return 17.73;case"battle_kalos_elite":return 12.34;case"battle_alola_elite":return 19.212;case"battle_galar_elite":return 164.069;case"battle_paldea_elite":return 12.77;case"battle_bb_elite":return 19.434;case"battle_final_encounter":return 19.159;case"battle_final":return 16.453;case"battle_kanto_gym":return 13.857;case"battle_johto_gym":return 12.911;case"battle_hoenn_gym":return 12.379;case"battle_sinnoh_gym":return 13.122;case"battle_unova_gym":return 19.145;case"battle_kalos_gym":return 44.81;case"battle_galar_gym":return 171.262;case"battle_paldea_gym":return 127.489;case"battle_legendary_kanto":return 32.966;case"battle_legendary_raikou":return 12.632;case"battle_legendary_entei":return 2.905;case"battle_legendary_suicune":return 12.636;case"battle_legendary_lugia":return 19.77;case"battle_legendary_ho_oh":return 17.668;case"battle_legendary_regis_g5":return 49.5;case"battle_legendary_regis_g6":return 21.13;case"battle_legendary_gro_kyo":return 10.547;case"battle_legendary_rayquaza":return 10.495;case"battle_legendary_deoxys":return 13.333;case"battle_legendary_lake_trio":return 16.887;case"battle_legendary_sinnoh":return 22.77;case"battle_legendary_dia_pal":return 16.009;case"battle_legendary_origin_forme":return 18.961;case"battle_legendary_giratina":return 10.451;case"battle_legendary_arceus":return 9.595;case"battle_legendary_unova":return 13.855;case"battle_legendary_kyurem":return 18.314;case"battle_legendary_res_zek":return 18.329;case"battle_legendary_xern_yvel":return 26.468;case"battle_legendary_tapu":return 0;case"battle_legendary_sol_lun":return 6.525;case"battle_legendary_ub":return 9.818;case"battle_legendary_dusk_dawn":return 5.211;case"battle_legendary_ultra_nec":return 10.344;case"battle_legendary_zac_zam":return 11.424;case"battle_legendary_glas_spec":return 12.503;case"battle_legendary_calyrex":return 50.641;case"battle_legendary_riders":return 18.155;case"battle_legendary_birds_galar":return .175;case"battle_legendary_paradox":return 6.442;case"battle_legendary_ruinous":return 6.333;case"battle_legendary_kor_mir":return 26.05;case"battle_legendary_loyal_three":return 6.5;case"battle_legendary_ogerpon":return 14.335;case"battle_legendary_terapagos":return 24.377;case"battle_legendary_pecharunt":return 6.508;case"battle_rival":return 14.11;case"battle_rival_2":return 17.714;case"battle_rival_3":return 17.586;case"battle_trainer":return 13.686;case"battle_wild":return 12.703;case"battle_wild_strong":return 13.94;case"end_summit":return 30.025;case"battle_rocket_grunt":return 12.707;case"battle_aqua_magma_grunt":return 12.062;case"battle_galactic_grunt":return 13.043;case"battle_plasma_grunt":return 14.758;case"battle_flare_grunt":return 4.228;case"battle_aether_grunt":return 16;case"battle_skull_grunt":return 20.87;case"battle_macro_grunt":return 11.56;case"battle_star_grunt":return 133.362;case"battle_galactic_admin":return 11.997;case"battle_colress":return 12.234;case"battle_skull_admin":return 15.463;case"battle_oleana":return 14.11;case"battle_star_admin":return 9.493;case"battle_rocket_boss":return 9.115;case"battle_aqua_magma_boss":return 14.847;case"battle_galactic_boss":return 106.962;case"battle_plasma_boss":return 25.624;case"battle_flare_boss":return 8.085;case"battle_aether_boss":return 11.33;case"battle_skull_boss":return 13.13;case"battle_macro_boss":return 11.42;case"battle_star_boss":return 25.764;case"mystery_encounter_gen_5_gts":return 8.52;case"mystery_encounter_gen_6_gts":return 9.24;case"mystery_encounter_fun_and_games":return 4.78;case"mystery_quiz_time":return 4.78;case"Battle_Mystery_Monster":return .01;case"Battle_against_demonstery":return .01;case"Battle_against_M.N.O_248 & M.N.O_248_2.0":return .01;case"Kecleon_Shop":return .01;case"Stop!_Thief!":return .01;case"monster_house":return .01;case"mystery_encounter_weird_dream":return 41.42;case"mystery_encounter_delibirdy":return 82.28;case"title_afd":return 47.66;case"battle_rival_3_afd":return 49.147}return 0}toggleInvert(e){e?this.cameras.main.setPostPipeline(oT):this.cameras.main.removePostPipeline("InvertPostFX")}addMoney(e){this.money=Math.min(this.money+e,Number.MAX_SAFE_INTEGER),this.updateMoneyText(),this.animateMoneyChanged(!0),this.validateAchvs(xy)}getWaveMoneyAmount(e){const t=this.currentBattle.waveIndex,i=Math.ceil(t/10)-1,n=Math.pow((i+1+(.75+((t-1)%10+1)/10))*100,1+.005*i)*e;return Math.floor(n/10)*10}addModifier(e,t,i,n,a,r){if(!e||!e.type)return!1;let o=!1;const l=e.type.soundName;this.validateAchvs(Oy,e);const h=[];if(e instanceof $n){if(e.add(this.modifiers,!!n)){if(e instanceof Ln){const u=this.getPokemonById(e.pokemonId);u&&(o=e.apply(u,!0))}i&&!this.sound.get(l)&&this.playSound(l)}else if(!n){const u=wy(e.type.tier);return this.phaseManager.queueMessage(m.t("battle:itemStackFull",{fullItemName:e.type.name,itemName:u.name}),void 0,!1,3e3),this.addModifier(u.newModifier(),t,i,!1,a)}for(const u of h)this.removeModifier(u);!t&&!n&&this.updateModifiers(!0,a)}else if(e instanceof My)if(i&&!this.sound.get(l)&&this.playSound(l),e instanceof Ny){for(const u in this.party){const p=this.party[u],f=[];if(e instanceof ky)if(e.fainted)f.push(1);else{const d=new Pt(1);this.applyModifiers(uf,!0,d),f.push(d.value)}else e instanceof Py?f.push(this.getPokemonById(e.fusePokemonId)):e instanceof By&&!ve(r)&&f.push(r);if(e.shouldApply(p,...f)){const d=e.apply(p,...f);o||=d}}this.party.forEach(u=>{u.updateInfo(a)})}else{const u=[this];if(e.shouldApply(...u)){const p=e.apply(...u);o||=p}}return o}addEnemyModifier(e,t,i){return new Promise(n=>{if(!e)return n();const a=[];if(e.add(this.enemyModifiers,!1)){if(e instanceof Ln){const r=this.getPokemonById(e.pokemonId);r&&e.apply(r,!0)}for(const r of a)this.removeModifier(r,!0)}t||this.updateModifiers(!1,i),n()})}tryTransferHeldItemModifier(e,t,i,n=1,a,r,o=!0){const l=e.pokemonId?e.getPokemon():null,h=new ot(!1);if(l&&l.isPlayer()!==t.isPlayer()&&Oe("BlockItemTheftAbAttr",{pokemon:l,cancelled:h}),h.value)return!1;const u=e.clone();u.pokemonId=t.id;const p=this.findModifier(d=>d instanceof ls&&d.matchType(e)&&d.pokemonId===t.id,t.isPlayer());if(p){const d=p.getMaxStackCount();if(p.stackCount>=d)return!1;const y=Math.min(n,e.stackCount,d-p.stackCount);e.stackCount-=y,u.stackCount=p.stackCount+y}else{const d=Math.min(n,e.stackCount);e.stackCount-=d,u.stackCount=d}if(!(e.stackCount===0)||!l||this.removeModifier(e,l.isEnemy())){const d=c(()=>!p||this.removeModifier(p,t.isEnemy())?t.isPlayer()?(this.addModifier(u,r,i,!1,a),l&&o&&Oe("PostItemLostAbAttr",{pokemon:l}),!0):(this.addEnemyModifier(u,r,a),l&&o&&Oe("PostItemLostAbAttr",{pokemon:l}),!0):!1,"addModifier");return l&&l.isPlayer()!==t.isPlayer()&&!r&&this.updateModifiers(l.isPlayer(),a),d(),!0}return!1}tryDiscardHeldItemModifier(e,t=1){const i=Math.min(t,e.stackCount);return e.stackCount-=i,e.stackCount>0?!0:this.removeModifier(e)}canTransferHeldItemModifier(e,t,i=1){const n=e.clone(),a=n.pokemonId?n.getPokemon():null,r=new ot(!1);if(a&&a.isPlayer()!==t.isPlayer()&&Oe("BlockItemTheftAbAttr",{pokemon:a,cancelled:r}),r.value)return!1;const o=this.findModifier(h=>h instanceof ls&&h.matchType(n)&&h.pokemonId===t.id,t.isPlayer());if(o){const h=o.getMaxStackCount();if(o.stackCount>=h)return!1;const u=Math.min(i,n.stackCount,h-o.stackCount);n.stackCount-=u}else{const h=Math.min(i,n.stackCount);n.stackCount-=h}return!(n.stackCount===0)||!a||this.hasModifier(e,!a.isPlayer())}removePartyMemberModifiers(e){return new Promise(t=>{const i=this.getPlayerParty()[e].id,n=this.modifiers.filter(a=>a instanceof ls&&a.pokemonId===i);for(const a of n)this.modifiers.splice(this.modifiers.indexOf(a),1);this.updateModifiers(),t()})}generateEnemyModifiers(e){return new Promise(t=>{if(this.currentBattle.battleSpec===Ht.FINAL_BOSS)return t();const i=this.gameMode.getWaveForDifficulty(this.currentBattle.waveIndex),n=this.gameMode.isWaveFinal(this.currentBattle.waveIndex);let a=Math.ceil(i/10);n&&(a=Math.ceil(a*2.5));const r=this.getEnemyParty();if(this.currentBattle.trainer){const o=this.currentBattle.trainer.genModifiers(r);for(const l of o)this.addEnemyModifier(l,!0,!0)}r.forEach((o,l)=>{if(e&&l<e.length&&e[l])for(const h of e[l]){let u;h.modifier instanceof Ly?u=h.modifier.newModifier(o):(u=h.modifier,u.pokemonId=o.id),u.stackCount=h.stackCount??1,u.isTransferable=h.isTransferable??u.isTransferable,this.addEnemyModifier(u,!0)}else{const h=o.isBoss()||this.currentBattle.battleType===ue.TRAINER&&!!this.currentBattle.trainer?.config.isBoss;let u=32;h&&(u/=2),n&&(u/=8);let p=0;for(let f=0;f<a;f++)Ve(this.gameMode.getEnemyModifierChance(h))||p++;h&&(p=Math.max(p,Math.floor(a/2))),Dy(i,p,[o],this.currentBattle.battleType===ue.TRAINER?ei.TRAINER:ei.WILD,u).map(f=>f.newModifier(o).add(this.enemyModifiers,!1))}return!0}),this.updateModifiers(!1),t()})}clearEnemyModifiers(){const e=this.enemyModifiers.filter(t=>t instanceof $n);for(const t of e)this.enemyModifiers.splice(this.enemyModifiers.indexOf(t),1);this.updateModifiers(!1),this.updateUIPositions()}clearEnemyHeldItemModifiers(e){const t=this.enemyModifiers.filter(i=>i instanceof ls&&(!e||i.getPokemon()===e));for(const i of t)this.enemyModifiers.splice(this.enemyModifiers.indexOf(i),1);this.updateModifiers(!1),this.updateUIPositions()}setModifiersVisible(e){[this.modifierBar,this.enemyModifierBar].map(t=>t.setVisible(e))}updateModifiers(e=!0,t){const i=e?this.modifiers:this.enemyModifiers;for(let a=0;a<i.length;a++){const r=i[a];r instanceof ls&&!this.getPokemonById(r.pokemonId)&&i.splice(a--,1),r instanceof ls&&!ve(r.getSpecies())&&!this.getPokemonById(r.pokemonId)?.hasSpecies(r.getSpecies())&&i.splice(a--,1)}for(const a of i)a instanceof $n&&(a.virtualStackCount=0);const n=i.slice(0);for(const a of n)a.getStackCount()||i.splice(i.indexOf(a),1);this.updatePartyForModifiers(e?this.getPlayerParty():this.getEnemyParty(),t),(e?this.modifierBar:this.enemyModifierBar).updateModifiers(i),e||this.updateUIPositions()}updatePartyForModifiers(e,t){return new Promise(i=>{Promise.allSettled(e.map(n=>(n.calculateStats(),n.updateInfo(t)))).then(()=>i())})}hasModifier(e,t=!1){return(t?this.enemyModifiers:this.modifiers).indexOf(e)>-1}removeModifier(e,t=!1){const i=t?this.enemyModifiers:this.modifiers,n=i.indexOf(e);if(n>-1){if(i.splice(n,1),e instanceof Ln){const a=this.getPokemonById(e.pokemonId);a&&e.apply(a,!1)}return!0}return!1}getModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(i=>i instanceof e)}findModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(e)}findModifier(e,t=!0){return(t?this.modifiers:this.enemyModifiers).find(e)}applyShuffledModifiers(e,t=!0,...i){let n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.executeWithSeedOffset(()=>{const a=c(r=>{if(r.length<1)return r;const o=Ve(r.length);return[r[o],...a(r.filter((l,h)=>h!==o))]},"shuffleModifiers");n=a(n)},this.currentBattle.turn<<4,this.waveSeed),this.applyModifiersInternal(n,t,i)}applyModifiers(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.applyModifiersInternal(n,t,i)}applyModifiersInternal(e,t,i){const n=[];for(const a of e)a.apply(...i)&&(a.type.name,n.push(a));return n}applyModifier(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));for(const a of n)if(a.apply(...i))return a.type.name,a;return null}triggerPokemonFormChange(e,t,i=!1,n=!1){if(ai.hasOwnProperty(e.species.speciesId)){const a=ai[e.species.speciesId].filter(o=>o.findTrigger(t)&&o.canChange(e));let r;if(e.species.speciesId===pe.NECROZMA&&a.length>1){const o=this.findModifiers(l=>l instanceof Ln&&l.pokemonId===e.id).filter(l=>l.active).map(l=>l.formChangeItem);r=o.includes(Sp.N_LUNARIZER)?a[0]:o.includes(Sp.N_SOLARIZER)?a[1]:null}else r=a[0];if(r){let o;return e.isPlayer()&&!r.quiet?o=this.phaseManager.create("FormChangePhase",e,r,n):o=this.phaseManager.create("QuietFormChangePhase",e,r),e.isPlayer()&&!r.quiet&&n?this.phaseManager.overridePhase(o):i?this.phaseManager.pushPhase(o):this.phaseManager.unshiftPhase(o),!0}}return!1}triggerPokemonBattleAnim(e,t,i,n=!1){const a=this.phaseManager,r=a.create("PokemonAnimPhase",t,e,i);return n?a.pushPhase(r):a.unshiftPhase(r),!0}validateAchvs(e,...t){const i=Object.values(Pe).filter(n=>n instanceof e);for(const n of i)this.validateAchv(n,t)}validateAchv(e,t){return(!this.gameData.achvUnlocks.hasOwnProperty(e.id)||le.ACHIEVEMENTS_REUNLOCK_OVERRIDE)&&e.validate(t)?(this.gameData.achvUnlocks[e.id]=Date.now(),this.ui.achvBar.showAchv(e),Ft.hasOwnProperty(e.id)&&this.validateVoucher(Ft[e.id]),!0):!1}validateVoucher(e,t){return!this.gameData.voucherUnlocks.hasOwnProperty(e.id)&&e.validate(t)?(this.gameData.voucherUnlocks[e.id]=Date.now(),this.ui.achvBar.showAchv(e),this.gameData.voucherCounts[e.voucherType]++,!0):!1}updateGameInfo(){const e={playTime:this.sessionPlayTime??0,gameMode:this.currentBattle?this.gameMode.getName():"Title",biome:this.currentBattle?ea(this.arena.biomeType):"",wave:this.currentBattle?.waveIndex??0,party:this.party?.map(t=>({name:t.name,form:t.getFormKey(),types:t.getTypes().map(i=>Se[i]),teraType:Se[t.getTeraType()],isTerastallized:t.isTerastallized,level:t.level,currentHP:t.hp,maxHP:t.getMaxHp(),status:t.status?.effect?Yt[t.status.effect]:""}))??[],modeChain:this.ui?.getModeChain()??[]};window.gameInfo=e}getActiveKeys(){const e=[];let t=this.getPlayerParty();t=t.concat(this.getEnemyParty());for(const i of t)e.push(i.getSpriteKey(!0)),i.isPlayer()&&e.push(i.getBattleSpriteKey(!0,!0)),e.push(i.species.getCryKey(i.formIndex)),i.fusionSpecies&&e.push(i.fusionSpecies.getCryKey(i.fusionFormIndex));return e}initFinalBossPhaseTwo(e){if(e.isEnemy()&&e.isBoss()&&!e.formIndex&&e.bossSegmentIndex<1){this.fadeOutBgm(ge(2e3),!1),this.ui.showDialogue(sf[Ht.FINAL_BOSS].firstStageWin,e.species.name,void 0,()=>{const t=nf(st.MINI_BLACK_HOLE).newModifier(e);t.setTransferrableFalse(),this.addEnemyModifier(t,!1,!0),e.generateAndPopulateMoveset(1),this.setFieldScale(.75),this.triggerPokemonFormChange(e,Ry,!1),this.currentBattle.double=!0;const i=this.getPlayerParty().filter(n=>n.isAllowedInBattle());i.length>1&&(this.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||this.phaseManager.pushNew("SummonPhase",1)),this.phaseManager.shiftPhase()});return}this.phaseManager.shiftPhase()}applyPartyExp(e,t,i,n){const a=n??this.currentBattle.playerParticipantIds,r=this.getPlayerParty(),o=this.findModifier(f=>f instanceof Fy),l=this.findModifier(f=>f instanceof Uy),h=r.filter(f=>f.hp),u=h.filter(f=>f.level<this.getMaxExpLevel()),p=[];if(i&&(e=Math.floor(e*this.currentBattle.waveIndex/5+1)),a.size>0){this.currentBattle.battleType===ue.TRAINER||this.currentBattle.mysteryEncounter?.encounterMode===hs.TRAINER_BATTLE?e=Math.floor(e*1.5):this.currentBattle.isBattleMysteryEncounter()&&this.currentBattle.mysteryEncounter&&(e=Math.floor(e*this.currentBattle.mysteryEncounter.expMultiplier));for(const f of h){const d=f.id,y=a.has(d);if(y&&t){f.addFriendship(Vy);const E=f.getHeldItems().find(B=>B instanceof Hy);E&&E.stackCount<E.getMaxStackCount()&&(E.stackCount++,this.updateModifiers(!0,!0),f.updateInfo());const b=f.getHeldItems().find(B=>B instanceof Yy);if(b&&b.getStackCount()<b.getMaxHeldItemCount()&&(b.incrementStackCount(),typeof battleContext<"u"&&typeof lastUsedMove<"u"&&lastUsedMove)){const B=b.applyMovePowerBoost(lastUsedMove,f,lastOpponent||null,lastUsedMove.getBasePower(),battleContext);`${lastUsedMove.getBasePower()}${B}${b.getStackCount()}`}const _=f.getHeldItems().find(B=>B instanceof Gy);_&&_.stackCount<_.getMaxHeldItemCount()&&(_.stackCount++,`${_.stackCount}`,typeof battleContext<"u"&&typeof lastOpponent<"u"&&lastOpponent&&[Stat.DEF,Stat.SPDEF].forEach(K=>{const V=f.getStatHolder(K);V&&(_.apply(f,K,V),`${K}${V.value}${_.stackCount}`)}));const O=f.getHeldItems().find(B=>B instanceof Wy);O&&O.stackCount<O.getMaxHeldItemCount()&&(O.stackCount++,`${O.stackCount}`);const w=f.getHeldItems().find(B=>B instanceof Ky);w&&w.stackCount<w.getMaxHeldItemCount()&&(w.stackCount++,`${w.stackCount}`);const U=f.getHeldItems().find(B=>B instanceof zy);U&&U.stackCount<U.getMaxHeldItemCount()&&(U.stackCount++,`${U.stackCount}`),this.updateModifiers(!0,!0),f.updateInfo()}if(!u.includes(f))continue;if(!y&&!o){p.push(0);continue}let g=0;y?g+=1/a.size:o&&(g+=o.getStackCount()*.2/a.size),f.pokerus&&(g*=1.5),le.XP_MULTIPLIER_OVERRIDE!==null&&(g=le.XP_MULTIPLIER_OVERRIDE);const T=new Pt(e*g);this.applyModifiers(jy,!0,f,T),p.push(Math.floor(T.value))}if(l){let f=0,d=0;u.forEach((E,b)=>{d+=p[b],f+=E.level});const y=Math.floor(f/u.length),g=[];u.forEach((E,b)=>{E.level<=y&&g.push(b)});const T=Math.floor(d/g.length);u.forEach((E,b)=>{p[b]=rs.Math.Linear(p[b],g.indexOf(b)>-1?T:0,.2*l.getStackCount())})}for(let f=0;f<u.length;f++){const d=p[f];if(d){const y=r.indexOf(u[f]);this.phaseManager.unshiftPhase(u[f].isOnField()?this.phaseManager.create("ExpPhase",y,d):this.phaseManager.create("ShowPartyExpBarPhase",y,d))}}}}isMysteryEncounterValidForWave(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();return this.gameMode.hasMysteryEncounters&&e===ue.WILD&&!this.gameMode.isBoss(t)&&t%10!==1&&t<n&&t>i}isWaveMysteryEncounter(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();if(this.isMysteryEncounterValidForWave(e,t)){const a=this.mysteryEncounterSaveData.encounterSpawnChance,r=this.mysteryEncounterSaveData.encounteredEvents,l=qy/(n-i)*(t-i)-r.length,h=a+Math.min(l*Qy,hr/2),u=le.MYSTERY_ENCOUNTER_RATE_OVERRIDE??h;if(r.length===0||t-r[r.length-1].waveIndex>3||le.MYSTERY_ENCOUNTER_RATE_OVERRIDE!==null){let f=hr;return this.executeWithSeedOffset(()=>{f=Ve(hr)},t*3*1e3),f<u}}return!1}getMysteryEncounter(e,t){let i;if(!ve(le.MYSTERY_ENCOUNTER_OVERRIDE)&&Rs.hasOwnProperty(le.MYSTERY_ENCOUNTER_OVERRIDE)){if(i=Rs[le.MYSTERY_ENCOUNTER_OVERRIDE],t)return i}else{if(t)return i=Rs[e??-1],i;i=ve(e)?null:Rs[e]}if(!i&&this.mysteryEncounterSaveData?.queuedEncounters&&this.mysteryEncounterSaveData.queuedEncounters.length>0){let g=0;for(;g<this.mysteryEncounterSaveData.queuedEncounters.length&&i;){const T=this.mysteryEncounterSaveData.queuedEncounters[g],E=T.spawnPercent;Ve(100)<E&&(i=Rs[T.type]),g++}}if(i)return i=new Cp(i),i.populateDialogueTokensFromRequirements(),i;const n=[ft.COMMON,ft.GREAT,ft.ULTRA,ft.ROGUE];for(const g of this.mysteryEncounterSaveData.encounteredEvents)g.tier===ft.COMMON?n[0]=n[0]-6:g.tier===ft.GREAT&&(n[1]=n[1]-4);const a=n.reduce((g,T)=>g+T),r=Ve(a),o=a-n[0],l=a-n[0]-n[1],h=a-n[0]-n[1]-n[2];let u=r>o?ft.COMMON:r>l?ft.GREAT:r>h?ft.ULTRA:ft.ROGUE;ve(le.MYSTERY_ENCOUNTER_TIER_OVERRIDE)||(u=le.MYSTERY_ENCOUNTER_TIER_OVERRIDE);let p=[];const f=this.mysteryEncounterSaveData.encounteredEvents.length>0?this.mysteryEncounterSaveData.encounteredEvents[this.mysteryEncounterSaveData.encounteredEvents.length-1].type:null,d=this.eventManager.getEventMysteryEncountersDisabled(),y=$y.get(this.arena.biomeType)?.filter(g=>!d.includes(g))??[];for(;p.length===0&&u!==null;)p=y.filter(g=>{const T=Rs[g];if(!T||this.eventManager.getMysteryEncounterTierForEvent(g,T.encounterTier)!==u)return!1;const E=T.disallowedGameModes;return E&&E.length>0&&E.includes(this.gameMode.modeId)||T.disallowedChallenges?.some(b=>this.gameMode.hasChallenge(b))||!T.meetsRequirements()||f!==null&&g===f?!1:!(this.mysteryEncounterSaveData.encounteredEvents.length>0&&T.maxAllowedEncounters&&T.maxAllowedEncounters>0&&this.mysteryEncounterSaveData.encounteredEvents.filter(b=>b.type===g).length>=T.maxAllowedEncounters)}).map(g=>Rs[g]),u===ft.ROGUE?u=ft.ULTRA:u===ft.ULTRA?u=ft.GREAT:u===ft.GREAT?u=ft.COMMON:u=null;return p.length===0?Rs[Xy.MYSTERIOUS_CHALLENGERS]:(i=p[Ve(p.length)],i=new Cp(i),i.populateDialogueTokensFromRequirements(),i)}};c(Yd,"BattleScene");let Wp=Yd;export{Wp as BattleScene};
